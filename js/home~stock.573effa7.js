(window.webpackJsonp=window.webpackJsonp||[]).push([["home~stock"],{"3db9":function(t,e,n){"use strict";e.a={get:function(t){var e=new XMLHttpRequest;e.open("get",t.url),e.responseType=t.responseType||"text",t.onprogress&&(e.onprogress=function(e){var n;e.lengthComputable?(n=e.loaded/e.total,t.onprogress(n,e.loaded,e.total)):t.onprogress(null)}),e.onload=function(n){400<=e.status?t.onerror&&t.onerror():t.onload&&t.onload(e.response)},t.onerror&&(e.onerror=t.onerror),e.send(null)}}},"620a":function(t,e,n){"use strict";(function(t){var r,i=n("3db9"),o={supportWebGL:function(){if(null==r)try{var t=document.createElement("canvas");if(!t.getContext("webgl")&&!t.getContext("experimental-webgl"))throw new Error}catch(t){r=!1}return r}};o.Int8Array="undefined"==typeof Int8Array?Array:Int8Array,o.Uint8Array="undefined"==typeof Uint8Array?Array:Uint8Array,o.Uint16Array="undefined"==typeof Uint16Array?Array:Uint16Array,o.Uint32Array="undefined"==typeof Uint32Array?Array:Uint32Array,o.Int16Array="undefined"==typeof Int16Array?Array:Int16Array,o.Float32Array="undefined"==typeof Float32Array?Array:Float32Array,o.Float64Array="undefined"==typeof Float64Array?Array:Float64Array;var a={};"undefined"!=typeof window?a=window:void 0!==t&&(a=t),o.requestAnimationFrame=a.requestAnimationFrame||a.msRequestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||function(t){setTimeout(t,16)},o.createCanvas=function(){return document.createElement("canvas")},o.createImage=function(){return new a.Image},o.request={get:i.a.get},o.addEventListener=function(t,e,n,r){t.addEventListener(e,n,r)},o.removeEventListener=function(t,e,n){t.removeEventListener(e,n)},e.a=o}).call(this,n("c8ba"))},"72dd":function(t,e,n){"use strict";n.d(e,"Vue2",(function(){return i}));var r=n("8bbf");n.o(r,"computed")&&n.d(e,"computed",(function(){return r.computed})),n.o(r,"defineComponent")&&n.d(e,"defineComponent",(function(){return r.defineComponent})),n.o(r,"h")&&n.d(e,"h",(function(){return r.h})),n.o(r,"inject")&&n.d(e,"inject",(function(){return r.inject})),n.o(r,"nextTick")&&n.d(e,"nextTick",(function(){return r.nextTick})),n.o(r,"onMounted")&&n.d(e,"onMounted",(function(){return r.onMounted})),n.o(r,"onUnmounted")&&n.d(e,"onUnmounted",(function(){return r.onUnmounted})),n.o(r,"shallowRef")&&n.d(e,"shallowRef",(function(){return r.shallowRef})),n.o(r,"toRefs")&&n.d(e,"toRefs",(function(){return r.toRefs})),n.o(r,"unref")&&n.d(e,"unref",(function(){return r.unref})),n.o(r,"watch")&&n.d(e,"watch",(function(){return r.watch})),n.o(r,"watchEffect")&&n.d(e,"watchEffect",(function(){return r.watchEffect}));var i=void 0},abc5:function(t){t.exports=JSON.parse('{"color":["#5ee0a1","#66c8f6","#ff7788","#f49966","#f2c638","#8c70f8"],"backgroundColor":"#031327","title":{"textStyle":{"color":"#21dff1"},"subtextStyle":{"color":"#6E7079"}},"line":{"itemStyle":{"borderWidth":1},"lineStyle":{"width":2},"symbolSize":4,"symbol":"emptyCircle","smooth":false},"radar":{"itemStyle":{"borderWidth":1},"lineStyle":{"width":2},"symbolSize":4,"symbol":"emptyCircle","smooth":false},"bar":{"itemStyle":{"barBorderWidth":"0","barBorderColor":"#ffffff"}},"pie":{"itemStyle":{"borderWidth":"0","borderColor":"#ffffff"}},"scatter":{"itemStyle":{"borderWidth":"0","borderColor":"#ffffff"}},"boxplot":{"itemStyle":{"borderWidth":"0","borderColor":"#ffffff"}},"parallel":{"itemStyle":{"borderWidth":"0","borderColor":"#ffffff"}},"sankey":{"itemStyle":{"borderWidth":"0","borderColor":"#ffffff"}},"funnel":{"itemStyle":{"borderWidth":"0","borderColor":"#ffffff"}},"gauge":{"itemStyle":{"borderWidth":"0","borderColor":"#ffffff"}},"candlestick":{"itemStyle":{"color":"#eb5454","color0":"#47b262","borderColor":"#eb5454","borderColor0":"#47b262","borderWidth":1}},"graph":{"itemStyle":{"borderWidth":"0","borderColor":"#ffffff"},"lineStyle":{"width":1,"color":"#aaa"},"symbolSize":4,"symbol":"emptyCircle","smooth":false,"color":["#ff7788","#f49966","#5ee0a1","#66c8f6","#f2c638","#8c70f8"],"label":{"color":"#eee"}},"map":{"itemStyle":{"normal":{"areaColor":"#eee","borderColor":"#444","borderWidth":0.5},"emphasis":{"areaColor":"rgba(255,215,0,0.8)","borderColor":"#444","borderWidth":1}},"label":{"normal":{"color":"#000"},"emphasis":{"textStyle":{"color":"rgb(100,0,0)"}}}},"geo":{"itemStyle":{"normal":{"areaColor":"#eee","borderColor":"#444","borderWidth":0.5},"emphasis":{"areaColor":"rgba(255,215,0,0.8)","borderColor":"#444","borderWidth":1}},"label":{"normal":{"textStyle":{"color":"#000"}},"emphasis":{"textStyle":{"color":"rgb(100,0,0)"}}}},"categoryAxis":{"axisLine":{"show":true,"lineStyle":{"color":"#21dff1"}},"axisTick":{"show":true,"lineStyle":{"color":"#21dff1"}},"axisLabel":{"show":true,"color":"#21dff1"},"splitLine":{"show":false,"lineStyle":{"color":["#E0E6F1"]}},"splitArea":{"show":false,"areaStyle":{"color":["rgba(250,250,250,0.2)","rgba(210,219,238,0.2)"]}}},"valueAxis":{"axisLine":{"show":true,"lineStyle":{"color":"#21dff1"}},"axisTick":{"show":false,"lineStyle":{"color":"#6E7079"}},"axisLabel":{"show":true,"color":"#21dff1"},"splitLine":{"show":false,"lineStyle":{"color":["#E0E6F1"]}},"splitArea":{"show":false,"areaStyle":{"color":["rgba(250,250,250,0.2)","rgba(210,219,238,0.2)"]}}},"logAxis":{"axisLine":{"show":true,"lineStyle":{"color":"#21dff1"}},"axisTick":{"show":true,"lineStyle":{"color":"#6E7079"}},"axisLabel":{"show":true,"color":"#21dff1"},"splitLine":{"show":false,"lineStyle":{"color":["#E0E6F1"]}},"splitArea":{"show":false,"areaStyle":{"color":["rgba(250,250,250,0.2)","rgba(210,219,238,0.2)"]}}},"timeAxis":{"axisLine":{"show":true,"lineStyle":{"color":"#6E7079"}},"axisTick":{"show":true,"lineStyle":{"color":"#6E7079"}},"axisLabel":{"show":true,"color":"#21dff1"},"splitLine":{"show":false,"lineStyle":{"color":["#E0E6F1"]}},"splitArea":{"show":false,"areaStyle":{"color":["rgba(250,250,250,0.2)","rgba(210,219,238,0.2)"]}}},"toolbox":{"iconStyle":{"normal":{"borderColor":"#999"},"emphasis":{"borderColor":"#666"}}},"legend":{"textStyle":{"color":"#21dff1"}},"tooltip":{"axisPointer":{"lineStyle":{"color":"#ccc","width":1},"crossStyle":{"color":"#ccc","width":1}}},"timeline":{"lineStyle":{"color":"#DAE1F5","width":2},"itemStyle":{"normal":{"color":"#A4B1D7","borderWidth":1},"emphasis":{"color":"#FFF"}},"controlStyle":{"normal":{"color":"#A4B1D7","borderColor":"#A4B1D7","borderWidth":1},"emphasis":{"color":"#A4B1D7","borderColor":"#A4B1D7","borderWidth":1}},"checkpointStyle":{"color":"#316bf3","borderColor":"fff"},"label":{"normal":{"textStyle":{"color":"#A4B1D7"}},"emphasis":{"textStyle":{"color":"#A4B1D7"}}}},"visualMap":{"color":["#bf444c","#d88273","#f6efa6"]},"dataZoom":{"handleSize":"undefined%"},"markPoint":{"label":{"color":"#eee"},"emphasis":{"label":{"color":"#eee"}}}}')},cc1f:function(t,e,n){"use strict";n.d(e,"a",(function(){return GH}));var r={};n.r(r),n.d(r,"parse",(function(){return tn})),n.d(r,"lift",(function(){return nn})),n.d(r,"toHex",(function(){return rn})),n.d(r,"fastLerp",(function(){return on})),n.d(r,"fastMapToColor",(function(){return an})),n.d(r,"lerp",(function(){return sn})),n.d(r,"mapToColor",(function(){return ln})),n.d(r,"modifyHSL",(function(){return un})),n.d(r,"modifyAlpha",(function(){return hn})),n.d(r,"stringify",(function(){return cn})),n.d(r,"lum",(function(){return dn})),n.d(r,"random",(function(){return pn}));var i={};n.r(i),n.d(i,"extendShape",(function(){return bh})),n.d(i,"extendPath",(function(){return wh})),n.d(i,"registerShape",(function(){return Sh})),n.d(i,"getShapeClass",(function(){return Mh})),n.d(i,"makePath",(function(){return Ah})),n.d(i,"makeImage",(function(){return Ch})),n.d(i,"mergePath",(function(){return Ih})),n.d(i,"resizePath",(function(){return Dh})),n.d(i,"subPixelOptimizeLine",(function(){return Rh})),n.d(i,"subPixelOptimizeRect",(function(){return Lh})),n.d(i,"subPixelOptimize",(function(){return Oh})),n.d(i,"updateProps",(function(){return Nh})),n.d(i,"initProps",(function(){return kh})),n.d(i,"removeElement",(function(){return Bh})),n.d(i,"removeElementWithFadeOut",(function(){return zh})),n.d(i,"isElementRemoved",(function(){return Hh})),n.d(i,"getTransform",(function(){return Vh})),n.d(i,"applyTransform",(function(){return Uh})),n.d(i,"transformDirection",(function(){return Gh})),n.d(i,"groupTransition",(function(){return Xh})),n.d(i,"clipPointsByRect",(function(){return jh})),n.d(i,"clipRectByRect",(function(){return Yh})),n.d(i,"createIcon",(function(){return Zh})),n.d(i,"linePolygonIntersect",(function(){return qh})),n.d(i,"lineLineIntersect",(function(){return Kh})),n.d(i,"Group",(function(){return ei})),n.d(i,"Image",(function(){return cs})),n.d(i,"Text",(function(){return Os})),n.d(i,"Circle",(function(){return tu})),n.d(i,"Ellipse",(function(){return ru})),n.d(i,"Sector",(function(){return bu})),n.d(i,"Ring",(function(){return Mu})),n.d(i,"Polygon",(function(){return Lu})),n.d(i,"Polyline",(function(){return Bu})),n.d(i,"Rect",(function(){return bs})),n.d(i,"Line",(function(){return Vu})),n.d(i,"BezierCurve",(function(){return Zu})),n.d(i,"Arc",(function(){return Ju})),n.d(i,"IncrementalDisplayable",(function(){return yh})),n.d(i,"CompoundPath",(function(){return th})),n.d(i,"LinearGradient",(function(){return oh})),n.d(i,"RadialGradient",(function(){return sh})),n.d(i,"BoundingRect",(function(){return Un})),n.d(i,"OrientedBoundingRect",(function(){return fh})),n.d(i,"Point",(function(){return Dn})),n.d(i,"Path",(function(){return rs}));var o={};n.r(o),n.d(o,"createList",(function(){return jx})),n.d(o,"getLayoutRect",(function(){return vd})),n.d(o,"createDimensions",(function(){return Mv})),n.d(o,"dataStack",(function(){return Yx})),n.d(o,"createSymbol",(function(){return qm})),n.d(o,"createScale",(function(){return Zx})),n.d(o,"mixinAxisModelCommonMethods",(function(){return qx})),n.d(o,"getECData",(function(){return Ps})),n.d(o,"enableHoverEmphasis",(function(){return bl})),n.d(o,"createTextStyle",(function(){return Kx}));var a={};n.r(a),n.d(a,"linearMap",(function(){return ui})),n.d(a,"round",(function(){return ci})),n.d(a,"asc",(function(){return di})),n.d(a,"getPrecision",(function(){return pi})),n.d(a,"getPrecisionSafe",(function(){return fi})),n.d(a,"getPixelPrecision",(function(){return gi})),n.d(a,"getPercentWithPrecision",(function(){return mi})),n.d(a,"MAX_SAFE_INTEGER",(function(){return yi})),n.d(a,"remRadian",(function(){return _i})),n.d(a,"isRadianAroundZero",(function(){return vi})),n.d(a,"parseDate",(function(){return bi})),n.d(a,"quantity",(function(){return Ti})),n.d(a,"quantityExponent",(function(){return wi})),n.d(a,"nice",(function(){return Si})),n.d(a,"quantile",(function(){return Mi})),n.d(a,"reformIntervals",(function(){return Ai})),n.d(a,"isNumeric",(function(){return Ei})),n.d(a,"numericToNumber",(function(){return Ci}));var s={};n.r(s),n.d(s,"extendShape",(function(){return bh})),n.d(s,"extendPath",(function(){return wh})),n.d(s,"makePath",(function(){return Ah})),n.d(s,"makeImage",(function(){return Ch})),n.d(s,"mergePath",(function(){return Ih})),n.d(s,"resizePath",(function(){return Dh})),n.d(s,"createIcon",(function(){return Zh})),n.d(s,"updateProps",(function(){return Nh})),n.d(s,"initProps",(function(){return kh})),n.d(s,"getTransform",(function(){return Vh})),n.d(s,"clipPointsByRect",(function(){return jh})),n.d(s,"clipRectByRect",(function(){return Yh})),n.d(s,"registerShape",(function(){return Sh})),n.d(s,"getShapeClass",(function(){return Mh})),n.d(s,"Group",(function(){return ei})),n.d(s,"Image",(function(){return cs})),n.d(s,"Text",(function(){return Os})),n.d(s,"Circle",(function(){return tu})),n.d(s,"Ellipse",(function(){return ru})),n.d(s,"Sector",(function(){return bu})),n.d(s,"Ring",(function(){return Mu})),n.d(s,"Polygon",(function(){return Lu})),n.d(s,"Polyline",(function(){return Bu})),n.d(s,"Rect",(function(){return bs})),n.d(s,"Line",(function(){return Vu})),n.d(s,"BezierCurve",(function(){return Zu})),n.d(s,"Arc",(function(){return Ju})),n.d(s,"IncrementalDisplayable",(function(){return yh})),n.d(s,"CompoundPath",(function(){return th})),n.d(s,"LinearGradient",(function(){return oh})),n.d(s,"RadialGradient",(function(){return sh})),n.d(s,"BoundingRect",(function(){return Un}));var l={};n.r(l),n.d(l,"map",(function(){return z})),n.d(l,"each",(function(){return F})),n.d(l,"indexOf",(function(){return P})),n.d(l,"inherits",(function(){return N})),n.d(l,"reduce",(function(){return H})),n.d(l,"filter",(function(){return V})),n.d(l,"bind",(function(){return G})),n.d(l,"curry",(function(){return W})),n.d(l,"isArray",(function(){return X})),n.d(l,"isString",(function(){return Y})),n.d(l,"isObject",(function(){return K})),n.d(l,"isFunction",(function(){return j})),n.d(l,"extend",(function(){return R})),n.d(l,"defaults",(function(){return L})),n.d(l,"clone",(function(){return I})),n.d(l,"merge",(function(){return D}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var u=function(t,e){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function h(t,e){function n(){this.constructor=t}u(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var c=function(){return(c=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function d(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}Object.create,Object.create;var p=function(){this.firefox=!1,this.ie=!1,this.edge=!1,this.newEdge=!1,this.weChat=!1},f=new function(){this.browser=new p,this.node=!1,this.wxa=!1,this.worker=!1,this.canvasSupported=!1,this.svgSupported=!1,this.touchEventsSupported=!1,this.pointerEventsSupported=!1,this.domSupported=!1};"object"==typeof wx&&"function"==typeof wx.getSystemInfoSync?(f.wxa=!0,f.canvasSupported=!0,f.touchEventsSupported=!0):"undefined"==typeof document&&"undefined"!=typeof self?(f.worker=!0,f.canvasSupported=!0):"undefined"==typeof navigator?(f.node=!0,f.canvasSupported=!0,f.svgSupported=!0):function(t,e){var n=e.browser,r=t.match(/Firefox\/([\d.]+)/),i=t.match(/MSIE\s([\d.]+)/)||t.match(/Trident\/.+?rv:(([\d.]+))/),o=t.match(/Edge?\/([\d.]+)/);t=/micromessenger/i.test(t);r&&(n.firefox=!0,n.version=r[1]),i&&(n.ie=!0,n.version=i[1]),o&&(n.edge=!0,n.version=o[1],n.newEdge=18<+o[1].split(".")[0]),t&&(n.weChat=!0),e.canvasSupported=!!document.createElement("canvas").getContext,e.svgSupported="undefined"!=typeof SVGRect,e.touchEventsSupported="ontouchstart"in window&&!n.ie&&!n.edge,e.pointerEventsSupported="onpointerdown"in window&&(n.edge||n.ie&&11<=+n.version),e.domSupported="undefined"!=typeof document}(navigator.userAgent,f);var g=f,m={"[object Function]":!0,"[object RegExp]":!0,"[object Date]":!0,"[object Error]":!0,"[object CanvasGradient]":!0,"[object CanvasPattern]":!0,"[object Image]":!0,"[object Canvas]":!0},y={"[object Int8Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Int16Array]":!0,"[object Uint16Array]":!0,"[object Int32Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0},_=Object.prototype.toString,v=Array.prototype,x=v.forEach,b=v.filter,T=v.slice,w=v.map,S=function(){}.constructor,M=S?S.prototype:null,A={},C=2311;function E(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];"undefined"!=typeof console&&console.error.apply(console,t)}function I(t){if(null==t||"object"!=typeof t)return t;var e=t,n=_.call(t);if("[object Array]"===n){if(!ht(t)){e=[];for(var r=0,i=t.length;r<i;r++)e[r]=I(t[r])}}else if(y[n]){if(!ht(t)){var o=t.constructor;if(o.from)e=o.from(t);else for(e=new o(t.length),r=0,i=t.length;r<i;r++)e[r]=I(t[r])}}else if(!m[n]&&!ht(t)&&!$(t))for(var a in e={},t)t.hasOwnProperty(a)&&(e[a]=I(t[a]));return e}function D(t,e,n){if(!K(e)||!K(t))return n?I(e):t;for(var r in e){var i,o;e.hasOwnProperty(r)&&(i=t[r],!K(o=e[r])||!K(i)||X(o)||X(i)||$(o)||$(i)||Q(o)||Q(i)||ht(o)||ht(i)?!n&&r in t||(t[r]=I(e[r])):D(i,o,n))}return t}function R(t,e){if(Object.assign)Object.assign(t,e);else for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function L(t,e,n){for(var r=U(e),i=0;i<r.length;i++){var o=r[i];(n?null!=e[o]:null==t[o])&&(t[o]=e[o])}return t}var O=function(){return A.createCanvas()};function P(t,e){if(t){if(t.indexOf)return t.indexOf(e);for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n}return-1}function N(t,e){var n,r=t.prototype;function i(){}for(n in i.prototype=e.prototype,t.prototype=new i,r)r.hasOwnProperty(n)&&(t.prototype[n]=r[n]);(t.prototype.constructor=t).superClass=e}function k(t,e,n){if(t="prototype"in t?t.prototype:t,e="prototype"in e?e.prototype:e,Object.getOwnPropertyNames)for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var o=r[i];"constructor"!==o&&(n?null!=e[o]:null==t[o])&&(t[o]=e[o])}else L(t,e,n)}function B(t){return!!t&&"string"!=typeof t&&"number"==typeof t.length}function F(t,e,n){if(t&&e)if(t.forEach&&t.forEach===x)t.forEach(e,n);else if(t.length===+t.length)for(var r=0,i=t.length;r<i;r++)e.call(n,t[r],r,t);else for(var o in t)t.hasOwnProperty(o)&&e.call(n,t[o],o,t)}function z(t,e,n){if(!t)return[];if(!e)return it(t);if(t.map&&t.map===w)return t.map(e,n);for(var r=[],i=0,o=t.length;i<o;i++)r.push(e.call(n,t[i],i,t));return r}function H(t,e,n,r){if(t&&e){for(var i=0,o=t.length;i<o;i++)n=e.call(r,n,t[i],i,t);return n}}function V(t,e,n){if(!t)return[];if(!e)return it(t);if(t.filter&&t.filter===b)return t.filter(e,n);for(var r=[],i=0,o=t.length;i<o;i++)e.call(n,t[i],i,t)&&r.push(t[i]);return r}function U(t){if(!t)return[];if(Object.keys)return Object.keys(t);var e,n=[];for(e in t)t.hasOwnProperty(e)&&n.push(e);return n}A.createCanvas=function(){return document.createElement("canvas")};var G=M&&j(M.bind)?M.call.bind(M.bind):function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return function(){return t.apply(e,n.concat(T.call(arguments)))}};function W(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return function(){return t.apply(this,e.concat(T.call(arguments)))}}function X(t){return Array.isArray?Array.isArray(t):"[object Array]"===_.call(t)}function j(t){return"function"==typeof t}function Y(t){return"string"==typeof t}function Z(t){return"[object String]"===_.call(t)}function q(t){return"number"==typeof t}function K(t){var e=typeof t;return"function"==e||!!t&&"object"==e}function Q(t){return m[_.call(t)]}function J(t){return y[_.call(t)]}function $(t){return"object"==typeof t&&"number"==typeof t.nodeType&&"object"==typeof t.ownerDocument}function tt(t){return t!=t}function et(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0,r=t.length;n<r;n++)if(null!=t[n])return t[n]}function nt(t,e){return null!=t?t:e}function rt(t,e,n){return null!=t?t:null!=e?e:n}function it(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return T.apply(t,e)}function ot(t){if("number"==typeof t)return[t,t,t,t];var e=t.length;return 2===e?[t[0],t[1],t[0],t[1]]:3===e?[t[0],t[1],t[2],t[1]]:t}function at(t,e){if(!t)throw new Error(e)}function st(t){return null==t?null:"function"==typeof t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}var lt="__ec_primitive__";function ut(t){t[lt]=!0}function ht(t){return t[lt]}var ct=(dt.prototype.get=function(t){return this.data.hasOwnProperty(t)?this.data[t]:null},dt.prototype.set=function(t,e){return this.data[t]=e},dt.prototype.each=function(t,e){for(var n in this.data)this.data.hasOwnProperty(n)&&t.call(e,this.data[n],n)},dt.prototype.keys=function(){return U(this.data)},dt.prototype.removeKey=function(t){delete this.data[t]},dt);function dt(t){this.data={};var e=X(t);this.data={};var n=this;function r(t,r){e?n.set(t,r):n.set(r,t)}t instanceof dt?t.each(r):t&&F(t,r)}function pt(t){return new ct(t)}function ft(t,e){var n=Object.create?Object.create(t):((n=function(){}).prototype=t,new n);return e&&R(n,e),n}function gt(t,e){return t.hasOwnProperty(e)}function mt(){}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var yt=function(t,e){return(yt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function _t(t,e){function n(){this.constructor=t}yt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function vt(t,e){return[t=null==t?0:t,e=null==e?0:e]}function xt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function bt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function Tt(t){return Math.sqrt(wt(t))}function wt(t){return t[0]*t[0]+t[1]*t[1]}function St(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function Mt(t,e){var n=Tt(e);return 0===n?(t[0]=0,t[1]=0):(t[0]=e[0]/n,t[1]=e[1]/n),t}function At(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))}Object.create,Object.create;var Ct=At,Et=function(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])};function It(t,e,n,r){return t[0]=e[0]+r*(n[0]-e[0]),t[1]=e[1]+r*(n[1]-e[1]),t}function Dt(t,e,n){var r=e[0];e=e[1];return t[0]=n[0]*r+n[2]*e+n[4],t[1]=n[1]*r+n[3]*e+n[5],t}function Rt(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function Lt(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}var Ot=function(t,e){this.target=t,this.topTarget=e&&e.topTarget};function Pt(t){(this.handler=t).on("mousedown",this._dragStart,this),t.on("mousemove",this._drag,this),t.on("mouseup",this._dragEnd,this)}var Nt=(Pt.prototype._dragStart=function(t){for(var e=t.target;e&&!e.draggable;)e=e.parent;e&&((this._draggingTarget=e).dragging=!0,this._x=t.offsetX,this._y=t.offsetY,this.handler.dispatchToElement(new Ot(e,t),"dragstart",t.event))},Pt.prototype._drag=function(t){var e,n,r,i,o=this._draggingTarget;o&&(r=t.offsetX,i=t.offsetY,e=r-this._x,n=i-this._y,this._x=r,this._y=i,o.drift(e,n,t),this.handler.dispatchToElement(new Ot(o,t),"drag",t.event),r=this.handler.findHover(r,i,o).target,i=this._dropTarget,o!==(this._dropTarget=r)&&(i&&r!==i&&this.handler.dispatchToElement(new Ot(i,t),"dragleave",t.event),r&&r!==i&&this.handler.dispatchToElement(new Ot(r,t),"dragenter",t.event)))},Pt.prototype._dragEnd=function(t){var e=this._draggingTarget;e&&(e.dragging=!1),this.handler.dispatchToElement(new Ot(e,t),"dragend",t.event),this._dropTarget&&this.handler.dispatchToElement(new Ot(this._dropTarget,t),"drop",t.event),this._draggingTarget=null,this._dropTarget=null},Pt);function kt(t){t&&(this._$eventProcessor=t)}var Bt=(kt.prototype.on=function(t,e,n,r){this._$handlers||(this._$handlers={});var i=this._$handlers;if("function"==typeof e&&(r=n,n=e,e=null),!n||!t)return this;var o=this._$eventProcessor;null!=e&&o&&o.normalizeQuery&&(e=o.normalizeQuery(e)),i[t]||(i[t]=[]);for(var a=0;a<i[t].length;a++)if(i[t][a].h===n)return this;return o={h:n,query:e,ctx:r||this,callAtLast:n.zrEventfulCallAtLast},e=i[t].length-1,r=i[t][e],r&&r.callAtLast?i[t].splice(e,0,o):i[t].push(o),this},kt.prototype.isSilent=function(t){var e=this._$handlers;return!e||!e[t]||!e[t].length},kt.prototype.off=function(t,e){var n=this._$handlers;if(!n)return this;if(!t)return this._$handlers={},this;if(e){if(n[t]){for(var r=[],i=0,o=n[t].length;i<o;i++)n[t][i].h!==e&&r.push(n[t][i]);n[t]=r}n[t]&&0===n[t].length&&delete n[t]}else delete n[t];return this},kt.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(!this._$handlers)return this;var r=this._$handlers[t],i=this._$eventProcessor;if(r)for(var o=e.length,a=r.length,s=0;s<a;s++){var l=r[s];if(!i||!i.filter||null==l.query||i.filter(t,l.query))switch(o){case 0:l.h.call(l.ctx);break;case 1:l.h.call(l.ctx,e[0]);break;case 2:l.h.call(l.ctx,e[0],e[1]);break;default:l.h.apply(l.ctx,e)}}return i&&i.afterTrigger&&i.afterTrigger(t),this},kt.prototype.triggerWithContext=function(t){if(!this._$handlers)return this;var e=this._$handlers[t],n=this._$eventProcessor;if(e)for(var r=arguments,i=r.length,o=r[i-1],a=e.length,s=0;s<a;s++){var l=e[s];if(!n||!n.filter||null==l.query||n.filter(t,l.query))switch(i){case 0:l.h.call(o);break;case 1:l.h.call(o,r[0]);break;case 2:l.h.call(o,r[0],r[1]);break;default:l.h.apply(o,r.slice(1,i-1))}}return n&&n.afterTrigger&&n.afterTrigger(t),this},kt),Ft=Math.log(2);function zt(t,e,n,r,i,o){var a=r+"-"+i,s=t.length;if(o.hasOwnProperty(a))return o[a];if(1===e){var l=Math.round(Math.log((1<<s)-1&~i)/Ft);return t[n][l]}for(var u=r|1<<n,h=n+1;r&1<<h;)h++;for(var c=0,d=0,p=0;d<s;d++){var f=1<<d;f&i||(c+=(p%2?-1:1)*t[n][d]*zt(t,e-1,h,u,i|f,o),p++)}return o[a]=c}function Ht(t,e){var n=[[t[0],t[1],1,0,0,0,-e[0]*t[0],-e[0]*t[1]],[0,0,0,t[0],t[1],1,-e[1]*t[0],-e[1]*t[1]],[t[2],t[3],1,0,0,0,-e[2]*t[2],-e[2]*t[3]],[0,0,0,t[2],t[3],1,-e[3]*t[2],-e[3]*t[3]],[t[4],t[5],1,0,0,0,-e[4]*t[4],-e[4]*t[5]],[0,0,0,t[4],t[5],1,-e[5]*t[4],-e[5]*t[5]],[t[6],t[7],1,0,0,0,-e[6]*t[6],-e[6]*t[7]],[0,0,0,t[6],t[7],1,-e[7]*t[6],-e[7]*t[7]]],r={},i=zt(n,8,0,0,0,r);if(0!==i){for(var o=[],a=0;a<8;a++)for(var s=0;s<8;s++)null==o[s]&&(o[s]=0),o[s]+=((a+s)%2?-1:1)*zt(n,7,0===a?1:0,1<<a,1<<s,r)/i*e[a];return function(t,e,n){var r=e*o[6]+n*o[7]+1;t[0]=(e*o[0]+n*o[1]+o[2])/r,t[1]=(e*o[3]+n*o[4]+o[5])/r}}}var Vt="___zrEVENTSAVED",Ut=[];function Gt(t,e,n,r,i){if(e.getBoundingClientRect&&g.domSupported&&!Wt(e)){var o=e[Vt]||(e[Vt]={});i=function(t,e,n){for(var r=n?"invTrans":"trans",i=e[r],o=e.srcCoords,a=[],s=[],l=!0,u=0;u<4;u++){var h=t[u].getBoundingClientRect(),c=2*u,d=h.left;h=h.top;a.push(d,h),l=l&&o&&d===o[c]&&h===o[1+c],s.push(t[u].offsetLeft,t[u].offsetTop)}return l&&i?i:(e.srcCoords=a,e[r]=n?Ht(s,a):Ht(a,s))}(function(t,e){var n=e.markers;if(n)return n;n=e.markers=[];for(var r=["left","right"],i=["top","bottom"],o=0;o<4;o++){var a=document.createElement("div"),s=a.style,l=o%2,u=(o>>1)%2;s.cssText=["position: absolute","visibility: hidden","padding: 0","margin: 0","border-width: 0","user-select: none","width:0","height:0",r[l]+":0",i[u]+":0",r[1-l]+":auto",i[1-u]+":auto",""].join("!important;"),t.appendChild(a),n.push(a)}return n}(e,o),o,i);if(i)return i(t,n,r),!0}return!1}function Wt(t){return"CANVAS"===t.nodeName.toUpperCase()}var Xt="undefined"!=typeof window&&!!window.addEventListener,jt=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Yt=[];function Zt(t,e,n,r){return n=n||{},r||!g.canvasSupported?qt(t,e,n):g.browser.firefox&&null!=e.layerX&&e.layerX!==e.offsetX?(n.zrX=e.layerX,n.zrY=e.layerY):null!=e.offsetX?(n.zrX=e.offsetX,n.zrY=e.offsetY):qt(t,e,n),n}function qt(t,e,n){if(g.domSupported&&t.getBoundingClientRect){var r=e.clientX,i=e.clientY;if(Wt(t))return e=t.getBoundingClientRect(),n.zrX=r-e.left,void(n.zrY=i-e.top);if(Gt(Yt,t,r,i))return n.zrX=Yt[0],void(n.zrY=Yt[1])}n.zrX=n.zrY=0}function Kt(t){return t||window.event}function Qt(t,e,n){if(null!=(e=Kt(e)).zrX)return e;var r=e.type;r&&0<=r.indexOf("touch")?(r=("touchend"!==r?e.targetTouches:e.changedTouches)[0])&&Zt(t,r,e,n):(Zt(t,e,e,n),i=function(t){var e=t.wheelDelta;if(e)return e;var n=t.deltaX;t=t.deltaY;return null!=n&&null!=t?3*(0!==t?Math.abs(t):Math.abs(n))*(0<t||!(t<0)&&0<n?-1:1):e}(e),e.zrDelta=i?i/120:-(e.detail||0)/3);var i=e.button;return null==e.which&&void 0!==i&&jt.test(e.type)&&(e.which=1&i?1:2&i?3:4&i?2:0),e}function Jt(t,e,n,r){Xt?t.addEventListener(e,n,r):t.attachEvent("on"+e,n)}var $t=Xt?function(t){t.preventDefault(),t.stopPropagation(),t.cancelBubble=!0}:function(t){t.returnValue=!1,t.cancelBubble=!0};function te(t){return 2===t.which||3===t.which}var ee=(ne.prototype.recognize=function(t,e,n){return this._doTrack(t,e,n),this._recognize(t)},ne.prototype.clear=function(){return this._track.length=0,this},ne.prototype._doTrack=function(t,e,n){var r=t.touches;if(r){for(var i={points:[],touches:[],target:e,event:t},o=0,a=r.length;o<a;o++){var s=r[o],l=Zt(n,s,{});i.points.push([l.zrX,l.zrY]),i.touches.push(s)}this._track.push(i)}},ne.prototype._recognize=function(t){for(var e in ie)if(ie.hasOwnProperty(e)&&(e=ie[e](this._track,t),e))return e},ne);function ne(){this._track=[]}function re(t){var e=t[1][0]-t[0][0];t=t[1][1]-t[0][1];return Math.sqrt(e*e+t*t)}var ie={pinch:function(t,e){var n=t.length;if(n){var r=(t[n-1]||{}).points;n=(t[n-2]||{}).points||r;if(n&&1<n.length&&r&&1<r.length)return n=re(r)/re(n),isFinite(n)||(n=1),e.pinchScale=n,r=[(r[0][0]+r[1][0])/2,(r[0][1]+r[1][1])/2],e.pinchX=r[0],e.pinchY=r[1],{type:"pinch",target:t[0].target,event:e}}}},oe="silent";function ae(){$t(this.event)}var se,le=(_t(ue,se=Bt),ue.prototype.dispose=function(){},ue.prototype.setCursor=function(){},ue);function ue(){var t=null!==se&&se.apply(this,arguments)||this;return t.handler=null,t}var he,ce=function(t,e){this.x=t,this.y=e},de=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],pe=(_t(fe,he=Bt),fe.prototype.setHandlerProxy=function(t){this.proxy&&this.proxy.dispose(),t&&(F(de,(function(e){t.on&&t.on(e,this[e],this)}),this),t.handler=this),this.proxy=t},fe.prototype.mousemove=function(t){var e=t.zrX,n=t.zrY,r=ge(this,e,n),i=this._hovered,o=i.target;o&&!o.__zr&&(o=(i=this.findHover(i.x,i.y)).target),r=this._hovered=r?new ce(e,n):this.findHover(e,n),e=r.target,n=this.proxy,n.setCursor&&n.setCursor(e?e.cursor:"default"),o&&e!==o&&this.dispatchToElement(i,"mouseout",t),this.dispatchToElement(r,"mousemove",t),e&&e!==o&&this.dispatchToElement(r,"mouseover",t)},fe.prototype.mouseout=function(t){var e=t.zrEventControl;"only_globalout"!==e&&this.dispatchToElement(this._hovered,"mouseout",t),"no_globalout"!==e&&this.trigger("globalout",{type:"globalout",event:t})},fe.prototype.resize=function(){this._hovered=new ce(0,0)},fe.prototype.dispatch=function(t,e){t=this[t],t&&t.call(this,e)},fe.prototype.dispose=function(){this.proxy.dispose(),this.storage=null,this.proxy=null,this.painter=null},fe.prototype.setCursorStyle=function(t){var e=this.proxy;e.setCursor&&e.setCursor(t)},fe.prototype.dispatchToElement=function(t,e,n){var r=(t=t||{}).target;if(!r||!r.silent){for(var i="on"+e,o={type:e,event:n,target:(t=t).target,topTarget:t.topTarget,cancelBubble:!1,offsetX:n.zrX,offsetY:n.zrY,gestureEvent:n.gestureEvent,pinchX:n.pinchX,pinchY:n.pinchY,pinchScale:n.pinchScale,wheelDelta:n.zrDelta,zrByTouch:n.zrByTouch,which:n.which,stop:ae};r&&(r[i]&&(o.cancelBubble=!!r[i].call(r,o)),r.trigger(e,o),r=r.__hostTarget||r.parent,!o.cancelBubble););o.cancelBubble||(this.trigger(e,o),this.painter&&this.painter.eachOtherLayer&&this.painter.eachOtherLayer((function(t){"function"==typeof t[i]&&t[i].call(t,o),t.trigger&&t.trigger(e,o)})))}},fe.prototype.findHover=function(t,e,n){for(var r=this.storage.getDisplayList(),i=new ce(t,e),o=r.length-1;0<=o;o--){var a=void 0;if(r[o]!==n&&!r[o].ignore&&(a=function(t,e,n){if(t[t.rectHover?"rectContain":"contain"](e,n)){for(var r=t,i=void 0,o=!1;r;){if(!(o=!!r.ignoreClip||o)){var a=r.getClipPath();if(a&&!a.contain(e,n))return!1;r.silent&&(i=!0)}a=r.__hostTarget,r=a||r.parent}return!i||oe}return!1}(r[o],t,e))&&(i.topTarget||(i.topTarget=r[o]),a!==oe)){i.target=r[o];break}}return i},fe.prototype.processGesture=function(t,e){this._gestureMgr||(this._gestureMgr=new ee);var n=this._gestureMgr;"start"===e&&n.clear();var r=n.recognize(t,this.findHover(t.zrX,t.zrY,null).target,this.proxy.dom);"end"===e&&n.clear(),r&&(n=r.type,t.gestureEvent=n,(t=new ce).target=r.target,this.dispatchToElement(t,n,r.event))},fe);function fe(t,e,n,r){var i=he.call(this)||this;return i._hovered=new ce(0,0),i.storage=t,i.painter=e,i.painterRoot=r,n=n||new le,i.proxy=null,i.setHandlerProxy(n),i._draggingMgr=new Nt(i),i}function ge(t,e,n){return t=t.painter,e<0||e>t.getWidth()||n<0||n>t.getHeight()}F(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],(function(t){pe.prototype[t]=function(e){var n,r,i=e.zrX,o=e.zrY,a=ge(this,i,o);if("mouseup"===t&&a||(r=(n=this.findHover(i,o)).target),"mousedown"===t)this._downEl=r,this._downPoint=[e.zrX,e.zrY],this._upEl=r;else if("mouseup"===t)this._upEl=r;else if("click"===t){if(this._downEl!==this._upEl||!this._downPoint||4<Ct(this._downPoint,[e.zrX,e.zrY]))return;this._downPoint=null}this.dispatchToElement(n,t,e)}}));var me=pe;function ye(){return[1,0,0,1,0,0]}function _e(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function ve(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function xe(t,e,n){var r=e[0]*n[0]+e[2]*n[1],i=e[1]*n[0]+e[3]*n[1],o=e[0]*n[2]+e[2]*n[3],a=e[1]*n[2]+e[3]*n[3],s=e[0]*n[4]+e[2]*n[5]+e[4];e=e[1]*n[4]+e[3]*n[5]+e[5];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=e,t}function be(t,e,n){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4]+n[0],t[5]=e[5]+n[1],t}function Te(t,e,n){var r=e[0],i=e[2],o=e[4],a=e[1],s=e[3],l=e[5];e=Math.sin(n),n=Math.cos(n);return t[0]=r*n+a*e,t[1]=-r*e+a*n,t[2]=i*n+s*e,t[3]=-i*e+n*s,t[4]=n*o+e*l,t[5]=n*l-e*o,t}function we(t,e,n){var r=n[0];n=n[1];return t[0]=e[0]*r,t[1]=e[1]*n,t[2]=e[2]*r,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*n,t}function Se(t,e){var n=e[0],r=e[2],i=e[4],o=e[1],a=e[3],s=e[5];e=n*a-o*r;return e?(t[0]=a*(e=1/e),t[1]=-o*e,t[2]=-r*e,t[3]=n*e,t[4]=(r*s-a*i)*e,t[5]=(o*i-n*s)*e,t):null}var Me=_e;function Ae(t){return 5e-5<t||t<-5e-5}var Ce=[],Ee=[],Ie=ye(),De=Math.abs;function Re(){}var Le=(Re.prototype.setPosition=function(t){this.x=t[0],this.y=t[1]},Re.prototype.setScale=function(t){this.scaleX=t[0],this.scaleY=t[1]},Re.prototype.setOrigin=function(t){this.originX=t[0],this.originY=t[1]},Re.prototype.needLocalTransform=function(){return Ae(this.rotation)||Ae(this.x)||Ae(this.y)||Ae(this.scaleX-1)||Ae(this.scaleY-1)},Re.prototype.updateTransform=function(){var t=this.parent,e=t&&t.transform,n=this.needLocalTransform(),r=this.transform;n||e?(r=r||ye(),n?this.getLocalTransform(r):Me(r),e&&(n?xe(r,t.transform,r):ve(r,t.transform)),this.transform=r,this._resolveGlobalScaleRatio(r)):r&&Me(r)},Re.prototype._resolveGlobalScaleRatio=function(t){var e,n,r=this.globalScaleRatio;null!=r&&1!==r&&(this.getGlobalScale(Ce),n=((Ce[1]-(e=Ce[1]<0?-1:1))*r+e)/Ce[1]||0,t[0]*=e=((Ce[0]-(e=Ce[0]<0?-1:1))*r+e)/Ce[0]||0,t[1]*=e,t[2]*=n,t[3]*=n),this.invTransform=this.invTransform||ye(),Se(this.invTransform,t)},Re.prototype.getLocalTransform=function(t){return Re.getLocalTransform(this,t)},Re.prototype.getComputedTransform=function(){for(var t=this,e=[];t;)e.push(t),t=t.parent;for(;t=e.pop();)t.updateTransform();return this.transform},Re.prototype.setLocalTransform=function(t){var e,n;t&&(e=t[0]*t[0]+t[1]*t[1],n=t[2]*t[2]+t[3]*t[3],Ae(e-1)&&(e=Math.sqrt(e)),Ae(n-1)&&(n=Math.sqrt(n)),t[0]<0&&(e=-e),t[3]<0&&(n=-n),this.rotation=Math.atan2(-t[1]/n,t[0]/e),e<0&&n<0&&(this.rotation+=Math.PI,e=-e,n=-n),this.x=t[4],this.y=t[5],this.scaleX=e,this.scaleY=n)},Re.prototype.decomposeTransform=function(){var t,e,n;this.transform&&(n=this.parent,t=this.transform,n&&n.transform&&(xe(Ee,n.invTransform,t),t=Ee),e=this.originX,n=this.originY,(e||n)&&(Ie[4]=e,Ie[5]=n,xe(Ee,t,Ie),Ee[4]-=e,Ee[5]-=n,t=Ee),this.setLocalTransform(t))},Re.prototype.getGlobalScale=function(t){var e=this.transform;return t=t||[],e?(t[0]=Math.sqrt(e[0]*e[0]+e[1]*e[1]),t[1]=Math.sqrt(e[2]*e[2]+e[3]*e[3]),e[0]<0&&(t[0]=-t[0]),e[3]<0&&(t[1]=-t[1])):(t[0]=1,t[1]=1),t},Re.prototype.transformCoordToLocal=function(t,e){return t=[t,e],e=this.invTransform,e&&Dt(t,t,e),t},Re.prototype.transformCoordToGlobal=function(t,e){return t=[t,e],e=this.transform,e&&Dt(t,t,e),t},Re.prototype.getLineScale=function(){var t=this.transform;return t&&1e-10<De(t[0]-1)&&1e-10<De(t[3]-1)?Math.sqrt(De(t[0]*t[3]-t[2]*t[1])):1},Re.getLocalTransform=function(t,e){Me(e=e||[]);var n=t.originX||0,r=t.originY||0,i=t.scaleX,o=t.scaleY,a=t.rotation||0,s=t.x;t=t.y;return e[4]-=n,e[5]-=r,e[0]*=i,e[1]*=o,e[2]*=i,e[3]*=o,e[4]*=i,e[5]*=o,a&&Te(e,e,a),e[4]+=n,e[5]+=r,e[4]+=s,e[5]+=t,e},Re.initDefaultProps=((Ql=Re.prototype).x=0,Ql.y=0,Ql.scaleX=1,Ql.scaleY=1,Ql.originX=0,Ql.originY=0,Ql.rotation=0,void(Ql.globalScaleRatio=1)),Re),Oe={linear:function(t){return t},quadraticIn:function(t){return t*t},quadraticOut:function(t){return t*(2-t)},quadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quarticIn:function(t){return t*t*t*t},quarticOut:function(t){return 1- --t*t*t*t},quarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quinticIn:function(t){return t*t*t*t*t},quinticOut:function(t){return--t*t*t*t*t+1},quinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sinusoidalIn:function(t){return 1-Math.cos(t*Math.PI/2)},sinusoidalOut:function(t){return Math.sin(t*Math.PI/2)},sinusoidalInOut:function(t){return.5*(1-Math.cos(Math.PI*t))},exponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},exponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},exponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},circularIn:function(t){return 1-Math.sqrt(1-t*t)},circularOut:function(t){return Math.sqrt(1- --t*t)},circularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var e,n=.1;return 0===t?0:1===t?1:(e=!n||n<1?(n=1,.1):.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*--t)*Math.sin((t-e)*(2*Math.PI)/.4))},elasticOut:function(t){var e,n=.1;return 0===t?0:1===t?1:(e=!n||n<1?(n=1,.1):.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)},elasticInOut:function(t){var e,n=.1;return 0===t?0:1===t?1:(e=!n||n<1?(n=1,.1):.4*Math.asin(1/n)/(2*Math.PI),(t*=2)<1?n*Math.pow(2,10*--t)*Math.sin((t-e)*(2*Math.PI)/.4)*-.5:n*Math.pow(2,-10*--t)*Math.sin((t-e)*(2*Math.PI)/.4)*.5+1)},backIn:function(t){return t*t*(2.70158*t-1.70158)},backOut:function(t){return--t*t*(2.70158*t+1.70158)+1},backInOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((1+e)*t-e)*.5:.5*((t-=2)*t*((1+e)*t+e)+2)},bounceIn:function(t){return 1-Oe.bounceOut(1-t)},bounceOut:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},bounceInOut:function(t){return t<.5?.5*Oe.bounceIn(2*t):.5*Oe.bounceOut(2*t-1)+.5}},Pe=Oe;function Ne(t){this._initialized=!1,this._startTime=0,this._pausedTime=0,this._paused=!1,this._life=t.life||1e3,this._delay=t.delay||0,this.loop=null!=t.loop&&t.loop,this.gap=t.gap||0,this.easing=t.easing||"linear",this.onframe=t.onframe,this.ondestroy=t.ondestroy,this.onrestart=t.onrestart}var ke=(Ne.prototype.step=function(t,e){if(this._initialized||(this._startTime=t+this._delay,this._initialized=!0),!this._paused){(n=(t-this._startTime-this._pausedTime)/this._life)<0&&(n=0);var n=Math.min(n,1),r=this.easing;r="string"==typeof r?Pe[r]:r,r="function"==typeof r?r(n):n;if(this.onframe&&this.onframe(r),1===n){if(!this.loop)return!0;this._restart(t),this.onrestart&&this.onrestart()}return!1}this._pausedTime+=e},Ne.prototype._restart=function(t){var e=(t-this._startTime-this._pausedTime)%this._life;this._startTime=t-e+this.gap,this._pausedTime=0},Ne.prototype.pause=function(){this._paused=!0},Ne.prototype.resume=function(){this._paused=!1},Ne),Be=function(t){this.value=t},Fe=(ze.prototype.insert=function(t){return t=new Be(t),this.insertEntry(t),t},ze.prototype.insertEntry=function(t){this.head?((this.tail.next=t).prev=this.tail,t.next=null,this.tail=t):this.head=this.tail=t,this._len++},ze.prototype.remove=function(t){var e=t.prev,n=t.next;e?e.next=n:this.head=n,n?n.prev=e:this.tail=e,t.next=t.prev=null,this._len--},ze.prototype.len=function(){return this._len},ze.prototype.clear=function(){this.head=this.tail=null,this._len=0},ze);function ze(){this._len=0}function He(t){this._list=new Fe,this._maxSize=10,this._map={},this._maxSize=t}var Ve=(He.prototype.put=function(t,e){var n,r,i=this._list,o=this._map,a=null;return null==o[t]&&(r=i.len(),n=this._lastRemovedEntry,r>=this._maxSize&&0<r&&(r=i.head,i.remove(r),delete o[r.key],a=r.value,this._lastRemovedEntry=r),n?n.value=e:n=new Be(e),n.key=t,i.insertEntry(n),o[t]=n),a},He.prototype.get=function(t){var e=this._map[t];t=this._list;if(null!=e)return e!==t.tail&&(t.remove(e),t.insertEntry(e)),e.value},He.prototype.clear=function(){this._list.clear(),this._map={}},He.prototype.len=function(){return this._list.len()},He),Ue={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ge(t){return(t=Math.round(t))<0?0:255<t?255:t}function We(t){return t<0?0:1<t?1:t}function Xe(t){return t.length&&"%"===t.charAt(t.length-1)?Ge(parseFloat(t)/100*255):Ge(parseInt(t,10))}function je(t){return t.length&&"%"===t.charAt(t.length-1)?We(parseFloat(t)/100):We(parseFloat(t))}function Ye(t,e,n){return n<0?n+=1:1<n&&--n,6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}function Ze(t,e,n){return t+(e-t)*n}function qe(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function Ke(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}var Qe=new Ve(20),Je=null;function $e(t,e){Je&&Ke(Je,e),Je=Qe.put(t,Je||e.slice())}function tn(t,e){if(t){e=e||[];var n=Qe.get(t);if(n)return Ke(e,n);var r=(t+="").replace(/ /g,"").toLowerCase();if(r in Ue)return Ke(e,Ue[r]),$e(t,e),e;var i=r.length;if("#"===r.charAt(0))return 4===i||5===i?0<=(o=parseInt(r.slice(1,4),16))&&o<=4095?(qe(e,(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,5===i?parseInt(r.slice(4),16)/15:1),$e(t,e),e):void qe(e,0,0,0,1):7===i||9===i?0<=(o=parseInt(r.slice(1,7),16))&&o<=16777215?(qe(e,(16711680&o)>>16,(65280&o)>>8,255&o,9===i?parseInt(r.slice(7),16)/255:1),$e(t,e),e):void qe(e,0,0,0,1):void 0;n=r.indexOf("(");var o=r.indexOf(")");if(-1!==n&&o+1===i){i=r.substr(0,n);var a=r.substr(n+1,o-(n+1)).split(","),s=1;switch(i){case"rgba":if(4!==a.length)return 3===a.length?qe(e,+a[0],+a[1],+a[2],1):qe(e,0,0,0,1);s=je(a.pop());case"rgb":return 3!==a.length?void qe(e,0,0,0,1):(qe(e,Xe(a[0]),Xe(a[1]),Xe(a[2]),s),$e(t,e),e);case"hsla":return 4!==a.length?void qe(e,0,0,0,1):(a[3]=je(a[3]),en(a,e),$e(t,e),e);case"hsl":return 3!==a.length?void qe(e,0,0,0,1):(en(a,e),$e(t,e),e);default:return}}qe(e,0,0,0,1)}}function en(t,e){var n=(parseFloat(t[0])%360+360)%360/360,r=je(t[1]),i=je(t[2]);r=i<=.5?i*(r+1):i+r-i*r,i=2*i-r;return qe(e=e||[],Ge(255*Ye(i,r,n+1/3)),Ge(255*Ye(i,r,n)),Ge(255*Ye(i,r,n-1/3)),1),4===t.length&&(e[3]=t[3]),e}function nn(t,e){var n=tn(t);if(n){for(var r=0;r<3;r++)n[r]=e<0?n[r]*(1-e)|0:(255-n[r])*e+n[r]|0,255<n[r]?n[r]=255:n[r]<0&&(n[r]=0);return cn(n,4===n.length?"rgba":"rgb")}}function rn(t){if(t=tn(t),t)return((1<<24)+(t[0]<<16)+(t[1]<<8)+ +t[2]).toString(16).slice(1)}function on(t,e,n){if(e&&e.length&&0<=t&&t<=1){n=n||[];var r=t*(e.length-1),i=Math.floor(r),o=Math.ceil(r);t=e[i],o=e[o],i=r-i;return n[0]=Ge(Ze(t[0],o[0],i)),n[1]=Ge(Ze(t[1],o[1],i)),n[2]=Ge(Ze(t[2],o[2],i)),n[3]=We(Ze(t[3],o[3],i)),n}}var an=on;function sn(t,e,n){if(e&&e.length&&0<=t&&t<=1){var r=t*(e.length-1),i=Math.floor(r),o=Math.ceil(r),a=tn(e[i]);t=tn(e[o]),e=r-i,e=cn([Ge(Ze(a[0],t[0],e)),Ge(Ze(a[1],t[1],e)),Ge(Ze(a[2],t[2],e)),We(Ze(a[3],t[3],e))],"rgba");return n?{color:e,leftIndex:i,rightIndex:o,value:r}:e}}var ln=sn;function un(t,e,n,r){var i=tn(t);if(t)return i=function(t){if(t){var e,n,r,i=t[0]/255,o=t[1]/255,a=t[2]/255,s=Math.min(i,o,a),l=Math.max(i,o,a),u=l-s,h=(l+s)/2;return 0==u?n=e=0:(n=h<.5?u/(l+s):u/(2-l-s),r=((l-i)/6+u/2)/u,s=((l-o)/6+u/2)/u,u=((l-a)/6+u/2)/u,i===l?e=u-s:o===l?e=1/3+r-u:a===l&&(e=2/3+s-r),e<0&&(e+=1),1<e&&--e),h=[360*e,n,h],null!=t[3]&&h.push(t[3]),h}}(i),null!=e&&(i[0]=(e=e,(e=Math.round(e))<0?0:360<e?360:e)),null!=n&&(i[1]=je(n)),null!=r&&(i[2]=je(r)),cn(en(i),"rgba")}function hn(t,e){if(t=tn(t),t&&null!=e)return t[3]=We(e),cn(t,"rgba")}function cn(t,e){if(t&&t.length){var n=t[0]+","+t[1]+","+t[2];return"rgba"!==e&&"hsva"!==e&&"hsla"!==e||(n+=","+t[3]),e+"("+n+")"}}function dn(t,e){return t=tn(t),t?(.299*t[0]+.587*t[1]+.114*t[2])*t[3]/255+(1-t[3])*e:0}function pn(){return"rgb("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+")"}var fn=Array.prototype.slice;function gn(t,e,n){return(e-t)*n+t}function mn(t,e,n,r){for(var i=e.length,o=0;o<i;o++)t[o]=gn(e[o],n[o],r)}function yn(t,e,n,r){for(var i=e.length,o=0;o<i;o++)t[o]=e[o]+n[o]*r;return t}function _n(t,e,n,r){for(var i=e.length,o=i&&e[0].length,a=0;a<i;a++){t[a]||(t[a]=[]);for(var s=0;s<o;s++)t[a][s]=e[a][s]+n[a][s]*r}return t}function vn(t,e){var n=t.length;if(n===e.length){for(var r=0;r<n;r++)if(t[r]!==e[r])return;return 1}}function xn(t,e,n,r,i,o,a){return t=.5*(n-t),r=.5*(r-e),(2*(e-n)+t+r)*a+(-3*(e-n)-2*t-r)*o+t*i+e}function bn(t,e,n,r,i,o,a,s){for(var l=e.length,u=0;u<l;u++)t[u]=xn(e[u],n[u],r[u],i[u],o,a,s)}function Tn(t){if(B(t)){var e=t.length;if(B(t[0])){for(var n=[],r=0;r<e;r++)n.push(fn.call(t[r]));return n}return fn.call(t)}return t}function wn(t){return t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.floor(t[2]),"rgba("+t.join(",")+")"}var Sn=[0,0,0,0],Mn=(An.prototype.isFinished=function(){return this._finished},An.prototype.setFinished=function(){this._finished=!0,this._additiveTrack&&this._additiveTrack.setFinished()},An.prototype.needsAnimate=function(){return!this._isAllValueEqual&&2<=this.keyframes.length&&this.interpolable},An.prototype.getAdditiveTrack=function(){return this._additiveTrack},An.prototype.addKeyframe=function(t,e){t>=this.maxTime?this.maxTime=t:this._needsSort=!0;var n=this.keyframes,r=n.length;if(this.interpolable)if(B(e)){var i,o=B((o=e)&&o[0])?2:1;if(0<r&&this.arrDim!==o)return void(this.interpolable=!1);if(1==o&&"number"!=typeof e[0]||2==o&&"number"!=typeof e[0][0])return void(this.interpolable=!1);0<r&&(i=n[r-1],this._isAllValueEqual&&(1==o&&vn(e,i.value)||(this._isAllValueEqual=!1))),this.arrDim=o}else{if(0<this.arrDim)return void(this.interpolable=!1);if("string"==typeof e)o=tn(e),o?(e=o,this.isValueColor=!0):this.interpolable=!1;else if("number"!=typeof e)return void(this.interpolable=!1);this._isAllValueEqual&&0<r&&(i=n[r-1],(this.isValueColor&&!vn(i.value,e)||i.value!==e)&&(this._isAllValueEqual=!1))}return e={time:t,value:e,percent:0},this.keyframes.push(e),e},An.prototype.prepare=function(t){var e=this.keyframes;this._needsSort&&e.sort((function(t,e){return t.time-e.time}));for(var n=this.arrDim,r=e.length,i=e[r-1],o=0;o<r;o++)e[o].percent=e[o].time/this.maxTime,0<n&&o!==r-1&&function(t,e,n){var r=t,i=e;if(r.push&&i.push){e=r.length;var o=i.length;if(e!==o)if(o<e)r.length=o;else for(var a=e;a<o;a++)r.push(1===n?i[a]:fn.call(i[a]));var s=r[0]&&r[0].length;for(a=0;a<r.length;a++)if(1===n)isNaN(r[a])&&(r[a]=i[a]);else for(var l=0;l<s;l++)isNaN(r[a][l])&&(r[a][l]=i[a][l])}}(e[o].value,i.value,n);if(t&&this.needsAnimate()&&t.needsAnimate()&&n===t.arrDim&&this.isValueColor===t.isValueColor&&!t._finished){this._additiveTrack=t;var a=e[0].value;for(o=0;o<r;o++)0===n?this.isValueColor?e[o].additiveValue=yn([],e[o].value,a,-1):e[o].additiveValue=e[o].value-a:1===n?e[o].additiveValue=yn([],e[o].value,a,-1):2===n&&(e[o].additiveValue=_n([],e[o].value,a,-1))}},An.prototype.step=function(t,e){if(!this._finished){this._additiveTrack&&this._additiveTrack._finished&&(this._additiveTrack=null);var n=null!=this._additiveTrack,r=n?"additiveValue":"value",i=this.keyframes,o=this.keyframes.length,a=this.propName,s=this.arrDim,l=this.isValueColor;if(e<0)u=0;else if(e<this._lastFramePercent){for(var u=Math.min(this._lastFrame+1,o-1);0<=u&&!(i[u].percent<=e);u--);u=Math.min(u,o-2)}else{for(u=this._lastFrame;u<o&&!(i[u].percent>e);u++);u=Math.min(u-1,o-2)}var h,c,d,p,f,g,m,y=i[u+1],_=i[u];_&&y&&(this._lastFrame=u,this._lastFramePercent=e,0!=(g=y.percent-_.percent)&&(h=(e-_.percent)/g,c=n?this._additiveValue:l?Sn:t[a],(0<s||l)&&!c&&(c=this._additiveValue=[]),this.useSpline?(d=i[u][r],p=i[0===u?u:u-1][r],f=i[o-2<u?o-1:u+1][r],g=i[o-3<u?o-1:u+2][r],0<s?(1===s?bn:function(t,e,n,r,i,o,a,s){for(var l=e.length,u=e[0].length,h=0;h<l;h++){t[h]||(t[1]=[]);for(var c=0;c<u;c++)t[h][c]=xn(e[h][c],n[h][c],r[h][c],i[h][c],o,a,s)}})(c,p,d,f,g,h,h*h,h*h*h):l?(bn(c,p,d,f,g,h,h*h,h*h*h),n||(t[a]=wn(c))):(m=void 0,m=this.interpolable?xn(p,d,f,g,h,h*h,h*h*h):f,n?this._additiveValue=m:t[a]=m)):0<s?(1===s?mn:function(t,e,n,r){for(var i=e.length,o=i&&e[0].length,a=0;a<i;a++){t[a]||(t[a]=[]);for(var s=0;s<o;s++)t[a][s]=gn(e[a][s],n[a][s],r)}})(c,_[r],y[r],h):l?(mn(c,_[r],y[r],h),n||(t[a]=wn(c))):(m=void 0,m=this.interpolable?gn(_[r],y[r],h):(_=_[r],r=y[r],.5<h?r:_),n?this._additiveValue=m:t[a]=m),n&&this._addToTarget(t)))}},An.prototype._addToTarget=function(t){var e=this.arrDim,n=this.propName,r=this._additiveValue;0===e?this.isValueColor?(tn(t[n],Sn),yn(Sn,Sn,r,1),t[n]=wn(Sn)):t[n]=t[n]+r:1===e?yn(t[n],t[n],r,1):2===e&&_n(t[n],t[n],r,1)},An);function An(t){this.keyframes=[],this.maxTime=0,this.arrDim=0,this.interpolable=!0,this._needsSort=!1,this._isAllValueEqual=!0,this._lastFrame=0,this._lastFramePercent=0,this.propName=t}function Cn(t,e,n){this._tracks={},this._trackKeys=[],this._delay=0,this._maxTime=0,this._paused=!1,this._started=0,this._clip=null,this._target=t,(this._loop=e)&&n?E("Can' use additive animation on looped animation."):this._additiveAnimators=n}var En=(Cn.prototype.getTarget=function(){return this._target},Cn.prototype.changeTarget=function(t){this._target=t},Cn.prototype.when=function(t,e){return this.whenWithKeys(t,e,U(e))},Cn.prototype.whenWithKeys=function(t,e,n){for(var r=this._tracks,i=0;i<n.length;i++){var o=n[i];if(!(s=r[o])){var a,s=r[o]=new Mn(o),l=void 0,u=this._getAdditiveTrack(o);if(u?(l=(a=u.keyframes[u.keyframes.length-1])&&a.value,u.isValueColor&&l&&(l=wn(l))):l=this._target[o],null==l)continue;0!==t&&s.addKeyframe(0,Tn(l)),this._trackKeys.push(o)}s.addKeyframe(t,Tn(e[o]))}return this._maxTime=Math.max(this._maxTime,t),this},Cn.prototype.pause=function(){this._clip.pause(),this._paused=!0},Cn.prototype.resume=function(){this._clip.resume(),this._paused=!1},Cn.prototype.isPaused=function(){return!!this._paused},Cn.prototype._doneCallback=function(){this._setTracksFinished(),this._clip=null;var t=this._doneList;if(t)for(var e=t.length,n=0;n<e;n++)t[n].call(this)},Cn.prototype._abortedCallback=function(){this._setTracksFinished();var t=this.animation,e=this._abortedList;if(t&&t.removeClip(this._clip),this._clip=null,e)for(var n=0;n<e.length;n++)e[n].call(this)},Cn.prototype._setTracksFinished=function(){for(var t=this._tracks,e=this._trackKeys,n=0;n<e.length;n++)t[e[n]].setFinished()},Cn.prototype._getAdditiveTrack=function(t){var e,n=this._additiveAnimators;if(n)for(var r=0;r<n.length;r++){var i=n[r].getTrack(t);i&&(e=i)}return e},Cn.prototype.start=function(t,e){if(!(0<this._started)){this._started=1;for(var n=this,r=[],i=0;i<this._trackKeys.length;i++){var o=this._trackKeys[i],a=this._tracks[o],s=this._getAdditiveTrack(o);o=a.keyframes;a.prepare(s),a.needsAnimate()?r.push(a):a.interpolable||(o=o[o.length-1])&&(n._target[a.propName]=o.value)}return r.length||e?(e=new ke({life:this._maxTime,loop:this._loop,delay:this._delay,onframe:function(t){n._started=2;var e=n._additiveAnimators;if(e){for(var i=!1,o=0;o<e.length;o++)if(e[o]._clip){i=!0;break}i||(n._additiveAnimators=null)}for(o=0;o<r.length;o++)r[o].step(n._target,t);var a=n._onframeList;if(a)for(o=0;o<a.length;o++)a[o](n._target,t)},ondestroy:function(){n._doneCallback()}}),this._clip=e,this.animation&&this.animation.addClip(e),t&&"spline"!==t&&(e.easing=t)):this._doneCallback(),this}},Cn.prototype.stop=function(t){var e;this._clip&&(e=this._clip,t&&e.onframe(1),this._abortedCallback())},Cn.prototype.delay=function(t){return this._delay=t,this},Cn.prototype.during=function(t){return t&&(this._onframeList||(this._onframeList=[]),this._onframeList.push(t)),this},Cn.prototype.done=function(t){return t&&(this._doneList||(this._doneList=[]),this._doneList.push(t)),this},Cn.prototype.aborted=function(t){return t&&(this._abortedList||(this._abortedList=[]),this._abortedList.push(t)),this},Cn.prototype.getClip=function(){return this._clip},Cn.prototype.getTrack=function(t){return this._tracks[t]},Cn.prototype.stopTracks=function(t,e){if(!t.length||!this._clip)return!0;for(var n=this._tracks,r=this._trackKeys,i=0;i<t.length;i++){var o=n[t[i]];o&&(e?o.step(this._target,1):1===this._started&&o.step(this._target,0),o.setFinished())}var a=!0;for(i=0;i<r.length;i++)if(!n[r[i]].isFinished()){a=!1;break}return a&&this._abortedCallback(),a},Cn.prototype.saveFinalToTarget=function(t,e){if(t){e=e||this._trackKeys;for(var n=0;n<e.length;n++){var r,i=e[n],o=this._tracks[i];o&&!o.isFinished()&&(r=(r=o.keyframes)[r.length-1])&&(r=Tn(r.value),o.isValueColor&&(r=wn(r)),t[i]=r)}}},Cn.prototype.__changeFinalValue=function(t,e){e=e||U(t);for(var n=0;n<e.length;n++){var r,i=e[n],o=this._tracks[i];o&&1<(r=o.keyframes).length&&(r=r.pop(),o.addKeyframe(r.time,t[i]),o.prepare(o.getAdditiveTrack()))}},Cn);function In(t,e){this.x=t||0,this.y=e||0}var Dn=(In.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},In.prototype.clone=function(){return new In(this.x,this.y)},In.prototype.set=function(t,e){return this.x=t,this.y=e,this},In.prototype.equal=function(t){return t.x===this.x&&t.y===this.y},In.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},In.prototype.scale=function(t){this.x*=t,this.y*=t},In.prototype.scaleAndAdd=function(t,e){this.x+=t.x*e,this.y+=t.y*e},In.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},In.prototype.dot=function(t){return this.x*t.x+this.y*t.y},In.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},In.prototype.lenSquare=function(){return this.x*this.x+this.y*this.y},In.prototype.normalize=function(){var t=this.len();return this.x/=t,this.y/=t,this},In.prototype.distance=function(t){var e=this.x-t.x;t=this.y-t.y;return Math.sqrt(e*e+t*t)},In.prototype.distanceSquare=function(t){var e=this.x-t.x;t=this.y-t.y;return e*e+t*t},In.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},In.prototype.transform=function(t){if(t){var e=this.x,n=this.y;return this.x=t[0]*e+t[2]*n+t[4],this.y=t[1]*e+t[3]*n+t[5],this}},In.prototype.toArray=function(t){return t[0]=this.x,t[1]=this.y,t},In.prototype.fromArray=function(t){this.x=t[0],this.y=t[1]},In.set=function(t,e,n){t.x=e,t.y=n},In.copy=function(t,e){t.x=e.x,t.y=e.y},In.len=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},In.lenSquare=function(t){return t.x*t.x+t.y*t.y},In.dot=function(t,e){return t.x*e.x+t.y*e.y},In.add=function(t,e,n){t.x=e.x+n.x,t.y=e.y+n.y},In.sub=function(t,e,n){t.x=e.x-n.x,t.y=e.y-n.y},In.scale=function(t,e,n){t.x=e.x*n,t.y=e.y*n},In.scaleAndAdd=function(t,e,n,r){t.x=e.x+n.x*r,t.y=e.y+n.y*r},In.lerp=function(t,e,n,r){var i=1-r;t.x=i*e.x+r*n.x,t.y=i*e.y+r*n.y},In),Rn=Math.min,Ln=Math.max,On=new Dn,Pn=new Dn,Nn=new Dn,kn=new Dn,Bn=new Dn,Fn=new Dn;function zn(t,e,n,r){n<0&&isFinite(n)&&(t+=n,n=-n),r<0&&isFinite(r)&&(e+=r,r=-r),this.x=t,this.y=e,this.width=n,this.height=r}var Hn,Vn,Un=(zn.prototype.union=function(t){var e=Rn(t.x,this.x),n=Rn(t.y,this.y);isFinite(this.x)&&isFinite(this.width)?this.width=Ln(t.x+t.width,this.x+this.width)-e:this.width=t.width,isFinite(this.y)&&isFinite(this.height)?this.height=Ln(t.y+t.height,this.y+this.height)-n:this.height=t.height,this.x=e,this.y=n},zn.prototype.applyTransform=function(t){zn.applyTransform(this,this,t)},zn.prototype.calculateTransform=function(t){var e=t.width/this.width,n=t.height/this.height,r=ye();return be(r,r,[-this.x,-this.y]),we(r,r,[e,n]),be(r,r,[t.x,t.y]),r},zn.prototype.intersect=function(t,e){if(!t)return!1;t instanceof zn||(t=zn.create(t));var n,r,i,o,a,s,l,u=this.x,h=this.x+this.width,c=this.y,d=this.y+this.height,p=t.x,f=t.x+t.width,g=t.y,m=t.y+t.height,y=!(h<p||f<u||d<g||m<c);return e&&(n=1/0,r=0,i=Math.abs(h-p),o=Math.abs(f-u),a=Math.abs(d-g),s=Math.abs(m-c),l=Math.min(i,o),t=Math.min(a,s),h<p||f<u?r<l&&(r=l,i<o?Dn.set(Fn,-i,0):Dn.set(Fn,o,0)):l<n&&(n=l,i<o?Dn.set(Bn,i,0):Dn.set(Bn,-o,0)),d<g||m<c?r<t&&(r=t,a<s?Dn.set(Fn,0,-a):Dn.set(Fn,0,s)):l<n&&(n=l,a<s?Dn.set(Bn,0,a):Dn.set(Bn,0,-s))),e&&Dn.copy(e,y?Bn:Fn),y},zn.prototype.contain=function(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height},zn.prototype.clone=function(){return new zn(this.x,this.y,this.width,this.height)},zn.prototype.copy=function(t){zn.copy(this,t)},zn.prototype.plain=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},zn.prototype.isFinite=function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)},zn.prototype.isZero=function(){return 0===this.width||0===this.height},zn.create=function(t){return new zn(t.x,t.y,t.width,t.height)},zn.copy=function(t,e){t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height},zn.applyTransform=function(t,e,n){if(n){if(n[1]<1e-5&&-1e-5<n[1]&&n[2]<1e-5&&-1e-5<n[2]){var r=n[0],i=n[3],o=n[4],a=n[5];return t.x=e.x*r+o,t.y=e.y*i+a,t.width=e.width*r,t.height=e.height*i,t.width<0&&(t.x+=t.width,t.width=-t.width),void(t.height<0&&(t.y+=t.height,t.height=-t.height))}On.x=Nn.x=e.x,On.y=kn.y=e.y,Pn.x=kn.x=e.x+e.width,Pn.y=Nn.y=e.y+e.height,On.transform(n),kn.transform(n),Pn.transform(n),Nn.transform(n),t.x=Rn(On.x,Pn.x,Nn.x,kn.x),t.y=Rn(On.y,Pn.y,Nn.y,kn.y),i=Ln(On.x,Pn.x,Nn.x,kn.x),n=Ln(On.y,Pn.y,Nn.y,kn.y),t.width=i-t.x,t.height=n-t.y}else t!==e&&zn.copy(t,e)},zn),Gn={},Wn="12px sans-serif",Xn={measureText:function(t,e){return Hn=Hn||O().getContext("2d"),Vn!==e&&(Vn=Hn.font=e||Wn),Hn.measureText(t)}};function jn(t,e){var n=Gn[e=e||Wn],r=(n=n||(Gn[e]=new Ve(500))).get(t);return null==r&&(r=Xn.measureText(t,e).width,n.put(t,r)),r}function Yn(t,e,n,r){return t=jn(t,e),e=Qn(e),n=qn(0,t,n),r=Kn(0,e,r),new Un(n,r,t,e)}function Zn(t,e,n,r){var i=((t||"")+"").split("\n");if(1===i.length)return Yn(i[0],e,n,r);for(var o=new Un(0,0,0,0),a=0;a<i.length;a++){var s=Yn(i[a],e,n,r);0===a?o.copy(s):o.union(s)}return o}function qn(t,e,n){return"right"===n?t-=e:"center"===n&&(t-=e/2),t}function Kn(t,e,n){return"middle"===n?t-=e/2:"bottom"===n&&(t-=e),t}function Qn(t){return jn("",t)}function Jn(t,e){return"string"==typeof t?0<=t.lastIndexOf("%")?parseFloat(t)/100*e:parseFloat(t):t}function $n(t,e,n){var r=e.position||"inside",i=null!=e.distance?e.distance:5,o=n.height,a=n.width,s=o/2,l=n.x,u=n.y,h="left",c="top";if(r instanceof Array)l+=Jn(r[0],n.width),u+=Jn(r[1],n.height),c=h=null;else switch(r){case"left":l-=i,u+=s,h="right",c="middle";break;case"right":l+=i+a,u+=s,c="middle";break;case"top":l+=a/2,u-=i,h="center",c="bottom";break;case"bottom":l+=a/2,u+=o+i,h="center";break;case"inside":l+=a/2,u+=s,h="center",c="middle";break;case"insideLeft":l+=i,u+=s,c="middle";break;case"insideRight":l+=a-i,u+=s,h="right",c="middle";break;case"insideTop":l+=a/2,u+=i,h="center";break;case"insideBottom":l+=a/2,u+=o-i,h="center",c="bottom";break;case"insideTopLeft":l+=i,u+=i;break;case"insideTopRight":l+=a-i,u+=i,h="right";break;case"insideBottomLeft":l+=i,u+=o-i,c="bottom";break;case"insideBottomRight":l+=a-i,u+=o-i,h="right",c="bottom"}return(t=t||{}).x=l,t.y=u,t.align=h,t.verticalAlign=c,t}var tr=1,er=tr="undefined"!=typeof window?Math.max(window.devicePixelRatio||window.screen&&window.screen.deviceXDPI/window.screen.logicalXDPI||1,1):tr,nr="#333",rr="#ccc",ir="__zr_normal__",or=["x","y","scaleX","scaleY","originX","originY","rotation","ignore"],ar={x:!0,y:!0,scaleX:!0,scaleY:!0,originX:!0,originY:!0,rotation:!0,ignore:!1},sr={},lr=new Un(0,0,0,0),ur=(hr.prototype._init=function(t){this.attr(t)},hr.prototype.drift=function(t,e,n){switch(this.draggable){case"horizontal":e=0;break;case"vertical":t=0}var r=this.transform;(r=r||(this.transform=[1,0,0,1,0,0]))[4]+=t,r[5]+=e,this.decomposeTransform(),this.markRedraw()},hr.prototype.beforeUpdate=function(){},hr.prototype.afterUpdate=function(){},hr.prototype.update=function(){this.updateTransform(),this.__dirty&&this.updateInnerText()},hr.prototype.updateInnerText=function(t){var e,n,r,i,o,a,s,l,u,h,c=this._textContent;!c||c.ignore&&!t||(this.textConfig||(this.textConfig={}),a=(e=this.textConfig).local,i=r=void 0,n=!1,(u=c.attachedTransform).parent=a?this:null,l=!1,u.x=c.x,u.y=c.y,u.originX=c.originX,u.originY=c.originY,u.rotation=c.rotation,u.scaleX=c.scaleX,u.scaleY=c.scaleY,null!=e.position&&(s=lr,e.layoutRect?s.copy(e.layoutRect):s.copy(this.getBoundingRect()),a||s.applyTransform(this.transform),this.calculateTextPosition?this.calculateTextPosition(sr,e,s):$n(sr,e,s),u.x=sr.x,u.y=sr.y,r=sr.align,i=sr.verticalAlign,(o=e.origin)&&null!=e.rotation&&(h=t=void 0,h="center"===o?(t=.5*s.width,.5*s.height):(t=Jn(o[0],s.width),Jn(o[1],s.height)),l=!0,u.originX=-u.x+t+(a?0:s.x),u.originY=-u.y+h+(a?0:s.y))),null!=e.rotation&&(u.rotation=e.rotation),(h=e.offset)&&(u.x+=h[0],u.y+=h[1],l||(u.originX=-h[0],u.originY=-h[1])),a=null==e.inside?"string"==typeof e.position&&0<=e.position.indexOf("inside"):e.inside,s=this._innerTextDefaultStyle||(this._innerTextDefaultStyle={}),h=u=l=void 0,a&&this.canBeInsideText()?(l=e.insideFill,u=e.insideStroke,null!=l&&"auto"!==l||(l=this.getInsideTextFill()),null!=u&&"auto"!==u||(u=this.getInsideTextStroke(l),h=!0)):(l=e.outsideFill,u=e.outsideStroke,null!=l&&"auto"!==l||(l=this.getOutsideFill()),null!=u&&"auto"!==u||(u=this.getOutsideStroke(l),h=!0)),(l=l||"#000")===s.fill&&u===s.stroke&&h===s.autoStroke&&r===s.align&&i===s.verticalAlign||(n=!0,s.fill=l,s.stroke=u,s.autoStroke=h,s.align=r,s.verticalAlign=i,c.setDefaultTextStyle(s)),n&&c.dirtyStyle(),c.markRedraw())},hr.prototype.canBeInsideText=function(){return!0},hr.prototype.getInsideTextFill=function(){return"#fff"},hr.prototype.getInsideTextStroke=function(t){return"#000"},hr.prototype.getOutsideFill=function(){return this.__zr&&this.__zr.isDarkMode()?rr:nr},hr.prototype.getOutsideStroke=function(t){for(var e=this.__zr&&this.__zr.getBackgroundColor(),n="string"==typeof e&&tn(e),r=(n=n||[255,255,255,1])[3],i=this.__zr.isDarkMode(),o=0;o<3;o++)n[o]=n[o]*r+(i?0:255)*(1-r);return n[3]=1,cn(n,"rgba")},hr.prototype.traverse=function(t,e){},hr.prototype.attrKV=function(t,e){"textConfig"===t?this.setTextConfig(e):"textContent"===t?this.setTextContent(e):"clipPath"===t?this.setClipPath(e):"extra"===t?(this.extra=this.extra||{},R(this.extra,e)):this[t]=e},hr.prototype.hide=function(){this.ignore=!0,this.markRedraw()},hr.prototype.show=function(){this.ignore=!1,this.markRedraw()},hr.prototype.attr=function(t,e){if("string"==typeof t)this.attrKV(t,e);else if(K(t))for(var n=U(t),r=0;r<n.length;r++){var i=n[r];this.attrKV(i,t[i])}return this.markRedraw(),this},hr.prototype.saveCurrentToNormalState=function(t){this._innerSaveToNormal(t);for(var e=this._normalState,n=0;n<this.animators.length;n++){var r=this.animators[n],i=r.__fromStateTransition;i&&i!==ir||(i=(i=r.targetName)?e[i]:e,r.saveFinalToTarget(i))}},hr.prototype._innerSaveToNormal=function(t){var e=(e=this._normalState)||(this._normalState={});t.textConfig&&!e.textConfig&&(e.textConfig=this.textConfig),this._savePrimaryToNormal(t,e,or)},hr.prototype._savePrimaryToNormal=function(t,e,n){for(var r=0;r<n.length;r++){var i=n[r];null==t[i]||i in e||(e[i]=this[i])}},hr.prototype.hasState=function(){return 0<this.currentStates.length},hr.prototype.getState=function(t){return this.states[t]},hr.prototype.ensureState=function(t){var e=this.states;return e[t]||(e[t]={}),e[t]},hr.prototype.clearStates=function(t){this.useState(ir,!1,t)},hr.prototype.useState=function(t,e,n){var r=t===ir;if(this.hasState()||!r){var i,o=this.currentStates,a=this.stateTransition;if(!(0<=P(o,t))||!e&&1!==o.length){if((i=(i=this.stateProxy&&!r?this.stateProxy(t):i)||this.states&&this.states[t])||r)return r||this.saveCurrentToNormalState(i),o=!(!i||!i.hoverLayer),o&&this._toggleHoverLayerFlag(!0),this._applyStateObj(t,i,this._normalState,e,!n&&!this.__inHover&&a&&0<a.duration,a),this._textContent&&this._textContent.useState(t,e),this._textGuide&&this._textGuide.useState(t,e),r?(this.currentStates=[],this._normalState={}):e?this.currentStates.push(t):this.currentStates=[t],this._updateAnimationTargets(),this.markRedraw(),!o&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~hr.REDARAW_BIT),i;E("State "+t+" not exists.")}}},hr.prototype.useStates=function(t,e){if(t.length){var n=[],r=this.currentStates,i=t.length,o=i===r.length;if(o)for(var a=0;a<i;a++)if(t[a]!==r[a]){o=!1;break}if(!o){for(a=0;a<i;a++){var s=t[a],l=void 0;(l=(l=this.stateProxy?this.stateProxy(s,t):l)||this.states[s])&&n.push(l)}var u=!(!n[i-1]||!n[i-1].hoverLayer);u&&this._toggleHoverLayerFlag(!0);var h=this._mergeStates(n),c=this.stateTransition;this.saveCurrentToNormalState(h),this._applyStateObj(t.join(","),h,this._normalState,!1,!e&&!this.__inHover&&c&&0<c.duration,c),this._textContent&&this._textContent.useStates(t),this._textGuide&&this._textGuide.useStates(t),this._updateAnimationTargets(),this.currentStates=t.slice(),this.markRedraw(),!u&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~hr.REDARAW_BIT)}}else this.clearStates()},hr.prototype._updateAnimationTargets=function(){for(var t=0;t<this.animators.length;t++){var e=this.animators[t];e.targetName&&e.changeTarget(this[e.targetName])}},hr.prototype.removeState=function(t){var e=P(this.currentStates,t);0<=e&&((t=this.currentStates.slice()).splice(e,1),this.useStates(t))},hr.prototype.replaceState=function(t,e,n){var r=this.currentStates.slice(),i=P(r,t);t=0<=P(r,e);0<=i?t?r.splice(i,1):r[i]=e:n&&!t&&r.push(e),this.useStates(r)},hr.prototype.toggleState=function(t,e){e?this.useState(t,!0):this.removeState(t)},hr.prototype._mergeStates=function(t){for(var e,n={},r=0;r<t.length;r++){var i=t[r];R(n,i),i.textConfig&&R(e=e||{},i.textConfig)}return e&&(n.textConfig=e),n},hr.prototype._applyStateObj=function(t,e,n,r,i,o){var a=!(e&&r);e&&e.textConfig?(this.textConfig=R({},(r?this:n).textConfig),R(this.textConfig,e.textConfig)):a&&n.textConfig&&(this.textConfig=n.textConfig);for(var s={},l=!1,u=0;u<or.length;u++){var h=or[u],c=i&&ar[h];e&&null!=e[h]?c?(l=!0,s[h]=e[h]):this[h]=e[h]:a&&null!=n[h]&&(c?(l=!0,s[h]=n[h]):this[h]=n[h])}if(!i)for(u=0;u<this.animators.length;u++){var d=this.animators[u],p=d.targetName;d.__changeFinalValue(p?(e||n)[p]:e||n)}l&&this._transitionState(t,s,o)},hr.prototype._attachComponent=function(t){if(t.__zr&&!t.__hostTarget)throw new Error("Text element has been added to zrender.");if(t===this)throw new Error("Recursive component attachment.");var e=this.__zr;e&&t.addSelfToZr(e),t.__zr=e,t.__hostTarget=this},hr.prototype._detachComponent=function(t){t.__zr&&t.removeSelfFromZr(t.__zr),t.__zr=null,t.__hostTarget=null},hr.prototype.getClipPath=function(){return this._clipPath},hr.prototype.setClipPath=function(t){this._clipPath&&this._clipPath!==t&&this.removeClipPath(),this._attachComponent(t),this._clipPath=t,this.markRedraw()},hr.prototype.removeClipPath=function(){var t=this._clipPath;t&&(this._detachComponent(t),this._clipPath=null,this.markRedraw())},hr.prototype.getTextContent=function(){return this._textContent},hr.prototype.setTextContent=function(t){var e=this._textContent;if(e!==t){if(e&&e!==t&&this.removeTextContent(),t.__zr&&!t.__hostTarget)throw new Error("Text element has been added to zrender.");t.attachedTransform=new Le,this._attachComponent(t),this._textContent=t,this.markRedraw()}},hr.prototype.setTextConfig=function(t){this.textConfig||(this.textConfig={}),R(this.textConfig,t),this.markRedraw()},hr.prototype.removeTextContent=function(){var t=this._textContent;t&&(t.attachedTransform=null,this._detachComponent(t),this._textContent=null,this._innerTextDefaultStyle=null,this.markRedraw())},hr.prototype.getTextGuideLine=function(){return this._textGuide},hr.prototype.setTextGuideLine=function(t){this._textGuide&&this._textGuide!==t&&this.removeTextGuideLine(),this._attachComponent(t),this._textGuide=t,this.markRedraw()},hr.prototype.removeTextGuideLine=function(){var t=this._textGuide;t&&(this._detachComponent(t),this._textGuide=null,this.markRedraw())},hr.prototype.markRedraw=function(){this.__dirty|=hr.REDARAW_BIT;var t=this.__zr;t&&(this.__inHover?t.refreshHover():t.refresh()),this.__hostTarget&&this.__hostTarget.markRedraw()},hr.prototype.dirty=function(){this.markRedraw()},hr.prototype._toggleHoverLayerFlag=function(t){this.__inHover=t;var e=this._textContent,n=this._textGuide;e&&(e.__inHover=t),n&&(n.__inHover=t)},hr.prototype.addSelfToZr=function(t){this.__zr=t;var e=this.animators;if(e)for(var n=0;n<e.length;n++)t.animation.addAnimator(e[n]);this._clipPath&&this._clipPath.addSelfToZr(t),this._textContent&&this._textContent.addSelfToZr(t),this._textGuide&&this._textGuide.addSelfToZr(t)},hr.prototype.removeSelfFromZr=function(t){this.__zr=null;var e=this.animators;if(e)for(var n=0;n<e.length;n++)t.animation.removeAnimator(e[n]);this._clipPath&&this._clipPath.removeSelfFromZr(t),this._textContent&&this._textContent.removeSelfFromZr(t),this._textGuide&&this._textGuide.removeSelfFromZr(t)},hr.prototype.animate=function(t,e){var n=t?this[t]:this;if(n)return e=new En(n,e),this.addAnimator(e,t),e;E('Property "'+t+'" is not existed in element '+this.id)},hr.prototype.addAnimator=function(t,e){var n=this.__zr,r=this;t.during((function(){r.updateDuringAnimation(e)})).done((function(){var e=r.animators,n=P(e,t);0<=n&&e.splice(n,1)})),this.animators.push(t),n&&n.animation.addAnimator(t),n&&n.wakeUp()},hr.prototype.updateDuringAnimation=function(t){this.markRedraw()},hr.prototype.stopAnimation=function(t,e){for(var n=this.animators,r=n.length,i=[],o=0;o<r;o++){var a=n[o];t&&t!==a.scope?i.push(a):a.stop(e)}return this.animators=i,this},hr.prototype.animateTo=function(t,e,n){cr(this,t,e,n)},hr.prototype.animateFrom=function(t,e,n){cr(this,t,e,n,!0)},hr.prototype._transitionState=function(t,e,n,r){for(var i=cr(this,e,n,r),o=0;o<i.length;o++)i[o].__fromStateTransition=t},hr.prototype.getBoundingRect=function(){return null},hr.prototype.getPaintRect=function(){return null},hr.REDARAW_BIT=1,hr.initDefaultProps=function(){var t=hr.prototype;t.type="element",t.name="",t.ignore=!1,t.silent=!1,t.isGroup=!1,t.draggable=!1,t.dragging=!1,t.ignoreClip=!1,t.__inHover=!1,t.__dirty=hr.REDARAW_BIT;var e={};function n(t,n,r){e[t+n+r]||(console.warn("DEPRECATED: '"+t+"' has been deprecated. use '"+n+"', '"+r+"' instead"),e[t+n+r]=!0)}function r(e,r,i,o){function a(t,e){Object.defineProperty(e,0,{get:function(){return t[i]},set:function(e){t[i]=e}}),Object.defineProperty(e,1,{get:function(){return t[o]},set:function(e){t[o]=e}})}Object.defineProperty(t,e,{get:function(){var t;return n(e,i,o),this[r]||(t=this[r]=[],a(this,t)),this[r]},set:function(t){n(e,i,o),this[i]=t[0],this[o]=t[1],this[r]=t,a(this,t)}})}Object.defineProperty&&(!g.browser.ie||8<g.browser.version)&&(r("position","_legacyPos","x","y"),r("scale","_legacyScale","scaleX","scaleY"),r("origin","_legacyOrigin","originX","originY"))}(),hr);function hr(t){this.id=C++,this.animators=[],this.currentStates=[],this.states={},this._init(t)}function cr(t,e,n,r,i){var o=[];function a(){u=!0,--l<=0&&(u?h&&h():c&&c())}function s(){--l<=0&&(u?h&&h():c&&c())}!function t(e,n,r,i,o,a,s,l){for(var u=[],h=[],c=U(i),d=o.duration,p=o.delay,f=o.additive,g=o.setToFinal,m=!K(a),y=0;y<c.length;y++){var _=c[y];null!=r[_]&&null!=i[_]&&(m||a[_])?K(i[_])&&!B(i[_])?n?l||(r[_]=i[_],e.updateDuringAnimation(n)):t(e,_,r[_],i[_],o,a&&a[_],s,l):(u.push(_),h.push(_)):l||(r[_]=i[_],e.updateDuringAnimation(n),h.push(_))}var v=u.length;if(0<v||o.force&&!s.length){for(var x=e.animators,b=[],T=0;T<x.length;T++)x[T].targetName===n&&b.push(x[T]);if(!f&&b.length)for(T=0;T<b.length;T++){var w=b[T].stopTracks(h);w&&(w=P(x,b[T]),x.splice(w,1))}var S=void 0,M=void 0,A=void 0;if(l)for(M={},g&&(S={}),T=0;T<v;T++)_=u[T],M[_]=r[_],g?S[_]=i[_]:r[_]=i[_];else if(g)for(A={},T=0;T<v;T++)_=u[T],A[_]=Tn(r[_]),pr(r,i,_);f=new En(r,!1,f?b:null),f.targetName=n,o.scope&&(f.scope=o.scope),g&&S&&f.whenWithKeys(0,S,u),A&&f.whenWithKeys(0,A,u),f.whenWithKeys(null==d?500:d,l?M:i,u).delay(p||0),e.addAnimator(f,n),s.push(f)}}(t,"",t,e,n=n||{},r,o,i);var l=o.length,u=!1,h=n.done,c=n.aborted;l||h&&h(),0<o.length&&n.during&&o[0].during((function(t,e){n.during(e)}));for(var d=0;d<o.length;d++){var p=o[d];p.done(a),p.aborted(s),p.start(n.easing,n.force)}return o}function dr(t,e,n){for(var r=0;r<n;r++)t[r]=e[r]}function pr(t,e,n){if(B(e[n]))if(B(t[n])||(t[n]=[]),J(e[n])){var r=e[n].length;t[n].length!==r&&(t[n]=new e[n].constructor(r),dr(t[n],e[n],r))}else{var i=e[n],o=t[n],a=i.length;if(B(i[0]))for(var s=i[0].length,l=0;l<a;l++)o[l]?dr(o[l],i[l],s):o[l]=Array.prototype.slice.call(i[l]);else dr(o,i,a);o.length=i.length}else t[n]=e[n]}k(ur,Bt),k(ur,Le);var fr=ur,gr=32,mr=7;function yr(t,e,n,r){var i=e+1;if(i===n)return 1;if(r(t[i++],t[e])<0){for(;i<n&&r(t[i],t[i-1])<0;)i++;!function(t,e,n){for(n--;e<n;){var r=t[e];t[e++]=t[n],t[n--]=r}}(t,e,i)}else for(;i<n&&0<=r(t[i],t[i-1]);)i++;return i-e}function _r(t,e,n,r,i){for(r===e&&r++;r<n;r++){for(var o,a=t[r],s=e,l=r;s<l;)i(a,t[o=s+l>>>1])<0?l=o:s=1+o;var u=r-s;switch(u){case 3:t[s+3]=t[s+2];case 2:t[s+2]=t[s+1];case 1:t[s+1]=t[s];break;default:for(;0<u;)t[s+u]=t[s+u-1],u--}t[s]=a}}function vr(t,e,n,r,i,o){var a=0,s=0,l=1;if(0<o(t,e[n+i])){for(s=r-i;l<s&&0<o(t,e[n+i+l]);)(l=1+((a=l)<<1))<=0&&(l=s);s<l&&(l=s),a+=i,l+=i}else{for(s=i+1;l<s&&o(t,e[n+i-l])<=0;)(l=1+((a=l)<<1))<=0&&(l=s);r=a,a=i-(l=s<l?s:l),l=i-r}for(a++;a<l;){var u=a+(l-a>>>1);0<o(t,e[n+u])?a=u+1:l=u}return l}function xr(t,e,n,r,i,o){var a=0,s=0,l=1;if(o(t,e[n+i])<0){for(s=i+1;l<s&&o(t,e[n+i-l])<0;)(l=1+((a=l)<<1))<=0&&(l=s);var u=a;a=i-(l=s<l?s:l),l=i-u}else{for(s=r-i;l<s&&0<=o(t,e[n+i+l]);)(l=1+((a=l)<<1))<=0&&(l=s);s<l&&(l=s),a+=i,l+=i}for(a++;a<l;){var h=a+(l-a>>>1);o(t,e[n+h])<0?l=h:a=h+1}return l}function br(t,e){var n,r,i=mr,o=0;t.length;var a=[];function s(s){var l=n[s],u=r[s],h=n[s+1],c=r[s+1];r[s]=u+c,s===o-3&&(n[s+1]=n[s+2],r[s+1]=r[s+2]),o--,s=xr(t[h],t,l,u,0,e),l+=s,0!=(u-=s)&&0!==(c=vr(t[l+u-1],t,h,c,c-1,e))&&(u<=c?function(n,r,o,s){var l=0;for(l=0;l<r;l++)a[l]=t[n+l];var u=0,h=o,c=n;if(t[c++]=t[h++],0!=--s)if(1!==r){for(var d,p,f,g=i;;){p=d=0,f=!1;do{if(e(t[h],a[u])<0){if(t[c++]=t[h++],p++,(d=0)==--s){f=!0;break}}else if(t[c++]=a[u++],d++,p=0,1==--r){f=!0;break}}while((d|p)<g);if(f)break;do{if(0!==(d=xr(t[h],a,u,r,0,e))){for(l=0;l<d;l++)t[c+l]=a[u+l];if(c+=d,u+=d,(r-=d)<=1){f=!0;break}}if(t[c++]=t[h++],0==--s){f=!0;break}if(0!==(p=vr(a[u],t,h,s,0,e))){for(l=0;l<p;l++)t[c+l]=t[h+l];if(c+=p,h+=p,0===(s-=p)){f=!0;break}}if(t[c++]=a[u++],1==--r){f=!0;break}}while(g--,mr<=d||mr<=p);if(f)break;g<0&&(g=0),g+=2}if((i=g)<1&&(i=1),1===r){for(l=0;l<s;l++)t[c+l]=t[h+l];t[c+s]=a[u]}else{if(0===r)throw new Error;for(l=0;l<r;l++)t[c+l]=a[u+l]}}else{for(l=0;l<s;l++)t[c+l]=t[h+l];t[c+s]=a[u]}else for(l=0;l<r;l++)t[c+l]=a[u+l]}:function(n,r,o,s){var l=0;for(l=0;l<s;l++)a[l]=t[o+l];var u=n+r-1,h=s-1,c=o+s-1,d=0,p=0;if(t[c--]=t[u--],0!=--r)if(1!==s){for(var f=i;;){var g=0,m=0,y=!1;do{if(e(a[h],t[u])<0){if(t[c--]=t[u--],g++,(m=0)==--r){y=!0;break}}else if(t[c--]=a[h--],m++,g=0,1==--s){y=!0;break}}while((g|m)<f);if(y)break;do{if(0!==(g=r-xr(a[h],t,n,r,r-1,e))){for(r-=g,p=1+(c-=g),d=1+(u-=g),l=g-1;0<=l;l--)t[p+l]=t[d+l];if(0===r){y=!0;break}}if(t[c--]=a[h--],1==--s){y=!0;break}if(0!==(m=s-vr(t[u],a,0,s,s-1,e))){for(s-=m,p=1+(c-=m),d=1+(h-=m),l=0;l<m;l++)t[p+l]=a[d+l];if(s<=1){y=!0;break}}if(t[c--]=t[u--],0==--r){y=!0;break}}while(f--,mr<=g||mr<=m);if(y)break;f<0&&(f=0),f+=2}if((i=f)<1&&(i=1),1===s){for(p=1+(c-=r),d=1+(u-=r),l=r-1;0<=l;l--)t[p+l]=t[d+l];t[c]=a[h]}else{if(0===s)throw new Error;for(d=c-(s-1),l=0;l<s;l++)t[d+l]=a[l]}}else{for(p=1+(c-=r),d=1+(u-=r),l=r-1;0<=l;l--)t[p+l]=t[d+l];t[c]=a[h]}else for(d=c-(s-1),l=0;l<s;l++)t[d+l]=a[l]})(l,u,h,c)}return n=[],r=[],{mergeRuns:function(){for(;1<o;){var t=o-2;if(1<=t&&r[t-1]<=r[t]+r[t+1]||2<=t&&r[t-2]<=r[t]+r[t-1])r[t-1]<r[t+1]&&t--;else if(r[t]>r[t+1])break;s(t)}},forceMergeRuns:function(){for(;1<o;){var t=o-2;0<t&&r[t-1]<r[t+1]&&t--,s(t)}},pushRun:function(t,e){n[o]=t,r[o]=e,o+=1}}}function Tr(t,e,n,r){var i=(r=r||t.length)-(n=n||0);if(!(i<2)){var o=0;if(i<gr)_r(t,n,r,n+(o=yr(t,n,r,e)),e);else{var a,s=br(t,e),l=function(t){for(var e=0;gr<=t;)e|=1&t,t>>=1;return t+e}(i);do{}while((o=yr(t,n,r,e))<l&&(_r(t,n,n+(a=l<(a=i)?l:i),n+o,e),o=a),s.pushRun(n,o),s.mergeRuns(),n+=o,0!==(i-=o));s.forceMergeRuns()}}}var wr=!1;function Sr(){wr||(wr=!0,console.warn("z / z2 / zlevel of displayable is invalid, which may cause unexpected errors"))}function Mr(t,e){return t.zlevel===e.zlevel?t.z===e.z?t.z2-e.z2:t.z-e.z:t.zlevel-e.zlevel}function Ar(){this._roots=[],this._displayList=[],this._displayListLen=0,this.displayableSortFunc=Mr}var Cr,Er=(Ar.prototype.traverse=function(t,e){for(var n=0;n<this._roots.length;n++)this._roots[n].traverse(t,e)},Ar.prototype.getDisplayList=function(t,e){e=e||!1;var n=this._displayList;return!t&&n.length||this.updateDisplayList(e),n},Ar.prototype.updateDisplayList=function(t){this._displayListLen=0;for(var e=this._roots,n=this._displayList,r=0,i=e.length;r<i;r++)this._updateAndAddDisplayable(e[r],null,t);n.length=this._displayListLen,g.canvasSupported&&Tr(n,Mr)},Ar.prototype._updateAndAddDisplayable=function(t,e,n){if(!t.ignore||n){t.beforeUpdate(),t.update(),t.afterUpdate();var r=t.getClipPath();if(t.ignoreClip)e=null;else if(r){e=e?e.slice():[];for(var i=r,o=t;i;)i.parent=o,i.updateTransform(),e.push(i),i=(o=i).getClipPath()}if(t.childrenRef){for(var a=t.childrenRef(),s=0;s<a.length;s++){var l=a[s];t.__dirty&&(l.__dirty|=fr.REDARAW_BIT),this._updateAndAddDisplayable(l,e,n)}t.__dirty=0}else{var u=t;e&&e.length?u.__clipPaths=e:u.__clipPaths&&0<u.__clipPaths.length&&(u.__clipPaths=[]),isNaN(u.z)&&(Sr(),u.z=0),isNaN(u.z2)&&(Sr(),u.z2=0),isNaN(u.zlevel)&&(Sr(),u.zlevel=0),this._displayList[this._displayListLen++]=u}u=t.getDecalElement&&t.getDecalElement(),u&&this._updateAndAddDisplayable(u,e,n),u=t.getTextGuideLine(),u&&this._updateAndAddDisplayable(u,e,n),u=t.getTextContent(),u&&this._updateAndAddDisplayable(u,e,n)}},Ar.prototype.addRoot=function(t){t.__zr&&t.__zr.storage===this||this._roots.push(t)},Ar.prototype.delRoot=function(t){if(t instanceof Array)for(var e=0,n=t.length;e<n;e++)this.delRoot(t[e]);else{var r=P(this._roots,t);0<=r&&this._roots.splice(r,1)}},Ar.prototype.delAllRoots=function(){this._roots=[],this._displayList=[],this._displayListLen=0},Ar.prototype.getRoots=function(){return this._roots},Ar.prototype.dispose=function(){this._displayList=null,this._roots=null},Ar),Ir="undefined"!=typeof window&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(t){return setTimeout(t,16)};function Dr(t){var e=Cr.call(this)||this;return e._running=!1,e._time=0,e._pausedTime=0,e._pauseStart=0,e._paused=!1,e.stage=(t=t||{}).stage||{},e.onframe=t.onframe||function(){},e}var Rr,Lr=(_t(Dr,Cr=Bt),Dr.prototype.addClip=function(t){t.animation&&this.removeClip(t),this._clipsHead?((this._clipsTail.next=t).prev=this._clipsTail,t.next=null,this._clipsTail=t):this._clipsHead=this._clipsTail=t,t.animation=this},Dr.prototype.addAnimator=function(t){t.animation=this,t=t.getClip(),t&&this.addClip(t)},Dr.prototype.removeClip=function(t){var e,n;t.animation&&(e=t.prev,n=t.next,e?e.next=n:this._clipsHead=n,n?n.prev=e:this._clipsTail=e,t.next=t.prev=t.animation=null)},Dr.prototype.removeAnimator=function(t){var e=t.getClip();e&&this.removeClip(e),t.animation=null},Dr.prototype.update=function(t){for(var e=(new Date).getTime()-this._pausedTime,n=e-this._time,r=this._clipsHead;r;){var i=r.next;r=(r.step(e,n)&&(r.ondestroy&&r.ondestroy(),this.removeClip(r)),i)}this._time=e,t||(this.onframe(n),this.trigger("frame",n),this.stage.update&&this.stage.update())},Dr.prototype._startLoop=function(){var t=this;this._running=!0,Ir((function e(){t._running&&(Ir(e),t._paused||t.update())}))},Dr.prototype.start=function(){this._running||(this._time=(new Date).getTime(),this._pausedTime=0,this._startLoop())},Dr.prototype.stop=function(){this._running=!1},Dr.prototype.pause=function(){this._paused||(this._pauseStart=(new Date).getTime(),this._paused=!0)},Dr.prototype.resume=function(){this._paused&&(this._pausedTime+=(new Date).getTime()-this._pauseStart,this._paused=!1)},Dr.prototype.clear=function(){for(var t=this._clipsHead;t;){var e=t.next;t.prev=t.next=t.animation=null,t=e}this._clipsHead=this._clipsTail=null},Dr.prototype.isFinished=function(){return null==this._clipsHead},Dr.prototype.animate=function(t,e){return e=e||{},this.start(),e=new En(t,e.loop),this.addAnimator(e),e},Dr),Or=g.domSupported,Pr=(Rr={pointerdown:1,pointerup:1,pointermove:1,pointerout:1},{mouse:wu=["click","dblclick","mousewheel","wheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],touch:["touchstart","touchend","touchmove"],pointer:z(wu,(function(t){var e=t.replace("mouse","pointer");return Rr.hasOwnProperty(e)?e:t}))}),Nr=["mousemove","mouseup"],kr=["pointermove","pointerup"],Br=!1;function Fr(t){return t=t.pointerType,"pen"===t||"touch"===t}function zr(t){t&&(t.zrByTouch=!0)}function Hr(t,e){for(var n=e,r=!1;n&&9!==n.nodeType&&!(r=n.domBelongToZr||n!==e&&n===t.painterRoot);)n=n.parentNode;return r}var Vr=function(t,e){this.stopPropagation=mt,this.stopImmediatePropagation=mt,this.preventDefault=mt,this.type=e.type,this.target=this.currentTarget=t.dom,this.pointerType=e.pointerType,this.clientX=e.clientX,this.clientY=e.clientY},Ur={mousedown:function(t){t=Qt(this.dom,t),this.__mayPointerCapture=[t.zrX,t.zrY],this.trigger("mousedown",t)},mousemove:function(t){t=Qt(this.dom,t);var e=this.__mayPointerCapture;!e||t.zrX===e[0]&&t.zrY===e[1]||this.__togglePointerCapture(!0),this.trigger("mousemove",t)},mouseup:function(t){t=Qt(this.dom,t),this.__togglePointerCapture(!1),this.trigger("mouseup",t)},mouseout:function(t){Hr(this,(t=Qt(this.dom,t)).toElement||t.relatedTarget)||(this.__pointerCapturing&&(t.zrEventControl="no_globalout"),this.trigger("mouseout",t))},wheel:function(t){Br=!0,t=Qt(this.dom,t),this.trigger("mousewheel",t)},mousewheel:function(t){Br||(t=Qt(this.dom,t),this.trigger("mousewheel",t))},touchstart:function(t){zr(t=Qt(this.dom,t)),this.__lastTouchMoment=new Date,this.handler.processGesture(t,"start"),Ur.mousemove.call(this,t),Ur.mousedown.call(this,t)},touchmove:function(t){zr(t=Qt(this.dom,t)),this.handler.processGesture(t,"change"),Ur.mousemove.call(this,t)},touchend:function(t){zr(t=Qt(this.dom,t)),this.handler.processGesture(t,"end"),Ur.mouseup.call(this,t),+new Date-+this.__lastTouchMoment<300&&Ur.click.call(this,t)},pointerdown:function(t){Ur.mousedown.call(this,t)},pointermove:function(t){Fr(t)||Ur.mousemove.call(this,t)},pointerup:function(t){Ur.mouseup.call(this,t)},pointerout:function(t){Fr(t)||Ur.mouseout.call(this,t)}};F(["click","dblclick","contextmenu"],(function(t){Ur[t]=function(e){e=Qt(this.dom,e),this.trigger(t,e)}}));var Gr={pointermove:function(t){Fr(t)||Gr.mousemove.call(this,t)},pointerup:function(t){Gr.mouseup.call(this,t)},mousemove:function(t){this.trigger("mousemove",t)},mouseup:function(t){var e=this.__pointerCapturing;this.__togglePointerCapture(!1),this.trigger("mouseup",t),e&&(t.zrEventControl="only_globalout",this.trigger("mouseout",t))}};function Wr(t,e){var n=e.domHandlers;g.pointerEventsSupported?F(Pr.pointer,(function(r){jr(e,r,(function(e){n[r].call(t,e)}))})):(g.touchEventsSupported&&F(Pr.touch,(function(r){jr(e,r,(function(i){var o;n[r].call(t,i),(o=e).touching=!0,null!=o.touchTimer&&(clearTimeout(o.touchTimer),o.touchTimer=null),o.touchTimer=setTimeout((function(){o.touching=!1,o.touchTimer=null}),700)}))})),F(Pr.mouse,(function(r){jr(e,r,(function(i){i=Kt(i),e.touching||n[r].call(t,i)}))})))}function Xr(t,e){function n(n){jr(e,n,(function(r){var i;r=Kt(r),Hr(t,r.target)||(i=r,r=Qt(t.dom,new Vr(t,i),!0),e.domHandlers[n].call(t,r))}),{capture:!0})}g.pointerEventsSupported?F(kr,n):g.touchEventsSupported||F(Nr,n)}function jr(t,e,n,r){t.mounted[e]=n,t.listenerOpts[e]=r,Jt(t.domTarget,e,n,r)}function Yr(t){var e,n,r,i,o,a=t.mounted;for(e in a)a.hasOwnProperty(e)&&(n=t.domTarget,i=a[r=e],o=t.listenerOpts[e],Xt?n.removeEventListener(r,i,o):n.detachEvent("on"+r,i));t.mounted={}}var Zr,qr=function(t,e){this.mounted={},this.listenerOpts={},this.touching=!1,this.domTarget=t,this.domHandlers=e};function Kr(t,e){var n=Zr.call(this)||this;return n.__pointerCapturing=!1,n.dom=t,n.painterRoot=e,n._localHandlerScope=new qr(t,Ur),Or&&(n._globalHandlerScope=new qr(document,Gr)),Wr(n,n._localHandlerScope),n}var Qr,Jr=(_t(Kr,Zr=Bt),Kr.prototype.dispose=function(){Yr(this._localHandlerScope),Or&&Yr(this._globalHandlerScope)},Kr.prototype.setCursor=function(t){this.dom.style&&(this.dom.style.cursor=t||"default")},Kr.prototype.__togglePointerCapture=function(t){var e;this.__mayPointerCapture=null,Or&&+this.__pointerCapturing^+t&&(this.__pointerCapturing=t,e=this._globalHandlerScope,t?Xr(this,e):Yr(e))},Kr),$r=(_t(ti,Qr=fr),ti.prototype.childrenRef=function(){return this._children},ti.prototype.children=function(){return this._children.slice()},ti.prototype.childAt=function(t){return this._children[t]},ti.prototype.childOfName=function(t){for(var e=this._children,n=0;n<e.length;n++)if(e[n].name===t)return e[n]},ti.prototype.childCount=function(){return this._children.length},ti.prototype.add=function(t){if(t&&(t!==this&&t.parent!==this&&(this._children.push(t),this._doAdd(t)),t.__hostTarget))throw"This elemenet has been used as an attachment";return this},ti.prototype.addBefore=function(t,e){var n;return t&&t!==this&&t.parent!==this&&e&&e.parent===this&&0<=(e=(n=this._children).indexOf(e))&&(n.splice(e,0,t),this._doAdd(t)),this},ti.prototype.replaceAt=function(t,e){var n=this._children,r=n[e];return t&&t!==this&&t.parent!==this&&t!==r&&(n[e]=t,r.parent=null,(e=this.__zr)&&r.removeSelfFromZr(e),this._doAdd(t)),this},ti.prototype._doAdd=function(t){t.parent&&t.parent.remove(t);var e=(t.parent=this).__zr;e&&e!==t.__zr&&t.addSelfToZr(e),e&&e.refresh()},ti.prototype.remove=function(t){var e=this.__zr,n=this._children,r=P(n,t);return r<0||(n.splice(r,1),t.parent=null,e&&t.removeSelfFromZr(e),e&&e.refresh()),this},ti.prototype.removeAll=function(){for(var t=this._children,e=this.__zr,n=0;n<t.length;n++){var r=t[n];e&&r.removeSelfFromZr(e),r.parent=null}return t.length=0,this},ti.prototype.eachChild=function(t,e){for(var n=this._children,r=0;r<n.length;r++){var i=n[r];t.call(e,i,r)}return this},ti.prototype.traverse=function(t,e){for(var n=0;n<this._children.length;n++){var r=this._children[n],i=t.call(e,r);r.isGroup&&!i&&r.traverse(t,e)}return this},ti.prototype.addSelfToZr=function(t){Qr.prototype.addSelfToZr.call(this,t);for(var e=0;e<this._children.length;e++)this._children[e].addSelfToZr(t)},ti.prototype.removeSelfFromZr=function(t){Qr.prototype.removeSelfFromZr.call(this,t);for(var e=0;e<this._children.length;e++)this._children[e].removeSelfFromZr(t)},ti.prototype.getBoundingRect=function(t){for(var e=new Un(0,0,0,0),n=t||this._children,r=[],i=null,o=0;o<n.length;o++){var a,s=n[o];s.ignore||s.invisible||(a=s.getBoundingRect(),(s=s.getLocalTransform(r))?(Un.applyTransform(e,a,s),(i=i||e.clone()).union(e)):(i=i||a.clone()).union(a))}return i||e},ti);function ti(t){var e=Qr.call(this)||this;return e.isGroup=!0,e._children=[],e.attr(t),e}$r.prototype.type="group";var ei=$r,ni=!g.canvasSupported,ri={},ii={},oi=(ai.prototype.add=function(t){t&&(this.storage.addRoot(t),t.addSelfToZr(this),this.refresh())},ai.prototype.remove=function(t){t&&(this.storage.delRoot(t),t.removeSelfFromZr(this),this.refresh())},ai.prototype.configLayer=function(t,e){this.painter.configLayer&&this.painter.configLayer(t,e),this.refresh()},ai.prototype.setBackgroundColor=function(t){this.painter.setBackgroundColor&&this.painter.setBackgroundColor(t),this.refresh(),this._backgroundColor=t,this._darkMode=function(t){if(!t)return!1;if("string"==typeof t)return dn(t,1)<.4;if(t.colorStops){for(var e=t.colorStops,n=0,r=e.length,i=0;i<r;i++)n+=dn(e[i].color,1);return(n/=r)<.4}return!1}(t)},ai.prototype.getBackgroundColor=function(){return this._backgroundColor},ai.prototype.setDarkMode=function(t){this._darkMode=t},ai.prototype.isDarkMode=function(){return this._darkMode},ai.prototype.refreshImmediately=function(t){t||this.animation.update(!0),this._needsRefresh=!1,this.painter.refresh(),this._needsRefresh=!1},ai.prototype.refresh=function(){this._needsRefresh=!0,this.animation.start()},ai.prototype.flush=function(){this._flush(!1)},ai.prototype._flush=function(t){var e,n=(new Date).getTime();this._needsRefresh&&(e=!0,this.refreshImmediately(t)),this._needsRefreshHover&&(e=!0,this.refreshHoverImmediately()),t=(new Date).getTime(),e?(this._stillFrameAccum=0,this.trigger("rendered",{elapsedTime:t-n})):0<this._sleepAfterStill&&(this._stillFrameAccum++,this._stillFrameAccum>this._sleepAfterStill&&this.animation.stop())},ai.prototype.setSleepAfterStill=function(t){this._sleepAfterStill=t},ai.prototype.wakeUp=function(){this.animation.start(),this._stillFrameAccum=0},ai.prototype.addHover=function(t){},ai.prototype.removeHover=function(t){},ai.prototype.clearHover=function(){},ai.prototype.refreshHover=function(){this._needsRefreshHover=!0},ai.prototype.refreshHoverImmediately=function(){this._needsRefreshHover=!1,this.painter.refreshHover&&"canvas"===this.painter.getType()&&this.painter.refreshHover()},ai.prototype.resize=function(t){this.painter.resize((t=t||{}).width,t.height),this.handler.resize()},ai.prototype.clearAnimation=function(){this.animation.clear()},ai.prototype.getWidth=function(){return this.painter.getWidth()},ai.prototype.getHeight=function(){return this.painter.getHeight()},ai.prototype.pathToImage=function(t,e){if(this.painter.pathToImage)return this.painter.pathToImage(t,e)},ai.prototype.setCursorStyle=function(t){this.handler.setCursorStyle(t)},ai.prototype.findHover=function(t,e){return this.handler.findHover(t,e)},ai.prototype.on=function(t,e,n){return this.handler.on(t,e,n),this},ai.prototype.off=function(t,e){this.handler.off(t,e)},ai.prototype.trigger=function(t,e){this.handler.trigger(t,e)},ai.prototype.clear=function(){for(var t=this.storage.getRoots(),e=0;e<t.length;e++)t[e]instanceof ei&&t[e].removeSelfFromZr(this);this.storage.delAllRoots(),this.painter.clear()},ai.prototype.dispose=function(){var t;this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=this.storage=this.painter=this.handler=null,t=this.id,delete ii[t]},ai);
/*!
* ZRender, a high performance 2d drawing library.
*
* Copyright (c) 2013, Baidu Inc.
* All rights reserved.
*
* LICENSE
* https://github.com/ecomfe/zrender/blob/master/LICENSE.txt
*/function ai(t,e,n){var r=this;this._sleepAfterStill=10,this._stillFrameAccum=0,this._needsRefresh=!0,this._needsRefreshHover=!0,this._darkMode=!1,n=n||{},this.dom=e,this.id=t;var i=new Er,o=n.renderer||"canvas";if(ni)throw new Error("IE8 support has been dropped since 5.0");if(ri[o]||(o=U(ri)[0]),!ri[o])throw new Error("Renderer '"+o+"' is not imported. Please import it first.");n.useDirtyRect=null!=n.useDirtyRect&&n.useDirtyRect,n=new ri[o](e,i,n,t),this.storage=i,this.painter=n,t=g.node||g.worker?null:new Jr(n.getViewportRoot(),n.root),this.handler=new me(i,n,t,n.root),this.animation=new Lr({stage:{update:function(){return r._flush(!0)}}}),this.animation.start()}function si(t,e){return e=new oi(C++,t,e),ii[e.id]=e}var li=1e-4;function ui(t,e,n,r){var i=e[1]-e[0],o=n[1]-n[0];if(0==i)return 0==o?n[0]:(n[0]+n[1])/2;if(r)if(0<i){if(t<=e[0])return n[0];if(t>=e[1])return n[1]}else{if(t>=e[0])return n[0];if(t<=e[1])return n[1]}else{if(t===e[0])return n[0];if(t===e[1])return n[1]}return(t-e[0])/i*o+n[0]}function hi(t,e){switch(t){case"center":case"middle":t="50%";break;case"left":case"top":t="0%";break;case"right":case"bottom":t="100%"}return"string"==typeof t?t.replace(/^\s+|\s+$/g,"").match(/%$/)?parseFloat(t)/100*e:parseFloat(t):null==t?NaN:+t}function ci(t,e,n){return null==e&&(e=10),e=Math.min(Math.max(0,e),20),t=(+t).toFixed(e),n?t:+t}function di(t){return t.sort((function(t,e){return t-e})),t}function pi(t){if(t=+t,isNaN(t))return 0;for(var e=1,n=0;Math.round(t*e)/e!==t;)e*=10,n++;return n}function fi(t){var e=t.toString();t=e.indexOf("e");if(0<t){var n=+e.slice(t+1);return n<0?-n:0}return n=e.indexOf("."),n<0?0:e.length-1-n}function gi(t,e){var n=Math.log,r=Math.LN10;t=Math.floor(n(t[1]-t[0])/r),r=Math.round(n(Math.abs(e[1]-e[0]))/r),r=Math.min(Math.max(-t+r,0),20);return isFinite(r)?r:20}function mi(t,e,n){if(!t[e])return 0;var r=H(t,(function(t,e){return t+(isNaN(e)?0:e)}),0);if(0===r)return 0;for(var i=Math.pow(10,n),o=(t=z(t,(function(t){return(isNaN(t)?0:t)/r*i*100})),100*i),a=z(t,(function(t){return Math.floor(t)})),s=H(a,(function(t,e){return t+e}),0),l=z(t,(function(t,e){return t-a[e]}));s<o;){for(var u=Number.NEGATIVE_INFINITY,h=null,c=0,d=l.length;c<d;++c)l[c]>u&&(u=l[c],h=c);++a[h],l[h]=0,++s}return a[e]/i}var yi=9007199254740991;function _i(t){var e=2*Math.PI;return(t%e+e)%e}function vi(t){return-li<t&&t<li}var xi=/^(?:(\d{4})(?:[-\/](\d{1,2})(?:[-\/](\d{1,2})(?:[T ](\d{1,2})(?::(\d{1,2})(?::(\d{1,2})(?:[.,](\d+))?)?)?(Z|[\+\-]\d\d:?\d\d)?)?)?)?)?$/;function bi(t){if(t instanceof Date)return t;if("string"!=typeof t)return null==t?new Date(NaN):new Date(Math.round(t));var e=xi.exec(t);return e?e[8]?(t=+e[4]||0,"Z"!==e[8].toUpperCase()&&(t-=+e[8].slice(0,3)),new Date(Date.UTC(+e[1],+(e[2]||1)-1,+e[3]||1,t,+(e[5]||0),+e[6]||0,+e[7]||0))):new Date(+e[1],+(e[2]||1)-1,+e[3]||1,+e[4]||0,+(e[5]||0),+e[6]||0,+e[7]||0):new Date(NaN)}function Ti(t){return Math.pow(10,wi(t))}function wi(t){if(0===t)return 0;var e=Math.floor(Math.log(t)/Math.LN10);return 10<=t/Math.pow(10,e)&&e++,e}function Si(t,e){var n=wi(t),r=Math.pow(10,n),i=t/r;i=e?i<1.5?1:i<2.5?2:i<4?3:i<7?5:10:i<1?1:i<2?2:i<3?3:i<5?5:10;return t=i*r,-20<=n?+t.toFixed(n<0?-n:0):t}function Mi(t,e){var n=(t.length-1)*e+1,r=Math.floor(n);e=+t[r-1],n-=r;return n?e+n*(t[r]-e):e}function Ai(t){t.sort((function(t,e){return function t(e,n,r){return e.interval[r]<n.interval[r]||e.interval[r]===n.interval[r]&&(e.close[r]-n.close[r]==(r?-1:1)||!r&&t(e,n,1))}(t,e,0)?-1:1}));for(var e=-1/0,n=1,r=0;r<t.length;){for(var i=t[r].interval,o=t[r].close,a=0;a<2;a++)i[a]<=e&&(i[a]=e,o[a]=a?1:1-n),e=i[a],n=o[a];i[0]===i[1]&&o[0]*o[1]!=1?t.splice(r,1):r++}return t}function Ci(t){var e=parseFloat(t);return e==t&&(0!==e||"string"!=typeof t||t.indexOf("x")<=0)?e:NaN}function Ei(t){return!isNaN(Ci(t))}function Ii(){return Math.round(9*Math.random())}function Di(t,e){return null==t?e:null==e?t:t*e/function t(e,n){return 0===n?e:t(n,e%n)}(t,e)}var Ri="series\0",Li="\0_ec_\0";function Oi(t){return t instanceof Array?t:null==t?[]:[t]}function Pi(t,e,n){if(t){t[e]=t[e]||{},t.emphasis=t.emphasis||{},t.emphasis[e]=t.emphasis[e]||{};for(var r=0,i=n.length;r<i;r++){var o=n[r];!t.emphasis[e].hasOwnProperty(o)&&t[e].hasOwnProperty(o)&&(t.emphasis[e][o]=t[e][o])}}}var Ni=["fontStyle","fontWeight","fontSize","fontFamily","rich","tag","color","textBorderColor","textBorderWidth","width","height","lineHeight","align","verticalAlign","baseline","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","textShadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY","backgroundColor","borderColor","borderWidth","borderRadius","padding"];function ki(t){return!K(t)||X(t)||t instanceof Date?t:t.value}function Bi(t,e,n){var r="normalMerge"===n,i="replaceMerge"===n,o="replaceAll"===n;t=t||[],e=(e||[]).slice();var a=pt();F(e,(function(t,n){K(t)||(e[n]=null)}));var s,l,u,h,c,d,p,f,g,m;n=function(t,e,n){var r=[];if("replaceAll"===n)return r;for(var i=0;i<t.length;i++){var o=t[i];o&&null!=o.id&&e.set(o.id,i),r.push({existing:"replaceMerge"===n||Ui(o)?null:o,newOption:null,keyInfo:null,brandNew:null})}return r}(t,a,n);return(r||i)&&(s=n,l=t,u=a,F(h=e,(function(t,e){var n,r,i;t&&null!=t.id&&(n=zi(t.id),null!=(r=u.get(n))&&(at(!(i=s[r]).newOption,'Duplicated option on id "'+n+'".'),i.newOption=t,i.existing=l[r],h[e]=null))}))),r&&(c=n,F(d=e,(function(t,e){if(t&&null!=t.name)for(var n=0;n<c.length;n++){var r=c[n].existing;if(!c[n].newOption&&r&&(null==r.id||null==t.id)&&!Ui(t)&&!Ui(r)&&Fi("name",r,t))return c[n].newOption=t,void(d[e]=null)}}))),r||i?(f=n,g=i,F(e,(function(t){if(t){for(var e,n=0;(e=f[n])&&(e.newOption||Ui(e.existing)||e.existing&&null!=t.id&&!Fi("id",t,e.existing));)n++;e?(e.newOption=t,e.brandNew=g):f.push({newOption:t,brandNew:g,existing:null,keyInfo:null}),n++}}))):o&&(p=n,F(e,(function(t){p.push({newOption:t,brandNew:!0,existing:null,keyInfo:null})}))),o=n,m=pt(),F(o,(function(t){var e=t.existing;e&&m.set(e.id,t)})),F(o,(function(t){var e=t.newOption;at(!e||null==e.id||!m.get(e.id)||m.get(e.id)===t,"id duplicates: "+(e&&e.id)),e&&null!=e.id&&m.set(e.id,t),t.keyInfo||(t.keyInfo={})})),F(o,(function(t,e){var n=t.existing,r=t.newOption,i=t.keyInfo;if(K(r)){if(i.name=null!=r.name?zi(r.name):n?n.name:Ri+e,n)i.id=zi(n.id);else if(null!=r.id)i.id=zi(r.id);else for(var o=0;i.id="\0"+i.name+"\0"+o++,m.get(i.id););m.set(i.id,t)}})),n}function Fi(t,e,n){return e=Hi(e[t],null),t=Hi(n[t],null),null!=e&&null!=t&&e===t}function zi(t){return Hi(t,"")}function Hi(t,e){if(null==t)return e;var n=typeof t;return"string"==n?t:"number"==n||Z(t)?t+"":e}function Vi(t){return t=t.name,!(!t||!t.indexOf(Ri))}function Ui(t){return t&&null!=t.id&&0===zi(t.id).indexOf(Li)}function Gi(t,e,n){F(t,(function(t){var r,i,o=t.newOption;K(o)&&(t.keyInfo.mainType=e,t.keyInfo.subType=(r=e,i=o,o=t.existing,t=n,i.type||(o?o.subType:t.determineSubType(r,i))))}))}function Wi(t,e){return null!=e.dataIndexInside?e.dataIndexInside:null!=e.dataIndex?X(e.dataIndex)?z(e.dataIndex,(function(e){return t.indexOfRawIndex(e)})):t.indexOfRawIndex(e.dataIndex):null!=e.name?X(e.name)?z(e.name,(function(e){return t.indexOfName(e)})):t.indexOfName(e.name):void 0}function Xi(){var t="__ec_inner_"+ji++;return function(e){return e[t]||(e[t]={})}}var ji=Ii();function Yi(t,e,n){e=Y(e)?((r={})[e+"Index"]=0,r):e;var r,i=pt(),o={},a=!1;F(e,(function(t,e){var r,s;"dataIndex"!==e&&"dataIndexInside"!==e?(r=(s=e.match(/^(\w+)(Index|Id|Name)$/)||[])[1],s=(s[2]||"").toLowerCase(),!r||!s||n&&n.includeMainTypes&&P(n.includeMainTypes,r)<0||(a=a||!!r,(i.get(r)||i.set(r,{}))[s]=t)):o[e]=t}));var s=n?n.defaultMainType:null;return!a&&s&&i.set(s,{}),i.each((function(e,r){e=Ki(t,r,e,{useDefault:s===r,enableAll:!n||null==n.enableAll||n.enableAll,enableNone:!n||null==n.enableNone||n.enableNone}),o[r+"Models"]=e.models,o[r+"Model"]=e.models[0]})),o}var Zi={useDefault:!0,enableAll:!1,enableNone:!1},qi={useDefault:!1,enableAll:!0,enableNone:!0};function Ki(t,e,n,r){r=r||Zi;var i=n.index,o=n.id,a=n.name;n={models:null,specified:null!=i||null!=o||null!=a};return n.specified?("none"===i||!1===i?(at(r.enableNone,'`"none"` or `false` is not a valid value on index option.'),n.models=[]):("all"===i&&(at(r.enableAll,'`"all"` is not a valid value on index option.'),i=o=a=null),n.models=t.queryComponents({mainType:e,index:i,id:o,name:a})),n):(a=void 0,n.models=r.useDefault&&(a=t.getComponent(e))?[a]:[],n)}function Qi(t,e,n){t.setAttribute?t.setAttribute(e,n):t[e]=n}function Ji(t,e,n,r,i){var o=null==e||"auto"===e;if(null==r)return r;if("number"==typeof r)return ci(l=gn(n||0,r,i),o?Math.max(fi(n||0),fi(r)):e);if("string"==typeof r)return i<1?n:r;for(var a,s,l,u=[],h=n,c=r,d=Math.max(h?h.length:0,c.length),p=0;p<d;++p)"ordinal"===t.getDimensionInfo(p).type?u[p]=(i<1&&h?h:c)[p]:(l=gn(a=h&&h[p]?h[p]:0,s=c[p],i),u[p]=ci(l,o?Math.max(fi(a),fi(s)):e));return u}var $i=".",to="___EC__COMPONENT__CONTAINER___",eo="___EC__EXTENDED_CLASS___";function no(t){var e={main:"",sub:""};return t&&(t=t.split($i),e.main=t[0]||"",e.sub=t[1]||""),e}function ro(t){(t.$constructor=t).extend=function(t){var e=this;function n(){for(var r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];if(t.$constructor)t.$constructor.apply(this,arguments);else{if("function"==typeof(r=e)&&/^class\s/.test(Function.prototype.toString.call(r)))return ft(n.prototype,new(e.bind.apply(e,d([void 0],i))));e.apply(this,arguments)}}return n[eo]=!0,R(n.prototype,t),n.extend=this.extend,n.superCall=ao,n.superApply=so,N(n,this),n.superClass=e,n}}function io(t,e){t.extend=e.extend}var oo=Math.round(10*Math.random());function ao(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return this.superClass.prototype[e].apply(t,n)}function so(t,e,n){return this.superClass.prototype[e].apply(t,n)}function lo(t){var e={};t.registerClass=function(t){var n,r=t.type||t.prototype.type;return r&&(at(/^[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)?$/.test(n=r),'componentType "'+n+'" illegal'),(r=no(t.prototype.type=r)).sub?r.sub!==to&&((function(t){var n=e[t.main];return n&&n[to]||((n=e[t.main]={})[to]=!0),n}(r))[r.sub]=t):e[r.main]=t),t},t.getClass=function(t,n,r){var i=e[t];if(i&&i[to]&&(i=n?i[n]:null),r&&!i)throw new Error(n?"Component "+t+"."+(n||"")+" not exists. Load it first.":t+".type should be specified.");return i},t.getClassesByMainType=function(t){t=no(t);var n=[];t=e[t.main];return t&&t[to]?F(t,(function(t,e){e!==to&&n.push(t)})):n.push(t),n},t.hasClass=function(t){return t=no(t),!!e[t.main]},t.getAllClassMainTypes=function(){var t=[];return F(e,(function(e,n){t.push(n)})),t},t.hasSubTypes=function(t){return t=no(t),t=e[t.main],t&&t[to]}}function uo(t,e){for(var n=0;n<t.length;n++)t[n][1]||(t[n][1]=t[n][0]);return e=e||!1,function(n,r,i){for(var o={},a=0;a<t.length;a++){var s=t[a][1];r&&0<=P(r,s)||i&&P(i,s)<0||null!=(s=n.getShallow(s,e))&&(o[t[a][0]]=s)}return o}}var ho=uo([["fill","color"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["opacity"],["shadowColor"]]),co=(po.prototype.getAreaStyle=function(t,e){return ho(this,t,e)},po);function po(){}var fo=new Ve(50);function go(t,e,n,r,i){if(t){if("string"!=typeof t)return t;if(e&&e.__zrImageSrc===t||!n)return e;var o=fo.get(t);i={hostEl:n,cb:r,cbPayload:i};return o?yo(e=o.image)||o.pending.push(i):((e=new Image).onload=e.onerror=mo,fo.put(t,e.__cachedImgObj={image:e,pending:[i]}),e.src=e.__zrImageSrc=t),e}return e}function mo(){var t=this.__cachedImgObj;this.onload=this.onerror=this.__cachedImgObj=null;for(var e=0;e<t.pending.length;e++){var n=t.pending[e],r=n.cb;r&&r(this,n.cbPayload),n.hostEl.dirty()}t.pending.length=0}function yo(t){return t&&t.width&&t.height}var _o=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g;function vo(t,e,n,r){var i=R({},r=r||{});i.font=e,n=nt(n,"..."),i.maxIterations=nt(r.maxIterations,2);var o=i.minChar=nt(r.minChar,0);i.cnCharWidth=jn("",e);var a=i.ascCharWidth=jn("a",e);i.placeholder=nt(r.placeholder,"");for(var s=t=Math.max(0,t-1),l=0;l<o&&a<=s;l++)s-=a;return e=jn(n,e),s<e&&(n="",e=0),s=t-e,i.ellipsis=n,i.ellipsisWidth=e,i.contentWidth=s,i.containerWidth=t,i}function xo(t,e){var n=e.containerWidth,r=e.font,i=e.contentWidth;if(!n)return"";if((s=jn(t,r))<=n)return t;for(var o=0;;o++){if(s<=i||o>=e.maxIterations){t+=e.ellipsis;break}var a=0===o?function(t,e,n,r){for(var i=0,o=0,a=t.length;o<a&&i<e;o++){var s=t.charCodeAt(o);i+=0<=s&&s<=127?n:r}return o}(t,i,e.ascCharWidth,e.cnCharWidth):0<s?Math.floor(t.length*i/s):0,s=jn(t=t.substr(0,a),r)}return""===t?e.placeholder:t}var bo=function(){},To=function(t){this.tokens=[],t&&(this.tokens=t)},wo=function(){this.width=0,this.height=0,this.contentWidth=0,this.contentHeight=0,this.outerWidth=0,this.outerHeight=0,this.lines=[]};function So(t,e){var n=new wo;if(null!=t&&(t+=""),!t)return n;for(var r,i=e.width,o=e.height,a=e.overflow,s="break"!==a&&"breakAll"!==a||null==i?null:{width:i,accumWidth:0,breakAll:"breakAll"===a},l=_o.lastIndex=0;null!=(r=_o.exec(t));){var u=r.index;l<u&&Mo(n,t.substring(l,u),e,s),Mo(n,r[2],e,s,r[1]),l=_o.lastIndex}l<t.length&&Mo(n,t.substring(l,t.length),e,s);var h=[],c=0,d=0,p=e.padding,f="truncate"===a,g="truncate"===e.lineOverflow;function m(t,e,n){t.width=e,t.lineHeight=n,c+=n,d=Math.max(d,e)}t:for(var y=0;y<n.lines.length;y++){for(var _=n.lines[y],v=0,x=0,b=0;b<_.tokens.length;b++){var T=(I=_.tokens[b]).styleName&&e.rich[I.styleName]||{},w=I.textPadding=T.padding,S=w?w[1]+w[3]:0,M=I.font=T.font||e.font;I.contentHeight=Qn(M);var A=nt(T.height,I.contentHeight);if(I.innerHeight=A,w&&(A+=w[0]+w[2]),I.height=A,I.lineHeight=rt(T.lineHeight,e.lineHeight,A),I.align=T&&T.align||e.align,I.verticalAlign=T&&T.verticalAlign||"middle",g&&null!=o&&c+I.lineHeight>o){0<b?(_.tokens=_.tokens.slice(0,b),m(_,x,v),n.lines=n.lines.slice(0,y+1)):n.lines=n.lines.slice(0,y);break t}var C,E=T.width;w=null==E||"auto"===E;"string"==typeof E&&"%"===E.charAt(E.length-1)?(I.percentWidth=E,h.push(I),I.contentWidth=jn(I.text,M)):(!w||(C=(E=T.backgroundColor)&&E.image)&&yo(C="string"!=typeof(E=C)?E:(E=fo.get(E))&&E.image)&&(I.width=Math.max(I.width,C.width*A/C.height)),null!=(C=f&&null!=i?i-x:null)&&C<I.width?!w||C<S?(I.text="",I.width=I.contentWidth=0):(I.text=function(t,e,n,r,i){if(!e)return"";var o=(t+"").split("\n");i=vo(e,n,r,i);for(var a=0,s=o.length;a<s;a++)o[a]=xo(o[a],i);return o.join("\n")}(I.text,C-S,M,e.ellipsis,{minChar:e.truncateMinChar}),I.width=I.contentWidth=jn(I.text,M)):I.contentWidth=jn(I.text,M)),I.width+=S,x+=I.width,T&&(v=Math.max(v,I.lineHeight))}m(_,x,v)}for(n.outerWidth=n.width=nt(i,d),n.outerHeight=n.height=nt(o,c),n.contentHeight=c,n.contentWidth=d,p&&(n.outerWidth+=p[1]+p[3],n.outerHeight+=p[0]+p[2]),y=0;y<h.length;y++){var I,D=(I=h[y]).percentWidth;I.width=parseInt(D,10)/100*n.width}return n}function Mo(t,e,n,r,i){var o,a,s,l=""===e,u=i&&n.rich[i]||{},h=t.lines,c=u.font||n.font,d=!1;r?(n=(n=u.padding)?n[1]+n[3]:0,null!=u.width&&"auto"!==u.width?(s=function(t,e){return"string"!=typeof t?t:0<=t.lastIndexOf("%")?parseFloat(t)/100*e:parseFloat(t)}(u.width,r.width)+n,0<h.length&&s+r.accumWidth>r.width&&(o=e.split("\n"),d=!0),r.accumWidth=s):(s=Co(e,c,r.width,r.breakAll,r.accumWidth),r.accumWidth=s.accumWidth+n,a=s.linesWidths,o=s.lines)):o=e.split("\n");for(var p=0;p<o.length;p++){var f,g,m=o[p],y=new bo;y.styleName=i,y.text=m,y.isLineHolder=!m&&!l,"number"==typeof u.width?y.width=u.width:y.width=a?a[p]:jn(m,c),p||d?h.push(new To([y])):1===(g=(f=(h[h.length-1]||(h[0]=new To)).tokens).length)&&f[0].isLineHolder?f[0]=y:!m&&g&&!l||f.push(y)}}var Ao=H(",&?/;] ".split(""),(function(t,e){return t[e]=!0,t}),{});function Co(t,e,n,r,i){for(var o,a=[],s=[],l="",u="",h=0,c=0,d=0;d<t.length;d++){var p,f,g=t.charAt(d);"\n"!==g?(p=jn(g,e),f=!r&&(o=void 0,!(!(33<=(o=(o=f=g).charCodeAt(0))&&o<=255)||Ao[f])),(a.length?n<c+p:n<i+c+p)?c?(l||u)&&(c=f?(l||(l=u,u="",c=h=0),a.push(l),s.push(c-h),u+=g,l="",h+=p):(u&&(l+=u,c+=h,u="",h=0),a.push(l),s.push(c),l=g,p)):f?(a.push(u),s.push(h),u=g,h=p):(a.push(g),s.push(p)):(c+=p,f?(u+=g,h+=p):(u&&(l+=u,u="",h=0),l+=g))):(u&&(l+=u,c+=h),a.push(l),s.push(c),u=l="",c=h=0)}return a.length||l||(l=t,u="",h=0),u&&(l+=u),l&&(a.push(l),s.push(c)),1===a.length&&(c+=i),{accumWidth:c,lines:a,linesWidths:s}}var Eo="__zr_style_"+Math.round(10*Math.random()),Io={shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"#000",opacity:1,blend:"source-over"},Do={style:{shadowBlur:!0,shadowOffsetX:!0,shadowOffsetY:!0,shadowColor:!0,opacity:!0}};Io[Eo]=!0;var Ro,Lo=["z","z2","invisible"],Oo=(_t(Po,Ro=fr),Po.prototype._init=function(t){for(var e=U(t),n=0;n<e.length;n++){var r=e[n];"style"===r?this.useStyle(t[r]):Ro.prototype.attrKV.call(this,r,t[r])}this.style||this.useStyle({})},Po.prototype.beforeBrush=function(){},Po.prototype.afterBrush=function(){},Po.prototype.innerBeforeBrush=function(){},Po.prototype.innerAfterBrush=function(){},Po.prototype.shouldBePainted=function(t,e,n,r){var i=this.transform;if(this.ignore||this.invisible||0===this.style.opacity||this.culling&&function(t,e,n){return No.copy(t.getBoundingRect()),t.transform&&No.applyTransform(t.transform),ko.width=e,ko.height=n,!No.intersect(ko)}(this,t,e)||i&&!i[0]&&!i[3])return!1;if(n&&this.__clipPaths)for(var o=0;o<this.__clipPaths.length;++o)if(this.__clipPaths[o].isZeroArea())return!1;if(r&&this.parent)for(var a=this.parent;a;){if(a.ignore)return!1;a=a.parent}return!0},Po.prototype.contain=function(t,e){return this.rectContain(t,e)},Po.prototype.traverse=function(t,e){t.call(e,this)},Po.prototype.rectContain=function(t,e){return e=this.transformCoordToLocal(t,e),this.getBoundingRect().contain(e[0],e[1])},Po.prototype.getPaintRect=function(){var t,e,n,r,i,o=this._paintRect;return this._paintRect&&!this.__dirty||(t=this.transform,e=this.getBoundingRect(),i=(r=this.style).shadowBlur||0,n=r.shadowOffsetX||0,r=r.shadowOffsetY||0,o=this._paintRect||(this._paintRect=new Un(0,0,0,0)),t?Un.applyTransform(o,e,t):o.copy(e),(i||n||r)&&(o.width+=2*i+Math.abs(n),o.height+=2*i+Math.abs(r),o.x=Math.min(o.x,o.x+n-i),o.y=Math.min(o.y,o.y+r-i)),i=this.dirtyRectTolerance,o.isZero()||(o.x=Math.floor(o.x-i),o.y=Math.floor(o.y-i),o.width=Math.ceil(o.width+1+2*i),o.height=Math.ceil(o.height+1+2*i))),o},Po.prototype.setPrevPaintRect=function(t){t?(this._prevPaintRect=this._prevPaintRect||new Un(0,0,0,0),this._prevPaintRect.copy(t)):this._prevPaintRect=null},Po.prototype.getPrevPaintRect=function(){return this._prevPaintRect},Po.prototype.animateStyle=function(t){return this.animate("style",t)},Po.prototype.updateDuringAnimation=function(t){"style"===t?this.dirtyStyle():this.markRedraw()},Po.prototype.attrKV=function(t,e){"style"!==t?Ro.prototype.attrKV.call(this,t,e):this.style?this.setStyle(e):this.useStyle(e)},Po.prototype.setStyle=function(t,e){return"string"==typeof t?this.style[t]=e:R(this.style,t),this.dirtyStyle(),this},Po.prototype.dirtyStyle=function(){this.markRedraw(),this.__dirty|=Po.STYLE_CHANGED_BIT,this._rect&&(this._rect=null)},Po.prototype.dirty=function(){this.dirtyStyle()},Po.prototype.styleChanged=function(){return!!(this.__dirty&Po.STYLE_CHANGED_BIT)},Po.prototype.styleUpdated=function(){this.__dirty&=~Po.STYLE_CHANGED_BIT},Po.prototype.createStyle=function(t){return ft(Io,t)},Po.prototype.useStyle=function(t){t[Eo]||(t=this.createStyle(t)),this.__inHover?this.__hoverStyle=t:this.style=t,this.dirtyStyle()},Po.prototype.isStyleObject=function(t){return t[Eo]},Po.prototype._innerSaveToNormal=function(t){Ro.prototype._innerSaveToNormal.call(this,t);var e=this._normalState;t.style&&!e.style&&(e.style=this._mergeStyle(this.createStyle(),this.style)),this._savePrimaryToNormal(t,e,Lo)},Po.prototype._applyStateObj=function(t,e,n,r,i,o){Ro.prototype._applyStateObj.call(this,t,e,n,r,i,o);var a,s=!(e&&r);if(e&&e.style?i?r?a=e.style:(a=this._mergeStyle(this.createStyle(),n.style),this._mergeStyle(a,e.style)):(a=this._mergeStyle(this.createStyle(),(r?this:n).style),this._mergeStyle(a,e.style)):s&&(a=n.style),a)if(i){var l=this.style;if(this.style=this.createStyle(s?{}:l),s)for(var u=U(l),h=0;h<u.length;h++)(d=u[h])in a&&(a[d]=a[d],this.style[d]=l[d]);var c=U(a);for(h=0;h<c.length;h++){var d=c[h];this.style[d]=this.style[d]}this._transitionState(t,{style:a},o,this.getAnimationStyleProps())}else this.useStyle(a);for(h=0;h<Lo.length;h++)d=Lo[h],e&&null!=e[d]?this[d]=e[d]:s&&null!=n[d]&&(this[d]=n[d])},Po.prototype._mergeStates=function(t){for(var e,n=Ro.prototype._mergeStates.call(this,t),r=0;r<t.length;r++){var i=t[r];i.style&&this._mergeStyle(e=e||{},i.style)}return e&&(n.style=e),n},Po.prototype._mergeStyle=function(t,e){return R(t,e),t},Po.prototype.getAnimationStyleProps=function(){return Do},Po.STYLE_CHANGED_BIT=2,Po.initDefaultProps=((Pu=Po.prototype).type="displayable",Pu.invisible=!1,Pu.z=0,Pu.z2=0,Pu.zlevel=0,Pu.culling=!1,Pu.cursor="pointer",Pu.rectHover=!1,Pu.incremental=!1,Pu._rect=null,Pu.dirtyRectTolerance=0,void(Pu.__dirty=fr.REDARAW_BIT|Po.STYLE_CHANGED_BIT)),Po);function Po(t){return Ro.call(this,t)||this}var No=new Un(0,0,0,0),ko=new Un(0,0,0,0),Bo=Oo,Fo=Math.pow,zo=Math.sqrt,Ho=1e-8,Vo=1e-4,Uo=zo(3),Go=1/3,Wo=vt(),Xo=vt(),jo=vt();function Yo(t){return-Ho<t&&t<Ho}function Zo(t){return Ho<t||t<-Ho}function qo(t,e,n,r,i){var o=1-i;return o*o*(o*t+3*i*e)+i*i*(i*r+3*o*n)}function Ko(t,e,n,r,i){var o=1-i;return 3*(((e-t)*o+2*(n-e)*i)*o+(r-n)*i*i)}function Qo(t,e,n,r,i,o){var a,s,l,u=r+3*(e-n)-t,h=3*(n-2*e+t);r=3*(e-t),n=t-i,e=h*h-3*u*r,t=h*r-9*u*n,i=r*r-3*h*n,n=0;return Yo(e)&&Yo(t)?Yo(h)?o[0]=0:0<=(s=-r/h)&&s<=1&&(o[n++]=s):Yo(r=t*t-4*e*i)?(l=-(i=t/e)/2,0<=(s=-h/u+i)&&s<=1&&(o[n++]=s),0<=l&&l<=1&&(o[n++]=l)):0<r?(a=e*h+1.5*u*(-t-(r=zo(r))),0<=(s=(-h-((r=(r=e*h+1.5*u*(-t+r))<0?-Fo(-r,Go):Fo(r,Go))+(a=a<0?-Fo(-a,Go):Fo(a,Go))))/(3*u))&&s<=1&&(o[n++]=s)):(a=(2*e*h-3*u*t)/(2*zo(e*e*e)),t=Math.acos(a)/3,s=(-h-2*(a=zo(e))*(e=Math.cos(t)))/(3*u),l=(-h+a*(e+Uo*Math.sin(t)))/(3*u),u=(-h+a*(e-Uo*Math.sin(t)))/(3*u),0<=s&&s<=1&&(o[n++]=s),0<=l&&l<=1&&(o[n++]=l),0<=u&&u<=1&&(o[n++]=u)),n}function Jo(t,e,n,r,i){var o,a=6*n-12*e+6*t;r=9*e+3*r-3*t-9*n,n=3*e-3*t,e=0;return Yo(r)?Zo(a)&&0<=(o=-n/a)&&o<=1&&(i[e++]=o):Yo(t=a*a-4*r*n)?i[0]=-a/(2*r):0<t&&(t=(-a-(n=zo(t)))/(2*r),0<=(o=(-a+n)/(2*r))&&o<=1&&(i[e++]=o),0<=t&&t<=1&&(i[e++]=t)),e}function $o(t,e,n,r,i,o){var a=(e-t)*i+t,s=(n-e)*i+e;e=(r-n)*i+n,n=(s-a)*i+a,s=(e-s)*i+s,i=(s-n)*i+n;o[0]=t,o[1]=a,o[2]=n,o[3]=i,o[4]=i,o[5]=s,o[6]=e,o[7]=r}function ta(t,e,n,r,i,o,a,s,l,u,h){var c,d,p,f,g=.005,m=1/0;Wo[0]=l,Wo[1]=u;for(var y=0;y<1;y+=.05)Xo[0]=qo(t,n,i,a,y),Xo[1]=qo(e,r,o,s,y),(p=Et(Wo,Xo))<m&&(c=y,m=p);m=1/0;for(var _=0;_<32&&!(g<Vo);_++)d=c+g,Xo[0]=qo(t,n,i,a,f=c-g),Xo[1]=qo(e,r,o,s,f),p=Et(Xo,Wo),0<=f&&p<m?(c=f,m=p):(jo[0]=qo(t,n,i,a,d),jo[1]=qo(e,r,o,s,d),f=Et(jo,Wo),d<=1&&f<m?(c=d,m=f):g*=.5);return h&&(h[0]=qo(t,n,i,a,c),h[1]=qo(e,r,o,s,c)),zo(m)}function ea(t,e,n,r){var i=1-r;return i*(i*t+2*r*e)+r*r*n}function na(t,e,n,r){return 2*((1-r)*(e-t)+r*(n-e))}function ra(t,e,n){return n=t+n-2*e,0==n?.5:(t-e)/n}function ia(t,e,n,r,i){var o=(e-t)*r+t;e=(n-e)*r+e,r=(e-o)*r+o;i[0]=t,i[1]=o,i[2]=r,i[3]=r,i[4]=e,i[5]=n}function oa(t,e,n,r,i,o,a,s,l){var u,h=.005,c=1/0;Wo[0]=a,Wo[1]=s;for(var d=0;d<1;d+=.05)Xo[0]=ea(t,n,i,d),Xo[1]=ea(e,r,o,d),(m=Et(Wo,Xo))<c&&(u=d,c=m);c=1/0;for(var p=0;p<32&&!(h<Vo);p++){var f=u-h,g=u+h;Xo[0]=ea(t,n,i,f),Xo[1]=ea(e,r,o,f);var m=Et(Xo,Wo);0<=f&&m<c?(u=f,c=m):(jo[0]=ea(t,n,i,g),jo[1]=ea(e,r,o,g),f=Et(jo,Wo),g<=1&&f<c?(u=g,c=f):h*=.5)}return l&&(l[0]=ea(t,n,i,u),l[1]=ea(e,r,o,u)),zo(c)}var aa=Math.min,sa=Math.max,la=Math.sin,ua=Math.cos,ha=2*Math.PI,ca=vt(),da=vt(),pa=vt();function fa(t,e,n,r,i,o){i[0]=aa(t,n),i[1]=aa(e,r),o[0]=sa(t,n),o[1]=sa(e,r)}var ga=[],ma=[],ya={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7},_a=[],va=[],xa=[],ba=[],Ta=[],wa=[],Sa=Math.min,Ma=Math.max,Aa=Math.cos,Ca=Math.sin,Ea=Math.sqrt,Ia=Math.abs,Da=Math.PI,Ra=2*Da,La="undefined"!=typeof Float32Array,Oa=[];function Pa(t){return Math.round(t/Da*1e8)/1e8%2*Da}function Na(t,e){var n=Pa(t[0]);n<0&&(n+=Ra);var r=n-t[0],i=t[1];i+=r,!e&&Ra<=i-n?i=n+Ra:e&&Ra<=n-i?i=n-Ra:!e&&i<n?i=n+(Ra-Pa(n-i)):e&&n<i&&(i=n-(Ra-Pa(i-n))),t[0]=n,t[1]=i}function ka(t){this.dpr=1,this._version=0,this._xi=0,this._yi=0,this._x0=0,this._y0=0,this._len=0,t&&(this._saveData=!1),this._saveData&&(this.data=[])}var Ba=(ka.prototype.increaseVersion=function(){this._version++},ka.prototype.getVersion=function(){return this._version},ka.prototype.setScale=function(t,e,n){0<(n=n||0)&&(this._ux=Ia(n/er/t)||0,this._uy=Ia(n/er/e)||0)},ka.prototype.setDPR=function(t){this.dpr=t},ka.prototype.setContext=function(t){this._ctx=t},ka.prototype.getContext=function(){return this._ctx},ka.prototype.beginPath=function(){return this._ctx&&this._ctx.beginPath(),this.reset(),this},ka.prototype.reset=function(){this._saveData&&(this._len=0),this._lineDash&&(this._lineDash=null,this._dashOffset=0),this._pathSegLen&&(this._pathSegLen=null,this._pathLen=0),this._version++},ka.prototype.moveTo=function(t,e){return this.addData(ya.M,t,e),this._ctx&&this._ctx.moveTo(t,e),this._x0=t,this._y0=e,this._xi=t,this._yi=e,this},ka.prototype.lineTo=function(t,e){var n=Ia(t-this._xi)>this._ux||Ia(e-this._yi)>this._uy||this._len<5;return this.addData(ya.L,t,e),this._ctx&&n&&(this._needsDash?this._dashedLineTo(t,e):this._ctx.lineTo(t,e)),n&&(this._xi=t,this._yi=e),this},ka.prototype.bezierCurveTo=function(t,e,n,r,i,o){return this.addData(ya.C,t,e,n,r,i,o),this._ctx&&(this._needsDash?this._dashedBezierTo(t,e,n,r,i,o):this._ctx.bezierCurveTo(t,e,n,r,i,o)),this._xi=i,this._yi=o,this},ka.prototype.quadraticCurveTo=function(t,e,n,r){return this.addData(ya.Q,t,e,n,r),this._ctx&&(this._needsDash?this._dashedQuadraticTo(t,e,n,r):this._ctx.quadraticCurveTo(t,e,n,r)),this._xi=n,this._yi=r,this},ka.prototype.arc=function(t,e,n,r,i,o){return Oa[0]=r,Oa[1]=i,Na(Oa,o),r=Oa[0],i=Oa[1],this.addData(ya.A,t,e,n,n,r,i-r,0,o?0:1),this._ctx&&this._ctx.arc(t,e,n,r,i,o),this._xi=Aa(i)*n+t,this._yi=Ca(i)*n+e,this},ka.prototype.arcTo=function(t,e,n,r,i){return this._ctx&&this._ctx.arcTo(t,e,n,r,i),this},ka.prototype.rect=function(t,e,n,r){return this._ctx&&this._ctx.rect(t,e,n,r),this.addData(ya.R,t,e,n,r),this},ka.prototype.closePath=function(){this.addData(ya.Z);var t=this._ctx,e=this._x0,n=this._y0;return t&&(this._needsDash&&this._dashedLineTo(e,n),t.closePath()),this._xi=e,this._yi=n,this},ka.prototype.fill=function(t){t&&t.fill(),this.toStatic()},ka.prototype.stroke=function(t){t&&t.stroke(),this.toStatic()},ka.prototype.setLineDash=function(t){if(t instanceof Array){this._lineDash=t;for(var e=this._dashIdx=0,n=0;n<t.length;n++)e+=t[n];this._dashSum=e,this._needsDash=!0}else this._lineDash=null,this._needsDash=!1;return this},ka.prototype.setLineDashOffset=function(t){return this._dashOffset=t,this},ka.prototype.len=function(){return this._len},ka.prototype.setData=function(t){var e=t.length;this.data&&this.data.length===e||!La||(this.data=new Float32Array(e));for(var n=0;n<e;n++)this.data[n]=t[n];this._len=e},ka.prototype.appendPath=function(t){for(var e=(t=t instanceof Array?t:[t]).length,n=0,r=this._len,i=0;i<e;i++)n+=t[i].len();for(La&&this.data instanceof Float32Array&&(this.data=new Float32Array(r+n)),i=0;i<e;i++)for(var o=t[i].data,a=0;a<o.length;a++)this.data[r++]=o[a];this._len=r},ka.prototype.addData=function(t,e,n,r,i,o,a,s,l){if(this._saveData){var u=this.data;this._len+arguments.length>u.length&&(this._expandData(),u=this.data);for(var h=0;h<arguments.length;h++)u[this._len++]=arguments[h]}},ka.prototype._expandData=function(){if(!(this.data instanceof Array)){for(var t=[],e=0;e<this._len;e++)t[e]=this.data[e];this.data=t}},ka.prototype._dashedLineTo=function(t,e){var n,r,i=this._dashSum,o=this._lineDash,a=this._ctx,s=this._dashOffset,l=this._xi,u=this._yi,h=t-l,c=e-u,d=Ea(h*h+c*c),p=l,f=u,g=o.length;for(s<0&&(s=i+s),p-=(s%=i)*(h/=d),f-=s*(c/=d);0<h&&p<=t||h<0&&t<=p||0===h&&(0<c&&f<=e||c<0&&e<=f);)p+=h*(n=o[r=this._dashIdx]),f+=c*n,this._dashIdx=(r+1)%g,0<h&&p<l||h<0&&l<p||0<c&&f<u||c<0&&u<f||a[r%2?"moveTo":"lineTo"]((0<=h?Sa:Ma)(p,t),(0<=c?Sa:Ma)(f,e));this._dashOffset=-Ea((h=p-t)*h+(c=f-e)*c)},ka.prototype._dashedBezierTo=function(t,e,n,r,i,o){var a,s,l,u,h,c=this._ctx,d=this._dashSum,p=this._dashOffset,f=this._lineDash,g=this._xi,m=this._yi,y=0,_=this._dashIdx,v=f.length,x=0;for(p<0&&(p=d+p),p%=d,a=0;a<1;a+=.1)s=qo(g,t,n,i,a+.1)-qo(g,t,n,i,a),l=qo(m,e,r,o,a+.1)-qo(m,e,r,o,a),y+=Ea(s*s+l*l);for(;_<v&&!(p<(x+=f[_]));_++);for(a=(x-p)/y;a<=1;)u=qo(g,t,n,i,a),h=qo(m,e,r,o,a),_%2?c.moveTo(u,h):c.lineTo(u,h),a+=f[_]/y,_=(_+1)%v;_%2!=0&&c.lineTo(i,o),this._dashOffset=-Ea((s=i-u)*s+(l=o-h)*l)},ka.prototype._dashedQuadraticTo=function(t,e,n,r){var i=n,o=r;n=(n+2*t)/3,r=(r+2*e)/3,t=(this._xi+2*t)/3,e=(this._yi+2*e)/3,this._dashedBezierTo(t,e,n,r,i,o)},ka.prototype.toStatic=function(){var t;!this._saveData||(t=this.data)instanceof Array&&(t.length=this._len,La&&11<this._len&&(this.data=new Float32Array(t)))},ka.prototype.getBoundingRect=function(){xa[0]=xa[1]=Ta[0]=Ta[1]=Number.MAX_VALUE,ba[0]=ba[1]=wa[0]=wa[1]=-Number.MAX_VALUE;for(var t,e,n,r,i=this.data,o=0,a=0,s=0,l=0,u=0;u<this._len;){var h=i[u++],c=1===u;switch(c&&(s=o=i[u],l=a=i[u+1]),h){case ya.M:o=s=i[u++],a=l=i[u++],Ta[0]=s,Ta[1]=l,wa[0]=s,wa[1]=l;break;case ya.L:fa(o,a,i[u],i[u+1],Ta,wa),o=i[u++],a=i[u++];break;case ya.C:!function(t,e,n,r,i,o,a,s,l,u){var h=Jo,c=qo,d=h(t,n,i,a,ga);l[0]=1/0,l[1]=1/0,u[0]=-1/0,u[1]=-1/0;for(var p=0;p<d;p++){var f=c(t,n,i,a,ga[p]);l[0]=aa(f,l[0]),u[0]=sa(f,u[0])}for(d=h(e,r,o,s,ma),p=0;p<d;p++){var g=c(e,r,o,s,ma[p]);l[1]=aa(g,l[1]),u[1]=sa(g,u[1])}l[0]=aa(t,l[0]),u[0]=sa(t,u[0]),l[0]=aa(a,l[0]),u[0]=sa(a,u[0]),l[1]=aa(e,l[1]),u[1]=sa(e,u[1]),l[1]=aa(s,l[1]),u[1]=sa(s,u[1])}(o,a,i[u++],i[u++],i[u++],i[u++],i[u],i[u+1],Ta,wa),o=i[u++],a=i[u++];break;case ya.Q:d=o,m=a,t=i[u++],e=i[u++],p=i[u],y=i[u+1],n=Ta,g=wa,_=f=_=f=r=void 0,r=ea,f=sa(aa((_=ra)(d,t,p),1),0),_=sa(aa(_(m,e,y),1),0),f=r(d,t,p,f),_=r(m,e,y,_),n[0]=aa(d,p,f),n[1]=aa(m,y,_),g[0]=sa(d,p,f),g[1]=sa(m,y,_),o=i[u++],a=i[u++];break;case ya.A:var d=i[u++],p=i[u++],f=i[u++],g=i[u++],m=i[u++],y=i[u++]+m;u+=1;var _=!i[u++];c&&(s=Aa(m)*f+d,l=Ca(m)*g+p),function(t,e,n,r,i,o,a,s,l){var u=Rt,h=Lt,c=Math.abs(i-o);if(c%ha<1e-4&&1e-4<c)return s[0]=t-n,s[1]=e-r,l[0]=t+n,l[1]=e+r;ca[0]=ua(i)*n+t,ca[1]=la(i)*r+e,da[0]=ua(o)*n+t,da[1]=la(o)*r+e,u(s,ca,da),h(l,ca,da),(i%=ha)<0&&(i+=ha),(o%=ha)<0&&(o+=ha),o<i&&!a?o+=ha:i<o&&a&&(i+=ha),a&&(a=o,o=i,i=a);for(var d=0;d<o;d+=Math.PI/2)i<d&&(pa[0]=ua(d)*n+t,pa[1]=la(d)*r+e,u(s,pa,s),h(l,pa,l))}(d,p,f,g,m,y,_,Ta,wa),o=Aa(y)*f+d,a=Ca(y)*g+p;break;case ya.R:fa(s=o=i[u++],l=a=i[u++],s+i[u++],l+i[u++],Ta,wa);break;case ya.Z:o=s,a=l}Rt(xa,xa,Ta),Lt(ba,ba,wa)}return 0===u&&(xa[0]=xa[1]=ba[0]=ba[1]=0),new Un(xa[0],xa[1],ba[0]-xa[0],ba[1]-xa[1])},ka.prototype._calculateLength=function(){var t=this.data,e=this._len,n=this._ux,r=this._uy,i=0,o=0,a=0,s=0;this._pathSegLen||(this._pathSegLen=[]);for(var l=this._pathSegLen,u=0,h=0,c=0;c<e;){var d=t[c++],p=1===c;p&&(a=i=t[c],s=o=t[c+1]);var f=-1;switch(d){case ya.M:i=a=t[c++],o=s=t[c++];break;case ya.L:var g=t[c++],m=(v=t[c++])-o;(Ia(C=g-i)>n||Ia(m)>r||c===e-1)&&(f=Math.sqrt(C*C+m*m),i=g,o=v);break;case ya.C:var y=t[c++],_=t[c++],v=(g=t[c++],t[c++]),x=t[c++],b=t[c++];f=function(t,e,n,r,i,o,a,s,l){for(var u=t,h=e,c=0,d=1/l,p=1;p<=l;p++){var f=p*d,g=qo(t,n,i,a,f),m=qo(e,r,o,s,f),y=g-u;f=m-h;c+=Math.sqrt(y*y+f*f),u=g,h=m}return c}(i,o,y,_,g,v,x,b,10),i=x,o=b;break;case ya.Q:f=function(t,e,n,r,i,o,a){for(var s=t,l=e,u=0,h=1/a,c=1;c<=a;c++){var d=c*h,p=ea(t,n,i,d),f=ea(e,r,o,d),g=p-s;d=f-l;u+=Math.sqrt(g*g+d*d),s=p,l=f}return u}(i,o,y=t[c++],_=t[c++],g=t[c++],v=t[c++],10),i=g,o=v;break;case ya.A:var T=t[c++],w=t[c++],S=t[c++],M=t[c++],A=t[c++];x=t[c++],b=x+A;c+=1,t[c++],p&&(a=Aa(A)*S+T,s=Ca(A)*M+w),f=Ma(S,M)*Sa(Ra,Math.abs(x)),i=Aa(b)*S+T,o=Ca(b)*M+w;break;case ya.R:a=i=t[c++],s=o=t[c++],f=2*t[c++]+2*t[c++];break;case ya.Z:var C=a-i;m=s-o;f=Math.sqrt(C*C+m*m),i=a,o=s}0<=f&&(u+=l[h++]=f)}return this._pathLen=u},ka.prototype.rebuildPath=function(t,e){var n,r,i,o,a=this.data,s=this._ux,l=this._uy,u=this._len,h=e<1,c=0,d=0;if(!h||(this._pathSegLen||this._calculateLength(),i=this._pathSegLen,o=e*this._pathLen))t:for(var p=0;p<u;){var f=a[p++],g=1===p;switch(g&&(P=n=a[p],N=r=a[p+1]),f){case ya.M:P=n=a[p++],N=r=a[p++],t.moveTo(n,r);break;case ya.L:if(k=a[p++],B=a[p++],Ia(k-n)>s||Ia(B-r)>l||p===u-1){if(h){if(o<c+(O=i[d++])){var m=(o-c)/O;t.lineTo(n*(1-m)+k*m,r*(1-m)+B*m);break t}c+=O}t.lineTo(k,B),n=k,r=B}break;case ya.C:var y=a[p++],_=a[p++],v=a[p++],x=a[p++],b=a[p++],T=a[p++];if(h){if(o<c+(O=i[d++])){$o(n,y,v,b,m=(o-c)/O,_a),$o(r,_,x,T,m,va),t.bezierCurveTo(_a[1],va[1],_a[2],va[2],_a[3],va[3]);break t}c+=O}t.bezierCurveTo(y,_,v,x,b,T),n=b,r=T;break;case ya.Q:if(y=a[p++],_=a[p++],v=a[p++],x=a[p++],h){if(o<c+(O=i[d++])){ia(n,y,v,m=(o-c)/O,_a),ia(r,_,x,m,va),t.quadraticCurveTo(_a[1],va[1],_a[2],va[2]);break t}c+=O}t.quadraticCurveTo(y,_,v,x),n=v,r=x;break;case ya.A:var w=a[p++],S=a[p++],M=a[p++],A=a[p++],C=a[p++],E=a[p++],I=a[p++],D=!a[p++],R=A<M?M:A,L=(b=.001<Ia(M-A),C+E);T=!1;if(h&&(o<c+(O=i[d++])&&(L=C+E*(o-c)/O,T=!0),c+=O),b&&t.ellipse?t.ellipse(w,S,M,A,I,C,L,D):t.arc(w,S,R,C,L,D),T)break t;g&&(P=Aa(C)*M+w,N=Ca(C)*A+S),n=Aa(L)*M+w,r=Ca(L)*A+S;break;case ya.R:var O,P=n=a[p],N=r=a[p+1],k=a[p++],B=a[p++];L=a[p++],A=a[p++];if(h){if(o<c+(O=i[d++])){S=o-c,t.moveTo(k,B),t.lineTo(k+Sa(S,L),B),0<(S-=L)&&t.lineTo(k+L,B+Sa(S,A)),0<(S-=A)&&t.lineTo(k+Ma(L-S,0),B+A),0<(S-=L)&&t.lineTo(k,B+Ma(A-S,0));break t}c+=O}t.rect(k,B,L,A);break;case ya.Z:if(h){if(o<c+(O=i[d++])){m=(o-c)/O,t.lineTo(n*(1-m)+P*m,r*(1-m)+N*m);break t}c+=O}t.closePath(),n=P,r=N}}},ka.CMD=ya,ka.initDefaultProps=((e=ka.prototype)._saveData=!0,e._needsDash=!1,e._dashOffset=0,e._dashIdx=0,e._dashSum=0,e._ux=0,void(e._uy=0)),ka);function Fa(t,e,n,r,i,o,a){if(0!==i){var s=i;i=0;if(!(e+s<a&&r+s<a||a<e-s&&a<r-s||t+s<o&&n+s<o||o<t-s&&o<n-s))return t===n?Math.abs(o-t)<=s/2:(n=(i=(e-r)/(t-n))*o-a+(t*r-n*e)/(t-n),n*n/(i*i+1)<=s/2*s/2)}}var za=2*Math.PI;function Ha(t){return(t%=za)<0&&(t+=za),t}var Va=2*Math.PI;function Ua(t,e,n,r,i,o){if(e<o&&r<o||o<e&&o<r)return 0;if(r===e)return 0;var a=(o-e)/(r-e);o=r<e?1:-1;return 1!=a&&0!=a||(o=r<e?.5:-.5),t=a*(n-t)+t,t===i?1/0:i<t?o:0}var Ga=Ba.CMD,Wa=2*Math.PI,Xa=1e-4,ja=[-1,-1,-1],Ya=[-1,-1];function Za(t,e,n,r,i,o,a,s,l,u){if(e<u&&r<u&&o<u&&s<u||u<e&&u<r&&u<o&&u<s)return 0;var h=Qo(e,r,o,s,u,ja);if(0===h)return 0;for(var c,d=0,p=-1,f=void 0,g=void 0,m=0;m<h;m++){var y=ja[m],_=0===y||1===y?.5:1;qo(t,n,i,a,y)<l||(p<0&&(p=Jo(e,r,o,s,Ya),Ya[1]<Ya[0]&&1<p&&(c=void 0,c=Ya[0],Ya[0]=Ya[1],Ya[1]=c),f=qo(e,r,o,s,Ya[0]),1<p&&(g=qo(e,r,o,s,Ya[1]))),2===p?y<Ya[0]?d+=f<e?_:-_:y<Ya[1]?d+=g<f?_:-_:d+=s<g?_:-_:y<Ya[0]?d+=f<e?_:-_:d+=s<f?_:-_)}return d}function qa(t,e,n,r,i,o,a,s){if(e<s&&r<s&&o<s||s<e&&s<r&&s<o)return 0;var l,u,h,c,d,p,f=(c=ja,p=(l=e)-2*(u=r)+(h=o),h=2*(u-l),u=l-(s=s),l=0,Yo(p)?Zo(h)&&0<=(d=-u/h)&&d<=1&&(c[l++]=d):Yo(s=h*h-4*p*u)?0<=(d=-h/(2*p))&&d<=1&&(c[l++]=d):0<s&&(s=(-h-(u=zo(s)))/(2*p),0<=(d=(-h+u)/(2*p))&&d<=1&&(c[l++]=d),0<=s&&s<=1&&(c[l++]=s)),l);if(0===f)return 0;var g=ra(e,r,o);if(0<=g&&g<=1){for(var m=0,y=ea(e,r,o,g),_=0;_<f;_++){var v=0===ja[_]||1===ja[_]?.5:1;ea(t,n,i,ja[_])<a||(ja[_]<g?m+=y<e?v:-v:m+=o<y?v:-v)}return m}return v=0===ja[0]||1===ja[0]?.5:1,ea(t,n,i,ja[0])<a?0:o<e?v:-v}function Ka(t,e,n,r,i){for(var o,a=t.data,s=t.len(),l=0,u=0,h=0,c=0,d=0,p=0;p<s;){var f=a[p++],g=1===p;switch(f===Ga.M&&1<p&&(n||(l+=Ua(u,h,c,d,r,i))),g&&(c=u=a[p],d=h=a[p+1]),f){case Ga.M:u=c=a[p++],h=d=a[p++];break;case Ga.L:if(n){if(Fa(u,h,a[p],a[p+1],e,r,i))return!0}else l+=Ua(u,h,a[p],a[p+1],r,i)||0;u=a[p++],h=a[p++];break;case Ga.C:if(n){if(function(t,e,n,r,i,o,a,s,l,u,h){if(0!==l)return l=l,e+l<h&&r+l<h&&o+l<h&&s+l<h||h<e-l&&h<r-l&&h<o-l&&h<s-l||t+l<u&&n+l<u&&i+l<u&&a+l<u||u<t-l&&u<n-l&&u<i-l&&u<a-l?void 0:ta(t,e,n,r,i,o,a,s,u,h,null)<=l/2}(u,h,a[p++],a[p++],a[p++],a[p++],a[p],a[p+1],e,r,i))return!0}else l+=Za(u,h,a[p++],a[p++],a[p++],a[p++],a[p],a[p+1],r,i)||0;u=a[p++],h=a[p++];break;case Ga.Q:if(n){if(function(t,e,n,r,i,o,a,s,l){if(0!==a)return a=a,e+a<l&&r+a<l&&o+a<l||l<e-a&&l<r-a&&l<o-a||t+a<s&&n+a<s&&i+a<s||s<t-a&&s<n-a&&s<i-a?void 0:oa(t,e,n,r,i,o,s,l,null)<=a/2}(u,h,a[p++],a[p++],a[p],a[p+1],e,r,i))return!0}else l+=qa(u,h,a[p++],a[p++],a[p],a[p+1],r,i)||0;u=a[p++],h=a[p++];break;case Ga.A:var m=a[p++],y=a[p++],_=a[p++],v=a[p++],x=a[p++],b=a[p++];p+=1;var T=!!(1-a[p++]),w=Math.cos(x)*_+m,S=Math.sin(x)*v+y;g?(c=w,d=S):l+=Ua(u,h,w,S,r,i);var M=(r-m)*v/_+m;if(n){if(function(t,e,n,r,i,o,a,s,l){if(0!==a&&(a=a,s-=t,l-=e,e=Math.sqrt(s*s+l*l),!(n<e-a||e+a<n)))return Math.abs(r-i)%Va<1e-4?1:((i=o?(o=r,r=Ha(i),Ha(o)):(r=Ha(r),Ha(i)))<r&&(i+=Va),s=Math.atan2(l,s),s<0&&(s+=Va),r<=s&&s<=i||r<=s+Va&&s+Va<=i)}(m,y,v,x,x+b,T,e,M,i))return!0}else l+=function(t,e,n,r,i,o,a,s){if(n<(s-=e)||s<-n)return 0;if(n=Math.sqrt(n*n-s*s),ja[0]=-n,ja[1]=n,(n=Math.abs(r-i))<1e-4)return 0;if(Wa-1e-4<=n){i=Wa;var l=o?1:-1;return a>=ja[r=0]+t&&a<=ja[1]+t?l:0}i<r&&(n=r,r=i,i=n),r<0&&(r+=Wa,i+=Wa);for(var u=0,h=0;h<2;h++){var c=ja[h];a<c+t&&(l=o?1:-1,(r<=(c=(c=Math.atan2(s,c))<0?Wa+c:c)&&c<=i||r<=c+Wa&&c+Wa<=i)&&(u+=l=c>Math.PI/2&&c<1.5*Math.PI?-l:l))}return u}(m,y,v,x,x+b,T,M,i);u=Math.cos(x+b)*_+m,h=Math.sin(x+b)*v+y;break;case Ga.R:if(c=u=a[p++],d=h=a[p++],w=c+a[p++],S=d+a[p++],n){if(Fa(c,d,w,d,e,r,i)||Fa(w,d,w,S,e,r,i)||Fa(w,S,c,S,e,r,i)||Fa(c,S,c,d,e,r,i))return!0}else l+=Ua(w,d,w,S,r,i),l+=Ua(c,S,c,d,r,i);break;case Ga.Z:if(n){if(Fa(u,h,c,d,e,r,i))return!0}else l+=Ua(u,h,c,d,r,i);u=c,h=d}}return n||(o=h,t=d,Math.abs(o-t)<Xa)||(l+=Ua(u,h,c,d,r,i)||0),0!==l}var Qa,Ja=L({fill:"#000",stroke:null,strokePercent:1,fillOpacity:1,strokeOpacity:1,lineDashOffset:0,lineWidth:1,lineCap:"butt",miterLimit:10,strokeNoScale:!1,strokeFirst:!1},Io),$a={style:L({fill:!0,stroke:!0,strokePercent:!0,fillOpacity:!0,strokeOpacity:!0,lineDashOffset:!0,lineWidth:!0,miterLimit:!0},Do.style)},ts=["x","y","rotation","scaleX","scaleY","originX","originY","invisible","culling","z","z2","zlevel","parent"];function es(t){return Qa.call(this,t)||this}var ns,rs=(_t(es,Qa=Bo),es.prototype.update=function(){var t=this;Qa.prototype.update.call(this);var e=this.style;if(e.decal){var n=this._decalEl=this._decalEl||new es;n.buildPath===es.prototype.buildPath&&(n.buildPath=function(e){t.buildPath(e,t.shape)}),n.silent=!0;var r,i=n.style;for(r in e)i[r]!==e[r]&&(i[r]=e[r]);i.fill=e.fill?e.decal:null,i.decal=null,i.shadowColor=null,e.strokeFirst&&(i.stroke=null);for(var o=0;o<ts.length;++o)n[ts[o]]=this[ts[o]];n.__dirty|=fr.REDARAW_BIT}else this._decalEl&&(this._decalEl=null)},es.prototype.getDecalElement=function(){return this._decalEl},es.prototype._init=function(t){var e=U(t);this.shape=this.getDefaultShape();var n=this.getDefaultStyle();n&&this.useStyle(n);for(var r=0;r<e.length;r++){var i=e[r],o=t[i];"style"===i?this.style?R(this.style,o):this.useStyle(o):"shape"===i?R(this.shape,o):Qa.prototype.attrKV.call(this,i,o)}this.style||this.useStyle({})},es.prototype.getDefaultStyle=function(){return null},es.prototype.getDefaultShape=function(){return{}},es.prototype.canBeInsideText=function(){return this.hasFill()},es.prototype.getInsideTextFill=function(){var t=this.style.fill;if("none"!==t){if(Y(t)){var e=dn(t,0);return.5<e?nr:.2<e?"#eee":rr}if(t)return rr}return nr},es.prototype.getInsideTextStroke=function(t){var e=this.style.fill;if(Y(e)){var n=this.__zr;if(!(!n||!n.isDarkMode())==dn(t,0)<.4)return e}},es.prototype.buildPath=function(t,e,n){},es.prototype.pathUpdated=function(){this.__dirty&=~es.SHAPE_CHANGED_BIT},es.prototype.createPathProxy=function(){this.path=new Ba(!1)},es.prototype.hasStroke=function(){var t=this.style,e=t.stroke;return!(null==e||"none"===e||!(0<t.lineWidth))},es.prototype.hasFill=function(){var t=this.style.fill;return null!=t&&"none"!==t},es.prototype.getBoundingRect=function(){var t=this._rect,e=this.style,n=!t;if(n&&(i=!1,this.path||(i=!0,this.createPathProxy()),r=this.path,(i||this.__dirty&es.SHAPE_CHANGED_BIT)&&(r.beginPath(),this.buildPath(r,this.shape,!1),this.pathUpdated()),t=r.getBoundingRect()),this._rect=t,this.hasStroke()&&this.path&&0<this.path.len()){var r,i=this._rectWithStroke||(this._rectWithStroke=t.clone());return(this.__dirty||n)&&(i.copy(t),r=e.strokeNoScale?this.getLineScale():1,n=e.lineWidth,this.hasFill()||(e=this.strokeContainThreshold,n=Math.max(n,null==e?4:e)),1e-10<r&&(i.width+=n/r,i.height+=n/r,i.x-=n/r/2,i.y-=n/r/2)),i}return t},es.prototype.contain=function(t,e){var n=this.transformCoordToLocal(t,e),r=this.getBoundingRect(),i=this.style;if(t=n[0],e=n[1],r.contain(t,e)){if(n=this.path,this.hasStroke()&&(r=i.lineWidth,i=i.strokeNoScale?this.getLineScale():1,1e-10<i&&(this.hasFill()||(r=Math.max(r,this.strokeContainThreshold)),Ka(n,r/i,!0,t,e))))return!0;if(this.hasFill())return Ka(n,0,!1,t,e)}return!1},es.prototype.dirtyShape=function(){this.__dirty|=es.SHAPE_CHANGED_BIT,this._rect&&(this._rect=null),this._decalEl&&this._decalEl.dirtyShape(),this.markRedraw()},es.prototype.dirty=function(){this.dirtyStyle(),this.dirtyShape()},es.prototype.animateShape=function(t){return this.animate("shape",t)},es.prototype.updateDuringAnimation=function(t){"style"===t?this.dirtyStyle():"shape"===t?this.dirtyShape():this.markRedraw()},es.prototype.attrKV=function(t,e){"shape"===t?this.setShape(e):Qa.prototype.attrKV.call(this,t,e)},es.prototype.setShape=function(t,e){var n=(n=this.shape)||(this.shape={});return"string"==typeof t?n[t]=e:R(n,t),this.dirtyShape(),this},es.prototype.shapeChanged=function(){return!!(this.__dirty&es.SHAPE_CHANGED_BIT)},es.prototype.createStyle=function(t){return ft(Ja,t)},es.prototype._innerSaveToNormal=function(t){Qa.prototype._innerSaveToNormal.call(this,t);var e=this._normalState;t.shape&&!e.shape&&(e.shape=R({},this.shape))},es.prototype._applyStateObj=function(t,e,n,r,i,o){Qa.prototype._applyStateObj.call(this,t,e,n,r,i,o);var a,s=!(e&&r);if(e&&e.shape?i?r?a=e.shape:(a=R({},n.shape),R(a,e.shape)):(a=R({},(r?this:n).shape),R(a,e.shape)):s&&(a=n.shape),a)if(i){this.shape=R({},this.shape);for(var l={},u=U(a),h=0;h<u.length;h++){var c=u[h];"object"==typeof a[c]?this.shape[c]=a[c]:l[c]=a[c]}this._transitionState(t,{shape:l},o)}else this.shape=a,this.dirtyShape()},es.prototype._mergeStates=function(t){for(var e,n=Qa.prototype._mergeStates.call(this,t),r=0;r<t.length;r++){var i=t[r];i.shape&&this._mergeStyle(e=e||{},i.shape)}return e&&(n.shape=e),n},es.prototype.getAnimationStyleProps=function(){return $a},es.prototype.isZeroArea=function(){return!1},es.extend=function(t){var e,n,r=(_t(i,e=es),i.prototype.getDefaultStyle=function(){return I(t.style)},i.prototype.getDefaultShape=function(){return I(t.shape)},i);function i(n){var r=e.call(this,n)||this;return t.init&&t.init.call(r,n),r}for(n in t)"function"==typeof t[n]&&(r.prototype[n]=t[n]);return r},es.SHAPE_CHANGED_BIT=4,es.initDefaultProps=((f=es.prototype).type="path",f.strokeContainThreshold=5,f.segmentIgnoreThreshold=0,f.subPixelOptimize=!1,f.autoBatch=!1,void(f.__dirty=fr.REDARAW_BIT|Bo.STYLE_CHANGED_BIT|es.SHAPE_CHANGED_BIT)),es),is=L({strokeFirst:!0,font:Wn,x:0,y:0,textAlign:"left",textBaseline:"top",miterLimit:2},Ja);_t(os,ns=Bo),os.prototype.hasStroke=function(){var t=this.style,e=t.stroke;return null!=e&&"none"!==e&&0<t.lineWidth},os.prototype.hasFill=function(){var t=this.style.fill;return null!=t&&"none"!==t},os.prototype.createStyle=function(t){return ft(is,t)},os.prototype.setBoundingRect=function(t){this._rect=t},os.prototype.getBoundingRect=function(){var t,e=this.style;return this._rect||(null!=(t=e.text)?t+="":t="",(t=Zn(t,e.font,e.textAlign,e.textBaseline)).x+=e.x||0,t.y+=e.y||0,this.hasStroke()&&(e=e.lineWidth,t.x-=e/2,t.y-=e/2,t.width+=e,t.height+=e),this._rect=t),this._rect},os.initDefaultProps=void(os.prototype.dirtyRectTolerance=10),v=os;function os(){return null!==ns&&ns.apply(this,arguments)||this}v.prototype.type="tspan";var as,ss=v,ls=L({x:0,y:0},Io),us={style:L({x:!0,y:!0,width:!0,height:!0,sx:!0,sy:!0,sWidth:!0,sHeight:!0},Do.style)};_t(hs,as=Bo),hs.prototype.createStyle=function(t){return ft(ls,t)},hs.prototype._getSize=function(t){var e=this.style,n=e[t];if(null!=n)return n;if(n=(r=e.image)&&"string"!=typeof r&&r.width&&r.height?e.image:this.__image,!n)return 0;var r="width"===t?"height":"width";e=e[r];return null==e?n[t]:n[t]/n[r]*e},hs.prototype.getWidth=function(){return this._getSize("width")},hs.prototype.getHeight=function(){return this._getSize("height")},hs.prototype.getAnimationStyleProps=function(){return us},hs.prototype.getBoundingRect=function(){var t=this.style;return this._rect||(this._rect=new Un(t.x||0,t.y||0,this.getWidth(),this.getHeight())),this._rect},S=hs;function hs(){return null!==as&&as.apply(this,arguments)||this}S.prototype.type="image";var cs=S,ds=Math.round;function ps(t,e,n){if(e){var r=e.x1,i=e.x2,o=e.y1;e=e.y2;return t.x1=r,t.x2=i,t.y1=o,t.y2=e,n=n&&n.lineWidth,n?(ds(2*r)===ds(2*i)&&(t.x1=t.x2=gs(r,n,!0)),ds(2*o)===ds(2*e)&&(t.y1=t.y2=gs(o,n,!0)),t):t}}function fs(t,e,n){if(e){var r=e.x,i=e.y,o=e.width;e=e.height;return t.x=r,t.y=i,t.width=o,t.height=e,n=n&&n.lineWidth,n?(t.x=gs(r,n,!0),t.y=gs(i,n,!0),t.width=Math.max(gs(r+o,n,!1)-t.x,0===o?0:1),t.height=Math.max(gs(i+e,n,!1)-t.y,0===e?0:1),t):t}}function gs(t,e,n){return e?(t=ds(2*t),(t+ds(e))%2==0?t/2:(t+(n?1:-1))/2):t}var ms,ys=function(){this.x=0,this.y=0,this.width=0,this.height=0},_s={};_t(vs,ms=rs),vs.prototype.getDefaultShape=function(){return new ys},vs.prototype.buildPath=function(t,e){var n,r,i,o,a,s,l,u,h,c,d,p,f,g;this.subPixelOptimize?(n=(g=fs(_s,e,this.style)).x,r=g.y,i=g.width,o=g.height,g.r=e.r,e=g):(n=e.x,r=e.y,i=e.width,o=e.height),e.r?(a=t,p=(s=e).x,f=s.y,g=s.width,e=s.height,s=s.r,g<0&&(p+=g,g=-g),e<0&&(f+=e,e=-e),"number"==typeof s?l=u=h=c=s:s instanceof Array?1===s.length?l=u=h=c=s[0]:2===s.length?(l=h=s[0],u=c=s[1]):3===s.length?(l=s[0],u=c=s[1],h=s[2]):(l=s[0],u=s[1],h=s[2],c=s[3]):l=u=h=c=0,g<l+u&&(l*=g/(d=l+u),u*=g/d),g<h+c&&(h*=g/(d=h+c),c*=g/d),e<u+h&&(u*=e/(d=u+h),h*=e/d),e<l+c&&(l*=e/(d=l+c),c*=e/d),a.moveTo(p+l,f),a.lineTo(p+g-u,f),0!==u&&a.arc(p+g-u,f+u,u,-Math.PI/2,0),a.lineTo(p+g,f+e-h),0!==h&&a.arc(p+g-h,f+e-h,h,0,Math.PI/2),a.lineTo(p+c,f+e),0!==c&&a.arc(p+c,f+e-c,c,Math.PI/2,Math.PI),a.lineTo(p,f+l),0!==l&&a.arc(p+l,f+l,l,Math.PI,1.5*Math.PI)):t.rect(n,r,i,o)},vs.prototype.isZeroArea=function(){return!this.shape.width||!this.shape.height},M=vs;function vs(t){return ms.call(this,t)||this}M.prototype.type="rect";var xs,bs=M,Ts={fill:"#000"},ws={style:L({fill:!0,stroke:!0,fillOpacity:!0,strokeOpacity:!0,lineWidth:!0,fontSize:!0,lineHeight:!0,width:!0,height:!0,textShadowColor:!0,textShadowBlur:!0,textShadowOffsetX:!0,textShadowOffsetY:!0,backgroundColor:!0,padding:!0,borderColor:!0,borderWidth:!0,borderRadius:!0},Do.style)},Ss=(_t(Ms,xs=Bo),Ms.prototype.childrenRef=function(){return this._children},Ms.prototype.update=function(){this.styleChanged()&&this._updateSubTexts();for(var t=0;t<this._children.length;t++){var e=this._children[t];e.zlevel=this.zlevel,e.z=this.z,e.z2=this.z2,e.culling=this.culling,e.cursor=this.cursor,e.invisible=this.invisible}var n=this.attachedTransform;n?(n.updateTransform(),(n=n.transform)?(this.transform=this.transform||[],ve(this.transform,n)):this.transform=null):xs.prototype.update.call(this)},Ms.prototype.getComputedTransform=function(){return this.__hostTarget&&(this.__hostTarget.getComputedTransform(),this.__hostTarget.updateInnerText(!0)),this.attachedTransform?this.attachedTransform.getComputedTransform():xs.prototype.getComputedTransform.call(this)},Ms.prototype._updateSubTexts=function(){var t;this._childCursor=0,Es(t=this.style),F(t.rich,Es),this.style.rich?this._updateRichTexts():this._updatePlainTexts(),this._children.length=this._childCursor,this.styleUpdated()},Ms.prototype.addSelfToZr=function(t){xs.prototype.addSelfToZr.call(this,t);for(var e=0;e<this._children.length;e++)this._children[e].__zr=t},Ms.prototype.removeSelfFromZr=function(t){xs.prototype.removeSelfFromZr.call(this,t);for(var e=0;e<this._children.length;e++)this._children[e].__zr=null},Ms.prototype.getBoundingRect=function(){if(this.styleChanged()&&this._updateSubTexts(),!this._rect){for(var t=new Un(0,0,0,0),e=this._children,n=[],r=null,i=0;i<e.length;i++){var o=e[i],a=o.getBoundingRect();o=o.getLocalTransform(n);o?(t.copy(a),t.applyTransform(o),(r=r||t.clone()).union(t)):(r=r||a.clone()).union(a)}this._rect=r||t}return this._rect},Ms.prototype.setDefaultTextStyle=function(t){this._defaultStyle=t||Ts},Ms.prototype.setTextContent=function(t){throw new Error("Can't attach text on another text")},Ms.prototype._mergeStyle=function(t,e){if(!e)return t;var n=e.rich,r=t.rich||n&&{};return R(t,e),n&&r?(this._mergeRich(r,n),t.rich=r):r&&(t.rich=r),t},Ms.prototype._mergeRich=function(t,e){for(var n=U(e),r=0;r<n.length;r++){var i=n[r];t[i]=t[i]||{},R(t[i],e[i])}},Ms.prototype.getAnimationStyleProps=function(){return ws},Ms.prototype._getOrCreateChild=function(t){var e=this._children[this._childCursor];return e&&e instanceof t||(e=new t),(this._children[this._childCursor++]=e).__zr=this.__zr,e.parent=this,e},Ms.prototype._updatePlainTexts=function(){var t,e,n=this.style,r=n.font||Wn,i=n.padding,o=function(t,e){null!=t&&(t+="");var n,r=e.overflow,i=e.padding,o=e.font,a="truncate"===r,s=Qn(o),l=nt(e.lineHeight,s),u="truncate"===e.lineOverflow,h=e.width,c=(n=null!=h&&"break"===r||"breakAll"===r?t?Co(t,e.font,h,"breakAll"===r,0).lines:[]:t?t.split("\n"):[]).length*l;(r=nt(e.height,c))<c&&u&&(d=Math.floor(r/l),n=n.slice(0,d));u=r;var d=h;if(i&&(u+=i[0]+i[2],null!=d&&(d+=i[1]+i[3])),t&&a&&null!=d)for(var p=vo(h,o,e.ellipsis,{minChar:e.truncateMinChar,placeholder:e.placeholder}),f=0;f<n.length;f++)n[f]=xo(n[f],p);if(null==h){var g=0;for(f=0;f<n.length;f++)g=Math.max(jn(n[f],o),g);h=g}return{lines:n,height:r,outerHeight:u,lineHeight:l,calculatedLineHeight:s,contentHeight:c,width:h}}(Rs(n),n),a=Ls(n),s=!!n.backgroundColor,l=o.outerHeight,u=o.lines,h=o.lineHeight,c=this._defaultStyle,d=n.x||0,p=n.y||0,f=n.align||c.align||"left",g=n.verticalAlign||c.verticalAlign||"top",m=d,y=Kn(p,o.contentHeight,g);(a||i)&&(t=o.width,i&&(t+=i[1]+i[3]),e=qn(d,t,f),p=Kn(p,l,g),a&&this._renderBackground(n,n,e,p,t,l)),y+=h/2,i&&(m=Ds(d,f,i),"top"===g?y+=i[0]:"bottom"===g&&(y-=i[2]));for(var _=0,v=(g=!1,null==(i="fill"in n?n.fill:(g=!0,c.fill))||"none"===i?null:i.image||i.colorStops?"#000":i),x=(Is("stroke"in n?n.stroke:s||c.autoStroke&&!g?null:(_=2,c.stroke))),b=0<n.textShadowBlur,T=null!=n.width&&("truncate"===n.overflow||"break"===n.overflow||"breakAll"===n.overflow),w=o.calculatedLineHeight,S=0;S<u.length;S++){var M=this._getOrCreateChild(ss),A=M.createStyle();M.useStyle(A),A.text=u[S],A.x=m,A.y=y,f&&(A.textAlign=f),A.textBaseline="middle",A.opacity=n.opacity,A.strokeFirst=!0,b&&(A.shadowBlur=n.textShadowBlur||0,A.shadowColor=n.textShadowColor||"transparent",A.shadowOffsetX=n.textShadowOffsetX||0,A.shadowOffsetY=n.textShadowOffsetY||0),x&&(A.stroke=x,A.lineWidth=n.lineWidth||_,A.lineDash=n.lineDash,A.lineDashOffset=n.lineDashOffset||0),v&&(A.fill=v),A.font=r,y+=h,T&&M.setBoundingRect(new Un(qn(A.x,n.width,A.textAlign),Kn(A.y,w,A.textBaseline),n.width,w))}},Ms.prototype._updateRichTexts=function(){var t=this.style,e=So(Rs(t),t),n=e.width,r=e.outerWidth,i=e.outerHeight,o=t.padding,a=t.x||0,s=t.y||0,l=this._defaultStyle,u=t.align||l.align,h=(l=t.verticalAlign||l.verticalAlign,u=qn(a,r,u),l=Kn(s,i,l),u),c=l;o&&(h+=o[3],c+=o[0]);var d=h+n;Ls(t)&&this._renderBackground(t,t,u,l,r,i);for(var p=!!t.backgroundColor,f=0;f<e.lines.length;f++){for(var g=e.lines[f],m=g.tokens,y=m.length,_=g.lineHeight,v=g.width,x=0,b=h,T=d,w=y-1,S=void 0;x<y&&(!(S=m[x]).align||"left"===S.align);)this._placeToken(S,t,_,c,b,"left",p),v-=S.width,b+=S.width,x++;for(;0<=w&&"right"===(S=m[w]).align;)this._placeToken(S,t,_,c,T,"right",p),v-=S.width,T-=S.width,w--;for(b+=(n-(b-h)-(d-T)-v)/2;x<=w;)S=m[x],this._placeToken(S,t,_,c,b+S.width/2,"center",p),b+=S.width,x++;c+=_}},Ms.prototype._placeToken=function(t,e,n,r,i,o,a){var s=e.rich[t.styleName]||{};s.text=t.text;var l=t.verticalAlign,u=r+n/2;"top"===l?u=r+t.height/2:"bottom"===l&&(u=r+n-t.height/2),!t.isLineHolder&&Ls(s)&&this._renderBackground(s,e,"right"===o?i-t.width:"center"===o?i-t.width/2:i,u-t.height/2,t.width,t.height);var h=!!s.backgroundColor,c=t.textPadding;c&&(i=Ds(i,o,c),u-=t.height/2-c[0]-t.innerHeight/2);var d=this._getOrCreateChild(ss),p=d.createStyle();d.useStyle(p),l=this._defaultStyle,r=!1,n=0,c=Is("fill"in s?s.fill:"fill"in e?e.fill:(r=!0,l.fill)),r=Is("stroke"in s?s.stroke:"stroke"in e?e.stroke:h||a||l.autoStroke&&!r?null:(n=2,l.stroke)),l=0<s.textShadowBlur||0<e.textShadowBlur,p.text=t.text,p.x=i,p.y=u,l&&(p.shadowBlur=s.textShadowBlur||e.textShadowBlur||0,p.shadowColor=s.textShadowColor||e.textShadowColor||"transparent",p.shadowOffsetX=s.textShadowOffsetX||e.textShadowOffsetX||0,p.shadowOffsetY=s.textShadowOffsetY||e.textShadowOffsetY||0),p.textAlign=o,p.textBaseline="middle",p.font=t.font||Wn,p.opacity=rt(s.opacity,e.opacity,1),r&&(p.lineWidth=rt(s.lineWidth,e.lineWidth,n),p.lineDash=nt(s.lineDash,e.lineDash),p.lineDashOffset=e.lineDashOffset||0,p.stroke=r),c&&(p.fill=c),c=t.contentWidth,t=t.contentHeight,d.setBoundingRect(new Un(qn(p.x,c,p.textAlign),Kn(p.y,t,p.textBaseline),c,t))},Ms.prototype._renderBackground=function(t,e,n,r,i,o){var a,s,l,u=t.backgroundColor,h=t.borderWidth,c=t.borderColor,d=Y(u),p=t.borderRadius,f=this;(d||h&&c)&&((a=this._getOrCreateChild(bs)).useStyle(a.createStyle()),a.style.fill=null,(s=a.shape).x=n,s.y=r,s.width=i,s.height=o,s.r=p,a.dirtyShape()),d?((l=a.style).fill=u||null,l.fillOpacity=nt(t.fillOpacity,1)):u&&u.image&&((g=this._getOrCreateChild(cs)).onload=function(){f.dirtyStyle()},(d=g.style).image=u.image,d.x=n,d.y=r,d.width=i,d.height=o),h&&c&&((l=a.style).lineWidth=h,l.stroke=c,l.strokeOpacity=nt(t.strokeOpacity,1),l.lineDash=t.borderDash,l.lineDashOffset=t.borderDashOffset||0,a.strokeContainThreshold=0,a.hasFill()&&a.hasStroke()&&(l.strokeFirst=!0,l.lineWidth*=2));var g=(a||g).style;g.shadowBlur=t.shadowBlur||0,g.shadowColor=t.shadowColor||"transparent",g.shadowOffsetX=t.shadowOffsetX||0,g.shadowOffsetY=t.shadowOffsetY||0,g.opacity=rt(t.opacity,e.opacity,1)},Ms.makeFont=function(t){var e,n="";return(t.fontSize||t.fontFamily||t.fontWeight)&&(e="",e="string"!=typeof t.fontSize||-1===t.fontSize.indexOf("px")&&-1===t.fontSize.indexOf("rem")&&-1===t.fontSize.indexOf("em")?isNaN(+t.fontSize)?"12px":t.fontSize+"px":t.fontSize,n=[t.fontStyle,t.fontWeight,e,t.fontFamily||"sans-serif"].join(" ")),n&&st(n)||t.textFont||t.font},Ms);function Ms(t){var e=xs.call(this)||this;return e.type="text",e._children=[],e._defaultStyle=Ts,e.attr(t),e}var As={left:!0,right:1,center:1},Cs={top:1,bottom:1,middle:1};function Es(t){var e;t&&(t.font=Ss.makeFont(t),e=t.align,t.align=null==(e="middle"===e?"center":e)||As[e]?e:"left",e=t.verticalAlign,t.verticalAlign=null==(e="center"===e?"middle":e)||Cs[e]?e:"top",t.padding&&(t.padding=ot(t.padding)))}function Is(t,e){return null==t||e<=0||"transparent"===t||"none"===t?null:t.image||t.colorStops?"#000":t}function Ds(t,e,n){return"right"===e?t-n[1]:"center"===e?t+n[3]/2-n[1]/2:t+n[3]}function Rs(t){return t=t.text,null!=t&&(t+=""),t}function Ls(t){return!!(t.backgroundColor||t.borderWidth&&t.borderColor)}var Os=Ss,Ps=Xi(),Ns=1,ks={},Bs=Xi(),Fs=0,zs=1,Hs=2,Vs=["emphasis","blur","select"],Us=["normal","emphasis","blur","select"],Gs=10,Ws=9,Xs="highlight",js="downplay",Ys="select",Zs="unselect",qs="toggleSelect";function Ks(t){return null!=t&&"none"!==t}var Qs=new Ve(100);function Js(t){if("string"!=typeof t)return t;var e=Qs.get(t);return e||(e=nn(t,-.1),Qs.put(t,e)),e}function $s(t,e,n){t.onHoverStateChange&&(t.hoverState||0)!==n&&t.onHoverStateChange(e),t.hoverState=n}function tl(t){$s(t,"emphasis",Hs)}function el(t){t.hoverState===Hs&&$s(t,"normal",Fs)}function nl(t){$s(t,"blur",zs)}function rl(t){t.hoverState===zs&&$s(t,"normal",Fs)}function il(t){t.selected=!0}function ol(t){t.selected=!1}function al(t,e,n){e(t,n)}function sl(t,e,n){al(t,e,n),t.isGroup&&t.traverse((function(t){al(t,e,n)}))}function ll(t,e){switch(e){case"emphasis":t.hoverState=Hs;break;case"normal":t.hoverState=Fs;break;case"blur":t.hoverState=zs;break;case"select":t.selected=!0}}function ul(t,e,n){var r=0<=P(t.currentStates,e),i=t.style.opacity;t=r?null:function(t,e,n,r){for(var i=t.style,o={},a=0;a<e.length;a++){var s=e[a],l=i[s];o[s]=null==l?r&&r[s]:l}for(a=0;a<t.animators.length;a++){var u=t.animators[a];u.__fromStateTransition&&u.__fromStateTransition.indexOf(n)<0&&"style"===u.targetName&&u.saveFinalToTarget(o,e)}return o}(t,["opacity"],e,{opacity:1}),e=(n=n||{}).style||{};return null==e.opacity&&(n=R({},n),e=R({opacity:r?i:.1*t.opacity},e),n.style=e),n}function hl(t,e){var n,r,i,o,a,s=this.states[t];if(this.style){if("emphasis"===t)return n=this,i=s,o=(r=e)&&0<=P(r,"select"),a=!1,n instanceof rs&&(e=Bs(n),r=o&&e.selectFill||e.normalFill,o=o&&e.selectStroke||e.normalStroke,(Ks(r)||Ks(o))&&(!Ks((e=(i=i||{}).style||{}).fill)&&Ks(r)?(a=!0,i=R({},i),(e=R({},e)).fill=Js(r)):!Ks(e.stroke)&&Ks(o)&&(a||(i=R({},i),e=R({},e)),e.stroke=Js(o)),i.style=e)),i&&null==i.z2&&(a||(i=R({},i)),a=n.z2EmphasisLift,i.z2=n.z2+(null!=a?a:Gs)),i;if("blur"===t)return ul(this,t,s);if("select"===t)return a=this,(i=s)&&null==i.z2&&(i=R({},i),t=a.z2SelectLift,i.z2=a.z2+(null!=t?t:Ws)),i}return s}function cl(t){t.stateProxy=hl;var e=t.getTextContent();t=t.getTextGuideLine();e&&(e.stateProxy=hl),t&&(t.stateProxy=hl)}function dl(t,e){t.__highByOuter|=1<<(e||0),sl(t,tl)}function pl(t,e){(t.__highByOuter&=~(1<<(e||0)))||sl(t,el)}function fl(t){sl(t,nl)}function gl(t){sl(t,rl)}function ml(t){sl(t,il)}function yl(t){sl(t,ol)}function _l(t,e){return t.__highDownSilentOnTouch&&e.zrByTouch}function vl(t,e,n,r,i){var o,a,s,l,u=r.getModel();function h(t,e){for(var n=0;n<e.length;n++){var r=t.getItemGraphicEl(e[n]);r&&gl(r)}}n=n||"coordinateSystem",i?null!=t&&e&&"none"!==e&&(a=u.getSeriesByIndex(t),(s=a.coordinateSystem)&&s.master&&(s=s.master),l=[],u.eachSeries((function(t){var i=a===t,o=t.coordinateSystem;if(o&&o.master&&(o=o.master),!("series"===n&&!i||"coordinateSystem"===n&&!(o&&s?o===s:i)||"series"===e&&i)){if(r.getViewOfSeriesModel(t).group.traverse((function(t){nl(t)})),B(e))h(t.getData(),e);else if(K(e))for(var u=U(e),c=0;c<u.length;c++)h(t.getData(u[c]),e[u[c]]);l.push(t)}})),u.eachComponent((function(t,e){"series"===t||(e=r.getViewOfComponentModel(e))&&e.blurSeries&&e.blurSeries(l,u)}))):(o=r).getModel().eachComponent((function(t,e){("series"===t?o.getViewOfSeriesModel(e):o.getViewOfComponentModel(e)).group.traverse((function(t){rl(t)}))}))}function xl(t){F(t.getAllData(),(function(e){var n=e.data,r=e.type;n.eachItemGraphicEl((function(e,n){(t.isSelected(n,r)?ml:yl)(e)}))}))}function bl(t,e,n){Ml(t,!0),sl(t,cl),function(t,e,n){t=Ps(t),null!=e?(t.focus=e,t.blurScope=n):t.focus&&(t.focus=null)}(t,e,n)}var Tl=["emphasis","blur","select"],wl={itemStyle:"getItemStyle",lineStyle:"getLineStyle",areaStyle:"getAreaStyle"};function Sl(t,e,n,r){n=n||"itemStyle";for(var i=0;i<Tl.length;i++){var o=Tl[i],a=e.getModel([o,n]);t.ensureState(o).style=r?r(a):a[wl[n]]()}}function Ml(t,e){var n=!1===e;e=t;t.highDownSilentOnTouch&&(e.__highDownSilentOnTouch=t.highDownSilentOnTouch),n&&!e.__highDownDispatcher||(e.__highByOuter=e.__highByOuter||0,e.__highDownDispatcher=!n)}function Al(t){return!(!t||!t.__highDownDispatcher)}function Cl(t){return t=t.type,t===Ys||t===Zs||t===qs}function El(t){return t=t.type,t===Xs||t===js}var Il=Ba.CMD,Dl=[[],[],[]],Rl=Math.sqrt,Ll=Math.atan2,Ol=Math.sqrt,Pl=Math.sin,Nl=Math.cos,kl=Math.PI;function Bl(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Fl(t,e){return(t[0]*e[0]+t[1]*e[1])/(Bl(t)*Bl(e))}function zl(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(Fl(t,e))}function Hl(t,e,n,r,i,o,a,s,l,u,h){var c=l*(kl/180),d=Nl(c)*(t-n)/2+Pl(c)*(e-r)/2,p=-1*Pl(c)*(t-n)/2+Nl(c)*(e-r)/2;l=d*d/(a*a)+p*p/(s*s);1<l&&(a*=Ol(l),s*=Ol(l)),l=(i===o?-1:1)*Ol((a*a*(s*s)-a*a*(p*p)-s*s*(d*d))/(a*a*(p*p)+s*s*(d*d)))||0,i=l*a*p/s,l=l*-s*d/a,t=(t+n)/2+Nl(c)*i-Pl(c)*l,n=(e+r)/2+Pl(c)*i+Nl(c)*l,e=zl([1,0],[(d-i)/a,(p-l)/s]),r=[(d-i)/a,(p-l)/s],p=[(-1*d-i)/a,(-1*p-l)/s],l=zl(r,p),Fl(r,p)<=-1&&(l=kl),(l=1<=Fl(r,p)?0:l)<0&&(p=Math.round(l/kl*1e6)/1e6,l=2*kl+p%2*kl),h.addData(u,t,n,a,s,e,l,c,o)}var Vl,Ul=/([mlvhzcqtsa])([^mlvhzcqtsa]*)/gi,Gl=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g,Wl=(_t(Xl,Vl=rs),Xl.prototype.applyTransform=function(t){},Xl);function Xl(){return null!==Vl&&Vl.apply(this,arguments)||this}function jl(t){return null!=t.setData}function Yl(t,e){var n=function(t){var e=new Ba;if(!t)return e;var n,r=0,i=0,o=r,a=i,s=Ba.CMD,l=t.match(Ul);if(!l)return e;for(var u=0;u<l.length;u++){for(var h=l[u],c=h.charAt(0),d=void 0,p=h.match(Gl)||[],f=p.length,g=0;g<f;g++)p[g]=parseFloat(p[g]);for(var m=0;m<f;){var y=void 0,_=void 0,v=void 0,x=void 0,b=void 0,T=void 0,w=void 0,S=r,M=i,A=void 0,C=void 0;switch(c){case"l":r+=p[m++],i+=p[m++],d=s.L,e.addData(d,r,i);break;case"L":r=p[m++],i=p[m++],d=s.L,e.addData(d,r,i);break;case"m":r+=p[m++],i+=p[m++],d=s.M,e.addData(d,r,i),o=r,a=i,c="l";break;case"M":r=p[m++],i=p[m++],d=s.M,e.addData(d,r,i),o=r,a=i,c="L";break;case"h":r+=p[m++],d=s.L,e.addData(d,r,i);break;case"H":r=p[m++],d=s.L,e.addData(d,r,i);break;case"v":i+=p[m++],d=s.L,e.addData(d,r,i);break;case"V":i=p[m++],d=s.L,e.addData(d,r,i);break;case"C":d=s.C,e.addData(d,p[m++],p[m++],p[m++],p[m++],p[m++],p[m++]),r=p[m-2],i=p[m-1];break;case"c":d=s.C,e.addData(d,p[m++]+r,p[m++]+i,p[m++]+r,p[m++]+i,p[m++]+r,p[m++]+i),r+=p[m-2],i+=p[m-1];break;case"S":y=r,_=i,A=e.len(),C=e.data,n===s.C&&(y+=r-C[A-4],_+=i-C[A-3]),d=s.C,S=p[m++],M=p[m++],r=p[m++],i=p[m++],e.addData(d,y,_,S,M,r,i);break;case"s":y=r,_=i,A=e.len(),C=e.data,n===s.C&&(y+=r-C[A-4],_+=i-C[A-3]),d=s.C,S=r+p[m++],M=i+p[m++],r+=p[m++],i+=p[m++],e.addData(d,y,_,S,M,r,i);break;case"Q":S=p[m++],M=p[m++],r=p[m++],i=p[m++],d=s.Q,e.addData(d,S,M,r,i);break;case"q":S=p[m++]+r,M=p[m++]+i,r+=p[m++],i+=p[m++],d=s.Q,e.addData(d,S,M,r,i);break;case"T":y=r,_=i,A=e.len(),C=e.data,n===s.Q&&(y+=r-C[A-4],_+=i-C[A-3]),r=p[m++],i=p[m++],d=s.Q,e.addData(d,y,_,r,i);break;case"t":y=r,_=i,A=e.len(),C=e.data,n===s.Q&&(y+=r-C[A-4],_+=i-C[A-3]),r+=p[m++],i+=p[m++],d=s.Q,e.addData(d,y,_,r,i);break;case"A":v=p[m++],x=p[m++],b=p[m++],T=p[m++],w=p[m++],Hl(S=r,M=i,r=p[m++],i=p[m++],T,w,v,x,b,d=s.A,e);break;case"a":v=p[m++],x=p[m++],b=p[m++],T=p[m++],w=p[m++],Hl(S=r,M=i,r+=p[m++],i+=p[m++],T,w,v,x,b,d=s.A,e)}}"z"!==c&&"Z"!==c||(d=s.Z,e.addData(d),r=o,i=a),n=d}return e.toStatic(),e}(t);e=R({},e);return e.buildPath=function(t){var e;jl(t)?(t.setData(n.data),(e=t.getContext())&&t.rebuildPath(e,1)):n.rebuildPath(e=t,1)},e.applyTransform=function(t){!function(t,e){for(var n,r,i,o,a=t.data,s=t.len(),l=Il.M,u=Il.C,h=Il.L,c=Il.R,d=Il.A,p=Il.Q,f=0,g=0;f<s;){switch(n=a[f++],g=f,r=0,n){case l:case h:r=1;break;case u:r=3;break;case p:r=2;break;case d:var m=e[4],y=e[5],_=Rl(e[0]*e[0]+e[1]*e[1]),v=Rl(e[2]*e[2]+e[3]*e[3]),x=Ll(-e[1]/v,e[0]/_);a[f]*=_,a[f++]+=m,a[f]*=v,a[f++]+=y,a[f++]*=_,a[f++]*=v,a[f++]+=x,a[f++]+=x,g=f+=2;break;case c:o[0]=a[f++],o[1]=a[f++],Dt(o,o,e),a[g++]=o[0],a[g++]=o[1],o[0]+=a[f++],o[1]+=a[f++],Dt(o,o,e),a[g++]=o[0],a[g++]=o[1]}for(i=0;i<r;i++){var b=Dl[i];b[0]=a[f++],b[1]=a[f++],Dt(b,b,e),a[g++]=b[0],a[g++]=b[1]}}t.increaseVersion()}(n,t),this.dirtyShape()},e}function Zl(t,e){return new Wl(Yl(t,e))}var ql,Kl=function(){this.cx=0,this.cy=0,this.r=0},Ql=(_t(Jl,ql=rs),Jl.prototype.getDefaultShape=function(){return new Kl},Jl.prototype.buildPath=function(t,e,n){n&&t.moveTo(e.cx+e.r,e.cy),t.arc(e.cx,e.cy,e.r,0,2*Math.PI)},Jl);function Jl(t){return ql.call(this,t)||this}Ql.prototype.type="circle";var $l,tu=Ql,eu=function(){this.cx=0,this.cy=0,this.rx=0,this.ry=0};_t(nu,$l=rs),nu.prototype.getDefaultShape=function(){return new eu},nu.prototype.buildPath=function(t,e){var n=e.cx,r=e.cy,i=e.rx,o=e.ry,a=.5522848*i;e=.5522848*o;t.moveTo(n-i,r),t.bezierCurveTo(n-i,r-e,n-a,r-o,n,r-o),t.bezierCurveTo(n+a,r-o,n+i,r-e,n+i,r),t.bezierCurveTo(n+i,r+e,n+a,r+o,n,r+o),t.bezierCurveTo(n-a,r+o,n-i,r+e,n-i,r),t.closePath()},tr=nu;function nu(t){return $l.call(this,t)||this}tr.prototype.type="ellipse";var ru=tr,iu=Math.PI,ou=2*iu,au=Math.sin,su=Math.cos,lu=Math.acos,uu=Math.atan2,hu=Math.abs,cu=Math.sqrt,du=Math.max,pu=Math.min,fu=1e-4;function gu(t,e,n,r,i,o,a){var s=t-n,l=e-r,u=(a?o:-o)/cu(s*s+l*l),h=u*l,c=-u*s,d=t+h,p=e+c;a=n+h,l=r+c,u=(d+a)/2,s=(p+l)/2,t=a-d,e=l-p,n=t*t+e*e,r=i-o,o=d*l-a*p,d=(e<0?-1:1)*cu(du(0,r*r*n-o*o)),l=(o*e-t*d)/n,a=(-o*t-e*d)/n,p=(o*e+t*d)/n,e=(-o*t+e*d)/n,d=l-u,n=a-s,u=p-u,s=e-s;return u*u+s*s<d*d+n*n&&(l=p,a=e),{cx:l,cy:a,x01:-h,y01:-c,x11:l*(i/r-1),y11:a*(i/r-1)}}function mu(t,e){var n,r,i,o,a,s,l,u,h,c,d,p,f,g,m,y,_,v,x,b,T,w,S,M=du(e.r,0),A=du(e.r0||0,0),C=0<M;(C||0<A)&&(C||(M=A,A=0),M<A&&(T=M,M=A,A=T),n=!!e.clockwise,o=(r=e.startAngle)===(i=e.endAngle)?0:(Na(y=[r,i],!n),hu(y[0]-y[1])),a=e.cx,s=e.cy,f=e.cornerRadius||0,m=e.innerCornerRadius||0,fu<M?ou-fu<o?(t.moveTo(a+M*su(r),s+M*au(r)),t.arc(a,s,M,r,i,!n),fu<A&&(t.moveTo(a+A*su(i),s+A*au(i)),t.arc(a,s,A,i,r,n))):(g=hu(M-A)/2,l=pu(g,f),_=u=pu(g,m),v=l,h=M*su(r),c=M*au(r),d=A*su(i),p=A*au(i),T=C=b=x=void 0,(fu<l||fu<u)&&(x=M*su(i),b=M*au(i),C=A*su(r),T=A*au(r),o<iu&&(y=function(t,e,n,r,i,o,a,s){var l=n-t;n=r-e,r=a-i;if(!((s=(a=s-o)*l-r*n)*s<fu))return[t+(s=(r*(e-o)-a*(t-i))/s)*l,e+s*n]}(h,c,C,T,x,b,d,p))&&(e=h-y[0],f=c-y[1],g=x-y[0],m=b-y[1],m=1/au(lu((e*g+f*m)/(cu(e*e+f*f)*cu(g*g+m*m)))/2),y=cu(y[0]*y[0]+y[1]*y[1]),_=pu(u,(A-y)/(m-1)),v=pu(l,(M-y)/(1+m)))),fu<o?fu<v?(w=gu(C,T,h,c,M,v,n),S=gu(x,b,d,p,M,v,n),t.moveTo(a+w.cx+w.x01,s+w.cy+w.y01),v<l?t.arc(a+w.cx,s+w.cy,v,uu(w.y01,w.x01),uu(S.y01,S.x01),!n):(t.arc(a+w.cx,s+w.cy,v,uu(w.y01,w.x01),uu(w.y11,w.x11),!n),t.arc(a,s,M,uu(w.cy+w.y11,w.cx+w.x11),uu(S.cy+S.y11,S.cx+S.x11),!n),t.arc(a+S.cx,s+S.cy,v,uu(S.y11,S.x11),uu(S.y01,S.x01),!n))):(t.moveTo(a+h,s+c),t.arc(a,s,M,r,i,!n)):t.moveTo(a+h,s+c),fu<A&&fu<o?fu<_?(w=gu(d,p,x,b,A,-_,n),S=gu(h,c,C,T,A,-_,n),t.lineTo(a+w.cx+w.x01,s+w.cy+w.y01),_<u?t.arc(a+w.cx,s+w.cy,_,uu(w.y01,w.x01),uu(S.y01,S.x01),!n):(t.arc(a+w.cx,s+w.cy,_,uu(w.y01,w.x01),uu(w.y11,w.x11),!n),t.arc(a,s,A,uu(w.cy+w.y11,w.cx+w.x11),uu(S.cy+S.y11,S.cx+S.x11),n),t.arc(a+S.cx,s+S.cy,_,uu(S.y11,S.x11),uu(S.y01,S.x01),!n))):(t.lineTo(a+d,s+p),t.arc(a,s,A,i,r,n)):t.lineTo(a+d,s+p)):t.moveTo(a,s),t.closePath())}var yu,_u=function(){this.cx=0,this.cy=0,this.r0=0,this.r=0,this.startAngle=0,this.endAngle=2*Math.PI,this.clockwise=!0,this.cornerRadius=0,this.innerCornerRadius=0};_t(vu,yu=rs),vu.prototype.getDefaultShape=function(){return new _u},vu.prototype.buildPath=function(t,e){mu(t,e)},vu.prototype.isZeroArea=function(){return this.shape.startAngle===this.shape.endAngle||this.shape.r===this.shape.r0},ur=vu;function vu(t){return yu.call(this,t)||this}ur.prototype.type="sector";var xu,bu=ur,Tu=function(){this.cx=0,this.cy=0,this.r=0,this.r0=0},wu=(_t(Su,xu=rs),Su.prototype.getDefaultShape=function(){return new Tu},Su.prototype.buildPath=function(t,e){var n=e.cx,r=e.cy,i=2*Math.PI;t.moveTo(n+e.r,r),t.arc(n,r,e.r,0,i,!1),t.moveTo(n+e.r0,r),t.arc(n,r,e.r0,0,i,!0)},Su);function Su(t){return xu.call(this,t)||this}wu.prototype.type="ring";var Mu=wu;function Au(t,e,n,r,i,o,a){return t=.5*(n-t),r=.5*(r-e),(2*(e-n)+t+r)*a+(-3*(e-n)-2*t-r)*o+t*i+e}function Cu(t,e,n){var r=e.smooth,i=e.points;if(i&&2<=i.length){if(r&&"spline"!==r){var o=function(t,e,n,r){var i,o,a=[],s=[],l=[],u=[];if(r){for(var h=[1/0,1/0],c=[-1/0,-1/0],d=0,p=t.length;d<p;d++)Rt(h,h,t[d]),Lt(c,c,t[d]);Rt(h,h,r[0]),Lt(c,c,r[1])}for(d=0,p=t.length;d<p;d++){var f=t[d];if(n)i=t[d?d-1:p-1],o=t[(d+1)%p];else{if(0===d||d===p-1){a.push([(y=t[d])[0],y[1]]);continue}i=t[d-1],o=t[d+1]}bt(s,o,i),St(s,s,e);var g=At(f,i),m=At(f,o),y=g+m;0!==y&&(g/=y,m/=y),St(l,s,-g),St(u,s,m),m=xt([],f,l),f=xt([],f,u),r&&(Lt(m,m,h),Rt(m,m,c),Lt(f,f,h),Rt(f,f,c)),a.push(m),a.push(f)}return n&&a.push(a.shift()),a}(i,r,n,e.smoothConstraint);t.moveTo(i[0][0],i[0][1]);for(var a=i.length,s=0;s<(n?a:a-1);s++){var l=o[2*s],u=o[2*s+1],h=i[(s+1)%a];t.bezierCurveTo(l[0],l[1],u[0],u[1],h[0],h[1])}}else{"spline"===r&&(i=function(t,e){for(var n=t.length,r=[],i=0,o=1;o<n;o++)i+=At(t[o-1],t[o]);var a=(a=i/2)<n?n:a;for(o=0;o<a;o++){var s=o/(a-1)*(e?n:n-1),l=Math.floor(s),u=s-l,h=void 0,c=t[l%n],d=void 0,p=void 0;p=e?(h=t[(l-1+n)%n],d=t[(l+1)%n],t[(l+2)%n]):(h=t[0===l?l:l-1],d=t[n-2<l?n-1:l+1],t[n-3<l?n-1:l+2]),s=u*u,l=u*s;r.push([Au(h[0],c[0],d[0],p[0],u,s,l),Au(h[1],c[1],d[1],p[1],u,s,l)])}return r}(i,n)),t.moveTo(i[0][0],i[0][1]);s=1;for(var c=i.length;s<c;s++)t.lineTo(i[s][0],i[s][1])}n&&t.closePath()}}var Eu,Iu=function(){this.points=null,this.smooth=0,this.smoothConstraint=null};_t(Du,Eu=rs),Du.prototype.getDefaultShape=function(){return new Iu},Du.prototype.buildPath=function(t,e){Cu(t,e,!0)},$r=Du;function Du(t){return Eu.call(this,t)||this}$r.prototype.type="polygon";var Ru,Lu=$r,Ou=function(){this.points=null,this.percent=1,this.smooth=0,this.smoothConstraint=null},Pu=(_t(Nu,Ru=rs),Nu.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},Nu.prototype.getDefaultShape=function(){return new Ou},Nu.prototype.buildPath=function(t,e){Cu(t,e,!1)},Nu);function Nu(t){return Ru.call(this,t)||this}Pu.prototype.type="polyline";var ku,Bu=Pu,Fu={},zu=function(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1};_t(Hu,ku=rs),Hu.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},Hu.prototype.getDefaultShape=function(){return new zu},Hu.prototype.buildPath=function(t,e){var n,r,i,o;o=this.subPixelOptimize?(n=(o=ps(Fu,e,this.style)).x1,r=o.y1,i=o.x2,o.y2):(n=e.x1,r=e.y1,i=e.x2,e.y2),e=e.percent,0!==e&&(t.moveTo(n,r),e<1&&(i=n*(1-e)+i*e,o=r*(1-e)+o*e),t.lineTo(i,o))},Hu.prototype.pointAt=function(t){var e=this.shape;return[e.x1*(1-t)+e.x2*t,e.y1*(1-t)+e.y2*t]},Oo=Hu;function Hu(t){return ku.call(this,t)||this}Oo.prototype.type="line";var Vu=Oo,Uu=[],Gu=function(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.cpx1=0,this.cpy1=0,this.percent=1};function Wu(t,e,n){var r=t.cpx2,i=t.cpy2;return null===r||null===i?[(n?Ko:qo)(t.x1,t.cpx1,t.cpx2,t.x2,e),(n?Ko:qo)(t.y1,t.cpy1,t.cpy2,t.y2,e)]:[(n?na:ea)(t.x1,t.cpx1,t.x2,e),(n?na:ea)(t.y1,t.cpy1,t.y2,e)]}var Xu;_t(ju,Xu=rs),ju.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},ju.prototype.getDefaultShape=function(){return new Gu},ju.prototype.buildPath=function(t,e){var n=e.x1,r=e.y1,i=e.x2,o=e.y2,a=e.cpx1,s=e.cpy1,l=e.cpx2,u=e.cpy2;e=e.percent;0!==e&&(t.moveTo(n,r),null==l||null==u?(e<1&&(ia(n,a,i,e,Uu),a=Uu[1],i=Uu[2],ia(r,s,o,e,Uu),s=Uu[1],o=Uu[2]),t.quadraticCurveTo(a,s,i,o)):(e<1&&($o(n,a,l,i,e,Uu),a=Uu[1],l=Uu[2],i=Uu[3],$o(r,s,u,o,e,Uu),s=Uu[1],u=Uu[2],o=Uu[3]),t.bezierCurveTo(a,s,l,u,i,o)))},ju.prototype.pointAt=function(t){return Wu(this.shape,t,!1)},ju.prototype.tangentAt=function(t){return t=Wu(this.shape,t,!0),Mt(t,t)},e=ju;function ju(t){return Xu.call(this,t)||this}e.prototype.type="bezier-curve";var Yu,Zu=e,qu=function(){this.cx=0,this.cy=0,this.r=0,this.startAngle=0,this.endAngle=2*Math.PI,this.clockwise=!0};_t(Ku,Yu=rs),Ku.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},Ku.prototype.getDefaultShape=function(){return new qu},Ku.prototype.buildPath=function(t,e){var n=e.cx,r=e.cy,i=Math.max(e.r,0),o=e.startAngle,a=e.endAngle,s=e.clockwise,l=Math.cos(o);e=Math.sin(o);t.moveTo(l*i+n,e*i+r),t.arc(n,r,i,o,a,!s)},f=Ku;function Ku(t){return Yu.call(this,t)||this}f.prototype.type="arc";var Qu,Ju=f;function $u(){var t=null!==Qu&&Qu.apply(this,arguments)||this;return t.type="compound",t}var th=(_t($u,Qu=rs),$u.prototype._updatePathDirty=function(){for(var t=this.shape.paths,e=this.shapeChanged(),n=0;n<t.length;n++)e=e||t[n].shapeChanged();e&&this.dirtyShape()},$u.prototype.beforeBrush=function(){this._updatePathDirty();for(var t=this.shape.paths||[],e=this.getGlobalScale(),n=0;n<t.length;n++)t[n].path||t[n].createPathProxy(),t[n].path.setScale(e[0],e[1],t[n].segmentIgnoreThreshold)},$u.prototype.buildPath=function(t,e){for(var n=e.paths||[],r=0;r<n.length;r++)n[r].buildPath(t,n[r].shape,!0)},$u.prototype.afterBrush=function(){for(var t=this.shape.paths||[],e=0;e<t.length;e++)t[e].pathUpdated()},$u.prototype.getBoundingRect=function(){return this._updatePathDirty.call(this),rs.prototype.getBoundingRect.call(this)},$u);function eh(t){this.colorStops=t||[]}var nh;eh.prototype.addColorStop=function(t,e){this.colorStops.push({offset:t,color:e})},v=eh;function rh(t,e,n,r,i,o){return i=nh.call(this,i)||this,i.x=null==t?0:t,i.y=null==e?0:e,i.x2=null==n?1:n,i.y2=null==r?0:r,i.type="linear",i.global=o||!1,i}var ih,oh=(_t(rh,nh=v),rh);function ah(t,e,n,r,i){return r=ih.call(this,r)||this,r.x=null==t?.5:t,r.y=null==e?.5:e,r.r=null==n?.5:n,r.type="radial",r.global=i||!1,r}var sh=(_t(ah,ih=v),ah),lh=[0,0],uh=[0,0],hh=new Dn,ch=new Dn;function dh(t,e){this._corners=[],this._axes=[],this._origin=[0,0];for(var n=0;n<4;n++)this._corners[n]=new Dn;for(n=0;n<2;n++)this._axes[n]=new Dn;t&&this.fromBoundingRect(t,e)}var ph,fh=(dh.prototype.fromBoundingRect=function(t,e){var n=this._corners,r=this._axes,i=t.x,o=t.y,a=i+t.width;t=o+t.height;if(n[0].set(i,o),n[1].set(a,o),n[2].set(a,t),n[3].set(i,t),e)for(var s=0;s<4;s++)n[s].transform(e);for(Dn.sub(r[0],n[1],n[0]),Dn.sub(r[1],n[3],n[0]),r[0].normalize(),r[1].normalize(),s=0;s<2;s++)this._origin[s]=r[s].dot(n[0])},dh.prototype.intersect=function(t,e){var n=!0,r=!e;return hh.set(1/0,1/0),ch.set(0,0),!this._intersectCheckOneSide(this,t,hh,ch,r,1)&&(n=!1,r)||!this._intersectCheckOneSide(t,this,hh,ch,r,-1)&&(n=!1,r)||r||Dn.copy(e,n?hh:ch),n},dh.prototype._intersectCheckOneSide=function(t,e,n,r,i,o){for(var a=!0,s=0;s<2;s++){var l=this._axes[s];if(this._getProjMinMaxOnAxis(s,t._corners,lh),this._getProjMinMaxOnAxis(s,e._corners,uh),lh[1]<uh[0]||uh[1]<lh[0]){if(a=!1,i)return a;var u=Math.abs(uh[0]-lh[1]),h=Math.abs(lh[0]-uh[1]);Math.min(u,h)>r.len()&&(u<h?Dn.scale(r,l,-u*o):Dn.scale(r,l,h*o))}else n&&(u=Math.abs(uh[0]-lh[1]),h=Math.abs(lh[0]-uh[1]),Math.min(u,h)<n.len()&&(u<h?Dn.scale(n,l,u*o):Dn.scale(n,l,-h*o)))}return a},dh.prototype._getProjMinMaxOnAxis=function(t,e,n){for(var r=this._axes[t],i=this._origin,o=e[0].dot(r)+i[t],a=o,s=o,l=1;l<e.length;l++){var u=e[l].dot(r)+i[t];a=Math.min(u,a),s=Math.max(u,s)}n[0]=a,n[1]=s},dh),gh=[];function mh(){var t=null!==ph&&ph.apply(this,arguments)||this;return t.notClear=!0,t.incremental=!0,t._displayables=[],t._temporaryDisplayables=[],t._cursor=0,t}var yh=(_t(mh,ph=Bo),mh.prototype.traverse=function(t,e){t.call(e,this)},mh.prototype.useStyle=function(){this.style={}},mh.prototype.getCursor=function(){return this._cursor},mh.prototype.innerAfterBrush=function(){this._cursor=this._displayables.length},mh.prototype.clearDisplaybles=function(){this._displayables=[],this._temporaryDisplayables=[],this._cursor=0,this.markRedraw(),this.notClear=!1},mh.prototype.clearTemporalDisplayables=function(){this._temporaryDisplayables=[]},mh.prototype.addDisplayable=function(t,e){(e?this._temporaryDisplayables:this._displayables).push(t),this.markRedraw()},mh.prototype.addDisplayables=function(t,e){e=e||!1;for(var n=0;n<t.length;n++)this.addDisplayable(t[n],e)},mh.prototype.getDisplayables=function(){return this._displayables},mh.prototype.getTemporalDisplayables=function(){return this._temporaryDisplayables},mh.prototype.eachPendingDisplayable=function(t){for(var e=this._cursor;e<this._displayables.length;e++)t&&t(this._displayables[e]);for(e=0;e<this._temporaryDisplayables.length;e++)t&&t(this._temporaryDisplayables[e])},mh.prototype.update=function(){this.updateTransform();for(var t=this._cursor;t<this._displayables.length;t++)(e=this._displayables[t]).parent=this,e.update(),e.parent=null;var e;for(t=0;t<this._temporaryDisplayables.length;t++)(e=this._temporaryDisplayables[t]).parent=this,e.update(),e.parent=null},mh.prototype.getBoundingRect=function(){if(!this._rect){for(var t=new Un(1/0,1/0,-1/0,-1/0),e=0;e<this._displayables.length;e++){var n=this._displayables[e],r=n.getBoundingRect().clone();n.needLocalTransform()&&r.applyTransform(n.getLocalTransform(gh)),t.union(r)}this._rect=t}return this._rect},mh.prototype.contain=function(t,e){var n=this.transformCoordToLocal(t,e);if(this.getBoundingRect().contain(n[0],n[1]))for(var r=0;r<this._displayables.length;r++)if(this._displayables[r].contain(t,e))return!0;return!1},mh),_h=Math.max,vh=Math.min,xh={};function bh(t){return rs.extend(t)}var Th=function(t,e){var n,r=Yl(t,e);function i(t){return t=n.call(this,t)||this,t.applyTransform=r.applyTransform,t.buildPath=r.buildPath,t}return _t(i,n=Wl),i};function wh(t,e){return Th(t,e)}function Sh(t,e){xh[t]=e}function Mh(t){if(xh.hasOwnProperty(t))return xh[t]}function Ah(t,e,n,r){return e=Zl(t,e),n&&("center"===r&&(n=Eh(n,e.getBoundingRect())),Dh(e,n)),e}function Ch(t,e,n){var r=new cs({style:{image:t,x:e.x,y:e.y,width:e.width,height:e.height},onload:function(t){"center"===n&&(t={width:t.width,height:t.height},r.setStyle(Eh(e,t)))}});return r}function Eh(t,e){var n=e.width/e.height;e=t.height*n,n=e<=t.width?t.height:(e=t.width)/n;return{x:t.x+t.width/2-e/2,y:t.y+t.height/2-n/2,width:e,height:n}}var Ih=function(t,e){for(var n=[],r=t.length,i=0;i<r;i++){var o=t[i];o.path||o.createPathProxy(),o.shapeChanged()&&o.buildPath(o.path,o.shape,!0),n.push(o.path)}return(e=new rs(e)).createPathProxy(),e.buildPath=function(t){var e;jl(t)&&(t.appendPath(n),(e=t.getContext())&&t.rebuildPath(e,1))},e};function Dh(t,e){t.applyTransform&&(e=t.getBoundingRect().calculateTransform(e),t.applyTransform(e))}function Rh(t){return ps(t.shape,t.shape,t.style),t}function Lh(t){return fs(t.shape,t.shape,t.style),t}var Oh=gs;function Ph(t,e,n,r,i,o,a){var s,l=!1;"function"==typeof i?(a=o,o=i,i=null):K(i)&&(o=i.cb,a=i.during,l=i.isFrom,s=i.removeOpt,i=i.dataIndex);var u,h="update"===t,c="remove"===t;r&&r.ecModel&&(u=(p=r.ecModel.getUpdatePayload())&&p.animation);var d,p,f=r&&r.isAnimationEnabled();c||e.stopAnimation("remove"),f?(f=p=d=void 0,"function"==typeof(f=u?(d=u.duration||0,p=u.easing||"cubicOut",u.delay||0):c?(d=nt((s=s||{}).duration,200),p=nt(s.easing,"cubicOut"),0):(d=r.getShallow(h?"animationDurationUpdate":"animationDuration"),p=r.getShallow(h?"animationEasingUpdate":"animationEasing"),r.getShallow(h?"animationDelayUpdate":"animationDelay")))&&(f=f(i,r.getAnimationDelayParams?r.getAnimationDelayParams(e,i):null)),0<(d="function"==typeof d?d(i):d)?l?e.animateFrom(n,{duration:d,delay:f||0,easing:p,done:o,force:!!o||!!a,scope:t,during:a}):e.animateTo(n,{duration:d,delay:f||0,easing:p,done:o,force:!!o||!!a,setToFinal:!0,scope:t,during:a}):(e.stopAnimation(),l||e.attr(n),o&&o())):(e.stopAnimation(),l||e.attr(n),a&&a(1),o&&o())}function Nh(t,e,n,r,i,o){Ph("update",t,e,n,r,i,o)}function kh(t,e,n,r,i,o){Ph("init",t,e,n,r,i,o)}function Bh(t,e,n,r,i,o){Hh(t)||Ph("remove",t,e,n,r,i,o)}function Fh(t,e,n,r){t.removeTextContent(),t.removeTextGuideLine(),Bh(t,{style:{opacity:0}},e,n,r)}function zh(t,e,n){function r(){t.parent&&t.parent.remove(t)}t.isGroup?t.traverse((function(t){t.isGroup||Fh(t,e,n,r)})):Fh(t,e,n,r)}function Hh(t){if(!t.__zr)return!0;for(var e=0;e<t.animators.length;e++)if("remove"===t.animators[e].scope)return!0;return!1}function Vh(t,e){for(var n=_e([]);t&&t!==e;)xe(n,t.getLocalTransform(),n),t=t.parent;return n}function Uh(t,e,n){return e&&!B(e)&&(e=Le.getLocalTransform(e)),Dt([],t,e=n?Se([],e):e)}function Gh(t,e,n){var r=0===e[4]||0===e[5]||0===e[0]?1:Math.abs(2*e[4]/e[0]),i=0===e[4]||0===e[5]||0===e[2]?1:Math.abs(2*e[4]/e[2]);i=Uh(i=["left"===t?-r:"right"===t?r:0,"top"===t?-i:"bottom"===t?i:0],e,n);return Math.abs(i[0])>Math.abs(i[1])?0<i[0]?"right":"left":0<i[1]?"bottom":"top"}function Wh(t){return!t.isGroup}function Xh(t,e,n){var r,i;function o(t){var e={x:t.x,y:t.y,rotation:t.rotation};return null!=t.shape&&(e.shape=R({},t.shape)),e}t&&e&&(i={},t.traverse((function(t){Wh(t)&&t.anid&&(i[t.anid]=t)})),r=i,e.traverse((function(t){var e,i;Wh(t)&&t.anid&&(e=r[t.anid])&&(i=o(t),t.attr(o(e)),Nh(t,i,n,Ps(t).dataIndex))})))}function jh(t,e){return z(t,(function(t){var n=t[0];n=_h(n,e.x);return n=vh(n,e.x+e.width),t=t[1],t=_h(t,e.y),[n,t=vh(t,e.y+e.height)]}))}function Yh(t,e){var n=_h(t.x,e.x),r=vh(t.x+t.width,e.x+e.width),i=_h(t.y,e.y);e=vh(t.y+t.height,e.y+e.height);if(n<=r&&i<=e)return{x:n,y:i,width:r-n,height:e-i}}function Zh(t,e,n){var r=R({rectHover:!0},e);e=r.style={strokeNoScale:!0};if(n=n||{x:-1,y:-1,width:2,height:2},t)return 0===t.indexOf("image://")?(e.image=t.slice(8),L(e,n),new cs(r)):Ah(t.replace("path://",""),r,n,"center")}function qh(t,e,n,r,i){for(var o=0,a=i[i.length-1];o<i.length;o++){var s=i[o];if(Kh(t,e,n,r,s[0],s[1],a[0],a[1]))return!0;a=s}}function Kh(t,e,n,r,i,o,a,s){var l=n-t,u=r-e;n=a-i,r=s-o,a=n*u-l*r;return!((s=a)<=1e-6&&-1e-6<=s)&&(i=t-i,o=e-o,l=(i*u-l*o)/a,!(l<0||1<l)&&(a=(i*r-n*o)/a,!(a<0||1<a)))}Sh("circle",tu),Sh("ellipse",ru),Sh("sector",bu),Sh("ring",Mu),Sh("polygon",Lu),Sh("polyline",Bu),Sh("rect",bs),Sh("line",Vu),Sh("bezierCurve",Zu),Sh("arc",Ju);var Qh={};function Jh(t,e){for(var n=0;n<Vs.length;n++){var r=Vs[n],i=e[r];r=t.ensureState(r);r.style=r.style||{},r.style.text=i}var o=t.currentStates.slice();t.clearStates(!0),t.setStyle({text:e.normal}),t.useStates(o,!0)}function $h(t,e,n){for(var r,i=t.labelFetcher,o=t.labelDataIndex,a=t.labelDimIndex,s=e.normal,l={normal:r=null==(r=i?i.getFormattedLabel(o,"normal",null,a,s&&s.get("formatter"),null!=n?{interpolatedValue:n}:null):r)?j(t.defaultText)?t.defaultText(o,t,n):t.defaultText:r},u=0;u<Vs.length;u++){var h=Vs[u],c=e[h];l[h]=nt(i?i.getFormattedLabel(o,h,null,a,c&&c.get("formatter")):null,r)}return l}function tc(t,e,n,r){n=n||Qh;for(var i=t instanceof Os,o=!1,a=0;a<Us.length;a++)if((d=e[Us[a]])&&d.getShallow("show")){o=!0;break}var s=i?t:t.getTextContent();if(o){i||(s||(s=new Os,t.setTextContent(s)),t.stateProxy&&(s.stateProxy=t.stateProxy));var l=$h(n,e),u=e.normal,h=!!u.getShallow("show"),c=nc(u,r&&r.normal,n,!1,!i);for(c.text=l.normal,i||t.setTextConfig(rc(u,n,!1)),a=0;a<Vs.length;a++){var d,p,f,g=Vs[a];(d=e[g])&&(p=s.ensureState(g),(f=!!nt(d.getShallow("show"),h))!=h&&(p.ignore=!f),p.style=nc(d,r&&r[g],n,!0,!i),p.style.text=l[g],i||(t.ensureState(g).textConfig=rc(d,n,!0)))}s.silent=!!u.getShallow("silent"),null!=s.style.x&&(c.x=s.style.x),null!=s.style.y&&(c.y=s.style.y),s.ignore=!h,s.useStyle(c),s.dirty(),n.enableTextSetter&&(lc(s).setLabelText=function(t){t=$h(n,e,t),Jh(s,t)})}else s&&(s.ignore=!0);t.dirty()}function ec(t,e){for(var n={normal:t.getModel(e=e||"label")},r=0;r<Vs.length;r++){var i=Vs[r];n[i]=t.getModel([i,e])}return n}function nc(t,e,n,r,i){var o={};return function(t,e,n,r,i){n=n||Qh;var o,a=e.ecModel,s=a&&a.option.textStyle,l=function(t){for(var e;t&&t!==t.ecModel;){var n=(t.option||Qh).rich;if(n){e=e||{};for(var r=U(n),i=0;i<r.length;i++){var o=r[i];e[o]=1}}t=t.parentModel}return e}(e);if(l)for(var u in o={},l){var h;l.hasOwnProperty(u)&&(h=e.getModel(["rich",u]),sc(o[u]={},h,s,n,r,i,!1,!0))}o&&(t.rich=o),a=e.get("overflow"),a&&(t.overflow=a),a=e.get("minMargin"),null!=a&&(t.margin=a),sc(t,e,s,n,r,i,!0,!1)}(o,t,n,r,i),e&&R(o,e),o}function rc(t,e,n){e=e||{};var r={},i=t.getShallow("rotate"),o=nt(t.getShallow("distance"),n?null:5),a=t.getShallow("offset");n=t.getShallow("position")||(n?null:"inside");return null!=(n="outside"===n?e.defaultOutsidePosition||"top":n)&&(r.position=n),null!=a&&(r.offset=a),null!=i&&(i*=Math.PI/180,r.rotation=i),null!=o&&(r.distance=o),r.outsideFill="inherit"===t.get("color")?e.inheritColor||null:"auto",r}var ic=["fontStyle","fontWeight","fontSize","fontFamily","textShadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY"],oc=["align","lineHeight","width","height","tag","verticalAlign"],ac=["padding","borderWidth","borderRadius","borderDashOffset","backgroundColor","borderColor","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"];function sc(t,e,n,r,i,o,a,s){n=!i&&n||Qh;var l=r&&r.inheritColor,u=e.getShallow("color"),h=e.getShallow("textBorderColor"),c=nt(e.getShallow("opacity"),n.opacity);"inherit"!==u&&"auto"!==u||(u=l||null),"inherit"!==h&&"auto"!==h||(h=l||null),o||(u=u||n.color,h=h||n.textBorderColor),null!=u&&(t.fill=u),null!=h&&(t.stroke=h),h=nt(e.getShallow("textBorderWidth"),n.textBorderWidth),null!=h&&(t.lineWidth=h),h=nt(e.getShallow("textBorderType"),n.textBorderType),null!=h&&(t.lineDash=h),h=nt(e.getShallow("textBorderDashOffset"),n.textBorderDashOffset),null!=h&&(t.lineDashOffset=h),null!=(c=i||null!=c||s?c:r&&r.defaultOpacity)&&(t.opacity=c),i||o||null==t.fill&&r.inheritColor&&(t.fill=r.inheritColor);for(var d=0;d<ic.length;d++){var p=ic[d];null!=(f=nt(e.getShallow(p),n[p]))&&(t[p]=f)}for(d=0;d<oc.length;d++)p=oc[d],null!=(f=e.getShallow(p))&&(t[p]=f);if(null!=t.verticalAlign||null!=(o=e.getShallow("baseline"))&&(t.verticalAlign=o),!a||!r.disableBox){for(d=0;d<ac.length;d++){var f;p=ac[d];null!=(f=e.getShallow(p))&&(t[p]=f)}r=e.getShallow("borderType"),null!=r&&(t.borderDash=r),"auto"!==t.backgroundColor&&"inherit"!==t.backgroundColor||!l||(t.backgroundColor=l),"auto"!==t.borderColor&&"inherit"!==t.borderColor||!l||(t.borderColor=l)}}var lc=Xi();function uc(t,e,n,r,i){var o,a,s,l=lc(t);l.valueAnimation&&(o=l.defaultInterpolatedText,a=nt(l.interpolatedValue,l.prevValue),s=l.value,(null==a?kh:Nh)(t,{},r,e,null,(function(r){var u=Ji(n,l.precision,a,s,r);l.interpolatedValue=1===r?null:u,u=$h({labelDataIndex:e,labelFetcher:i,defaultText:o?o(u):u+""},l.statesModels,u),Jh(t,u)})))}var hc=["textStyle","color"],cc=new Os;function dc(){}dc.prototype.getTextColor=function(t){var e=this.ecModel;return this.getShallow("color")||(!t&&e?e.get(hc):null)},dc.prototype.getFont=function(){return t={fontStyle:this.getShallow("fontStyle"),fontWeight:this.getShallow("fontWeight"),fontSize:this.getShallow("fontSize"),fontFamily:this.getShallow("fontFamily")},e=(e=this.ecModel)&&e.getModel("textStyle"),st([t.fontStyle||e&&e.getShallow("fontStyle")||"",t.fontWeight||e&&e.getShallow("fontWeight")||"",(t.fontSize||e&&e.getShallow("fontSize")||12)+"px",t.fontFamily||e&&e.getShallow("fontFamily")||"sans-serif"].join(" "));var t,e},dc.prototype.getTextRect=function(t){return cc.useStyle({text:t,fontStyle:this.getShallow("fontStyle"),fontWeight:this.getShallow("fontWeight"),fontSize:this.getShallow("fontSize"),fontFamily:this.getShallow("fontFamily"),verticalAlign:this.getShallow("verticalAlign")||this.getShallow("baseline"),padding:this.getShallow("padding"),lineHeight:this.getShallow("lineHeight"),rich:this.getShallow("rich")}),cc.update(),cc.getBoundingRect()},S=dc,M=[["lineWidth","width"],["stroke","color"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"],["lineDash","type"],["lineDashOffset","dashOffset"],["lineCap","cap"],["lineJoin","join"],["miterLimit"]];var pc=uo(M);fc.prototype.getLineStyle=function(t){return pc(this,t)},Ql=fc;function fc(){}tr=[["fill","color"],["stroke","borderColor"],["lineWidth","borderWidth"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"],["lineDash","borderType"],["lineDashOffset","borderDashOffset"],["lineCap","borderCap"],["lineJoin","borderJoin"],["miterLimit","borderMiterLimit"]];var gc=uo(tr);mc.prototype.getItemStyle=function(t,e){return gc(this,t,e)},ur=mc;function mc(){}var yc,_c;vc.prototype.init=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i]},vc.prototype.mergeOption=function(t,e){D(this.option,t,!0)},vc.prototype.get=function(t,e){return null==t?this.option:this._doGet(this.parsePath(t),!e&&this.parentModel)},vc.prototype.getShallow=function(t,e){var n=this.option;n=null==n?n:n[t];return null!=n||e||(e=this.parentModel)&&(n=e.getShallow(t)),n},vc.prototype.getModel=function(t,e){var n=null!=t;t=n?this.parsePath(t):null;return new vc(n?this._doGet(t):this.option,e=e||this.parentModel&&this.parentModel.getModel(this.resolveParentPath(t)),this.ecModel)},vc.prototype.isEmpty=function(){return null==this.option},vc.prototype.restoreData=function(){},vc.prototype.clone=function(){return new this.constructor(I(this.option))},vc.prototype.parsePath=function(t){return"string"==typeof t?t.split("."):t},vc.prototype.resolveParentPath=function(t){return t},vc.prototype.isAnimationEnabled=function(){if(!g.node&&this.option)return null!=this.option.animation?!!this.option.animation:this.parentModel?this.parentModel.isAnimationEnabled():void 0},vc.prototype._doGet=function(t,e){var n=this.option;if(!t)return n;for(var r=0;r<t.length&&(!t[r]||null!=(n=n&&"object"==typeof n?n[t[r]]:null));r++);return null==n&&e?e._doGet(this.resolveParentPath(t),e.parentModel):n},wu=vc;function vc(t,e,n){this.parentModel=e,this.ecModel=n,this.option=t}ro(wu),yc=wu,_c=["__\0is_clz",oo++].join("_"),yc.prototype[_c]=!0,yc.isInstance=function(t){return!(!t||!t[_c])},k(wu,Ql),k(wu,ur),k(wu,co),k(wu,S);var xc=wu,bc=Math.round(10*Math.random());function Tc(t){return[t||"",bc++].join("_")}function wc(t,e){return D(D({},t,!0),e,!0)}var Sc="ZH",Mc="EN",Ac=Mc,Cc={},Ec={},Ic=g.domSupported&&-1<(document.documentElement.lang||navigator.language||navigator.browserLanguage).toUpperCase().indexOf(Sc)?Sc:Ac;function Dc(t,e){t=t.toUpperCase(),Ec[t]=new xc(e),Cc[t]=e}Dc(Mc,{time:{month:["January","February","March","April","May","June","July","August","September","October","November","December"],monthAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayOfWeekAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},legend:{selector:{all:"All",inverse:"Inv"}},toolbox:{brush:{title:{rect:"Box Select",polygon:"Lasso Select",lineX:"Horizontally Select",lineY:"Vertically Select",keep:"Keep Selections",clear:"Clear Selections"}},dataView:{title:"Data View",lang:["Data View","Close","Refresh"]},dataZoom:{title:{zoom:"Zoom",back:"Zoom Reset"}},magicType:{title:{line:"Switch to Line Chart",bar:"Switch to Bar Chart",stack:"Stack",tiled:"Tile"}},restore:{title:"Restore"},saveAsImage:{title:"Save as Image",lang:["Right Click to Save Image"]}},series:{typeNames:{pie:"Pie chart",bar:"Bar chart",line:"Line chart",scatter:"Scatter plot",effectScatter:"Ripple scatter plot",radar:"Radar chart",tree:"Tree",treemap:"Treemap",boxplot:"Boxplot",candlestick:"Candlestick",k:"K line chart",heatmap:"Heat map",map:"Map",parallel:"Parallel coordinate map",lines:"Line graph",graph:"Relationship graph",sankey:"Sankey diagram",funnel:"Funnel chart",gauge:"Guage",pictorialBar:"Pictorial bar",themeRiver:"Theme River Map",sunburst:"Sunburst"}},aria:{general:{withTitle:'This is a chart about "{title}"',withoutTitle:"This is a chart"},series:{single:{prefix:"",withName:" with type {seriesType} named {seriesName}.",withoutName:" with type {seriesType}."},multiple:{prefix:". It consists of {seriesCount} series count.",withName:" The {seriesId} series is a {seriesType} representing {seriesName}.",withoutName:" The {seriesId} series is a {seriesType}.",separator:{middle:"",end:""}}},data:{allData:"The data is as follows: ",partialData:"The first {displayCnt} items are: ",withName:"the data for {name} is {value}",withoutName:"{value}",separator:{middle:", ",end:". "}}}}),Dc(Sc,{time:{month:["","","","","","","","","","","",""],monthAbbr:["1","2","3","4","5","6","7","8","9","10","11","12"],dayOfWeek:["","","","","","",""],dayOfWeekAbbr:["","","","","","",""]},legend:{selector:{all:"",inverse:""}},toolbox:{brush:{title:{rect:"",polygon:"",lineX:"",lineY:"",keep:"",clear:""}},dataView:{title:"",lang:["","",""]},dataZoom:{title:{zoom:"",back:""}},magicType:{title:{line:"",bar:"",stack:"",tiled:""}},restore:{title:""},saveAsImage:{title:"",lang:[""]}},series:{typeNames:{pie:"",bar:"",line:"",scatter:"",effectScatter:"",radar:"",tree:"",treemap:"",boxplot:"",candlestick:"K",k:"K",heatmap:"",map:"",parallel:"",lines:"",graph:"",sankey:"",funnel:"",gauge:"",pictorialBar:"",themeRiver:"",sunburst:""}},aria:{general:{withTitle:"{title}",withoutTitle:""},series:{single:{prefix:"",withName:"{seriesType}{seriesName}",withoutName:"{seriesType}"},multiple:{prefix:"{seriesCount}",withName:"{seriesId}{seriesName}{seriesType}",withoutName:"{seriesId}{seriesType}",separator:{middle:"",end:""}}},data:{allData:"",partialData:"{displayCnt}",withName:"{name}{value}",withoutName:"{value}",separator:{middle:"",end:""}}}});var Rc=1e3,Lc=60*Rc,Oc=60*Lc,Pc=24*Oc,Nc=($r=365*Pc,{year:"{yyyy}",month:"{MMM}",day:"{d}",hour:"{HH}:{mm}",minute:"{HH}:{mm}",second:"{HH}:{mm}:{ss}",millisecond:"{hh}:{mm}:{ss} {SSS}",none:"{yyyy}-{MM}-{dd} {hh}:{mm}:{ss} {SSS}"}),kc=(Pu="{yyyy}-{MM}-{dd}",{year:"{yyyy}",month:"{yyyy}-{MM}",day:Pu,hour:Pu+" "+Nc.hour,minute:Pu+" "+Nc.minute,second:Pu+" "+Nc.second,millisecond:Nc.none}),Bc=["year","month","day","hour","minute","second","millisecond"],Fc=["year","half-year","quarter","month","week","half-week","day","half-day","quarter-day","hour","minute","second","millisecond"];function zc(t,e){return"0000".substr(0,e-(t+="").length)+t}function Hc(t){switch(t){case"half-year":case"quarter":return"month";case"week":case"half-week":return"day";case"half-day":case"quarter-day":return"hour";default:return t}}function Vc(t,e,n,r){var i=bi(t),o=i[Wc(n)](),a=i[Xc(n)]()+1,s=Math.floor((a-1)/4)+1,l=i[jc(n)](),u=i["get"+(n?"UTC":"")+"Day"](),h=i[Yc(n)](),c=(h-1)%12+1,d=i[Zc(n)](),p=i[qc(n)](),f=i[Kc(n)]();t=(r instanceof xc?r:Ec[r||Ic]||Ec[Ac]).getModel("time"),i=t.get("month"),n=t.get("monthAbbr"),r=t.get("dayOfWeek"),t=t.get("dayOfWeekAbbr");return(e||"").replace(/{yyyy}/g,o+"").replace(/{yy}/g,o%100+"").replace(/{Q}/g,s+"").replace(/{MMMM}/g,i[a-1]).replace(/{MMM}/g,n[a-1]).replace(/{MM}/g,zc(a,2)).replace(/{M}/g,a+"").replace(/{dd}/g,zc(l,2)).replace(/{d}/g,l+"").replace(/{eeee}/g,r[u]).replace(/{ee}/g,t[u]).replace(/{e}/g,u+"").replace(/{HH}/g,zc(h,2)).replace(/{H}/g,h+"").replace(/{hh}/g,zc(c+"",2)).replace(/{h}/g,c+"").replace(/{mm}/g,zc(d,2)).replace(/{m}/g,d+"").replace(/{ss}/g,zc(p,2)).replace(/{s}/g,p+"").replace(/{SSS}/g,zc(f,3)).replace(/{S}/g,f+"")}function Uc(t,e){var n=bi(t),r=n[Xc(e)]()+1,i=n[jc(e)](),o=n[Yc(e)](),a=n[Zc(e)]();t=n[qc(e)](),e=0===n[Kc(e)](),t=e&&0===t,a=t&&0===a,o=a&&0===o,i=o&&1===i;return i&&1===r?"year":i?"month":o?"day":a?"hour":t?"minute":e?"second":"millisecond"}function Gc(t,e,n){var r="number"==typeof t?bi(t):t;switch(e=e||Uc(t,n)){case"year":return r[Wc(n)]();case"half-year":return 6<=r[Xc(n)]()?1:0;case"quarter":return Math.floor((r[Xc(n)]()+1)/4);case"month":return r[Xc(n)]();case"day":return r[jc(n)]();case"half-day":return r[Yc(n)]()/24;case"hour":return r[Yc(n)]();case"minute":return r[Zc(n)]();case"second":return r[qc(n)]();case"millisecond":return r[Kc(n)]()}}function Wc(t){return t?"getUTCFullYear":"getFullYear"}function Xc(t){return t?"getUTCMonth":"getMonth"}function jc(t){return t?"getUTCDate":"getDate"}function Yc(t){return t?"getUTCHours":"getHours"}function Zc(t){return t?"getUTCMinutes":"getMinutes"}function qc(t){return t?"getUTCSeconds":"getSeconds"}function Kc(t){return t?"getUTCSeconds":"getSeconds"}function Qc(t){return t?"setUTCMonth":"setMonth"}function Jc(t){return t?"setUTCDate":"setDate"}function $c(t){return t?"setUTCHours":"setHours"}function td(t){return t?"setUTCMinutes":"setMinutes"}function ed(t){return t?"setUTCSeconds":"setSeconds"}function nd(t){return t?"setUTCSeconds":"setSeconds"}function rd(t){return Ei(t)?(t=(t+"").split("."),t[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g,"$1,")+(1<t.length?"."+t[1]:"")):Y(t)?t:"-"}var id=ot,od=/([&<>"'])/g,ad={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function sd(t){return null==t?"":(t+"").replace(od,(function(t,e){return ad[e]}))}function ld(t,e,n){function r(t){return t&&st(t)?t:"-"}function i(t){return null!=t&&!isNaN(t)&&isFinite(t)}var o="time"===e,a=t instanceof Date;if(o||a){if(o=o?bi(t):t,!isNaN(+o))return Vc(o,"yyyy-MM-dd hh:mm:ss",n);if(a)return"-"}return"ordinal"===e?Z(t)?r(t):q(t)&&i(t)?t+"":"-":(e=Ci(t),i(e)?rd(e):Z(t)?r(t):"-")}function ud(t,e){return"{"+t+(null==e?"":e)+"}"}var hd=["a","b","c","d","e","f","g"];function cd(t,e,n){var r=(e=X(e)?e:[e]).length;if(!r)return"";for(var i=e[0].$vars||[],o=0;o<i.length;o++){var a=hd[o];t=t.replace(ud(a),ud(a,0))}for(var s=0;s<r;s++)for(var l=0;l<i.length;l++){var u=e[s][i[l]];t=t.replace(ud(hd[l],s),n?sd(u):u)}return t}function dd(t,e){return e=e||"transparent",Y(t)?t:K(t)&&t.colorStops&&(t.colorStops[0]||{}).color||e}function pd(t,e){var n;"_blank"===e||"blank"===e?((n=window.open()).opener=null,n.location.href=t):window.open(t,e)}var fd=F,gd=["left","right","top","bottom","width","height"],md=[["width","left","right"],["height","top","bottom"]];function yd(t,e,n,r,i){var o=0,a=0;null==r&&(r=1/0),null==i&&(i=1/0);var s=0;e.eachChild((function(l,u){var h,c,d=l.getBoundingRect(),p=e.childAt(u+1);u=p&&p.getBoundingRect();s="horizontal"===t?(p=d.width+(u?-u.x+d.x:0),r<(h=o+p)||l.newline?(o=0,h=p,a+=s+n,d.height):Math.max(s,d.height)):(u=d.height+(u?-u.y+d.y:0),i<(c=a+u)||l.newline?(o+=s+n,a=0,c=u,d.width):Math.max(s,d.width)),l.newline||(l.x=o,l.y=a,l.markRedraw(),"horizontal"===t?o=h+n:a=c+n)}))}var _d=yd;function vd(t,e,n){n=id(n||0);var r=e.width,i=e.height,o=hi(t.left,r),a=hi(t.top,i),s=hi(t.right,r),l=hi(t.bottom,i),u=hi(t.width,r),h=hi(t.height,i),c=n[2]+n[0],d=n[1]+n[3];e=t.aspect;switch(isNaN(u)&&(u=r-s-d-o),isNaN(h)&&(h=i-l-c-a),null!=e&&(isNaN(u)&&isNaN(h)&&(r/i<e?u=.8*r:h=.8*i),isNaN(u)&&(u=e*h),isNaN(h)&&(h=u/e)),isNaN(o)&&(o=r-s-u-d),isNaN(a)&&(a=i-l-h-c),t.left||t.right){case"center":o=r/2-u/2-n[3];break;case"right":o=r-u-d}switch(t.top||t.bottom){case"middle":case"center":a=i/2-h/2-n[0];break;case"bottom":a=i-h-c}return o=o||0,a=a||0,isNaN(u)&&(u=r-d-o-(s||0)),isNaN(h)&&(h=i-c-a-(l||0)),l=new Un(o+n[3],a+n[0],u,h),l.margin=n,l}function xd(t,e,n,r,i){var o,a=!i||!i.hv||i.hv[0],s=!i||!i.hv||i.hv[1],l=i&&i.boundingMode||"all";(a||s)&&("raw"===l?o="group"===t.type?new Un(0,0,+e.width||0,+e.height||0):t.getBoundingRect():(o=t.getBoundingRect(),t.needLocalTransform()&&(i=t.getLocalTransform(),(o=o.clone()).applyTransform(i))),r=vd(L({width:o.width,height:o.height},e),n,r),a=a?r.x-o.x:0,o=s?r.y-o.y:0,"raw"===l?(t.x=a,t.y=o):(t.x+=a,t.y+=o),t.markRedraw())}function bd(t){return t=t.layoutMode||t.constructor.layoutMode,K(t)?t:t?{type:t}:null}function Td(t,e,n){var r=n&&n.ignoreSize;X(r)||(r=[r,r]);var i=o(md[0],0);n=o(md[1],1);function o(n,i){var o={},l=0,u={},h=0;if(fd(n,(function(e){u[e]=t[e]})),fd(n,(function(t){a(e,t)&&(o[t]=u[t]=e[t]),s(o,t)&&l++,s(u,t)&&h++})),r[i])return s(e,n[1])?u[n[2]]=null:s(e,n[2])&&(u[n[1]]=null),u;if(2!==h&&l){if(2<=l)return o;for(var c=0;c<n.length;c++){var d=n[c];if(!a(o,d)&&a(t,d)){o[d]=t[d];break}}return o}return u}function a(t,e){return t.hasOwnProperty(e)}function s(t,e){return null!=t[e]&&"auto"!==t[e]}function l(t,e,n){fd(t,(function(t){e[t]=n[t]}))}l(md[0],t,i),l(md[1],t,n)}function wd(t){return e={},(n=t)&&e&&fd(gd,(function(t){n.hasOwnProperty(t)&&(e[t]=n[t])})),e;var e,n}W(yd,"vertical"),W(yd,"horizontal");var Sd,Md,Ad,Cd,Ed=Xi(),Id=(h(Dd,Sd=xc),Dd.prototype.init=function(t,e,n){this.mergeDefaultAndTheme(t,n)},Dd.prototype.mergeDefaultAndTheme=function(t,e){var n=bd(this),r=n?wd(t):{};D(t,e.getTheme().get(this.mainType)),D(t,this.getDefaultOption()),n&&Td(t,r,n)},Dd.prototype.mergeOption=function(t,e){D(this.option,t,!0);var n=bd(this);n&&Td(this.option,t,n)},Dd.prototype.optionUpdated=function(t,e){},Dd.prototype.getDefaultOption=function(){var t=this.constructor;if(!(e=t)||!e[eo])return t.defaultOption;var e=Ed(this);if(!e.defaultOption){for(var n=[],r=t;r;){var i=r.prototype.defaultOption;i&&n.push(i),r=r.superClass}for(var o={},a=n.length-1;0<=a;a--)o=D(o,n[a],!0);e.defaultOption=o}return e.defaultOption},Dd.prototype.getReferringComponents=function(t,e){var n=t+"Id";return Ki(this.ecModel,t,{index:this.get(t+"Index",!0),id:this.get(n,!0)},e)},Dd.prototype.getBoxLayoutParams=function(){return{left:this.get("left"),top:this.get("top"),right:this.get("right"),bottom:this.get("bottom"),width:this.get("width"),height:this.get("height")}},Dd.protoInitialize=((Oo=Dd.prototype).type="component",Oo.id="",Oo.name="",Oo.mainType="",Oo.subType="",void(Oo.componentIndex=0)),Dd);function Dd(t,e,n){return n=Sd.call(this,t,e,n)||this,n.uid=Tc("ec_cpt_model"),n}function Rd(t,e){return t[e]||(t[e]={predecessor:[],successor:[]}),t[e]}io(Id,xc),lo(Id),Ad={},(Md=Id).registerSubTypeDefaulter=function(t,e){t=no(t),Ad[t.main]=e},Md.determineSubType=function(t,e){var n,r=e.type;return r||(n=no(t).main,Md.hasSubTypes(t)&&Ad[n]&&(r=Ad[n](e))),r},Cd=function(t){var e=[];return F(Id.getClassesByMainType(t),(function(t){e=e.concat(t.dependencies||t.prototype.dependencies||[])})),e=z(e,(function(t){return no(t).main})),"dataset"!==t&&P(e,"dataset")<=0&&e.unshift("dataset"),e},Id.topologicalTravel=function(t,e,n,r){if(t.length){e=(o={},a=[],F(i=e,(function(t){var e,n,r=Rd(o,t),s=r.originalDeps=Cd(t);e=i,n=[],F(s,(function(t){0<=P(e,t)&&n.push(t)})),s=n;r.entryCount=s.length,0===r.entryCount&&a.push(t),F(s,(function(e){P(r.predecessor,e)<0&&r.predecessor.push(e);var n=Rd(o,e);P(n.successor,e)<0&&n.successor.push(t)}))})),{graph:o,noEntryList:a});var i,o,a,s=e.graph,l=e.noEntryList,u={};for(F(t,(function(t){u[t]=!0}));l.length;){var h=l.pop(),c=s[h],d=!!u[h];d&&(n.call(r,h,c.originalDeps.slice()),delete u[h]),F(c.successor,d?f:p)}F(u,(function(){throw new Error("")}))}function p(t){s[t].entryCount--,0===s[t].entryCount&&l.push(t)}function f(t){u[t]=!0,p(t)}};var Ld=Id;e="";"undefined"!=typeof navigator&&(e=navigator.platform||"");f="rgba(0, 0, 0, 0.2)";var Od={darkMode:"auto",color:["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc"],gradientColor:["#f6efa6","#d88273","#bf444c"],aria:{decal:{decals:[{color:f,dashArrayX:[1,0],dashArrayY:[2,5],symbolSize:1,rotation:Math.PI/6},{color:f,symbol:"circle",dashArrayX:[[8,8],[0,8,8,0]],dashArrayY:[6,0],symbolSize:.8},{color:f,dashArrayX:[1,0],dashArrayY:[4,3],rotation:-Math.PI/4},{color:f,dashArrayX:[[6,6],[0,6,6,0]],dashArrayY:[6,0]},{color:f,dashArrayX:[[1,0],[1,6]],dashArrayY:[1,0,6,0],rotation:Math.PI/4},{color:f,symbol:"triangle",dashArrayX:[[9,9],[0,9,9,0]],dashArrayY:[7,2],symbolSize:.75}]}},textStyle:{fontFamily:e.match(/^Win/)?"Microsoft YaHei":"sans-serif",fontSize:12,fontStyle:"normal",fontWeight:"normal"},blendMode:null,stateAnimation:{duration:300,easing:"cubicOut"},animation:"auto",animationDuration:1e3,animationDurationUpdate:500,animationEasing:"cubicInOut",animationEasingUpdate:"cubicInOut",animationThreshold:2e3,progressiveThreshold:3e3,progressive:400,hoverLayerThreshold:3e3,useUTC:!1},Pd=pt(["tooltip","label","itemName","itemId","seriesName"]),Nd="original",kd="arrayRows",Bd="objectRows",Fd="keyedColumns",zd="typedArray",Hd="unknown",Vd="column",Ud="row",Gd={Must:1,Might:2,Not:3},Wd=Xi();function Xd(t,e,n){var r={},i=Yd(e);if(!i||!t)return r;var o,a,s=[],l=[];e=e.ecModel,e=Wd(e).datasetMap,n=i.uid+"_"+n.seriesLayoutBy;F(t=t.slice(),(function(e,n){e=K(e)?e:t[n]={name:e},"ordinal"===e.type&&null==o&&(o=n,a=c(e)),r[e.name]=[]}));var u=e.get(n)||e.set(n,{categoryWayDim:a,valueWayDim:0});function h(t,e,n){for(var r=0;r<n;r++)t.push(e+r)}function c(t){return t=t.dimsDef,t?t.length:1}return F(t,(function(t,e){var n,i=t.name;t=c(t);null==o?(n=u.valueWayDim,h(r[i],n,t),h(l,n,t),u.valueWayDim+=t):o===e?(h(r[i],0,t),h(s,0,t)):(n=u.categoryWayDim,h(r[i],n,t),h(l,n,t),u.categoryWayDim+=t)})),s.length&&(r.itemName=s),l.length&&(r.seriesName=l),r}function jd(t,e,n){var r={};if(!Yd(t))return r;var i,o=e.sourceFormat,a=e.dimensionsDefine;return o!==Bd&&o!==Fd||F(a,(function(t,e){"name"===(K(t)?t.name:t)&&(i=e)})),t=function(){for(var t={},r={},s=[],l=0,u=Math.min(5,n);l<u;l++){var h=Zd(e.data,o,e.seriesLayoutBy,a,e.startIndex,l);s.push(h);var c=h===Gd.Not;if(c&&null==t.v&&l!==i&&(t.v=l),null!=t.n&&t.n!==t.v&&(c||s[t.n]!==Gd.Not)||(t.n=l),d(t)&&s[t.n]!==Gd.Not)return t;c||(h===Gd.Might&&null==r.v&&l!==i&&(r.v=l),null!=r.n&&r.n!==r.v||(r.n=l))}function d(t){return null!=t.v&&null!=t.n}return d(t)?t:d(r)?r:null}(),t&&(r.value=[t.v],t=null!=i?i:t.n,r.itemName=[t],r.seriesName=[t]),r}function Yd(t){if(!t.get("data",!0))return Ki(t.ecModel,"dataset",{index:t.get("datasetIndex",!0),id:t.get("datasetId",!0)},Zi).models[0]}function Zd(t,e,n,r,i,o){var a,s,l;if(J(t))return Gd.Not;if(r&&(K(r=r[o])?(s=r.name,l=r.type):Y(r)&&(s=r)),null!=l)return"ordinal"===l?Gd.Must:Gd.Not;if(e===kd){var u=t;if(n===Ud){for(var h=u[o],c=0;c<(h||[]).length&&c<5;c++)if(null!=(a=y(h[i+c])))return a}else for(c=0;c<u.length&&c<5;c++){var d=u[i+c];if(d&&null!=(a=y(d[o])))return a}}else if(e===Bd){var p=t;if(!s)return Gd.Not;for(c=0;c<p.length&&c<5;c++)if((g=p[c])&&null!=(a=y(g[s])))return a}else if(e===Fd){if(!s)return Gd.Not;if(!(h=t[s])||J(h))return Gd.Not;for(c=0;c<h.length&&c<5;c++)if(null!=(a=y(h[c])))return a}else if(e===Nd){var f=t;for(c=0;c<f.length&&c<5;c++){var g,m=ki(g=f[c]);if(!X(m))return Gd.Not;if(null!=(a=y(m[o])))return a}}function y(t){var e=Y(t);return null!=t&&isFinite(t)&&""!==t?e?Gd.Might:Gd.Not:e&&"-"!==t?Gd.Must:void 0}return Gd.Not}var qd,Kd,Qd,Jd=pt(),$d=Xi(),tp=(Xi(),ep.prototype.getColorFromPalette=function(t,e,n){var r=Oi(this.get("color",!0)),i=this.get("colorLayer",!0);return np(this,$d,r,i,t,e,n)},ep.prototype.clearColorPalette=function(){var t,e;(e=$d)(t=this).paletteIdx=0,e(t).paletteNameMap={}},ep);function ep(){}function np(t,e,n,r,i,o,a){return e=e(o=o||t),t=e.paletteIdx||0,o=e.paletteNameMap=e.paletteNameMap||{},o.hasOwnProperty(i)?o[i]:(a=(a=null!=a&&r?function(t,e){for(var n=t.length,r=0;r<n;r++)if(t[r].length>e)return t[r];return t[n-1]}(r,a):n)||n)&&a.length?(n=a[t],i&&(o[i]=n),e.paletteIdx=(t+1)%a.length,n):void 0}var rp,ip="\0_ec_inner";h(op,rp=xc),op.prototype.init=function(t,e,n,r,i,o){r=r||{},this.option=null,this._theme=new xc(r),this._locale=new xc(i),this._optionManager=o},op.prototype.setOption=function(t,e,n){e=lp(e),this._optionManager.setOption(t,n,e),this._resetOption(null,e)},op.prototype.resetOption=function(t,e){return this._resetOption(t,lp(e))},op.prototype._resetOption=function(t,e){var n,r=!1,i=this._optionManager;return t&&"recreate"!==t||(n=i.mountOption("recreate"===t),this.option&&"recreate"!==t?(this.restoreData(),this._mergeOption(n,e)):Qd(this,n),r=!0),"timeline"!==t&&"media"!==t||this.restoreData(),t&&"recreate"!==t&&"timeline"!==t||(n=i.getTimelineOption(this))&&(r=!0,this._mergeOption(n,e)),t&&"recreate"!==t&&"media"!==t||(i=i.getMediaOption(this)).length&&F(i,(function(t){r=!0,this._mergeOption(t,e)}),this),r},op.prototype.mergeOption=function(t){this._mergeOption(t,null)},op.prototype._mergeOption=function(t,e){var n=this.option,r=this._componentsMap,i=this._componentsCount,o=[],a=pt(),s=e&&e.replaceMergeMainTypeMap;Wd(this).datasetMap=pt(),F(t,(function(t,e){null!=t&&(Ld.hasClass(e)?e&&(o.push(e),a.set(e,!0)):n[e]=null==n[e]?I(t):D(n[e],t,!0))})),s&&s.each((function(t,e){Ld.hasClass(e)&&!a.get(e)&&(o.push(e),a.set(e,!0))})),Ld.topologicalTravel(o,Ld.getAllClassMainTypes(),(function(e){var o=function(t,e,n){return(e=Jd.get(e))&&(t=e(t))?n.concat(t):n}(this,e,Oi(t[e])),a=r.get(e),l=a?s&&s.get(e)?"replaceMerge":"normalMerge":"replaceAll";l=Bi(a,o,l);Gi(l,e,Ld),n[e]=null,r.set(e,null),i.set(e,0);var u=[],h=[],c=0;F(l,(function(t,n){var r,i=t.existing,o=t.newOption;o?(r=Ld.getClass(e,t.keyInfo.subType,!0),i&&i.constructor===r?(i.name=t.keyInfo.name,i.mergeOption(o,this),i.optionUpdated(o,!1)):(n=R({componentIndex:n},t.keyInfo),R(i=new r(o,this,this,n),n),t.brandNew&&(i.__requireNewView=!0),i.init(o,this,this),i.optionUpdated(null,!0))):i&&(i.mergeOption({},this),i.optionUpdated({},!1)),i?(u.push(i.option),h.push(i),c++):(u.push(void 0),h.push(void 0))}),this),n[e]=u,r.set(e,h),i.set(e,c),"series"===e&&qd(this)}),this),this._seriesIndices||qd(this)},op.prototype.getOption=function(){var t=I(this.option);return F(t,(function(e,n){if(Ld.hasClass(n)){for(var r=Oi(e),i=r.length,o=!1,a=i-1;0<=a;a--)r[a]&&!Ui(r[a])?o=!0:(r[a]=null,o||i--);r.length=i,t[n]=r}})),delete t[ip],t},op.prototype.getTheme=function(){return this._theme},op.prototype.getLocaleModel=function(){return this._locale},op.prototype.getLocale=function(t){return this.getLocaleModel().get(t)},op.prototype.setUpdatePayload=function(t){this._payload=t},op.prototype.getUpdatePayload=function(){return this._payload},op.prototype.getComponent=function(t,e){var n=this._componentsMap.get(t);if(n){if(t=n[e||0],t)return t;if(null==e)for(var r=0;r<n.length;r++)if(n[r])return n[r]}},op.prototype.queryComponents=function(t){var e=t.mainType;if(!e)return[];var n,r=t.index,i=t.id,o=t.name,a=this._componentsMap.get(e);return a&&a.length?(null!=r?(n=[],F(Oi(r),(function(t){a[t]&&n.push(a[t])}))):n=null!=i?ap("id",i,a):null!=o?ap("name",o,a):V(a,(function(t){return!!t})),sp(n,t)):[]},op.prototype.findComponents=function(t){var e,n,r,i,o,a=t.query,s=t.mainType,l=(n=s+"Index",r=s+"Id",i=s+"Name",!(e=a)||null==e[n]&&null==e[r]&&null==e[i]?null:{mainType:s,index:e[n],id:e[r],name:e[i]});l=l?this.queryComponents(l):V(this._componentsMap.get(s),(function(t){return!!t}));return o=sp(l,t),t.filter?V(o,t.filter):o},op.prototype.eachComponent=function(t,e,n){var r=this._componentsMap;if(j(t)){var i=e,o=t;r.each((function(t,e){for(var n=0;t&&n<t.length;n++){var r=t[n];r&&o.call(i,e,r,r.componentIndex)}}))}else for(var a=Y(t)?r.get(t):K(t)?this.findComponents(t):null,s=0;a&&s<a.length;s++){var l=a[s];l&&e.call(n,l,l.componentIndex)}},op.prototype.getSeriesByName=function(t){var e=Hi(t,null);return V(this._componentsMap.get("series"),(function(t){return!!t&&null!=e&&t.name===e}))},op.prototype.getSeriesByIndex=function(t){return this._componentsMap.get("series")[t]},op.prototype.getSeriesByType=function(t){return V(this._componentsMap.get("series"),(function(e){return!!e&&e.subType===t}))},op.prototype.getSeries=function(){return V(this._componentsMap.get("series").slice(),(function(t){return!!t}))},op.prototype.getSeriesCount=function(){return this._componentsCount.get("series")},op.prototype.eachSeries=function(t,e){Kd(this),F(this._seriesIndices,(function(n){var r=this._componentsMap.get("series")[n];t.call(e,r,n)}),this)},op.prototype.eachRawSeries=function(t,e){F(this._componentsMap.get("series"),(function(n){n&&t.call(e,n,n.componentIndex)}))},op.prototype.eachSeriesByType=function(t,e,n){Kd(this),F(this._seriesIndices,(function(r){var i=this._componentsMap.get("series")[r];i.subType===t&&e.call(n,i,r)}),this)},op.prototype.eachRawSeriesByType=function(t,e,n){return F(this.getSeriesByType(t),e,n)},op.prototype.isSeriesFiltered=function(t){return Kd(this),null==this._seriesIndicesMap.get(t.componentIndex)},op.prototype.getCurrentSeriesIndices=function(){return(this._seriesIndices||[]).slice()},op.prototype.filterSeries=function(t,e){Kd(this);var n=[];F(this._seriesIndices,(function(r){var i=this._componentsMap.get("series")[r];t.call(e,i,r)&&n.push(r)}),this),this._seriesIndices=n,this._seriesIndicesMap=pt(n)},op.prototype.restoreData=function(t){qd(this);var e=this._componentsMap,n=[];e.each((function(t,e){Ld.hasClass(e)&&n.push(e)})),Ld.topologicalTravel(n,Ld.getAllClassMainTypes(),(function(n){F(e.get(n),(function(e){!e||"series"===n&&function(t,e){if(e){var n=e.seriesIndex,r=e.seriesId;e=e.seriesName;return null!=n&&t.componentIndex!==n||null!=r&&t.id!==r||null!=e&&t.name!==e}}(e,t)||e.restoreData()}))}))},op.internalField=(qd=function(t){var e=t._seriesIndices=[];F(t._componentsMap.get("series"),(function(t){t&&e.push(t.componentIndex)})),t._seriesIndicesMap=pt(e)},Kd=function(t){},void(Qd=function(t,e){t.option={},t.option[ip]=1,t._componentsMap=pt({series:[]}),t._componentsCount=pt();var n,r,i=e.aria;K(i)&&null==i.enabled&&(i.enabled=!0),n=e,i=t._theme.option,r=n.color&&!n.colorLayer,F(i,(function(t,e){"colorLayer"===e&&r||Ld.hasClass(e)||("object"==typeof t?n[e]=n[e]?D(n[e],t,!1):I(t):null==n[e]&&(n[e]=t))})),D(e,Od,!1),t._mergeOption(e,null)})),v=op;function op(){return null!==rp&&rp.apply(this,arguments)||this}function ap(t,e,n){if(X(e)){var r=pt();return F(e,(function(t){null!=t&&null!=Hi(t,null)&&r.set(t,!0)})),V(n,(function(e){return e&&r.get(e[t])}))}var i=Hi(e,null);return V(n,(function(e){return e&&null!=i&&e[t]===i}))}function sp(t,e){return e.hasOwnProperty("subType")?V(t,(function(t){return t&&t.subType===e.subType})):t}function lp(t){var e=pt();return t&&F(Oi(t.replaceMerge),(function(t){e.set(t,!0)})),{replaceMergeMainTypeMap:e}}function up(t){F(cp,(function(e){this[e]=G(t[e],t)}),this)}k(v,tp);var hp=v,cp=["getDom","getZr","getWidth","getHeight","getDevicePixelRatio","dispatchAction","isDisposed","on","off","getDataURL","getConnectedDataURL","getOption","getId","updateLabelLayout"],dp={};function pp(){this._coordinateSystems=[]}var fp=(pp.prototype.create=function(t,e){var n=[];F(dp,(function(r,i){r=r.create(t,e),n=n.concat(r||[])})),this._coordinateSystems=n},pp.prototype.update=function(t,e){F(this._coordinateSystems,(function(n){n.update&&n.update(t,e)}))},pp.prototype.getCoordinateSystems=function(){return this._coordinateSystems.slice()},pp.register=function(t,e){dp[t]=e},pp.get=function(t){return dp[t]},pp),gp=/^(min|max)?(.+)$/;function mp(t){this._timelineOptions=[],this._mediaList=[],this._currentMediaIndices=[],this._api=t}var yp=(mp.prototype.setOption=function(t,e,n){t&&(F(Oi(t.series),(function(t){t&&t.data&&J(t.data)&&ut(t.data)})),F(Oi(t.dataset),(function(t){t&&t.source&&J(t.source)&&ut(t.source)}))),t=I(t);var r=this._optionBackup;e=function(t,e,n){var r,i,o=[],a=t.baseOption,s=t.timeline,l=t.options,u=t.media,h=!!t.media,c=!!(l||s||a&&a.timeline);function d(t){F(e,(function(e){e(t,n)}))}return a?(i=a).timeline||(i.timeline=s):((c||h)&&(t.options=t.media=null),i=t),h&&X(u)&&F(u,(function(t){t&&t.option&&(t.query?o.push(t):r=r||t)})),d(i),F(l,d),F(o,(function(t){return d(t.option)})),{baseOption:i,timelineOptions:l||[],mediaDefault:r,mediaList:o}}(t,e,!r);this._newBaseOption=e.baseOption,r?(e.timelineOptions.length&&(r.timelineOptions=e.timelineOptions),e.mediaList.length&&(r.mediaList=e.mediaList),e.mediaDefault&&(r.mediaDefault=e.mediaDefault)):this._optionBackup=e},mp.prototype.mountOption=function(t){var e=this._optionBackup;return this._timelineOptions=e.timelineOptions,this._mediaList=e.mediaList,this._mediaDefault=e.mediaDefault,this._currentMediaIndices=[],I(t?e.baseOption:this._newBaseOption)},mp.prototype.getTimelineOption=function(t){var e,n=this._timelineOptions;return!n.length||(t=t.getComponent("timeline"))&&(e=I(n[t.getCurrentIndex()])),e},mp.prototype.getMediaOption=function(t){var e=this._api.getWidth(),n=this._api.getHeight(),r=this._mediaList,i=this._mediaDefault,o=[],a=[];if(!r.length&&!i)return a;for(var s,l,u=0,h=r.length;u<h;u++)!function(t,e,n){var r={width:e,height:n,aspectratio:e/n},i=!0;return F(t,(function(t,e){var n=e.match(gp);n&&n[1]&&n[2]&&(e=n[1],n=n[2].toLowerCase(),n=r[n],t=t,("min"===(e=e)?t<=n:"max"===e?n<=t:n===t)||(i=!1))})),i}(r[u].query,e,n)||o.push(u);return(o=!o.length&&i?[-1]:o).length&&(s=o,l=this._currentMediaIndices,s.join(",")!==l.join(","))&&(a=z(o,(function(t){return I((-1===t?i:r[t]).option)}))),this._currentMediaIndices=o,a},mp),_p=F,vp=K,xp=["areaStyle","lineStyle","nodeStyle","linkStyle","chordStyle","label","labelLine"];function bp(t){var e=t&&t.itemStyle;if(e)for(var n=0,r=xp.length;n<r;n++){var i=xp[n],o=e.normal,a=e.emphasis;o&&o[i]&&(t[i]=t[i]||{},t[i].normal?D(t[i].normal,o[i]):t[i].normal=o[i],o[i]=null),a&&a[i]&&(t[i]=t[i]||{},t[i].emphasis?D(t[i].emphasis,a[i]):t[i].emphasis=a[i],a[i]=null)}}function Tp(t,e,n){var r,i;t&&t[e]&&(t[e].normal||t[e].emphasis)&&(r=t[e].normal,i=t[e].emphasis,r&&(n?(t[e].normal=t[e].emphasis=null,L(t[e],r)):t[e]=r),i&&(t.emphasis=t.emphasis||{},(t.emphasis[e]=i).focus&&(t.emphasis.focus=i.focus),i.blurScope&&(t.emphasis.blurScope=i.blurScope)))}function wp(t){Tp(t,"itemStyle"),Tp(t,"lineStyle"),Tp(t,"areaStyle"),Tp(t,"label"),Tp(t,"labelLine"),Tp(t,"upperLabel"),Tp(t,"edgeLabel")}function Sp(t,e){var n=vp(t)&&t[e],r=vp(n)&&n.textStyle;if(r)for(var i=0,o=Ni.length;i<o;i++){var a=Ni[i];r.hasOwnProperty(a)&&(n[a]=r[a])}}function Mp(t){t&&(wp(t),Sp(t,"label"),t.emphasis&&Sp(t.emphasis,"label"))}function Ap(t){return X(t)?t:t?[t]:[]}function Cp(t){return(X(t)?t[0]:t)||{}}function Ep(t,e){_p(Ap(t.series),(function(t){vp(t)&&function(t){if(vp(t)){bp(t),wp(t),Sp(t,"label"),Sp(t,"upperLabel"),Sp(t,"edgeLabel"),t.emphasis&&(Sp(t.emphasis,"label"),Sp(t.emphasis,"upperLabel"),Sp(t.emphasis,"edgeLabel"));var e=t.markPoint;e&&(bp(e),Mp(e));var n=t.markLine;n&&(bp(n),Mp(n));var r=t.markArea;r&&Mp(r);var i=t.data;if("graph"===t.type){i=i||t.nodes;var o=t.links||t.edges;if(o&&!J(o))for(var a=0;a<o.length;a++)Mp(o[a]);F(t.categories,(function(t){wp(t)}))}if(i&&!J(i))for(a=0;a<i.length;a++)Mp(i[a]);if((e=t.markPoint)&&e.data){var s=e.data;for(a=0;a<s.length;a++)Mp(s[a])}if((n=t.markLine)&&n.data){var l=n.data;for(a=0;a<l.length;a++)X(l[a])?(Mp(l[a][0]),Mp(l[a][1])):Mp(l[a])}"gauge"===t.type?(Sp(t,"axisLabel"),Sp(t,"title"),Sp(t,"detail")):"treemap"===t.type?(Tp(t.breadcrumb,"itemStyle"),F(t.levels,(function(t){wp(t)}))):"tree"===t.type&&wp(t.leaves)}}(t)}));var n=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","parallelAxis","radar"];e&&n.push("valueAxis","categoryAxis","logAxis","timeAxis"),_p(n,(function(e){_p(Ap(t[e]),(function(t){t&&(Sp(t,"axisLabel"),Sp(t.axisPointer,"label"))}))})),_p(Ap(t.parallel),(function(t){t=t&&t.parallelAxisDefault,Sp(t,"axisLabel"),Sp(t&&t.axisPointer,"label")})),_p(Ap(t.calendar),(function(t){Tp(t,"itemStyle"),Sp(t,"dayLabel"),Sp(t,"monthLabel"),Sp(t,"yearLabel")})),_p(Ap(t.radar),(function(t){Sp(t,"name"),t.name&&null==t.axisName&&(t.axisName=t.name,delete t.name),null!=t.nameGap&&null==t.axisNameGap&&(t.axisNameGap=t.nameGap,delete t.nameGap)})),_p(Ap(t.geo),(function(t){vp(t)&&(Mp(t),_p(Ap(t.regions),(function(t){Mp(t)})))})),_p(Ap(t.timeline),(function(t){Mp(t),Tp(t,"label"),Tp(t,"itemStyle"),Tp(t,"controlStyle",!0),t=t.data,X(t)&&F(t,(function(t){K(t)&&(Tp(t,"label"),Tp(t,"itemStyle"))}))})),_p(Ap(t.toolbox),(function(t){Tp(t,"iconStyle"),_p(t.feature,(function(t){Tp(t,"iconStyle")}))})),Sp(Cp(t.axisPointer),"label"),Sp(Cp(t.tooltip).axisPointer,"label")}function Ip(t){t&&F(Dp,(function(e){e[0]in t&&!(e[1]in t)&&(t[e[1]]=t[e[0]])}))}var Dp=[["x","left"],["y","top"],["x2","right"],["y2","bottom"]],Rp=["grid","geo","parallel","legend","toolbox","title","visualMap","dataZoom","timeline"],Lp=[["borderRadius","barBorderRadius"],["borderColor","barBorderColor"],["borderWidth","barBorderWidth"]];function Op(t){var e=t&&t.itemStyle;if(e)for(var n=0;n<Lp.length;n++){var r=Lp[n][1],i=Lp[n][0];null!=e[r]&&(e[i]=e[r])}}function Pp(t){t&&"edge"===t.alignTo&&null!=t.margin&&null==t.edgeDistance&&(t.edgeDistance=t.margin)}function Np(t){t&&t.downplay&&!t.blur&&(t.blur=t.downplay)}function kp(t,e){Ep(t,e),t.series=Oi(t.series),F(t.series,(function(t){if(K(t)){var e,n,r=t.type;if("line"===r)null!=t.clipOverflow&&(t.clip=t.clipOverflow);else if("pie"===r||"gauge"===r){if(null!=t.clockWise&&(t.clockwise=t.clockWise),Pp(t.label),(e=t.data)&&!J(e))for(var i=0;i<e.length;i++)Pp(e[i]);null!=t.hoverOffset&&(t.emphasis=t.emphasis||{},(t.emphasis.scaleSize=null)&&(t.emphasis.scaleSize=t.hoverOffset))}else if("gauge"===r){var o=function(t,e){for(var n=e.split(","),r=t,i=0;i<n.length&&null!=(r=r&&r[n[i]]);i++);return r}(t,"pointer.color");null!=o&&function(t,e,n,r){for(var i,o=e.split(","),a=t,s=0;s<o.length-1;s++)null==a[i=o[s]]&&(a[i]={}),a=a[i];!r&&null!=a[o[s]]||(a[o[s]]=n)}(t,"itemStyle.color",o)}else if("bar"===r){if(Op(t),Op(t.backgroundStyle),Op(t.emphasis),(e=t.data)&&!J(e))for(i=0;i<e.length;i++)"object"==typeof e[i]&&(Op(e[i]),Op(e[i]&&e[i].emphasis))}else"sunburst"===r?((n=t.highlightPolicy)&&(t.emphasis=t.emphasis||{},t.emphasis.focus||(t.emphasis.focus=n)),Np(t),function t(e,n){if(e)for(var r=0;r<e.length;r++)n(e[r]),e[r]&&t(e[r].children,n)}(t.data,Np)):"graph"===r||"sankey"===r?(n=t)&&null!=n.focusNodeAdjacency&&(n.emphasis=n.emphasis||{},null==n.emphasis.focus&&(n.emphasis.focus="adjacency")):"map"===r&&(t.mapType&&!t.map&&(t.map=t.mapType),t.mapLocation&&L(t,t.mapLocation));null!=t.hoverAnimation&&(t.emphasis=t.emphasis||{},t.emphasis&&null==t.emphasis.scale&&(t.emphasis.scale=t.hoverAnimation)),Ip(t)}})),t.dataRange&&(t.visualMap=t.dataRange),F(Rp,(function(e){e=t[e],e&&F(e=X(e)?e:[e],(function(t){Ip(t)}))}))}function Bp(t){F(t,(function(e,n){var r=[],i=[NaN,NaN],o=[e.stackResultDimension,e.stackedOverDimension],a=e.data,s=e.isStackedByIndex;o=a.map(o,(function(o,l,u){var h,c,d=a.get(e.stackedDimension,u);if(isNaN(d))return i;s?c=a.getRawIndex(u):h=a.get(e.stackedByDimension,u);for(var p=NaN,f=n-1;0<=f;f--){var g=t[f];if(0<=(c=s?c:g.data.rawIndexOf(g.stackedByDimension,h))&&(g=g.data.getByRawIndex(g.stackResultDimension,c),0<=d&&0<g||d<=0&&g<0)){d+=g,p=g;break}}return r[0]=d,r[1]=p,r}));a.hostModel.setData(o),e.data=o}))}var Fp,zp,Hp=function(t){this.data=t.data||(t.sourceFormat===Fd?{}:[]),this.sourceFormat=t.sourceFormat||Hd,this.seriesLayoutBy=t.seriesLayoutBy||Vd,this.startIndex=t.startIndex||0,this.dimensionsDefine=t.dimensionsDefine,this.dimensionsDetectedCount=t.dimensionsDetectedCount,this.encodeDefine=t.encodeDefine,this.metaRawOption=t.metaRawOption};function Vp(t){return t instanceof Hp}function Up(t,e,n,r){n=n||Xp(t);var i=e.seriesLayoutBy,o=function(t,e,n,r,i){var o,a,s;return t?(e===kd?(s=t,"auto"===r||null==r?Yp((function(t){null!=t&&"-"!==t&&(Y(t)?null==a&&(a=1):a=0)}),n,s,10):a=q(r)?r:r?1:0,i||1!==a||(i=[],Yp((function(t,e){i[e]=null!=t?t+"":""}),n,s,1/0)),o=i?i.length:n===Ud?s.length:s[0]?s[0].length:null):e===Bd?i=i||function(t){for(var e,n=0;n<t.length&&!(e=t[n++]););if(e){var r=[];return F(e,(function(t,e){r.push(e)})),r}}(t):e===Fd?i||(i=[],F(t,(function(t,e){i.push(e)}))):e===Nd&&(t=ki(t[0]),o=X(t)&&t.length||1),{startIndex:a,dimensionsDefine:jp(i),dimensionsDetectedCount:o}):{dimensionsDefine:jp(i),startIndex:a,dimensionsDetectedCount:o}}(t,n,i,e.sourceHeader,e.dimensions);return new Hp({data:t,sourceFormat:n,seriesLayoutBy:i,dimensionsDefine:o.dimensionsDefine,startIndex:o.startIndex,dimensionsDetectedCount:o.dimensionsDetectedCount,encodeDefine:Wp(r),metaRawOption:I(e)})}function Gp(t){return new Hp({data:t,sourceFormat:J(t)?zd:Nd})}function Wp(t){return t?pt(t):null}function Xp(t){var e=Hd;if(J(t))e=zd;else if(X(t)){0===t.length&&(e=kd);for(var n=0,r=t.length;n<r;n++){var i=t[n];if(null!=i){if(X(i)){e=kd;break}if(K(i)){e=Bd;break}}}}else if(K(t))for(var o in t)if(gt(t,o)&&B(t[o])){e=Fd;break}return e}function jp(t){if(t){var e=pt();return z(t,(function(t,n){var r={name:(t=K(t)?t:{name:t}).name,displayName:t.displayName,type:t.type};return null==r.name||(r.name+="",null==r.displayName&&(r.displayName=r.name),t=e.get(r.name),t?r.name+="-"+t.count++:e.set(r.name,{count:1})),r}))}}function Yp(t,e,n,r){if(e===Ud)for(var i=0;i<n.length&&i<r;i++)t(n[i]?n[i][0]:null,i);else{var o=n[0]||[];for(i=0;i<o.length&&i<r;i++)t(o[i],i)}}var Zp=(qp.prototype.getSource=function(){return this._source},qp.prototype.count=function(){return 0},qp.prototype.getItem=function(t,e){},qp.prototype.appendData=function(t){},qp.prototype.clean=function(){},qp.protoInitialize=((Bo=qp.prototype).pure=!1,void(Bo.persistent=!0)),qp.internalField=function(){var t;zp=function(t,i,o){var a=o.sourceFormat,s=o.seriesLayoutBy,l=o.startIndex,u=o.dimensionsDefine;R(t,Fp[nf(a,s)]),a===zd?(t.getItem=e,t.count=r,t.fillStorage=n):(o=Qp(a,s),t.getItem=G(o,null,i,l,u),s=$p(a,s),t.count=G(s,null,i,l,u))};var e=function(t,e){t-=this._offset,e=e||[];for(var n=this._data,r=this._dimSize,i=r*t,o=0;o<r;o++)e[o]=n[i+o];return e},n=function(t,e,n,r){for(var i=this._data,o=this._dimSize,a=0;a<o;a++){for(var s=r[a],l=null==s[0]?1/0:s[0],u=null==s[1]?-1/0:s[1],h=e-t,c=n[a],d=0;d<h;d++){var p=i[d*o+a];(c[t+d]=p)<l&&(l=p),u<p&&(u=p)}s[0]=l,s[1]=u}},r=function(){return this._data?this._data.length/this._dimSize:0};function i(t){for(var e=0;e<t.length;e++)this._data.push(t[e])}(t={})[kd+"_"+Vd]={pure:!0,appendData:i},t[kd+"_"+Ud]={pure:!0,appendData:function(){throw new Error('Do not support appendData when set seriesLayoutBy: "row".')}},t[Bd]={pure:!0,appendData:i},t[Fd]={pure:!0,appendData:function(t){var e=this._data;F(t,(function(t,n){for(var r=e[n]||(e[n]=[]),i=0;i<(t||[]).length;i++)r.push(t[i])}))}},t[Nd]={appendData:i},t[zd]={persistent:!1,pure:!0,appendData:function(t){this._data=t},clean:function(){this._offset+=this.count(),this._data=null}},Fp=t}(),qp);function qp(t,e){var n=Vp(t)?t:Gp(t);this._source=n,t=this._data=n.data,n.sourceFormat===zd&&(this._offset=0,this._dimSize=e,this._data=t),zp(this,t,n)}Ql=function(t,e,n,r){return t[r]};var Kp=((ur={})[kd+"_"+Vd]=function(t,e,n,r){return t[r+e]},ur[kd+"_"+Ud]=function(t,e,n,r){r+=e;for(var i=[],o=t,a=0;a<o.length;a++){var s=o[a];i.push(s?s[r]:null)}return i},ur[Bd]=Ql,ur[Fd]=function(t,e,n,r){for(var i=[],o=0;o<n.length;o++){var a=t[n[o].name];i.push(a?a[r]:null)}return i},ur[Nd]=Ql,ur);function Qp(t,e){return Kp[nf(t,e)]}co=function(t,e,n){return t.length};var Jp=((S={})[kd+"_"+Vd]=function(t,e,n){return Math.max(0,t.length-e)},S[kd+"_"+Ud]=function(t,e,n){return t=t[0],t?Math.max(0,t.length-e):0},S[Bd]=co,S[Fd]=function(t,e,n){return n=t[n[0].name],n?n.length:0},S[Nd]=co,S);function $p(t,e){return Jp[nf(t,e)]}wu=function(t,e,n){return null!=e?t[e]:t};var tf=((Pu={})[kd]=wu,Pu[Bd]=function(t,e,n){return null!=e?t[n]:t},Pu[Fd]=wu,Pu[Nd]=function(t,e,n){return t=ki(t),null!=e&&t instanceof Array?t[e]:t},Pu[zd]=wu,Pu);function ef(t){return tf[t]}function nf(t,e){return t===kd?t+"_"+e:t}function rf(t,e,n){if(t){var r=t.getRawDataItem(e);if(null!=r){var i,o;e=t.getProvider().getSource().sourceFormat,n=t.getDimensionInfo(n);return n&&(i=n.name,o=n.index),ef(e)(r,o,i)}}}var of=/\{@(.+?)\}/g;af.prototype.getDataParams=function(t,e){var n=this.getData(e),r=this.getRawValue(t,e),i=n.getRawIndex(t),o=n.getName(t),a=n.getRawDataItem(t),s=n.getItemVisual(t,"style"),l=s&&s[n.getItemVisual(t,"drawType")||"fill"],u=s&&s.stroke;t=this.mainType,s="series"===t,n=n.userOutput;return{componentType:t,componentSubType:this.subType,componentIndex:this.componentIndex,seriesType:s?this.subType:null,seriesIndex:this.seriesIndex,seriesId:s?this.id:null,seriesName:s?this.name:null,name:o,dataIndex:i,data:a,dataType:e,value:r,color:l,borderColor:u,dimensionNames:n?n.dimensionNames:null,encode:n?n.encode:null,$vars:["seriesName","name","value"]}},af.prototype.getFormattedLabel=function(t,e,n,r,i,o){e=e||"normal";var a=this.getData(n);n=this.getDataParams(t,n);return o&&(n.value=o.interpolatedValue),null!=r&&X(n.value)&&(n.value=n.value[r]),"function"==typeof(i=i||a.getItemModel(t).get("normal"===e?["label","formatter"]:[e,"label","formatter"]))?(n.status=e,n.dimensionIndex=r,i(n)):"string"==typeof i?cd(i,n).replace(of,(function(e,n){var r=n.length;r="["===n.charAt(0)&&"]"===n.charAt(r-1)?+n.slice(1,r-1):n,n=rf(a,t,r);return o&&X(o.interpolatedValue)&&(r=a.getDimensionInfo(r))&&(n=o.interpolatedValue[r.index]),null!=n?n+"":""})):void 0},af.prototype.getRawValue=function(t,e){return rf(this.getData(e),t)},af.prototype.formatTooltip=function(t,e,n){},Oo=af;function af(){}function sf(t){var e,n;return K(t)?t.type&&(n=t):e=t,{markupText:e,markupFragment:n}}function lf(t){return new uf(t)}var uf=(hf.prototype.perform=function(t){var e,n=this._upstream,r=t&&t.skip;this._dirty&&n&&((o=this.context).data=o.outputData=n.context.outputData),this.__pipeline&&(this.__pipeline.currentTask=this),this._plan&&!r&&(e=this._plan(this.context));var i=l(this._modBy),o=this._modDataCount||0,a=l(t&&t.modBy),s=t&&t.modDataCount||0;function l(t){return 1<=t?t:1}if(i===a&&o===s||(e="reset"),!this._dirty&&"reset"!==e||(this._dirty=!1,p=this._doReset(r)),this._modBy=a,this._modDataCount=s,t=t&&t.step,this._dueEnd=n?n._outputDueEnd:this._count?this._count(this.context):1/0,this._progress){var u=this._dueIndex,h=Math.min(null!=t?this._dueIndex+t:1/0,this._dueEnd);if(!r&&(p||u<h)){var c=this._progress;if(X(c))for(var d=0;d<c.length;d++)this._doProgress(c[d],u,h,a,s);else this._doProgress(c,u,h,a,s)}this._dueIndex=h;var p=null!=this._settedOutputEnd?this._settedOutputEnd:h;this._outputDueEnd=p}else this._dueIndex=this._outputDueEnd=null!=this._settedOutputEnd?this._settedOutputEnd:this._dueEnd;return this.unfinished()},hf.prototype.dirty=function(){this._dirty=!0,this._onDirty&&this._onDirty(this.context)},hf.prototype._doProgress=function(t,e,n,r,i){yf.reset(e,n,r,i),this._callingProgress=t,this._callingProgress({start:e,end:n,count:n-e,next:yf.next},this.context)},hf.prototype._doReset=function(t){var e;this._dueIndex=this._outputDueEnd=this._dueEnd=0,this._settedOutputEnd=null,!t&&this._reset&&((n=this._reset(this.context))&&n.progress&&(e=n.forceFirstProgress,n=n.progress),X(n)&&!n.length&&(n=null)),this._progress=n,this._modBy=this._modDataCount=null;var n=this._downstream;return n&&n.dirty(),e},hf.prototype.unfinished=function(){return this._progress&&this._dueIndex<this._dueEnd},hf.prototype.pipe=function(t){this._downstream===t&&!this._dirty||((this._downstream=t)._upstream=this,t.dirty())},hf.prototype.dispose=function(){this._disposed||(this._upstream&&(this._upstream._downstream=null),this._downstream&&(this._downstream._upstream=null),this._dirty=!1,this._disposed=!0)},hf.prototype.getUpstream=function(){return this._upstream},hf.prototype.getDownstream=function(){return this._downstream},hf.prototype.setOutputEnd=function(t){this._outputDueEnd=this._settedOutputEnd=t},hf);function hf(t){this._reset=(t=t||{}).reset,this._plan=t.plan,this._count=t.count,this._onDirty=t.onDirty,this._dirty=!0}var cf,df,pf,ff,gf,mf,yf=mf={reset:function(t,e,n,r){df=t,cf=e,pf=n,ff=r,gf=Math.ceil(ff/pf),mf.next=1<pf&&0<ff?vf:_f}};function _f(){return df<cf?df++:null}function vf(){var t=df%gf*pf+Math.ceil(df/gf);t=cf<=df?null:t<ff?t:df;return df++,t}function xf(t){throw new Error(t)}function bf(t,e){var n=e&&e.type;return"ordinal"!==n?null==(t="time"===n&&"number"!=typeof t&&null!=t&&"-"!==t?+bi(t):t)||""===t?NaN:+t:(e=e&&e.ordinalMeta,e?e.parseAndCollect(t):t)}pt({number:function(t){return parseFloat(t)},time:function(t){return+bi(t)},trim:function(t){return"string"==typeof t?st(t):t}});var Tf={lt:function(t,e){return t<e},lte:function(t,e){return t<=e},gt:function(t,e){return e<t},gte:function(t,e){return e<=t}};function wf(t,e){"number"!=typeof e&&xf(""),this._opFn=Tf[t],this._rvalFloat=Ci(e)}wf.prototype.evaluate=function(t){return"number"==typeof t?this._opFn(t,this._rvalFloat):this._opFn(Ci(t),this._rvalFloat)};var Sf=(Mf.prototype.evaluate=function(t,e){var n=typeof t,r=typeof e,i="number"==n?t:Ci(t),o="number"==r?e:Ci(e),a=isNaN(i),s=isNaN(o);return a&&(i=this._incomparable),s&&(o=this._incomparable),a&&s&&(r="string"==r,(n="string"==n)&&(i=r?t:0),r&&(o=n?e:0)),i<o?this._resultLT:o<i?-this._resultLT:0},Mf);function Mf(t,e){t="desc"===t,this._resultLT=t?1:-1,this._incomparable="min"===(e=null==e?t?"min":"max":e)?-1/0:1/0}function Af(t,e){this._rval=e,this._isEQ=t,this._rvalTypeof=typeof e,this._rvalFloat=Ci(e)}Af.prototype.evaluate=function(t){var e,n=t===this._rval;return n||(e=typeof t)===this._rvalTypeof||"number"!=e&&"number"!==this._rvalTypeof||(n=Ci(t)===this._rvalFloat),this._isEQ?n:!n};var Cf=(Ef.prototype.getRawData=function(){throw new Error("not supported")},Ef.prototype.getRawDataItem=function(t){throw new Error("not supported")},Ef.prototype.cloneRawData=function(){},Ef.prototype.getDimensionInfo=function(t){},Ef.prototype.cloneAllDimensionInfo=function(){},Ef.prototype.count=function(){},Ef.prototype.retrieveValue=function(t,e){},Ef.prototype.retrieveValueFromItem=function(t,e){},Ef.prototype.convertValue=bf,Ef);function Ef(){}function If(t){return Nf(t.sourceFormat)||xf(""),t.data}function Df(t){var e=t.sourceFormat,n=t.data;if(Nf(e)||xf(""),e===kd){for(var r=[],i=0,o=n.length;i<o;i++)r.push(n[i].slice());return r}if(e===Bd){for(r=[],i=0,o=n.length;i<o;i++)r.push(R({},n[i]));return r}}function Rf(t,e,n){if(null!=n)return"number"==typeof n||!isNaN(n)&&!gt(e,n)?t[n]:gt(e,n)?e[n]:void 0}function Lf(t){return I(t)}var Of=pt();function Pf(t,e){var n=Oi(t);t=n.length;t||xf("");for(var r=0,i=t;r<i;r++)e=function(t,e){e.length||xf(""),K(t)||xf("");var n=t.type,r=Of.get(n);return r||xf(""),n=z(e,(function(t){return function(t,e){var n=new Cf,r=t.data,i=n.sourceFormat=t.sourceFormat,o=t.startIndex;t.seriesLayoutBy!==Vd&&xf("");var a=[],s={},l=t.dimensionsDefine;if(l)F(l,(function(t,e){var n=t.name;t={index:e,name:n,displayName:t.displayName};a.push(t),null!=n&&(gt(s,n)&&xf(""),s[n]=t)}));else for(var u=0;u<t.dimensionsDetectedCount;u++)a.push({index:u});var h=Qp(i,Vd);e.__isBuiltIn&&(n.getRawDataItem=function(t){return h(r,o,a,t)},n.getRawData=G(If,null,t)),n.cloneRawData=G(Df,null,t),e=$p(i,Vd),n.count=G(e,null,r,o,a);var c=ef(i);n.retrieveValue=function(t,e){return t=h(r,o,a,t),d(t,e)};var d=n.retrieveValueFromItem=function(t,e){if(null!=t){var n=a[e];return n?c(t,e,n.name):void 0}};return n.getDimensionInfo=G(Rf,null,a,s),n.cloneAllDimensionInfo=G(Lf,null,a),n}(t,r)})),z(Oi(r.transform({upstream:n[0],upstreamList:n,config:I(t.config)})),(function(t,n){K(t)||xf(""),t.data||xf(""),Nf(Xp(t.data))||xf("");var r=e[0];r=r&&0===n&&!t.dimensions?((n=r.startIndex)&&(t.data=r.data.slice(0,n).concat(t.data)),{seriesLayoutBy:Vd,sourceHeader:n,dimensions:r.metaRawOption.dimensions}):{seriesLayoutBy:Vd,sourceHeader:0,dimensions:t.dimensions};return Up(t.data,r,null,null)}))}(n[r],e),r!==i-1&&(e.length=Math.max(e.length,1));return e}function Nf(t){return t===kd||t===Bd}var kf=(Bf.prototype.dirty=function(){this._setLocalSource([],[])},Bf.prototype._setLocalSource=function(t,e){this._sourceList=t,this._upstreamSignList=e,this._versionSignBase++,9e10<this._versionSignBase&&(this._versionSignBase=0)},Bf.prototype._getVersionSign=function(){return this._sourceHost.uid+"_"+this._versionSignBase},Bf.prototype.prepareSource=function(){this._isDirty()&&this._createSource()},Bf.prototype._createSource=function(){this._setLocalSource([],[]);var t,e,n,r,i,o,a=this._sourceHost,s=this._getUpstreamSourceManagers(),l=!!s.length;zf(a)?(o=a,i=e=t=void 0,n=l?((r=s[0]).prepareSource(),t=(i=r.getSource()).data,e=i.sourceFormat,[r._getVersionSign()]):(e=J(t=o.get("data",!0))?zd:Nd,[]),r=this._getSourceMetaRawOption(),i=i?i.metaRawOption:null,o=[Up(t,{seriesLayoutBy:nt(r.seriesLayoutBy,i?i.seriesLayoutBy:null),sourceHeader:nt(r.sourceHeader,i?i.sourceHeader:null),dimensions:nt(r.dimensions,i?i.dimensions:null)},e,o.get("encode",!0))]):(a=a,n=l?(o=(s=this._applyTransform(s)).sourceList,s.upstreamSignList):(o=[Up(a.get("source",!0),this._getSourceMetaRawOption(),null,null)],[])),this._setLocalSource(o,n)},Bf.prototype._applyTransform=function(t){var e,n=this._sourceHost,r=n.get("transform",!0),i=n.get("fromTransformResult",!0);null==i||1!==t.length&&Hf("");var o=[],a=[];return F(t,(function(t){t.prepareSource();var e=t.getSource(i||0);null==i||e||Hf(""),o.push(e),a.push(t._getVersionSign())})),r?e=Pf(r,o,n.componentIndex):null!=i&&(e=[(n=o[0],new Hp({data:n.data,sourceFormat:n.sourceFormat,seriesLayoutBy:n.seriesLayoutBy,dimensionsDefine:I(n.dimensionsDefine),startIndex:n.startIndex,dimensionsDetectedCount:n.dimensionsDetectedCount,encodeDefine:Wp(n.encodeDefine)}))]),{sourceList:e,upstreamSignList:a}},Bf.prototype._isDirty=function(){if(!this._sourceList.length)return!0;for(var t=this._getUpstreamSourceManagers(),e=0;e<t.length;e++){var n=t[e];if(n._isDirty()||this._upstreamSignList[e]!==n._getVersionSign())return!0}},Bf.prototype.getSource=function(t){return this._sourceList[t||0]},Bf.prototype._getUpstreamSourceManagers=function(){var t=this._sourceHost;if(zf(t)){var e=Yd(t);return e?[e.getSourceManager()]:[]}return z((t=t).get("transform",!0)||t.get("fromTransformResult",!0)?Ki(t.ecModel,"dataset",{index:t.get("fromDatasetIndex",!0),id:t.get("fromDatasetId",!0)},Zi).models:[],(function(t){return t.getSourceManager()}))},Bf.prototype._getSourceMetaRawOption=function(){var t,e,n,r=this._sourceHost;return zf(r)?(t=r.get("seriesLayoutBy",!0),e=r.get("sourceHeader",!0),n=r.get("dimensions",!0)):this._getUpstreamSourceManagers().length||(t=(r=r).get("seriesLayoutBy",!0),e=r.get("sourceHeader",!0),n=r.get("dimensions",!0)),{seriesLayoutBy:t,sourceHeader:e,dimensions:n}},Bf);function Bf(t){this._sourceList=[],this._upstreamSignList=[],this._versionSignBase=0,this._sourceHost=t}function Ff(t){t.option.transform&&ut(t.option.transform)}function zf(t){return"series"===t.mainType}function Hf(t){throw new Error(t)}var Vf="line-height:1";function Uf(t,e){var n=t.color||"#6e7079",r=t.fontSize||12,i=t.fontWeight||"400",o=t.color||"#464646",a=t.fontSize||14;t=t.fontWeight||"900";return"html"===e?{nameStyle:"font-size:"+sd(r+"")+"px;color:"+sd(n)+";font-weight:"+sd(i+""),valueStyle:"font-size:"+sd(a+"")+"px;color:"+sd(o)+";font-weight:"+sd(t+"")}:{nameStyle:{fontSize:r,fill:n,fontWeight:i},valueStyle:{fontSize:a,fill:o,fontWeight:t}}}var Gf=[0,10,20,30],Wf=["","\n","\n\n","\n\n\n"];function Xf(t,e){return e.type=t,e}function jf(t){return gt(Yf,t.type)&&Yf[t.type]}var Yf={section:{planLayout:function(t){var e=t.blocks.length,n=1<e||0<e&&!t.noHeader,r=0;F(t.blocks,(function(t){jf(t).planLayout(t);var e=t.__gapLevelBetweenSubBlocks;r<=e&&(r=e+(!n||e&&("section"!==t.type||t.noHeader)?0:1))})),t.__gapLevelBetweenSubBlocks=r},build:function(t,e,n,r){var i=e.noHeader,o=qf(e),a=function(t,e,n,r){var i=[],o=e.blocks||[];at(!o||X(o)),o=o||[];var a,s,l=t.orderMode;e.sortBlocks&&l&&(o=o.slice(),gt(a={valueAsc:"asc",valueDesc:"desc"},l)?(s=new Sf(a[l],null),o.sort((function(t,e){return s.evaluate(t.sortParam,e.sortParam)}))):"seriesDesc"===l&&o.reverse());var u=qf(e);if(F(o,(function(e,n){var o=jf(e).build(t,e,n>0?u.html:0,r);null!=o&&i.push(o)})),i.length)return"richText"===t.renderMode?i.join(u.richText):Kf(i.join(""),n)}(t,e,i?n:o.html,r);return i?a:(e=ld(e.header,"ordinal",t.useUTC),r=Uf(r,t.renderMode).nameStyle,"richText"===t.renderMode?Qf(t,e,r)+o.richText+a:Kf('<div style="'+r+";"+Vf+';">'+sd(e)+"</div>"+a,n))}},nameValue:{planLayout:function(t){t.__gapLevelBetweenSubBlocks=0},build:function(t,e,n,r){var i=t.renderMode,o=e.noName,a=e.noValue,s=!e.markerType,l=e.name,u=e.value,h=t.useUTC;if(!o||!a){var c=s?"":t.markupStyleCreator.makeTooltipMarker(e.markerType,e.markerColor||"#333",i),d=o?"":ld(l,"ordinal",h),p=e.valueType,f=a?[]:X(u)?z(u,(function(t,e){return ld(t,X(p)?p[e]:p,h)})):[ld(u,X(p)?p[0]:p,h)];l=!s||!o,e=!s&&o,u=Uf(r,i),r=u.nameStyle,u=u.valueStyle;return"richText"===i?(s?"":c)+(o?"":Qf(t,d,r))+(a?"":function(t,e,n,r,i){return i=[i],r=r?10:20,n&&i.push({padding:[0,0,0,r],align:"right"}),t.markupStyleCreator.wrapRichTextStyle(e.join("  "),i)}(t,f,l,e,u)):Kf((s?"":c)+(o?"":'<span style="'+r+";"+(s?"":"margin-left:2px")+'">'+sd(d)+"</span>")+(a?"":function(t,e,n,r){return n=n?"10px":"20px",'<span style="'+(e?"float:right;margin-left:"+n:"")+";"+r+'">'+z(t,sd).join("&nbsp;&nbsp;")+"</span>"}(f,l,e,u)),n)}}}};function Zf(t,e,n,r,i,o){if(t){var a=jf(t);return a.planLayout(t),a.build({useUTC:i,renderMode:n,orderMode:r,markupStyleCreator:e},t,0,o)}}function qf(t){return t=t.__gapLevelBetweenSubBlocks,{html:Gf[t],richText:Wf[t]}}function Kf(t,e){return'<div style="margin: '+e+"px 0 0;"+Vf+';">'+t+'<div style="clear:both"></div></div>'}function Qf(t,e,n){return t.markupStyleCreator.wrapRichTextStyle(e,n)}function Jf(t,e){return t=t.get("padding"),null!=t?t:"richText"===e?[8,10]:10}var $f=(tg.prototype._generateStyleName=function(){return"__EC_aUTo_"+this._nextStyleNameId++},tg.prototype.makeTooltipMarker=function(t,e,n){var r,i,o="richText"===n?this._generateStyleName():null;e=Y(r={color:e,type:t,renderMode:n,markerId:o})?{color:r,extraCssText:i}:r||{},t=e.color,n=e.type,i=e.extraCssText,r=e.renderMode||"html",t=t?"html"===r?"subItem"===n?'<span style="display:inline-block;vertical-align:middle;margin-right:8px;margin-left:3px;border-radius:4px;width:4px;height:4px;background-color:'+sd(t)+";"+(i||"")+'"></span>':'<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:'+sd(t)+";"+(i||"")+'"></span>':{renderMode:r,content:"{"+(e.markerId||"markerX")+"|}  ",style:"subItem"===n?{width:4,height:4,borderRadius:2,backgroundColor:t}:{width:10,height:10,borderRadius:5,backgroundColor:t}}:"";return Y(t)?t:(this.richTextStyles[o]=t.style,t.content)},tg.prototype.wrapRichTextStyle=function(t,e){var n={};return X(e)?F(e,(function(t){return R(n,t)})):R(n,e),e=this._generateStyleName(),this.richTextStyles[e]=n,"{"+e+"|"+t+"}"},tg);function tg(){this.richTextStyles={},this._nextStyleNameId=Ii()}function eg(t){var e,n,r,i,o,a,s,l,u,h,c,d,p=t.series,f=t.dataIndex,g=t.multipleSeries,m=p.getData(),y=m.mapDimensionsAll("defaultedTooltip"),_=y.length,v=p.getRawValue(f),x=X(v);e=f,t=dd((t=p).getData().getItemVisual(e,"style")[t.visualDrawType]);function b(t,e){e=l.getDimensionInfo(e),e&&!1!==e.otherDims.tooltip&&(u?d.push(Xf("nameValue",{markerType:"subItem",markerColor:s,name:e.displayName,value:t,valueType:e.type})):(h.push(t),c.push(e.type)))}return 1<_||x&&!_?(n=(i=v,o=f,a=y,s=t,l=p.getData(),u=H(i,(function(t,e,n){return n=l.getDimensionInfo(n),t||n&&!1!==n.tooltip&&null!=n.displayName}),!1),h=[],c=[],d=[],a.length?F(a,(function(t){b(rf(l,o,t),t)})):F(i,b),r={inlineValues:h,inlineValueTypes:c,blocks:d}).inlineValueTypes,a=r.blocks,r=(i=r.inlineValues)[0]):_?(_=m.getDimensionInfo(y[0]),r=i=rf(m,f,y[0]),n=_.type):r=i=x?v[0]:v,v=Vi(p),p=v&&p.name||"",f=m.getName(f),f=g?p:f,Xf("section",{header:p,noHeader:g||!v,sortParam:r,blocks:[Xf("nameValue",{markerType:"item",markerColor:t,name:f,noName:!st(f),value:i,valueType:n})].concat(a||[])})}var ng=Xi();function rg(t,e){return t.getName(e)||t.getId(e)}var ig;h(og,ig=Ld),og.prototype.init=function(t,e,n){this.seriesIndex=this.componentIndex,this.dataTask=lf({count:sg,reset:lg}),this.dataTask.context={model:this},this.mergeDefaultAndTheme(t,n),(ng(this).sourceManager=new kf(this)).prepareSource(),n=this.getInitialData(t,n),hg(n,this),this.dataTask.context.data=n,ng(this).dataBeforeProcessed=n,ag(this),this._initSelectedMapFromData(n)},og.prototype.mergeDefaultAndTheme=function(t,e){var n=bd(this),r=n?wd(t):{},i=this.subType;Ld.hasClass(i),D(t,e.getTheme().get(this.subType)),D(t,this.getDefaultOption()),Pi(t,"label",["show"]),this.fillDataTextStyle(t.data),n&&Td(t,r,n)},og.prototype.mergeOption=function(t,e){t=D(this.option,t,!0),this.fillDataTextStyle(t.data);var n=bd(this);n&&Td(this.option,t,n),n=ng(this).sourceManager,n.dirty(),n.prepareSource(),e=this.getInitialData(t,e),hg(e,this),this.dataTask.dirty(),this.dataTask.context.data=e,ng(this).dataBeforeProcessed=e,ag(this),this._initSelectedMapFromData(e)},og.prototype.fillDataTextStyle=function(t){if(t&&!J(t))for(var e=["show"],n=0;n<t.length;n++)t[n]&&t[n].label&&Pi(t[n],"label",e)},og.prototype.getInitialData=function(t,e){},og.prototype.appendData=function(t){this.getRawData().appendData(t.data)},og.prototype.getData=function(t){var e=dg(this);return e?(e=e.context.data,null==t?e:e.getLinkedData(t)):ng(this).data},og.prototype.getAllData=function(){var t=this.getData();return t&&t.getLinkedDataAll?t.getLinkedDataAll():[{data:t}]},og.prototype.setData=function(t){var e,n=dg(this);n&&((e=n.context).outputData=t,n!==this.dataTask&&(e.data=t)),ng(this).data=t},og.prototype.getSource=function(){return ng(this).sourceManager.getSource()},og.prototype.getRawData=function(){return ng(this).dataBeforeProcessed},og.prototype.getBaseAxis=function(){var t=this.coordinateSystem;return t&&t.getBaseAxis&&t.getBaseAxis()},og.prototype.formatTooltip=function(t,e,n){return eg({series:this,dataIndex:t,multipleSeries:e})},og.prototype.isAnimationEnabled=function(){if(g.node)return!1;var t=this.getShallow("animation");return!!(t=!(t&&this.getData().count()>this.getShallow("animationThreshold"))&&t)},og.prototype.restoreData=function(){this.dataTask.dirty()},og.prototype.getColorFromPalette=function(t,e,n){var r=this.ecModel;return tp.prototype.getColorFromPalette.call(this,t,e,n)||r.getColorFromPalette(t,e,n)},og.prototype.coordDimToDataDim=function(t){return this.getRawData().mapDimensionsAll(t)},og.prototype.getProgressive=function(){return this.get("progressive")},og.prototype.getProgressiveThreshold=function(){return this.get("progressiveThreshold")},og.prototype.select=function(t,e){this._innerSelect(this.getData(e),t)},og.prototype.unselect=function(t,e){var n=this.option.selectedMap;if(n)for(var r=this.getData(e),i=0;i<t.length;i++){var o=rg(r,t[i]);n[o]=!1,this._selectedDataIndicesMap[o]=-1}},og.prototype.toggleSelect=function(t,e){for(var n=[],r=0;r<t.length;r++)n[0]=t[r],this.isSelected(t[r],e)?this.unselect(n,e):this.select(n,e)},og.prototype.getSelectedDataIndices=function(){for(var t=this._selectedDataIndicesMap,e=U(t),n=[],r=0;r<e.length;r++){var i=t[e[r]];0<=i&&n.push(i)}return n},og.prototype.isSelected=function(t,e){var n=this.option.selectedMap;return n&&n[rg(this.getData(e),t)]||!1},og.prototype._innerSelect=function(t,e){var n,r=this.option.selectedMode,i=e.length;if(r&&i)if("multiple"===r)for(var o=this.option.selectedMap||(this.option.selectedMap={}),a=0;a<i;a++){var s,l=e[a];o[s=rg(t,l)]=!0,this._selectedDataIndicesMap[s]=t.getRawIndex(l)}else"single"!==r&&!0!==r||(s=rg(t,n=e[i-1]),this.option.selectedMap=((r={})[s]=!0,r),this._selectedDataIndicesMap=((r={})[s]=t.getRawIndex(n),r))},og.prototype._initSelectedMapFromData=function(t){var e;this.option.selectedMap||(e=[],t.hasItemOption&&t.each((function(n){var r=t.getRawDataItem(n);"object"==typeof r&&r.selected&&e.push(n)})),0<e.length&&this._innerSelect(t,e))},og.registerClass=function(t){return Ld.registerClass(t)},og.protoInitialize=((f=og.prototype).type="series.__base__",f.seriesIndex=0,f.useColorPaletteOnData=!1,f.ignoreStyleOnData=!1,f.hasSymbolVisual=!1,f.defaultSymbol="circle",f.visualStyleAccessPath="itemStyle",void(f.visualDrawType="fill")),e=og;function og(){var t=null!==ig&&ig.apply(this,arguments)||this;return t._selectedDataIndicesMap={},t}function ag(t){var e,n,r=t.name;Vi(t)||(t.name=(t=(e=(t=t).getRawData()).mapDimensionsAll("seriesName"),n=[],F(t,(function(t){t=e.getDimensionInfo(t),t.displayName&&n.push(t.displayName)})),n.join(" ")||r))}function sg(t){return t.model.getRawData().count()}function lg(t){return t=t.model,t.setData(t.getRawData().cloneShallow()),ug}function ug(t,e){e.outputData&&t.end>e.outputData.count()&&e.model.getRawData().cloneShallow(e.outputData)}function hg(t,e){F(d(t.CHANGABLE_METHODS,t.DOWNSAMPLE_METHODS),(function(n){t.wrapMethod(n,W(cg,e))}))}function cg(t,e){return t=dg(t),t&&t.setOutputEnd((e||this).count()),e}function dg(t){var e=(t.ecModel||{}).scheduler,n=e&&e.getPipeline(t.uid);if(n)return e=n.currentTask,!e||(n=e.agentStubMap)&&(e=n.get(t.uid)),e}k(e,Oo),k(e,tp),io(e,Ld);var pg=e;fg.prototype.init=function(t,e){},fg.prototype.render=function(t,e,n,r){},fg.prototype.dispose=function(t,e){},fg.prototype.updateView=function(t,e,n,r){},fg.prototype.updateLayout=function(t,e,n,r){},fg.prototype.updateVisual=function(t,e,n,r){},fg.prototype.blurSeries=function(t,e){},v=fg;function fg(){this.group=new ei,this.uid=Tc("viewComponent")}ro(v),lo(v);var gg=v;function mg(){var t=Xi();return function(e){var n=t(e),r=e.pipelineContext,i=!!n.large,o=!!n.progressiveRender;e=n.large=!(!r||!r.large),r=n.progressiveRender=!(!r||!r.progressiveRender);return!(i==e&&o==r)&&"reset"}}var yg=Xi(),_g=mg();vg.prototype.init=function(t,e){},vg.prototype.render=function(t,e,n,r){},vg.prototype.highlight=function(t,e,n,r){bg(t.getData(),r,"emphasis")},vg.prototype.downplay=function(t,e,n,r){bg(t.getData(),r,"normal")},vg.prototype.remove=function(t,e){this.group.removeAll()},vg.prototype.dispose=function(t,e){},vg.prototype.updateView=function(t,e,n,r){this.render(t,e,n,r)},vg.prototype.updateLayout=function(t,e,n,r){this.render(t,e,n,r)},vg.prototype.updateVisual=function(t,e,n,r){this.render(t,e,n,r)},vg.markUpdateMethod=function(t,e){yg(t).updateMethod=e},vg.protoInitialize=void(vg.prototype.type="chart"),Bo=vg;function vg(){this.group=new ei,this.uid=Tc("viewChart"),this.renderTask=lf({plan:Tg,reset:wg}),this.renderTask.context={view:this}}function xg(t,e,n){t&&("emphasis"===e?dl:pl)(t,n)}function bg(t,e,n){var r,i=Wi(t,e),o=e&&null!=e.highlightKey?(r=e.highlightKey,e=null==(e=ks[r])&&Ns<=32?ks[r]=Ns++:e):null;null!=i?F(Oi(i),(function(e){xg(t.getItemGraphicEl(e),n,o)})):t.eachItemGraphicEl((function(t){xg(t,n,o)}))}function Tg(t){return _g(t.model)}function wg(t){var e=t.model,n=t.ecModel,r=t.api,i=t.payload,o=e.pipelineContext.progressiveRender,a=t.view;t=i&&yg(i).updateMethod,t=o?"incrementalPrepareRender":t&&a[t]?t:"render";return"render"!==t&&a[t](e,n,r,i),Sg[t]}ro(Bo),lo(Bo);var Sg={incrementalPrepareRender:{progress:function(t,e){e.view.incrementalRender(t,e.model,e.ecModel,e.api,e.payload)}},render:{forceFirstProgress:!0,progress:function(t,e){e.view.render(e.model,e.ecModel,e.api,e.payload)}}},Mg=Bo,Ag="\0__throttleOriginMethod",Cg="\0__throttleRate",Eg="\0__throttleType";function Ig(t,e,n){var r,i,o,a,s,l=0,u=0,h=null;function c(){u=(new Date).getTime(),h=null,t.apply(o,a||[])}function d(){for(var t=[],d=0;d<arguments.length;d++)t[d]=arguments[d];r=(new Date).getTime(),o=this,a=t;var p=s||e,f=s||n;s=null,i=r-(f?l:u)-p,clearTimeout(h),f?h=setTimeout(c,p):0<=i?c():h=setTimeout(c,-i),l=r}return e=e||0,d.clear=function(){h&&(clearTimeout(h),h=null)},d.debounceNextCall=function(t){s=t},d}function Dg(t,e,n,r){var i=t[e];if(i){var o=i[Ag]||i,a=i[Eg];if(i[Cg]!==n||a!==r){if(null==n||!r)return t[e]=o;(i=t[e]=Ig(o,n,"debounce"===r))[Ag]=o,i[Eg]=r,i[Cg]=n}return i}}var Rg=Xi(),Lg={itemStyle:uo(tr,!0),lineStyle:uo(M,!0)},Og={lineStyle:"stroke",itemStyle:"fill"};function Pg(t,e){return t=t.visualStyleMapper||Lg[e],t||(console.warn("Unkown style type '"+e+"'."),Lg.itemStyle)}function Ng(t,e){return t=t.visualDrawType||Og[e],t||(console.warn("Unkown style type '"+e+"'."),"fill")}Ql={createOnAllSeries:!0,performRawSeries:!0,reset:function(t,e){var n=t.getData(),r=t.visualStyleAccessPath||"itemStyle",i=t.getModel(r),o=Pg(t,r)(i);i=i.getShallow("decal");i&&(n.setVisual("decal",i),i.dirty=!0);var a=Ng(t,r),s=(r=o[a],j(r)?r:null);if(o[a]&&!s||(o[a]=t.getColorFromPalette(t.name,null,e.getSeriesCount()),n.setVisual("colorFromPalette",!0)),n.setVisual("style",o),n.setVisual("drawType",a),!e.isSeriesFiltered(t)&&s)return n.setVisual("colorFromPalette",!1),{dataEach:function(e,n){var r=t.getDataParams(n),i=R({},o);i[a]=s(r),e.setItemVisual(n,"style",i)}}}};var kg=new xc,Bg=(ur={createOnAllSeries:!0,performRawSeries:!0,reset:function(t,e){if(!t.ignoreStyleOnData&&!e.isSeriesFiltered(t)){e=t.getData();var n=t.visualStyleAccessPath||"itemStyle",r=Pg(t,n),i=e.getVisual("drawType");return{dataEach:e.hasItemOption?function(t,e){var o=t.getRawDataItem(e);o&&o[n]&&(kg.option=o[n],o=r(kg),R(t.ensureUniqueItemVisual(e,"style"),o),kg.option.decal&&(t.setItemVisual(e,"decal",kg.option.decal),kg.option.decal.dirty=!0),i in o&&t.setItemVisual(e,"colorFromPalette",!1))}:null}}}},co={performRawSeries:!0,overallReset:function(t){var e=pt();t.eachSeries((function(t){var n;t.useColorPaletteOnData&&((n=e.get(t.type))||e.set(t.type,n={}),Rg(t).scope=n)})),t.eachSeries((function(e){var n,r,i,o,a,s;e.useColorPaletteOnData&&!t.isSeriesFiltered(e)&&(n=e.getRawData(),r={},i=e.getData(),o=Rg(e).scope,a=e.visualStyleAccessPath||"itemStyle",s=Ng(e,a),i.each((function(t){var e=i.getRawIndex(t);r[e]=t})),n.each((function(t){var a,l=r[t];i.getItemVisual(l,"colorFromPalette")&&(a=i.ensureUniqueItemVisual(l,"style"),l=n.getName(t)||t+"",t=n.count(),a[s]=e.getColorFromPalette(l,o,t))})))}))}},Math.PI);function Fg(t,e,n,r){this._stageTaskMap=pt(),this.ecInstance=t,this.api=e,n=this._dataProcessorHandlers=n.slice(),r=this._visualHandlers=r.slice(),this._allHandlers=n.concat(r)}function zg(t){t.overallReset(t.ecModel,t.api,t.payload)}function Hg(t){return t.overallProgress&&Vg}function Vg(){this.agent.dirty(),this.getDownstream().dirty()}function Ug(){this.agent&&this.agent.dirty()}function Gg(t){return t.plan?t.plan(t.model,t.ecModel,t.api,t.payload):null}function Wg(t){return t.useClearVisual&&t.data.clearAllVisual(),t=t.resetDefines=Oi(t.reset(t.model,t.ecModel,t.api,t.payload)),1<t.length?z(t,(function(t,e){return jg(e)})):Xg}Fg.prototype.restoreData=function(t,e){t.restoreData(e),this._stageTaskMap.each((function(t){t=t.overallTask,t&&t.dirty()}))},Fg.prototype.getPerformArgs=function(t,e){if(t.__pipeline){var n=this._pipelineMap.get(t.__pipeline.id),r=n.context;n=!e&&n.progressiveEnabled&&(!r||r.progressiveRender)&&t.__idxInPipeline>n.blockIndex?n.step:null,r=r&&r.modDataCount;return{step:n,modBy:null!=r?Math.ceil(r/n):null,modDataCount:r}}},Fg.prototype.getPipeline=function(t){return this._pipelineMap.get(t)},Fg.prototype.updateStreamModes=function(t,e){var n=this._pipelineMap.get(t.uid),r=t.getData().count(),i=n.progressiveEnabled&&e.incrementalPrepareRender&&r>=n.threshold;e=t.get("large")&&r>=t.get("largeThreshold"),r="mod"===t.get("progressiveChunkMode")?r:null;t.pipelineContext=n.context={progressiveRender:i,modDataCount:r,large:e}},Fg.prototype.restorePipelines=function(t){var e=this,n=e._pipelineMap=pt();t.eachSeries((function(t){var r=t.getProgressive(),i=t.uid;n.set(i,{id:i,head:null,tail:null,threshold:t.getProgressiveThreshold(),progressiveEnabled:r&&!(t.preventIncremental&&t.preventIncremental()),blockIndex:-1,step:Math.round(r||700),count:0}),e._pipe(t,t.dataTask)}))},Fg.prototype.prepareStageTasks=function(){var t=this._stageTaskMap,e=this.api.getModel(),n=this.api;F(this._allHandlers,(function(r){var i=t.get(r.uid)||t.set(r.uid,{});at(!(r.reset&&r.overallReset),""),r.reset&&this._createSeriesStageTask(r,i,e,n),r.overallReset&&this._createOverallStageTask(r,i,e,n)}),this)},Fg.prototype.prepareView=function(t,e,n,r){var i=t.renderTask,o=i.context;o.model=e,o.ecModel=n,o.api=r,i.__block=!t.incrementalPrepareRender,this._pipe(e,i)},Fg.prototype.performDataProcessorTasks=function(t,e){this._performStageTasks(this._dataProcessorHandlers,t,e,{block:!0})},Fg.prototype.performVisualTasks=function(t,e,n){this._performStageTasks(this._visualHandlers,t,e,n)},Fg.prototype._performStageTasks=function(t,e,n,r){r=r||{};var i=!1,o=this;function a(t,e){return t.setDirty&&(!t.dirtyMap||t.dirtyMap.get(e.__pipeline.id))}F(t,(function(t,s){var l,u,h,c,d;r.visualType&&r.visualType!==t.visualType||(l=(c=o._stageTaskMap.get(t.uid)).seriesTaskMap,(u=c.overallTask)?((c=u.agentStubMap).each((function(t){a(r,t)&&(t.dirty(),h=!0)})),h&&u.dirty(),o.updatePayload(u,n),d=o.getPerformArgs(u,r.block),c.each((function(t){t.perform(d)})),u.perform(d)&&(i=!0)):l&&l.each((function(s,l){a(r,s)&&s.dirty();var u=o.getPerformArgs(s,r.block);u.skip=!t.performRawSeries&&e.isSeriesFiltered(s.context.model),o.updatePayload(s,n),s.perform(u)&&(i=!0)})))})),this.unfinished=i||this.unfinished},Fg.prototype.performSeriesTasks=function(t){var e;t.eachSeries((function(t){e=t.dataTask.perform()||e})),this.unfinished=e||this.unfinished},Fg.prototype.plan=function(){this._pipelineMap.each((function(t){var e=t.tail;do{if(e.__block){t.blockIndex=e.__idxInPipeline;break}}while(e=e.getUpstream())}))},Fg.prototype.updatePayload=function(t,e){"remain"!==e&&(t.context.payload=e)},Fg.prototype._createSeriesStageTask=function(t,e,n,r){var i=this,o=e.seriesTaskMap,a=e.seriesTaskMap=pt(),s=t.seriesType;e=t.getTargetSeries;function l(e){var s=e.uid;s=a.set(s,o&&o.get(s)||lf({plan:Gg,reset:Wg,count:Yg}));s.context={model:e,ecModel:n,api:r,useClearVisual:t.isVisual&&!t.isLayout,plan:t.plan,reset:t.reset,scheduler:i},i._pipe(e,s)}t.createOnAllSeries?n.eachRawSeries(l):s?n.eachRawSeriesByType(s,l):e&&e(n,r).each(l)},Fg.prototype._createOverallStageTask=function(t,e,n,r){var i=this,o=e.overallTask=e.overallTask||lf({reset:zg});o.context={ecModel:n,api:r,overallReset:t.overallReset,scheduler:i};var a=o.agentStubMap,s=o.agentStubMap=pt(),l=t.seriesType,u=(e=t.getTargetSeries,!0),h=!1;function c(t){var e=t.uid;e=s.set(e,a&&a.get(e)||(h=!0,lf({reset:Hg,onDirty:Ug})));e.context={model:t,overallProgress:u},e.agent=o,e.__block=u,i._pipe(t,e)}at(!t.createOnAllSeries,""),l?n.eachRawSeriesByType(l,c):e?e(n,r).each(c):(u=!1,F(n.getSeries(),c)),h&&o.dirty()},Fg.prototype._pipe=function(t,e){t=t.uid,t=this._pipelineMap.get(t),t.head||(t.head=e),t.tail&&t.tail.pipe(e),(t.tail=e).__idxInPipeline=t.count++,e.__pipeline=t},Fg.wrapStageHandler=function(t,e){return(t=j(t)?{overallReset:t,seriesType:function(t){Zg=null;try{t(qg,Kg)}catch(t){}return Zg}(t)}:t).uid=Tc("stageHandler"),e&&(t.visualType=e),t},S=Fg;var Xg=jg(0);function jg(t){return function(e,n){var r=n.data,i=n.resetDefines[t];if(i&&i.dataEach)for(var o=e.start;o<e.end;o++)i.dataEach(r,o);else i&&i.progress&&i.progress(e,r)}}function Yg(t){return t.data.count()}var Zg,qg={},Kg={};function Qg(t,e){for(var n in e.prototype)t[n]=mt}Qg(qg,hp),Qg(Kg,up),qg.eachSeriesByType=qg.eachRawSeriesByType=function(t){Zg=t},qg.eachComponent=function(t){"series"===t.mainType&&t.subType&&(Zg=t.subType)};var Jg=S,$g=(wu=["#37A2DA","#32C5E9","#67E0E3","#9FE6B8","#FFDB5C","#ff9f7f","#fb7293","#E062AE","#E690D1","#e7bcf3","#9d96f5","#8378EA","#96BFFF"],Pu={color:wu,colorLayer:[["#37A2DA","#ffd85c","#fd7b5f"],["#37A2DA","#67E0E3","#FFDB5C","#ff9f7f","#E062AE","#9d96f5"],["#37A2DA","#32C5E9","#9FE6B8","#FFDB5C","#ff9f7f","#fb7293","#e7bcf3","#8378EA","#96BFFF"],wu]},"#B9B8CE");f="#100C2A",e=function(){return{axisLine:{lineStyle:{color:$g}},splitLine:{lineStyle:{color:"#484753"}},splitArea:{areaStyle:{color:["rgba(255,255,255,0.02)","rgba(255,255,255,0.05)"]}},minorSplitLine:{lineStyle:{color:"#20203B"}}}},v=["#4992ff","#7cffb2","#fddd60","#ff6e76","#58d9f9","#05c091","#ff8a45","#8d48e3","#dd79ff"],Bo={darkMode:!0,color:v,backgroundColor:f,axisPointer:{lineStyle:{color:"#817f91"},crossStyle:{color:"#817f91"},label:{color:"#fff"}},legend:{textStyle:{color:$g}},textStyle:{color:$g},title:{textStyle:{color:"#EEF1FA"},subtextStyle:{color:"#B9B8CE"}},toolbox:{iconStyle:{borderColor:$g}},dataZoom:{borderColor:"#71708A",textStyle:{color:$g},brushStyle:{color:"rgba(135,163,206,0.3)"},handleStyle:{color:"#353450",borderColor:"#C5CBE3"},moveHandleStyle:{color:"#B0B6C3",opacity:.3},fillerColor:"rgba(135,163,206,0.2)",emphasis:{handleStyle:{borderColor:"#91B7F2",color:"#4D587D"},moveHandleStyle:{color:"#636D9A",opacity:.7}},dataBackground:{lineStyle:{color:"#71708A",width:1},areaStyle:{color:"#71708A"}},selectedDataBackground:{lineStyle:{color:"#87A3CE"},areaStyle:{color:"#87A3CE"}}},visualMap:{textStyle:{color:$g}},timeline:{lineStyle:{color:$g},label:{color:$g},controlStyle:{color:$g,borderColor:$g}},calendar:{itemStyle:{color:f},dayLabel:{color:$g},monthLabel:{color:$g},yearLabel:{color:$g}},timeAxis:e(),logAxis:e(),valueAxis:e(),categoryAxis:e(),line:{symbol:"circle"},graph:{color:v},gauge:{title:{color:$g},axisLine:{lineStyle:{color:[[1,"rgba(207,212,219,0.2)"]]}},axisLabel:{color:$g},detail:{color:"#EEF1FA"}},candlestick:{itemStyle:{color:"#f64e56",color0:"#54ea92",borderColor:"#f64e56",borderColor0:"#54ea92"}}};function tm(t){var e=t=Y(t)?(new DOMParser).parseFromString(t,"text/xml"):t;for(9===e.nodeType&&(e=e.firstChild);"svg"!==e.nodeName.toLowerCase()||1!==e.nodeType;)e=e.nextSibling;return e}Bo.categoryAxis.splitLine.show=!1,tr=Bo;var em=pt(),nm={registerMap:function(t,e,n){var r;n=X(e)?e:e.svg?[{type:"svg",source:e.svg,specialAreas:e.specialAreas}]:((r=e.geoJson||e.geoJSON)&&!e.features&&(n=e.specialAreas,e=r),[{type:"geoJSON",source:e,specialAreas:n}]);return F(n,(function(t){var e=t.type;"geoJson"===e&&(e=t.type="geoJSON"),(0,rm[e])(t)})),em.set(t,n)},retrieveMap:function(t){return em.get(t)}},rm={geoJSON:function(t){var e=t.source;t.geoJSON=Y(e)?"undefined"!=typeof JSON&&JSON.parse?JSON.parse(e):new Function("return ("+e+");")():e},svg:function(t){t.svgXML=tm(t.source)}},im=(om.prototype.normalizeQuery=function(t){var e,n,r,i={},o={},a={};return Y(t)?(e=no(t),i.mainType=e.main||null,i.subType=e.sub||null):(n=["Index","Name","Id"],r={name:1,dataIndex:1,dataType:1},F(t,(function(t,e){for(var s=!1,l=0;l<n.length;l++){var u=n[l],h=e.lastIndexOf(u);0<h&&h===e.length-u.length&&"data"!==(h=e.slice(0,h))&&(i.mainType=h,i[u.toLowerCase()]=t,s=!0)}r.hasOwnProperty(e)&&(o[e]=t,s=!0),s||(a[e]=t)}))),{cptQuery:i,dataQuery:o,otherQuery:a}},om.prototype.filter=function(t,e){var n=this.eventInfo;if(!n)return!0;var r=n.targetEl,i=n.packedEvent,o=n.model,a=n.view;if(!o||!a)return!0;var s=e.cptQuery;n=e.dataQuery;return l(s,o,"mainType")&&l(s,o,"subType")&&l(s,o,"index","componentIndex")&&l(s,o,"name")&&l(s,o,"id")&&l(n,i,"name")&&l(n,i,"dataIndex")&&l(n,i,"dataType")&&(!a.filterForExposedEvent||a.filterForExposedEvent(t,e.otherQuery,r,i));function l(t,e,n,r){return null==t[n]||e[r||n]===t[n]}},om.prototype.afterTrigger=function(){this.eventInfo=null},om);function om(){}function am(t,e,n){switch(n){case"color":return t.getItemVisual(e,"style")[t.getVisual("drawType")];case"opacity":return t.getItemVisual(e,"style").opacity;case"symbol":case"symbolSize":case"liftZ":return t.getItemVisual(e,n);default:}}function sm(t,e){switch(e){case"color":return t.getVisual("style")[t.getVisual("drawType")];case"opacity":return t.getVisual("style").opacity;case"symbol":case"symbolSize":case"liftZ":return t.getVisual(e);default:}}function lm(t,e,n,r){switch(n){case"color":t.ensureUniqueItemVisual(e,"style")[t.getVisual("drawType")]=r,t.setItemVisual(e,"colorFromPalette",!1);break;case"opacity":t.ensureUniqueItemVisual(e,"style").opacity=r;break;case"symbol":case"symbolSize":case"liftZ":t.setItemVisual(e,n,r);break;default:}}M={createOnAllSeries:!0,performRawSeries:!0,reset:function(t,e){var n=t.getData();if(t.legendSymbol&&n.setVisual("legendSymbol",t.legendSymbol),t.hasSymbolVisual){var r=t.get("symbol"),i=t.get("symbolSize"),o=t.get("symbolKeepAspect"),a=t.get("symbolRotate"),s=j(r),l=j(i),u=j(a),h=s||l||u,c=!s&&r?r:t.defaultSymbol;if(n.setVisual({legendSymbol:t.legendSymbol||c,symbol:c,symbolSize:l?null:i,symbolKeepAspect:o,symbolRotate:u?null:a}),!e.isSeriesFiltered(t))return{dataEach:h?function(e,n){var o=t.getRawValue(n),h=t.getDataParams(n);s&&e.setItemVisual(n,"symbol",r(o,h)),l&&e.setItemVisual(n,"symbolSize",i(o,h)),u&&e.setItemVisual(n,"symbolRotate",a(o,h))}:null}}}},S={createOnAllSeries:!0,performRawSeries:!0,reset:function(t,e){if(t.hasSymbolVisual&&!e.isSeriesFiltered(t))return{dataEach:t.getData().hasItemOption?function(t,e){var n=(o=t.getItemModel(e)).getShallow("symbol",!0),r=o.getShallow("symbolSize",!0),i=o.getShallow("symbolRotate",!0),o=o.getShallow("symbolKeepAspect",!0);null!=n&&t.setItemVisual(e,"symbol",n),null!=r&&t.setItemVisual(e,"symbolSize",r),null!=i&&t.setItemVisual(e,"symbolRotate",i),null!=o&&t.setItemVisual(e,"symbolKeepAspect",o)}:null}}};var um=2*Math.PI,hm=Ba.CMD,cm=["top","right","bottom","left"];function dm(t,e,n,r,i,o,a,s){var l=i-t,u=o-e,h=n-t;n=r-e,r=Math.sqrt(h*h+n*n),u=(l*(h/=r)+u*(n/=r))/r;return s&&(u=Math.min(Math.max(u,0),1)),h=a[0]=t+(u*=r)*h,n=a[1]=e+u*n,Math.sqrt((h-i)*(h-i)+(n-o)*(n-o))}function pm(t,e,n,r,i,o,a){return n<0&&(t+=n,n=-n),r<0&&(e+=r,r=-r),n=t+n,r=e+r,n=a[0]=Math.min(Math.max(i,t),n),r=a[1]=Math.min(Math.max(o,e),r),Math.sqrt((n-i)*(n-i)+(r-o)*(r-o))}var fm=[];function gm(t,e,n){for(var r=0,i=0,o=0,a=0,s=1/0,l=e.data,u=t.x,h=t.y,c=0;c<l.length;){var d=l[c++];1===c&&(o=r=l[c],a=i=l[c+1]);var p=s;switch(d){case hm.M:r=o=l[c++],i=a=l[c++];break;case hm.L:p=dm(r,i,l[c],l[c+1],u,h,fm,!0),r=l[c++],i=l[c++];break;case hm.C:p=ta(r,i,l[c++],l[c++],l[c++],l[c++],l[c],l[c+1],u,h,fm),r=l[c++],i=l[c++];break;case hm.Q:p=oa(r,i,l[c++],l[c++],l[c],l[c+1],u,h,fm),r=l[c++],i=l[c++];break;case hm.A:var f=l[c++],g=l[c++],m=l[c++],y=l[c++],_=l[c++],v=l[c++];c+=1;var x=!!(1-l[c++]),b=Math.cos(_)*m+f,T=Math.sin(_)*y+g;c<=1&&(o=b,a=T),p=function(t,e,n,r,i,o,a,s,l){a-=t,s-=e;var u=Math.sqrt(a*a+s*s),h=(a/=u)*n+t,c=(s/=u)*n+e;if(Math.abs(r-i)%um<1e-4)return l[0]=h,l[1]=c,u-n;(i=o?(d=r,r=Ha(i),Ha(d)):(r=Ha(r),Ha(i)))<r&&(i+=um);var d=Math.atan2(s,a);return d<0&&(d+=um),r<=d&&d<=i||r<=d+um&&d+um<=i?(l[0]=h,l[1]=c,u-n):(u=n*Math.cos(r)+t,r=n*Math.sin(r)+e,t=n*Math.cos(i)+t,i=n*Math.sin(i)+e,(e=(u-a)*(u-a)+(r-s)*(r-s))<(s=(t-a)*(t-a)+(i-s)*(i-s))?(l[0]=u,l[1]=r,Math.sqrt(e)):(l[0]=t,l[1]=i,Math.sqrt(s)))}(f,g,y,_,_+v,x,(u-f)*y/m+f,h,fm),r=Math.cos(_+v)*m+f,i=Math.sin(_+v)*y+g;break;case hm.R:p=pm(o=r=l[c++],a=i=l[c++],l[c++],l[c++],u,h,fm);break;case hm.Z:p=dm(r,i,o,a,u,h,fm,!0),r=o,i=a}p<s&&(s=p,n.set(fm[0],fm[1]))}return s}var mm=new Dn,ym=new Dn,_m=new Dn,vm=new Dn,xm=new Dn;function bm(t,e){if(t){var n=t.getTextGuideLine(),r=t.getTextContent();if(r&&n){var i=t.textGuideLineConfig||{},o=[[0,0],[0,0],[0,0]],a=i.candidates||cm,s=r.getBoundingRect().clone();s.applyTransform(r.getComputedTransform());var l=1/0,u=i.anchor,h=t.getComputedTransform(),c=h&&Se([],h),d=e.get("length2")||0;u&&_m.copy(u);for(var p,f=0;f<a.length;f++){!function(t,e,n,r,i){var o=n.width,a=n.height;switch(t){case"top":r.set(n.x+o/2,n.y-e),i.set(0,-1);break;case"bottom":r.set(n.x+o/2,n.y+a+e),i.set(0,1);break;case"left":r.set(n.x-e,n.y+a/2),i.set(-1,0);break;case"right":r.set(n.x+o+e,n.y+a/2),i.set(1,0)}}(a[f],0,s,mm,vm),Dn.scaleAndAdd(ym,mm,vm,d),ym.transform(c);var g=t.getBoundingRect(),m=u?u.distance(ym):t instanceof rs?gm(ym,t.path,_m):(m=ym,p=_m,m=pm(g.x,g.y,g.width,g.height,ym.x,ym.y,fm),p.set(fm[0],fm[1]),m);m<l&&(l=m,ym.transform(h),_m.transform(h),_m.toArray(o[0]),ym.toArray(o[1]),mm.toArray(o[2]))}Sm(o,e.get("minTurnAngle")),n.setShape({points:o})}}}var Tm=[],wm=new Dn;function Sm(t,e){var n,r;e<=180&&0<e&&(e=e/180*Math.PI,mm.fromArray(t[0]),ym.fromArray(t[1]),_m.fromArray(t[2]),Dn.sub(vm,mm,ym),Dn.sub(xm,_m,ym),n=vm.len(),r=xm.len(),n<.001||r<.001||(vm.scale(1/n),xm.scale(1/r),r=vm.dot(xm),Math.cos(e)<r&&(r=dm(ym.x,ym.y,_m.x,_m.y,mm.x,mm.y,Tm,!1),wm.fromArray(Tm),wm.scaleAndAdd(xm,r/Math.tan(Math.PI-e)),e=_m.x!==ym.x?(wm.x-ym.x)/(_m.x-ym.x):(wm.y-ym.y)/(_m.y-ym.y),isNaN(e)||(e<0?Dn.copy(wm,ym):1<e&&Dn.copy(wm,_m),wm.toArray(t[1])))))}function Mm(t,e,n,r){var i="normal"===n;n=i?t:t.ensureState(n);n.ignore=e,e=r.get("smooth"),e&&!0===e&&(e=.3),n.shape=n.shape||{},0<e&&(n.shape.smooth=e),r=r.getModel("lineStyle").getLineStyle(),i?t.useStyle(r):n.style=r}function Am(t,e){var n=e.smooth,r=e.points;if(r)if(t.moveTo(r[0][0],r[0][1]),0<n&&3<=r.length){var i=Ct(r[0],r[1]);e=Ct(r[1],r[2]);if(!i||!e)return t.lineTo(r[1][0],r[1][1]),void t.lineTo(r[2][0],r[2][1]);n=Math.min(i,e)*n,i=It([],r[1],r[0],n/i),n=It([],r[1],r[2],n/e),e=It([],i,n,.5),t.bezierCurveTo(i[0],i[1],i[0],i[1],e[0],e[1]),t.bezierCurveTo(n[0],n[1],n[0],n[1],r[2][0],r[2][1])}else for(var o=1;o<r.length;o++)t.lineTo(r[o][0],r[o][1])}function Cm(t,e,n){var r=t.getTextGuideLine(),i=t.getTextContent();if(i){for(var o=e.normal,a=o.get("show"),s=i.ignore,l=0;l<Us.length;l++){var u,h=Us[l],c=e[h],d="normal"===h;c&&(u=c.get("show"),!(d?s:nt(i.states[h]&&i.states[h].ignore,s))&&nt(u,a)?(r||(r=new Bu,t.setTextGuideLine(r),d||!s&&a||Mm(r,!0,"normal",e.normal),t.stateProxy&&(r.stateProxy=t.stateProxy)),Mm(r,!1,h,c)):(d=d?r:r&&r.states.normal)&&(d.ignore=!0))}r&&(L(r.style,n),r.style.fill=null,o=o.get("showAbove"),(t.textGuideLineConfig=t.textGuideLineConfig||{}).showAbove=o||!1,r.buildPath=Am)}else r&&t.removeTextGuideLine()}function Em(t,e){for(var n={normal:t.getModel(e=e||"labelLine")},r=0;r<Vs.length;r++){var i=Vs[r];n[i]=t.getModel([i,e])}return n}function Im(t,e,n,r,i,o){var a=t.length;if(!(a<2)){t.sort((function(t,n){return t.rect[e]-n.rect[e]}));for(var s=0,l=!1,u=[],h=0,c=0;c<a;c++){var d=t[c],p=d.rect;(f=p[e]-s)<0&&(p[e]-=f,d.label[e]-=f,l=!0);var f=Math.max(-f,0);u.push(f),h+=f,s=p[e]+p[n]}0<h&&o&&b(-h/a,0,a);var g,m,y=t[0],_=t[a-1];return v(),g<0&&T(-g,.8),m<0&&T(m,.8),v(),x(g,m,1),x(m,g,-1),v(),g<0&&w(-g),m<0&&w(m),l}function v(){g=y.rect[e]-r,m=i-_.rect[e]-_.rect[n]}function x(t,e,n){t<0&&(0<(e=Math.min(e,-t))?(b(e*n,0,a),(e+=t)<0&&T(-e*n,1)):T(-t*n,1))}function b(n,r,i){0!==n&&(l=!0);for(var o=r;o<i;o++){var a=t[o];a.rect[e]+=n,a.label[e]+=n}}function T(r,i){for(var o=[],s=0,l=1;l<a;l++){var u=t[l-1].rect;u=Math.max(t[l].rect[e]-u[e]-u[n],0);o.push(u),s+=u}if(s){var h=Math.min(Math.abs(r)/s,i);if(0<r)for(l=0;l<a-1;l++)b(o[l]*h,0,l+1);else for(l=a-1;0<l;l--)b(-o[l-1]*h,l,a)}}function w(t){var e=t<0?-1:1;t=Math.abs(t);for(var n=Math.ceil(t/(a-1)),r=0;r<a-1;r++)if(0<e?b(n,0,r+1):b(-n,a-r-1,a),(t-=n)<=0)return}}function Dm(t,e,n,r){return Im(t,"y","height",e,n,r)}function Rm(t,e){var n=t.label;e=e&&e.getTextGuideLine();return{dataIndex:t.dataIndex,dataType:t.dataType,seriesIndex:t.seriesModel.seriesIndex,text:t.label.style.text,rect:t.hostRect,labelRect:t.rect,align:n.style.align,verticalAlign:n.style.verticalAlign,labelLinePoints:function(t){if(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n].slice());return e}}(e&&e.shape.points)}}var Lm=["align","verticalAlign","width","height","fontSize"],Om=new Le,Pm=Xi(),Nm=Xi();function km(t,e,n){for(var r=0;r<n.length;r++){var i=n[r];null!=e[i]&&(t[i]=e[i])}}var Bm=["x","y","rotation"];function Fm(){this._labelList=[],this._chartViewList=[]}var zm=(Fm.prototype.clearLabels=function(){this._labelList=[],this._chartViewList=[]},Fm.prototype._addLabel=function(t,e,n,r,i){var o=r.style,a=r.__hostTarget.textConfig||{},s=r.getComputedTransform(),l=r.getBoundingRect().plain();Un.applyTransform(l,l,s),s?Om.setLocalTransform(s):(Om.x=Om.y=Om.rotation=Om.originX=Om.originY=0,Om.scaleX=Om.scaleY=1);var u,h=r.__hostTarget;h&&(u=h.getBoundingRect().plain(),s=h.getComputedTransform(),Un.applyTransform(u,u,s)),h=u&&h.getTextGuideLine(),this._labelList.push({label:r,labelLine:h,seriesModel:n,dataIndex:t,dataType:e,layoutOption:i,computedLayoutOption:null,rect:l,hostRect:u,priority:u?u.width*u.height:0,defaultAttr:{ignore:r.ignore,labelGuideIgnore:h&&h.ignore,x:Om.x,y:Om.y,rotation:Om.rotation,style:{x:o.x,y:o.y,align:o.align,verticalAlign:o.verticalAlign,width:o.width,height:o.height,fontSize:o.fontSize},cursor:r.cursor,attachedPos:a.position,attachedRot:a.rotation}})},Fm.prototype.addLabelsOfSeries=function(t){var e=this;this._chartViewList.push(t);var n=t.__model,r=n.get("labelLayout");(j(r)||U(r).length)&&t.group.traverse((function(t){if(t.ignore)return!0;var i=t.getTextContent();t=Ps(t);i&&!i.disableLabelLayout&&e._addLabel(t.dataIndex,t.dataType,n,i,r)}))},Fm.prototype.updateLayoutConfig=function(t){for(var e=t.getWidth(),n=t.getHeight(),r=0;r<this._labelList.length;r++){var i=this._labelList[r],o=i.label,a=o.__hostTarget,s=i.defaultAttr,l=void 0;l="function"==typeof i.layoutOption?i.layoutOption(Rm(i,a)):i.layoutOption;i.computedLayoutOption=l=l||{};var u=Math.PI/180;a&&a.setTextConfig({local:!1,position:null!=l.x||null!=l.y?null:s.attachedPos,rotation:null!=l.rotate?l.rotate*u:s.attachedRot,offset:[l.dx||0,l.dy||0]});var h,c=!1;null!=l.x?(o.x=hi(l.x,e),o.setStyle("x",0),c=!0):(o.x=s.x,o.setStyle("x",s.style.x)),null!=l.y?(o.y=hi(l.y,n),o.setStyle("y",0),c=!0):(o.y=s.y,o.setStyle("y",s.style.y)),!l.labelLinePoints||(h=a.getTextGuideLine())&&(h.setShape({points:l.labelLinePoints}),c=!1),Pm(o).needsUpdateLabelLine=c,o.rotation=null!=l.rotate?l.rotate*u:s.rotation;for(var d=0;d<Lm.length;d++){var p=Lm[d];o.setStyle(p,(null!=l[p]?l:s.style)[p])}l.draggable?(o.draggable=!0,o.cursor="move",a&&(u=i.seriesModel,null!=i.dataIndex&&(u=i.seriesModel.getData(i.dataType).getItemModel(i.dataIndex)),o.on("drag",function(t,e){return function(){bm(t,e)}}(a,u.getModel("labelLine"))))):(o.off("drag"),o.cursor=s.cursor)}},Fm.prototype.layout=function(t){var e,n=t.getWidth(),r=t.getHeight(),i=function(t){for(var e=[],n=0;n<t.length;n++){var r,i,o,a,s,l,u=t[n];u.defaultAttr.ignore||(i=(r=u.label).getComputedTransform(),o=r.getBoundingRect(),a=!i||i[1]<1e-5&&i[2]<1e-5,l=r.style.margin||0,(s=o.clone()).applyTransform(i),s.x-=l/2,s.y-=l/2,s.width+=l,s.height+=l,l=a?new fh(o,i):null,e.push({label:r,labelLine:u.labelLine,rect:s,localRect:o,obb:l,priority:u.priority,defaultAttr:u.defaultAttr,layoutOption:u.computedLayoutOption,axisAligned:a,transform:i}))}return e}(this._labelList),o=V(i,(function(t){return"shiftX"===t.layoutOption.moveOverlap}));t=V(i,(function(t){return"shiftY"===t.layoutOption.moveOverlap}));Im(o,"x","width",0,n,e),Dm(t,0,r),function(t){var e=[];t.sort((function(t,e){return e.priority-t.priority}));var n=new Un(0,0,0,0);function r(t){var e;t.ignore||null==(e=t.ensureState("emphasis")).ignore&&(e.ignore=!1),t.ignore=!0}for(var i=0;i<t.length;i++){var o=t[i],a=o.axisAligned,s=o.localRect,l=o.transform,u=o.label,h=o.labelLine;n.copy(o.rect),n.width-=.1,n.height-=.1,n.x+=.05,n.y+=.05;for(var c=o.obb,d=!1,p=0;p<e.length;p++){var f=e[p];if(n.intersect(f.rect)){if(a&&f.axisAligned){d=!0;break}if(f.obb||(f.obb=new fh(f.localRect,f.transform)),(c=c||new fh(s,l)).intersect(f.obb)){d=!0;break}}}d?(r(u),h&&r(h)):(u.attr("ignore",o.defaultAttr.ignore),h&&h.attr("ignore",o.defaultAttr.labelGuideIgnore),e.push(o))}}(V(i,(function(t){return t.layoutOption.hideOverlap})))},Fm.prototype.processLabelsOverall=function(){var t=this;F(this._chartViewList,(function(e){var n=e.__model,r=e.ignoreLabelLineUpdate,i=n.isAnimationEnabled();e.group.traverse((function(e){if(e.ignore)return!0;var o=!r,a=e.getTextContent();(o=!o&&a?Pm(a).needsUpdateLabelLine:o)&&t._updateLabelLine(e,n),i&&t._animateLabels(e,n)}))}))},Fm.prototype._updateLabelLine=function(t,e){var n=t.getTextContent(),r=Ps(t),i=r.dataIndex;n&&null!=i&&(e=(n=e.getData(r.dataType)).getItemModel(i),r={},i=n.getItemVisual(i,"style"),n=n.getVisual("drawType"),r.stroke=i[n],n=e.getModel("labelLine"),Cm(t,Em(e),r),bm(t,n))},Fm.prototype._animateLabels=function(t,e){var n,r,i,o,a,s,l,u=t.getTextContent(),h=t.getTextGuideLine();!u||u.ignore||u.invisible||t.disableLabelAnimation||Hh(t)||(s=(a=Pm(u)).oldLayout,n=(l=Ps(t)).dataIndex,r={x:u.x,y:u.y,rotation:u.rotation},l=e.getData(l.dataType),s?(u.attr(s),(i=t.prevStates)&&(0<=P(i,"select")&&u.attr(a.oldLayoutSelect),0<=P(i,"emphasis")&&u.attr(a.oldLayoutEmphasis)),Nh(u,r,e,n)):(u.attr(r),lc(u).valueAnimation||(i=nt(u.style.opacity,1),u.style.opacity=0,kh(u,{style:{opacity:i}},e,n))),a.oldLayout=r,u.states.select&&(km(o=a.oldLayoutSelect={},r,Bm),km(o,u.states.select,Bm)),u.states.emphasis&&(km(o=a.oldLayoutEmphasis={},r,Bm),km(o,u.states.emphasis,Bm)),uc(u,n,l,e,e)),!h||h.ignore||h.invisible||(s=(a=Nm(h)).oldLayout,l={points:h.shape.points},s?(h.attr({shape:s}),Nh(h,{shape:l},e)):(h.setShape(l),h.style.strokePercent=0,kh(h,{style:{strokePercent:1}},e)),a.oldLayout=l)},Fm);function Hm(t,e){F([[t+"ToggleSelect","toggleSelect"],[t+"Select","select"],[t+"UnSelect","unselect"]],(function(n){e(n[0],(function(e,r,i){var o;e=R({},e),i.dispatchAction(R(e,{type:n[1],seriesIndex:(e=e,o=[],r.eachComponent({mainType:"series",subType:t,query:e},(function(t){o.push(t.seriesIndex)})),o)}))}))}))}function Vm(t,e,n,r,i){var o=t+e;n.isSilent(o)||r.eachComponent({mainType:"series",subType:"pie"},(function(t){for(var e,r,a=t.seriesIndex,s=i.selected,l=0;l<s.length;l++)s[l].seriesIndex===a&&(r=Wi(e=t.getData(),i.fromActionPayload),n.trigger(o,{type:o,seriesId:t.id,name:X(r)?e.getName(r[0]):e.getName(r),selected:R({},t.option.selectedMap)}))}))}function Um(t,e,n){for(var r;t&&(!e(t)||(r=t,!n));)t=t.__hostTarget||t.parent;return r}var Gm=Math.round(9*Math.random());function Wm(){this._id="__ec_inner_"+Gm++}Wm.prototype.get=function(t){return this._guard(t)[this._id]},Wm.prototype.set=function(t,e){return t=this._guard(t),"function"==typeof Object.defineProperty?Object.defineProperty(t,this._id,{value:e,enumerable:!1,configurable:!0}):t[this._id]=e,this},Wm.prototype.delete=function(t){return!!this.has(t)&&(delete this._guard(t)[this._id],!0)},Wm.prototype.has=function(t){return!!this._guard(t)[this._id]},Wm.prototype._guard=function(t){if(t!==Object(t))throw TypeError("Value of WeakMap is not a non-null object.");return t},wu=Wm,f=rs.extend({type:"triangle",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(t,e){var n=e.cx,r=e.cy,i=e.width/2;e=e.height/2;t.moveTo(n,r-e),t.lineTo(n+i,r+e),t.lineTo(n-i,r+e),t.closePath()}}),e=rs.extend({type:"diamond",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(t,e){var n=e.cx,r=e.cy,i=e.width/2;e=e.height/2;t.moveTo(n,r-e),t.lineTo(n+i,r),t.lineTo(n,r+e),t.lineTo(n-i,r),t.closePath()}}),v=rs.extend({type:"pin",shape:{x:0,y:0,width:0,height:0},buildPath:function(t,e){var n=e.x,r=e.y,i=e.width/5*3,o=Math.max(i,e.height),a=i/2,s=a*a/(o-a),l=r-o+a+s,u=Math.asin(s/a),h=Math.cos(u)*a,c=Math.sin(u);e=Math.cos(u),i=.6*a,o=.7*a;t.moveTo(n-h,l+s),t.arc(n,l,a,Math.PI-u,2*Math.PI+u),t.bezierCurveTo(n+h-c*i,l+s+e*i,n,r-o,n,r),t.bezierCurveTo(n,r-o,n-h+c*i,l+s+e*i,n-h,l+s),t.closePath()}}),Bo=rs.extend({type:"arrow",shape:{x:0,y:0,width:0,height:0},buildPath:function(t,e){var n=e.height,r=e.width,i=e.x;e=e.y,r=r/3*2;t.moveTo(i,e),t.lineTo(i+r,e+n),t.lineTo(i,e+n/4*3),t.lineTo(i-r,e+n),t.lineTo(i,e),t.closePath()}});var Xm={line:function(t,e,n,r,i){i.x=t,i.y=e+r/2-1,i.width=n,i.height=2},rect:function(t,e,n,r,i){i.x=t,i.y=e,i.width=n,i.height=r},roundRect:function(t,e,n,r,i){i.x=t,i.y=e,i.width=n,i.height=r,i.r=Math.min(n,r)/4},square:function(t,e,n,r,i){r=Math.min(n,r),i.x=t,i.y=e,i.width=r,i.height=r},circle:function(t,e,n,r,i){i.cx=t+n/2,i.cy=e+r/2,i.r=Math.min(n,r)/2},diamond:function(t,e,n,r,i){i.cx=t+n/2,i.cy=e+r/2,i.width=n,i.height=r},pin:function(t,e,n,r,i){i.x=t+n/2,i.y=e+r/2,i.width=n,i.height=r},arrow:function(t,e,n,r,i){i.x=t+n/2,i.y=e+r/2,i.width=n,i.height=r},triangle:function(t,e,n,r,i){i.cx=t+n/2,i.cy=e+r/2,i.width=n,i.height=r}},jm={};F({line:bs,rect:bs,roundRect:bs,square:bs,circle:tu,diamond:e,pin:v,arrow:Bo,triangle:f},(function(t,e){jm[e]=new t}));var Ym=rs.extend({type:"symbol",shape:{symbolType:"",x:0,y:0,width:0,height:0},calculateTextPosition:function(t,e,n){var r=$n(t,e,n);t=this.shape;return t&&"pin"===t.symbolType&&"inside"===e.position&&(r.y=n.y+.4*n.height),r},buildPath:function(t,e,n){var r,i=e.symbolType;"none"!==i&&(r=(r=jm[i])||jm[i="rect"],Xm[i](e.x,e.y,e.width,e.height,r.shape),r.buildPath(t,r.shape,n))}});function Zm(t,e){var n;"image"!==this.type&&(n=this.style,this.__isEmptyBrush?(n.stroke=t,n.fill=e||"#fff",n.lineWidth=2):n.fill=t,this.markRedraw())}function qm(t,e,n,r,i,o,a){var s=0===t.indexOf("empty");return(i=0===(t=s?t.substr(5,1).toLowerCase()+t.substr(6):t).indexOf("image://")?Ch(t.slice(8),new Un(e,n,r,i),a?"center":"cover"):0===t.indexOf("path://")?Ah(t.slice(7),{},new Un(e,n,r,i),a?"center":"cover"):new Ym({shape:{symbolType:t,x:e,y:n,width:r,height:i}})).__isEmptyBrush=s,i.setColor=Zm,o&&i.setColor(o),i}function Km(t,e,n){for(var r,i,o,a,s,l,u,h,c,d="radial"===e.type?(r=t,i=e,a=(o=n).width,s=o.height,l=Math.min(a,s),u=null==i.x?.5:i.x,h=null==i.y?.5:i.y,c=null==i.r?.5:i.r,i.global||(u=u*a+o.x,h=h*s+o.y,c*=l),r.createRadialGradient(u,h,0,u,h,c)):(l=t,r=n,h=null==(u=e).x?0:u.x,c=null==u.x2?1:u.x2,t=null==u.y?0:u.y,n=null==u.y2?0:u.y2,u.global||(h=h*r.width+r.x,c=c*r.width+r.x,t=t*r.height+r.y,n=n*r.height+r.y),h=isNaN(h)?0:h,c=isNaN(c)?1:c,t=isNaN(t)?0:t,n=isNaN(n)?0:n,l.createLinearGradient(h,t,c,n)),p=e.colorStops,f=0;f<p.length;f++)d.addColorStop(p[f].offset,p[f].color);return d}function Qm(t,e){return t&&"solid"!==t&&0<e?(e=e||1,"dashed"===t?[4*e,2*e]:"dotted"===t?[e]:q(t)?[t]:X(t)?t:null):null}var Jm=new Ba(!0);function $m(t){var e=t.stroke;return!(null==e||"none"===e||!(0<t.lineWidth))}function ty(t){return t=t.fill,null!=t&&"none"!==t}function ey(t,e){var n;null!=e.fillOpacity&&1!==e.fillOpacity?(n=t.globalAlpha,t.globalAlpha=e.fillOpacity*e.opacity,t.fill(),t.globalAlpha=n):t.fill()}function ny(t,e){var n;null!=e.strokeOpacity&&1!==e.strokeOpacity?(n=t.globalAlpha,t.globalAlpha=e.strokeOpacity*e.opacity,t.stroke(),t.globalAlpha=n):t.stroke()}function ry(t,e,n){if(n=go(e.image,e.__image,n),yo(n))return t=t.createPattern(n,e.repeat||"repeat"),"function"==typeof DOMMatrix&&((n=new DOMMatrix).rotateSelf(0,0,(e.rotation||0)/Math.PI*180),n.scaleSelf(e.scaleX||1,e.scaleY||1),n.translateSelf(e.x||0,e.y||0),t.setTransform(n)),t}var iy=["shadowBlur","shadowOffsetX","shadowOffsetY"],oy=[["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]];function ay(t,e,n,r,i){var o=!1;if(!r&&e===(n=n||{}))return!1;!r&&e.opacity===n.opacity||(o||(py(t,i),o=!0),t.globalAlpha=(null==e.opacity?Io:e).opacity),!r&&e.blend===n.blend||(o||(py(t,i),o=!0),t.globalCompositeOperation=e.blend||Io.blend);for(var a=0;a<iy.length;a++){var s=iy[a];!r&&e[s]===n[s]||(o||(py(t,i),o=!0),t[s]=t.dpr*(e[s]||0))}return!r&&e.shadowColor===n.shadowColor||(o||(py(t,i),o=!0),t.shadowColor=e.shadowColor||Io.shadowColor),o}function sy(t,e,n,r,i){var o=fy(e,i.inHover),a=r?null:n&&fy(n,i.inHover)||{};if(o!==a){var s=ay(t,o,a,r,i);!r&&o.fill===a.fill||(s||(py(t,i),s=!0),t.fillStyle=o.fill),!r&&o.stroke===a.stroke||(s||(py(t,i),s=!0),t.strokeStyle=o.stroke),!r&&o.opacity===a.opacity||(s||(py(t,i),s=!0),t.globalAlpha=null==o.opacity?1:o.opacity),e.hasStroke()&&(e=o.lineWidth/(o.strokeNoScale&&e&&e.getLineScale?e.getLineScale():1),t.lineWidth!==e&&(s||(py(t,i),s=!0),t.lineWidth=e));for(var l=0;l<oy.length;l++){var u=oy[l],h=u[0];!r&&o[h]===a[h]||(s||(py(t,i),s=!0),t[h]=o[h]||u[1])}return s}}function ly(t,e){var n=e.transform;e=t.dpr||1;n?t.setTransform(e*n[0],e*n[1],e*n[2],e*n[3],e*n[4],e*n[5]):t.setTransform(e,0,0,e,0,0)}var uy=1,hy=2,cy=3,dy=4;function py(t,e){e.batchFill&&t.fill(),e.batchStroke&&t.stroke(),e.batchFill="",e.batchStroke=""}function fy(t,e){return e&&t.__hoverStyle||t.style}function gy(t,e){my(t,e,{inHover:!1,viewWidth:0,viewHeight:0},!0)}function my(t,e,n,r){var i=e.transform;if(!e.shouldBePainted(n.viewWidth,n.viewHeight,!1,!1))return e.__dirty&=~fr.REDARAW_BIT,void(e.__isRendered=!1);var o,a,s,l,u,h,c,d,p,f,g,m,y,_=e.__clipPaths,v=n.prevElClipPaths,x=!1,b=!1;v&&!function(t,e){if(t!==e&&(t||e)){if(!t||!e||t.length!==e.length)return 1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return 1}}(_,v)||(v&&v.length&&(py(t,n),t.restore(),b=x=!0,n.prevElClipPaths=null,n.allClipped=!1,n.prevEl=null),_&&_.length&&(py(t,n),t.save(),function(t,e,n){for(var r=!1,i=0;i<t.length;i++){var o=t[i];r=r||o.isZeroArea();ly(e,o),e.beginPath(),o.buildPath(e,o.shape),e.clip()}n.allClipped=r}(_,t,n),x=!0),n.prevElClipPaths=_),n.allClipped?e.__isRendered=!1:(e.beforeBrush&&e.beforeBrush(),e.innerBeforeBrush(),(u=n.prevEl)||(b=x=!0),o=e instanceof rs&&e.autoBatch&&(o=e.style,v=ty(o),_=$m(o),!(o.lineDash||!(+v^+_)||v&&"string"!=typeof o.fill||_&&"string"!=typeof o.stroke||o.strokePercent<1||o.strokeOpacity<1||o.fillOpacity<1)),x||(a=i,c=u.transform,a&&c?a[0]!==c[0]||a[1]!==c[1]||a[2]!==c[2]||a[3]!==c[3]||a[4]!==c[4]||a[5]!==c[5]:a||c)?(py(t,n),ly(t,e)):o||py(t,n),a=fy(e,n.inHover),e instanceof rs?(n.lastDrawType!==uy&&(b=!0,n.lastDrawType=uy),sy(t,e,u,b,n),o&&(n.batchFill||n.batchStroke)||t.beginPath(),function(t,e,n,r){var i=$m(n),o=ty(n),a=n.strokePercent,s=a<1,l=!e.path;e.silent&&!s||!l||e.createPathProxy();var u,h,c,d,p,f,g,m=e.path||Jm;r||(u=n.fill,h=n.stroke,c=o&&!!u.colorStops,_=i&&!!h.colorStops,d=o&&!!u.image,x=i&&!!h.image,g=b=f=v=p=void 0,(c||_)&&(g=e.getBoundingRect()),c&&(p=e.__dirty?Km(t,u,g):e.__canvasFillGradient,e.__canvasFillGradient=p),_&&(v=e.__dirty?Km(t,h,g):e.__canvasStrokeGradient,e.__canvasStrokeGradient=v),d&&(f=e.__dirty||!e.__canvasFillPattern?ry(t,u,e):e.__canvasFillPattern,e.__canvasFillPattern=f),x&&(b=e.__dirty||!e.__canvasStrokePattern?ry(t,h,e):e.__canvasStrokePattern,e.__canvasStrokePattern=f),c?t.fillStyle=p:d&&(f?t.fillStyle=f:o=!1),_?t.strokeStyle=v:x&&(b?t.strokeStyle=b:i=!1));var y,_=n.lineDash&&0<n.lineWidth&&Qm(n.lineDash,n.lineWidth),v=n.lineDashOffset,x=!!t.setLineDash,b=e.getGlobalScale();m.setScale(b[0],b[1],e.segmentIgnoreThreshold),!_||(y=n.strokeNoScale&&e.getLineScale?e.getLineScale():1)&&1!==y&&(_=z(_,(function(t){return t/y})),v/=y),b=!0,(l||e.__dirty&rs.SHAPE_CHANGED_BIT||_&&!x&&i)&&(m.setDPR(t.dpr),s?m.setContext(null):(m.setContext(t),b=!1),m.reset(),_&&!x&&(m.setLineDash(_),m.setLineDashOffset(v)),e.buildPath(m,e.shape,r),m.toStatic(),e.pathUpdated()),b&&m.rebuildPath(t,s?a:1),_&&x&&(t.setLineDash(_),t.lineDashOffset=v),r||(n.strokeFirst?(i&&ny(t,n),o&&ey(t,n)):(o&&ey(t,n),i&&ny(t,n))),_&&x&&t.setLineDash([])}(t,e,a,o),o&&(n.batchFill=a.fill||"",n.batchStroke=a.stroke||"")):e instanceof ss?(n.lastDrawType!==cy&&(b=!0,n.lastDrawType=cy),sy(t,e,u,b,n),h=t,c=e,null!=(y=(d=a).text)&&(y+=""),y&&(h.font=d.font||Wn,h.textAlign=d.textAlign,h.textBaseline=d.textBaseline,p=void 0,h.setLineDash&&(f=d.lineDash&&0<d.lineWidth&&Qm(d.lineDash,d.lineWidth),g=d.lineDashOffset,f&&((m=d.strokeNoScale&&c.getLineScale?c.getLineScale():1)&&1!==m&&(f=z(f,(function(t){return t/m})),g/=m),h.setLineDash(f),h.lineDashOffset=g,p=!0)),d.strokeFirst?($m(d)&&h.strokeText(y,d.x,d.y),ty(d)&&h.fillText(y,d.x,d.y)):(ty(d)&&h.fillText(y,d.x,d.y),$m(d)&&h.strokeText(y,d.x,d.y)),p&&h.setLineDash([]))):e instanceof cs?(n.lastDrawType!==hy&&(b=!0,n.lastDrawType=hy),f=u,g=b,ay(t,fy(e,(y=n).inHover),f&&fy(f,y.inHover),g,y),d=t,p=a,(u=(h=e).__image=go(p.image,h.__image,h,h.onload))&&yo(u)&&(f=p.x||0,g=p.y||0,y=h.getWidth(),a=h.getHeight(),h=u.width/u.height,null==y&&null!=a?y=a*h:null==a&&null!=y?a=y/h:null==y&&null==a&&(y=u.width,a=u.height),p.sWidth&&p.sHeight?(s=p.sx||0,l=p.sy||0,d.drawImage(u,s,l,p.sWidth,p.sHeight,f,g,y,a)):p.sx&&p.sy?(s=p.sx,l=p.sy,d.drawImage(u,s,l,y-s,a-l,f,g,y,a)):d.drawImage(u,f,g,y,a))):e instanceof yh&&(n.lastDrawType!==dy&&(b=!0,n.lastDrawType=dy),function(t,e,n){var r=e.getDisplayables(),i=e.getTemporalDisplayables();t.save();var o,a,s={prevElClipPaths:null,prevEl:null,allClipped:!1,viewWidth:n.viewWidth,viewHeight:n.viewHeight,inHover:n.inHover};for(o=e.getCursor(),a=r.length;o<a;o++)(h=r[o]).beforeBrush&&h.beforeBrush(),h.innerBeforeBrush(),my(t,h,s,o===a-1),h.innerAfterBrush(),h.afterBrush&&h.afterBrush(),s.prevEl=h;for(var l=0,u=i.length;l<u;l++){var h;(h=i[l]).beforeBrush&&h.beforeBrush(),h.innerBeforeBrush(),my(t,h,s,l===u-1),h.innerAfterBrush(),h.afterBrush&&h.afterBrush(),s.prevEl=h}e.clearTemporalDisplayables(),e.notClear=!0,t.restore()}(t,e,n)),o&&r&&py(t,n),e.innerAfterBrush(),e.afterBrush&&e.afterBrush(),(n.prevEl=e).__dirty=0,e.__isRendered=!0)}var yy=new wu,_y=new Ve(100),vy=["symbol","symbolSize","symbolKeepAspect","color","backgroundColor","dashArrayX","dashArrayY","maxTileWidth","maxTileHeight"];function xy(t,e){if("none"===t)return null;var n=e.getDevicePixelRatio(),r=e.getZr(),i="svg"===r.painter.type;if(t.dirty&&yy.delete(t),e=yy.get(t),e)return e;var o=L(t,{symbol:"rect",symbolSize:1,symbolKeepAspect:!0,color:"rgba(0, 0, 0, 0.2)",backgroundColor:null,dashArrayX:5,dashArrayY:5,rotation:0,maxTileWidth:512,maxTileHeight:512});return"none"===o.backgroundColor&&(o.backgroundColor=null),e={repeat:"repeat"},function(t){for(var e,a=[n],s=!0,l=0;l<vy.length;++l){var u=o[vy[l]],h=typeof u;if(null!=u&&!X(u)&&"string"!=h&&"number"!=h&&"boolean"!=h){s=!1;break}a.push(u)}var c;s&&(e=a.join(",")+(i?"-svg":""),(c=_y.get(e))&&(i?t.svgElement=c:t.image=c));var d,p=function t(e){if(!e||0===e.length)return[[0,0]];if("number"==typeof e)return[[o=Math.ceil(e),o]];for(var n=!0,r=0;r<e.length;++r)if("number"!=typeof e[r]){n=!1;break}if(n)return t([e]);var i=[];for(r=0;r<e.length;++r){var o;"number"==typeof e[r]?(o=Math.ceil(e[r]),i.push([o,o])):(o=z(e[r],(function(t){return Math.ceil(t)}))).length%2==1?i.push(o.concat(o)):i.push(o)}return i}(o.dashArrayX),f=function(t){if(!t||"object"==typeof t&&0===t.length)return[0,0];if("number"==typeof t){var e=Math.ceil(t);return[e,e]}return e=z(t,(function(t){return Math.ceil(t)})),t.length%2?e.concat(e):e}(o.dashArrayY),g=function t(e){if(!e||0===e.length)return[["rect"]];if("string"==typeof e)return[[e]];for(var n=!0,r=0;r<e.length;++r)if("string"!=typeof e[r]){n=!1;break}if(n)return t([e]);var i=[];for(r=0;r<e.length;++r)"string"==typeof e[r]?i.push([e[r]]):i.push(e[r]);return i}(o.symbol),m=function(t){return z(t,by)}(p),y=by(f),_=!i&&O(),v=i&&r.painter.createSVGElement("g"),x=function(){for(var t=1,e=0,n=m.length;e<n;++e)t=Di(t,m[e]);var r=1;for(e=0,n=g.length;e<n;++e)r=Di(r,g[e].length);t*=r;var i=y*m.length*g.length;return{width:Math.max(1,Math.min(t,o.maxTileWidth)),height:Math.max(1,Math.min(i,o.maxTileHeight))}}();_&&(_.width=x.width*n,_.height=x.height*n,d=_.getContext("2d")),function(){d&&(d.clearRect(0,0,_.width,_.height),o.backgroundColor&&(d.fillStyle=o.backgroundColor,d.fillRect(0,0,_.width,_.height)));for(var t=0,e=0;e<f.length;++e)t+=f[e];if(!(t<=0))for(var a=-y,s=0,l=0,u=0;a<x.height;){if(s%2==0){for(var h=l/2%g.length,c=0,m=0,b=0;c<2*x.width;){var T,w,S,M,A,C=0;for(e=0;e<p[u].length;++e)C+=p[u][e];if(C<=0)break;m%2==0&&(A=.5*(1-o.symbolSize),T=c+p[u][m]*A,w=a+f[s]*A,S=p[u][m]*o.symbolSize,M=f[s]*o.symbolSize,A=b/2%g[h].length,function(t,e,a,s,l){var u=i?1:n;u=qm(l,t*u,e*u,a*u,s*u,o.color,o.symbolKeepAspect);i?v.appendChild(r.painter.paintOne(u)):gy(d,u)}(T,w,S,M,g[h][A])),c+=p[u][m],++b,++m===p[u].length&&(m=0)}++u===p.length&&(u=0)}a+=f[s],++l,++s===f.length&&(s=0)}}(),s&&_y.put(e,_||v),t.image=_,t.svgElement=v,t.svgWidth=x.width,t.svgHeight=x.height}(e),e.rotation=o.rotation,e.scaleX=e.scaleY=i?1:1/n,yy.set(t,e),t.dirty=!1,e}function by(t){for(var e=0,n=0;n<t.length;++n)e+=t[n];return t.length%2==1?2*e:e}var Ty=at,wy=F,Sy=j,My=K,Ay=P,Cy="undefined"!=typeof window,Ey=(Bo={PROCESSOR:{FILTER:1e3,SERIES_FILTER:800,STATISTIC:5e3},VISUAL:{LAYOUT:1e3,PROGRESSIVE_LAYOUT:1100,GLOBAL:2e3,CHART:3e3,POST_CHART_LAYOUT:4600,COMPONENT:4e3,BRUSH:5e3,CHART_ITEM:4500,ARIA:6e3,DECAL:7e3}},"__flagInMainProcess"),Iy="__optionUpdated",Dy="__needsUpdateStatus",Ry=/^[a-zA-Z0-9_]+$/,Ly="__connectUpdateStatus";function Oy(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(!this.isDisposed())return Ny(this,t,e);f_(this.id)}}function Py(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Ny(this,t,e)}}function Ny(t,e,n){return n[0]=n[0]&&n[0].toLowerCase(),Bt.prototype[e].apply(t,n)}var ky,By=(h(Fy,ky=Bt),Fy);function Fy(){return null!==ky&&ky.apply(this,arguments)||this}var zy,Hy,Vy,Uy,Gy,Wy,Xy,jy,Yy,Zy,qy,Ky,Qy,Jy,$y,t_,e_,n_,r_,i_,o_;f=By.prototype;f.on=Py("on"),f.off=Py("off");var a_,s_=(h(l_,a_=Bt),l_.prototype._onframe=function(){if(!this._disposed){o_(this);var t=this._scheduler;if(this[Iy]){var e=this[Iy].silent;this[Ey]=!0,zy(this),Uy.update.call(this),this._zr.flush(),this[Ey]=!1,this[Iy]=!1,jy.call(this,e),Yy.call(this,e)}else if(t.unfinished){var n=1,r=this._model,i=this._api;t.unfinished=!1;do{var o=+new Date}while(t.performSeriesTasks(r),t.performDataProcessorTasks(r),Wy(this,r),t.performVisualTasks(r),$y(this,this._model,i,"remain"),0<(n-=+new Date-o)&&t.unfinished);t.unfinished||this._zr.flush()}}},l_.prototype.getDom=function(){return this._dom},l_.prototype.getId=function(){return this.id},l_.prototype.getZr=function(){return this._zr},l_.prototype.setOption=function(t,e,n){var r,i,o,a,s;this._disposed?f_(this.id):(My(e)&&(n=e.lazyUpdate,r=e.silent,i=e.replaceMerge,o=e.transition,e=e.notMerge),this[Ey]=!0,this._model&&!e||(a=new yp(this._api),s=this._theme,(e=this._model=new hp).scheduler=this._scheduler,e.init(null,null,null,s,this._locale,a)),this._model.setOption(t,{replaceMerge:i},__),r_(this,o),n?(this[Iy]={silent:r},this[Ey]=!1,this.getZr().wakeUp()):(zy(this),Uy.update.call(this),this._zr.flush(),this[Iy]=!1,this[Ey]=!1,jy.call(this,r),Yy.call(this,r)))},l_.prototype.setTheme=function(){console.error("ECharts#setTheme() is DEPRECATED in ECharts 3.0")},l_.prototype.getModel=function(){return this._model},l_.prototype.getOption=function(){return this._model&&this._model.getOption()},l_.prototype.getWidth=function(){return this._zr.getWidth()},l_.prototype.getHeight=function(){return this._zr.getHeight()},l_.prototype.getDevicePixelRatio=function(){return this._zr.painter.dpr||Cy&&window.devicePixelRatio||1},l_.prototype.getRenderedCanvas=function(t){if(g.canvasSupported)return(t=R({},t||{})).pixelRatio=t.pixelRatio||this.getDevicePixelRatio(),t.backgroundColor=t.backgroundColor||this._model.get("backgroundColor"),this._zr.painter.getRenderedCanvas(t)},l_.prototype.getSvgDataURL=function(){if(g.svgSupported){var t=this._zr;return F(t.storage.getDisplayList(),(function(t){t.stopAnimation(null,!0)})),t.painter.toDataURL()}},l_.prototype.getDataURL=function(t){if(!this._disposed){var e=(t=t||{}).excludeComponents,n=this._model,r=[],i=this;return wy(e,(function(t){n.eachComponent({mainType:t},(function(t){t=i._componentsMap[t.__viewId],t.group.ignore||(r.push(t),t.group.ignore=!0)}))})),t="svg"===this._zr.painter.getType()?this.getSvgDataURL():this.getRenderedCanvas(t).toDataURL("image/"+(t&&t.type||"png")),wy(r,(function(t){t.group.ignore=!1})),t}f_(this.id)},l_.prototype.getConnectedDataURL=function(t){if(this._disposed)f_(this.id);else if(g.canvasSupported){var e="svg"===t.type,n=this.group,r=Math.min,i=Math.max;if(M_[n]){var o=1/0,a=1/0,s=-1/0,l=-1/0,u=[],h=t&&t.pixelRatio||this.getDevicePixelRatio();F(S_,(function(h,c){var d;h.group===n&&(d=e?h.getZr().painter.getSvgDom().innerHTML:h.getRenderedCanvas(I(t)),h=h.getDom().getBoundingClientRect(),o=r(h.left,o),a=r(h.top,a),s=i(h.right,s),l=i(h.bottom,l),u.push({dom:d,left:h.left,top:h.top}))}));var c=(s*=h)-(o*=h),d=(l*=h)-(a*=h),p=O(),f=si(p,{renderer:e?"svg":"canvas"});if(f.resize({width:c,height:d}),e){var m="";return wy(u,(function(t){var e=t.left-o,n=t.top-a;m+='<g transform="translate('+e+","+n+')">'+t.dom+"</g>"})),f.painter.getSvgRoot().innerHTML=m,t.connectedBackgroundColor&&f.painter.setBackgroundColor(t.connectedBackgroundColor),f.refreshImmediately(),f.painter.toDataURL()}return t.connectedBackgroundColor&&f.add(new bs({shape:{x:0,y:0,width:c,height:d},style:{fill:t.connectedBackgroundColor}})),wy(u,(function(t){t=new cs({style:{x:t.left*h-o,y:t.top*h-a,image:t.dom}}),f.add(t)})),f.refreshImmediately(),p.toDataURL("image/"+(t&&t.type||"png"))}return this.getDataURL(t)}},l_.prototype.convertToPixel=function(t,e){return Gy(this,"convertToPixel",t,e)},l_.prototype.convertFromPixel=function(t,e){return Gy(this,"convertFromPixel",t,e)},l_.prototype.containPixel=function(t,e){var n;if(!this._disposed)return F(Yi(this._model,t),(function(t,r){0<=r.indexOf("Models")&&F(t,(function(t){var i,o=t.coordinateSystem;o&&o.containPoint?n=n||!!o.containPoint(e):"seriesModels"===r&&(i=this._chartsMap[t.__viewId])&&i.containPoint&&(n=n||i.containPoint(e,t))}),this)}),this),!!n;f_(this.id)},l_.prototype.getVisual=function(t,e){var n=Yi(this._model,t,{defaultMainType:"series"});return t=n.seriesModel.getData(),n=n.hasOwnProperty("dataIndexInside")?n.dataIndexInside:n.hasOwnProperty("dataIndex")?t.indexOfRawIndex(n.dataIndex):null,null!=n?am(t,n,e):sm(t,e)},l_.prototype.getViewOfComponentModel=function(t){return this._componentsMap[t.__viewId]},l_.prototype.getViewOfSeriesModel=function(t){return this._chartsMap[t.__viewId]},l_.prototype._initEvents=function(){var t,e,n,r=this;wy(p_,(function(t){function e(e){var n,i,o,a=r.getModel(),s=e.target;"globalout"===t?n={}:s&&Um(s,(function(t){var e=Ps(t);return e&&null!=e.dataIndex?(t=e.dataModel||a.getSeriesByIndex(e.seriesIndex),n=t&&t.getDataParams(e.dataIndex,e.dataType)||{},1):e.eventData&&(n=R({},e.eventData),1)}),!0),n&&(i=n.componentType,o=n.componentIndex,"markLine"!==i&&"markPoint"!==i&&"markArea"!==i||(i="series",o=n.seriesIndex),o=(i=i&&null!=o&&a.getComponent(i,o))&&r["series"===i.mainType?"_chartsMap":"_componentsMap"][i.__viewId],n.event=e,n.type=t,r._$eventProcessor.eventInfo={targetEl:s,packedEvent:n,model:i,view:o},r.trigger(t,n))}e.zrEventfulCallAtLast=!0,r._zr.on(t,e,r)})),wy(m_,(function(t,e){r._messageCenter.on(e,(function(t){this.trigger(e,t)}),r)})),wy(["selectchanged"],(function(t){r._messageCenter.on(t,(function(e){this.trigger(t,e)}),r)})),t=this._messageCenter,n=(e=this)._api,t.on("selectchanged",(function(t){var r=n.getModel();t.isFromClick?(Vm("map","selectchanged",e,r,t),Vm("pie","selectchanged",e,r,t)):"select"===t.fromAction?(Vm("map","selected",e,r,t),Vm("pie","selected",e,r,t)):"unselect"===t.fromAction&&(Vm("map","unselected",e,r,t),Vm("pie","unselected",e,r,t))}))},l_.prototype.isDisposed=function(){return this._disposed},l_.prototype.clear=function(){this._disposed?f_(this.id):this.setOption({series:[]},!0)},l_.prototype.dispose=function(){var t,e;this._disposed?f_(this.id):(this._disposed=!0,Qi(this.getDom(),C_,""),t=this._api,e=this._model,wy(this._componentsViews,(function(n){n.dispose(e,t)})),wy(this._chartsViews,(function(n){n.dispose(e,t)})),this._zr.dispose(),delete S_[this.id])},l_.prototype.resize=function(t){var e;this._disposed?f_(this.id):(this._zr.resize(t),e=this._model,this._loadingFX&&this._loadingFX.resize(),e&&(e=e.resetOption("media"),t=t&&t.silent,this[Ey]=!0,e&&zy(this),Uy.update.call(this,{type:"resize",animation:{duration:0}}),this[Ey]=!1,jy.call(this,t),Yy.call(this,t)))},l_.prototype.showLoading=function(t,e){this._disposed?f_(this.id):(My(t)&&(e=t,t=""),t=t||"default",this.hideLoading(),w_[t]&&(t=w_[t](this._api,e),e=this._zr,this._loadingFX=t,e.add(t)))},l_.prototype.hideLoading=function(){this._disposed?f_(this.id):(this._loadingFX&&this._zr.remove(this._loadingFX),this._loadingFX=null)},l_.prototype.makeActionFromEvent=function(t){var e=R({},t);return e.type=m_[t.type],e},l_.prototype.dispatchAction=function(t,e){var n;this._disposed?f_(this.id):(My(e)||(e={silent:!!e}),g_[t.type]&&this._model&&(this[Ey]?this._pendingActions.push(t):(n=e.silent,Xy.call(this,t,n),(e=e.flush)?this._zr.flush():!1!==e&&g.browser.weChat&&this._throttledZrFlush(),jy.call(this,n),Yy.call(this,n))))},l_.prototype.updateLabelLayout=function(){var t=this._labelManager;t.updateLayoutConfig(this._api),t.layout(this._api),t.processLabelsOverall()},l_.prototype.appendData=function(t){var e;this._disposed?f_(this.id):(e=t.seriesIndex,this.getModel().getSeriesByIndex(e).appendData(t),this._scheduler.unfinished=!0,this.getZr().wakeUp())},l_.internalField=(zy=function(t){var e=t._scheduler;e.restorePipelines(t._model),e.prepareStageTasks(),Hy(t,!0),Hy(t,!1),e.plan()},Hy=function(t,e){for(var n=t._model,r=t._scheduler,i=e?t._componentsViews:t._chartsViews,o=e?t._componentsMap:t._chartsMap,a=t._zr,s=t._api,l=0;l<i.length;l++)i[l].__alive=!1;function u(t){var l=t.__requireNewView;t.__requireNewView=!1;var u="_ec_"+t.id+"_"+t.type,h=!l&&o[u];h||(l=no(t.type),(h=new(e?gg.getClass(l.main,l.sub):Mg.getClass(l.sub))).init(n,s),o[u]=h,i.push(h),a.add(h.group)),t.__viewId=h.__id=u,h.__alive=!0,h.__model=t,h.group.__ecComponentInfo={mainType:t.mainType,index:t.componentIndex},e||r.prepareView(h,t,n,s)}for(e?n.eachComponent((function(t,e){"series"!==t&&u(e)})):n.eachSeries(u),l=0;l<i.length;){var h=i[l];h.__alive?l++:(e||h.renderTask.dispose(),a.remove(h.group),h.dispose(n,s),i.splice(l,1),o[h.__id]===h&&delete o[h.__id],h.__id=h.group.__ecComponentInfo=null)}},Vy=function(t,e,n,r,i){var o,a,s=t._model;function l(r){r&&r.__alive&&r[e]&&r[e](r.__model,s,t._api,n)}s.setUpdatePayload(n),r?((o={})[r+"Id"]=n[r+"Id"],o[r+"Index"]=n[r+"Index"],o[r+"Name"]=n[r+"Name"],o={mainType:r,query:o},i&&(o.subType=i),null!=(i=n.excludeSeriesId)&&(a=pt(),wy(Oi(i),(function(t){t=Hi(t,null),null!=t&&a.set(t,!0)}))),s&&s.eachComponent(o,(function(e){var i,o,s,u;a&&null!=a.get(e.id)||(El(n)&&!n.notBlur?e instanceof pg&&function(t,e,n){if(El(e)){var r,i=e.type===Xs,o=t.seriesIndex,a=t.getData(e.dataType),s=(e=(X(e=Wi(a,e))?e[0]:e)||0,a.getItemGraphicEl(e));if(!s)for(var l=a.count(),u=0;!s&&u<l;)s=a.getItemGraphicEl(u++);s?vl(o,(r=Ps(s)).focus,r.blurScope,n,i):(r=t.get(["emphasis","focus"]),t=t.get(["emphasis","blurScope"]),null!=r&&vl(o,r,t,n,i))}}(e,n,t._api):Cl(n)&&e instanceof pg&&(i=e,o=n,t._api,Cl(o)&&(s=o.dataType,X(u=Wi(i.getData(s),o))||(u=[u]),i[o.type===qs?"toggleSelect":o.type===Ys?"select":"unselect"](u,s)),xl(e),i_(t)),l(t["series"===r?"_chartsMap":"_componentsMap"][e.__viewId]))}),t)):wy([].concat(t._componentsViews).concat(t._chartsViews),l)},Uy={prepareAndUpdate:function(t){zy(this),Uy.update.call(this,t)},update:function(t){var e=this._model,n=this._api,r=this._zr,i=this._coordSysMgr,o=this._scheduler;e&&(e.setUpdatePayload(t),o.restoreData(e,t),o.performSeriesTasks(e),i.create(e,n),o.performDataProcessorTasks(e,t),Wy(this,e),i.update(e,n),Ky(e),o.performVisualTasks(e,t),Qy(this,e,n,t),o=e.get("backgroundColor")||"transparent",t=e.get("darkMode"),g.canvasSupported?(r.setBackgroundColor(o),null!=t&&"auto"!==t&&r.setDarkMode(t)):(o=cn(t=tn(o),"rgb"),0===t[3]&&(o="transparent")),t_(e,n))},updateTransform:function(t){var e,n,r=this,i=this._model,o=this._api;i&&(i.setUpdatePayload(t),e=[],i.eachComponent((function(n,a){"series"===n||(n=r.getViewOfComponentModel(a))&&n.__alive&&(!n.updateTransform||(a=n.updateTransform(a,i,o,t))&&a.update)&&e.push(n)})),n=pt(),i.eachSeries((function(e){var a=r._chartsMap[e.__viewId];(!a.updateTransform||(a=a.updateTransform(e,i,o,t))&&a.update)&&n.set(e.uid,1)})),Ky(i),this._scheduler.performVisualTasks(i,t,{setDirty:!0,dirtyMap:n}),$y(this,i,o,t,n),t_(i,this._api))},updateView:function(t){var e=this._model;e&&(e.setUpdatePayload(t),Mg.markUpdateMethod(t,"updateView"),Ky(e),this._scheduler.performVisualTasks(e,t,{setDirty:!0}),Qy(this,this._model,this._api,t),t_(e,this._api))},updateVisual:function(t){var e=this,n=this._model;n&&(n.setUpdatePayload(t),n.eachSeries((function(t){t.getData().clearAllVisual()})),Mg.markUpdateMethod(t,"updateVisual"),Ky(n),this._scheduler.performVisualTasks(n,t,{visualType:"visual",setDirty:!0}),n.eachComponent((function(r,i){"series"===r||(r=e.getViewOfComponentModel(i))&&r.__alive&&r.updateVisual(i,n,e._api,t)})),n.eachSeries((function(r){e._chartsMap[r.__viewId].updateVisual(r,n,e._api,t)})),t_(n,this._api))},updateLayout:function(t){Uy.update.call(this,t)}},Gy=function(t,e,n,r){if(t._disposed)f_(t.id);else for(var i,o=t._model,a=t._coordSysMgr.getCoordinateSystems(),s=Yi(o,n),l=0;l<a.length;l++){var u=a[l];if(u[e]&&null!=(i=u[e](o,s,r)))return i}},Wy=function(t,e){var n=t._chartsMap,r=t._scheduler;e.eachSeries((function(t){r.updateStreamModes(t,n[t.__viewId])}))},Xy=function(t,e){var n=this,r=this.getModel(),i=t.type,o=t.escapeConnect,a=g_[i],s=a.actionInfo,l=(s.update||"update").split(":"),u=l.pop(),h=null!=l[0]&&no(l[0]);this[Ey]=!0;var c=[t],d=!1;t.batch&&(d=!0,c=z(t.batch,(function(e){return(e=L(R({},e),t)).batch=null,e})));var p,f,g=[],m=(l=Cl(t),El(t)||l);wy(c,(function(t){(p=(p=a.action(t,n._model,n._api))||R({},t)).type=s.event||p.type,g.push(p),m?(Vy(n,u,t,"series"),i_(n)):h&&Vy(n,u,t,h.main,h.sub)})),"none"===u||m||h||(this[Iy]?(zy(this),Uy.update.call(this,t),this[Iy]=!1):Uy[u].call(this,t)),p=d?{type:s.event||i,escapeConnect:o,batch:g}:g[0],this[Ey]=!1,e||((e=this._messageCenter).trigger(p.type,p),l&&(r={type:"selectchanged",escapeConnect:o,selected:(f=[],r.eachSeries((function(t){F(t.getAllData(),(function(e){e.data;var n=e.type;e=t.getSelectedDataIndices();0<e.length&&(e={dataIndex:e,seriesIndex:t.seriesIndex},null!=n&&(e.dataType=n),f.push(e))}))})),f),isFromClick:t.isFromClick||!1,fromAction:t.type,fromActionPayload:t},e.trigger(r.type,r)))},jy=function(t){for(var e=this._pendingActions;e.length;){var n=e.shift();Xy.call(this,n,t)}},Yy=function(t){t||this.trigger("updated")},Zy=function(t,e){t.on("rendered",(function(n){e.trigger("rendered",n),!t.animation.isFinished()||e[Iy]||e._scheduler.unfinished||e._pendingActions.length||e.trigger("finished")}))},qy=function(t,e){t.on("mouseover",(function(t){var n,r=Um(t.target,Al);r&&(vl((n=Ps(r)).seriesIndex,n.focus,n.blurScope,e._api,!0),_l(r=r,t)||r.__highByOuter||sl(r,tl),i_(e))})).on("mouseout",(function(t){var n,r=Um(t.target,Al);r&&(vl((n=Ps(r)).seriesIndex,n.focus,n.blurScope,e._api,!1),_l(r=r,t)||r.__highByOuter||sl(r,el),i_(e))})).on("click",(function(t){var n=Um(t.target,(function(t){return null!=Ps(t).dataIndex}),!0);n&&(t=n.selected?"unselect":"select",n=Ps(n),e._api.dispatchAction({type:t,dataType:n.dataType,dataIndexInside:n.dataIndex,seriesIndex:n.seriesIndex,isFromClick:!0}))}))},Ky=function(t){t.clearColorPalette(),t.eachSeries((function(t){t.clearColorPalette()}))},Qy=function(t,e,n,r){Jy(t,e,n,r),wy(t._chartsViews,(function(t){t.__alive=!1})),$y(t,e,n,r),wy(t._chartsViews,(function(t){t.__alive||t.remove(e,n)}))},Jy=function(t,e,n,r,i){wy(i||t._componentsViews,(function(t){var i=t.__model;c_(0,t),t.render(i,e,n,r),h_(i,t),d_(i,t)}))},$y=function(t,e,n,r,i){var o=t._scheduler,a=t._labelManager;a.clearLabels();var s,l,u=!1;e.eachSeries((function(e){var n=t._chartsMap[e.__viewId];n.__alive=!0;var s=n.renderTask;o.updatePayload(s,r),c_(0,n),i&&i.get(e.uid)&&s.dirty(),s.perform(o.getPerformArgs(s))&&(u=!0),e.__transientTransitionOpt=null,n.group.silent=!!e.get("silent"),function(t,e){var n=t.get("blendMode")||null;e.group.traverse((function(t){t.isGroup||(t.style.blend=n),t.eachPendingDisplayable&&t.eachPendingDisplayable((function(t){t.style.blend=n}))}))}(e,n),xl(e),a.addLabelsOfSeries(n)})),o.unfinished=u||o.unfinished,a.updateLayoutConfig(n),a.layout(n),a.processLabelsOverall(),e.eachSeries((function(e){var n=t._chartsMap[e.__viewId];h_(e,n),d_(e,n)})),n=e,e=(s=t)._zr.storage,l=0,e.traverse((function(t){t.isGroup||l++})),l>n.get("hoverLayerThreshold")&&!g.node&&!g.worker&&n.eachSeries((function(t){t.preventUsingHoverLayer||(t=s._chartsMap[t.__viewId]).__alive&&t.group.traverse((function(t){t.states.emphasis&&(t.states.emphasis.hoverLayer=!0)}))}))},t_=function(t,e){wy(x_,(function(n){n(t,e)}))},i_=function(t){t[Dy]=!0,t.getZr().wakeUp()},o_=function(t){t[Dy]&&(t.getZr().storage.traverse((function(t){Hh(t)||u_(t)})),t[Dy]=!1)},e_=function(t){return h(e,n=up),e.prototype.getCoordinateSystems=function(){return t._coordSysMgr.getCoordinateSystems()},e.prototype.getComponentByElement=function(e){for(;e;){var n=e.__ecComponentInfo;if(null!=n)return t._model.getComponent(n.mainType,n.index);e=e.parent}},e.prototype.enterEmphasis=function(e,n){dl(e,n),i_(t)},e.prototype.leaveEmphasis=function(e,n){pl(e,n),i_(t)},e.prototype.enterBlur=function(e){fl(e),i_(t)},e.prototype.leaveBlur=function(e){gl(e),i_(t)},e.prototype.enterSelect=function(e){ml(e),i_(t)},e.prototype.leaveSelect=function(e){yl(e),i_(t)},e.prototype.getModel=function(){return t.getModel()},e.prototype.getViewOfComponentModel=function(e){return t.getViewOfComponentModel(e)},e.prototype.getViewOfSeriesModel=function(e){return t.getViewOfSeriesModel(e)},new e(t);function e(){return null!==n&&n.apply(this,arguments)||this}var n},n_=function(t){function e(t,e){for(var n=0;n<t.length;n++)t[n][Ly]=e}wy(m_,(function(n,r){t._messageCenter.on(r,(function(n){var r,i;M_[t.group]&&0!==t[Ly]&&(n&&n.escapeConnect||(r=t.makeActionFromEvent(n),i=[],wy(S_,(function(e){e!==t&&e.group===t.group&&i.push(e)})),e(i,0),wy(i,(function(t){1!==t[Ly]&&t.dispatchAction(r)})),e(i,2)))}))}))},void(r_=function(t,e){var n=t._model;F(Oi(e),(function(t){var e,r=t.from,i=t.to;null==i&&xf(e);var o={includeMainTypes:["series"],enableAll:!1,enableNone:!1},a=r?Yi(n,r,o):null;o=Yi(n,i,o).seriesModel;null==o&&(e=""),null!=(e=a&&a.seriesModel!==o?"":e)&&xf(e),o.__transientTransitionOpt={from:r?r.dimension:null,to:i.dimension,dividingMethod:t.dividingMethod}}))})),l_);function l_(t,e,n){var r=a_.call(this,new im)||this;function i(t,e){return t.__prio-e.__prio}return r._chartsViews=[],r._chartsMap={},r._componentsViews=[],r._componentsMap={},r._pendingActions=[],n=n||{},"string"==typeof e&&(e=T_[e]),r._dom=t,t=r._zr=si(t,{renderer:n.renderer||"canvas",devicePixelRatio:n.devicePixelRatio,width:n.width,height:n.height,useDirtyRect:null!=n.useDirtyRect&&n.useDirtyRect}),r._throttledZrFlush=Ig(G(t.flush,t),17),(e=I(e))&&kp(e,!0),r._theme=e,r._locale=function(t){if(Y(t)){var e=Cc[t.toUpperCase()]||{};return t===Sc||t===Mc?I(e):D(I(e),I(Cc[Ac]),!1)}return D(I(t),I(Cc[Ac]),!1)}(n.locale||Ic),r._coordSysMgr=new fp,n=r._api=e_(r),Tr(b_,i),Tr(y_,i),r._scheduler=new Jg(r,n,y_,b_),r._messageCenter=new By,r._labelManager=new zm,r._initEvents(),r.resize=G(r.resize,r),t.animation.on("frame",r._onframe,r),Zy(t,r),qy(t,r),ut(r),r}function u_(t){for(var e=[],n=t.currentStates,r=0;r<n.length;r++){var i=n[r];"emphasis"!==i&&"blur"!==i&&"select"!==i&&e.push(i)}t.selected&&t.states.select&&e.push("select"),t.hoverState===Hs&&t.states.emphasis?e.push("emphasis"):t.hoverState===zs&&t.states.blur&&e.push("blur"),t.useStates(e)}function h_(t,e){var n,r;t.preventAutoZ||(n=t.get("z"),r=t.get("zlevel"),e.group.traverse((function(t){var e,i;t.isGroup||(null!=n&&(t.z=n),null!=r&&(t.zlevel=r),i=t.getTextContent(),e=t.getTextGuideLine(),i&&(i.z=t.z,i.zlevel=t.zlevel,i.z2=t.z2+2),e&&(i=t.textGuideLineConfig&&t.textGuideLineConfig.showAbove,e.z=t.z,e.zlevel=t.zlevel,e.z2=t.z2+(i?1:-1)))})))}function c_(t,e){e.group.traverse((function(t){var e,n;Hh(t)||(e=t.getTextContent(),n=t.getTextGuideLine(),t.stateTransition&&(t.stateTransition=null),e&&e.stateTransition&&(e.stateTransition=null),n&&n.stateTransition&&(n.stateTransition=null),t.hasState()?(t.prevStates=t.currentStates,t.clearStates()):t.prevStates&&(t.prevStates=null))}))}function d_(t,e){var n=t.getModel("stateAnimation"),r=t.isAnimationEnabled(),i=(t=n.get("duration"),0<t?{duration:t,delay:n.get("delay"),easing:n.get("easing")}:null);e.group.traverse((function(t){var e,n,o;t.states&&t.states.emphasis&&(Hh(t)||(t instanceof rs&&((o=Bs(n=t)).normalFill=n.style.fill,o.normalStroke=n.style.stroke,n=n.states.select||{},o.selectFill=n.style&&n.style.fill||null,o.selectStroke=n.style&&n.style.stroke||null),!t.__dirty||(e=t.prevStates)&&t.useStates(e),r&&(t.stateTransition=i,n=t.getTextContent(),e=t.getTextGuideLine(),n&&(n.stateTransition=i),e&&(e.stateTransition=i)),t.__dirty&&u_(t)))}))}wu=s_.prototype,wu.on=Oy("on"),wu.off=Oy("off"),wu.one=function(t,e,n){var r=this;this.on.call(this,t,(function n(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];e&&e.apply&&e.apply(this,i),r.off(t,n)}),n)};var p_=["click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","globalout","contextmenu"];function f_(){}var g_={},m_={},y_=[],__=[],v_=[],x_=[],b_=[],T_={},w_={},S_={},M_={},A_=+new Date,C_=(new Date,"_echarts_instance_");function E_(t,e,n){var r=I_(t);if(r)return r;var i=new s_(t,e,n);return i.id="ec_"+A_++,S_[i.id]=i,Qi(t,C_,i.id),n_(i),wy(v_,(function(t){t(i)})),i}function I_(t){return S_[(e=C_,(t=t).getAttribute?t.getAttribute(e):t[e])];var e}function D_(t,e){T_[t]=e}function R_(t){Ay(__,t)<0&&__.push(t)}function L_(t,e){F_(y_,t,e,2e3)}function O_(t){Ay(v_,t)<0&&t&&v_.push(t)}function P_(t){Ay(x_,t)<0&&t&&x_.push(t)}function N_(t,e,n){"function"==typeof e&&(n=e,e="");var r=My(t)?t.type:[t,t={event:e}][0];t.event=(t.event||r).toLowerCase(),e=t.event,m_[e]||(Ty(Ry.test(r)&&Ry.test(e)),g_[r]||(g_[r]={action:n,actionInfo:t}),m_[e]=r)}function k_(t,e){F_(b_,t,e,3e3,"visual")}var B_=[];function F_(t,e,n,r,i){(Sy(e)||My(e))&&(n=e,e=r),0<=Ay(B_,n)||(B_.push(n),(i=Jg.wrapStageHandler(n,i)).__prio=e,i.__raw=n,t.push(i))}function z_(t,e){w_[t]=e}f=function(t){var e=(t=I(t)).type;e||xf("");var n=e.split(":");2!==n.length&&xf("");var r=!1;"echarts"===n[0]&&(e=n[1],r=!0),t.__isBuiltIn=r,Of.set(e,t)},k_(2e3,Ql),k_(4500,ur),k_(4500,co),k_(2e3,M),k_(4500,S),k_(7e3,(function(t,e){t.eachRawSeries((function(n){var r;t.isSeriesFiltered(n)||((r=n.getData()).hasItemVisual()&&r.each((function(t){var n=r.getItemVisual(t,"decal");n&&(r.ensureUniqueItemVisual(t,"style").decal=xy(n,e))})),(n=r.getVisual("decal"))&&(r.getVisual("style").decal=xy(n,e)))}))})),R_(kp),L_(900,(function(t){var e=pt();t.eachSeries((function(t){var n,r=t.get("stack");r&&(n=e.get(r)||e.set(r,[]),(t={stackResultDimension:(r=t.getData()).getCalculationInfo("stackResultDimension"),stackedOverDimension:r.getCalculationInfo("stackedOverDimension"),stackedDimension:r.getCalculationInfo("stackedDimension"),stackedByDimension:r.getCalculationInfo("stackedByDimension"),isStackedByIndex:r.getCalculationInfo("isStackedByIndex"),data:r,seriesModel:t}).stackedDimension&&(t.isStackedByIndex||t.stackedByDimension)&&(n.length&&r.setCalculationInfo("stackedOnSeries",n[n.length-1].seriesModel),n.push(t)))})),e.each(Bp)})),z_("default",(function(t,e){L(e=e||{},{text:"loading",textColor:"#000",fontSize:12,fontWeight:"normal",fontStyle:"normal",fontFamily:"sans-serif",maskColor:"rgba(255, 255, 255, 0.8)",showSpinner:!0,color:"#5470c6",spinnerRadius:10,lineWidth:5,zlevel:0});var n=new ei,r=new bs({style:{fill:e.maskColor},zlevel:e.zlevel,z:1e4});n.add(r);var i,o=new Os({style:{text:e.text,fill:e.textColor,fontSize:e.fontSize,fontWeight:e.fontWeight,fontStyle:e.fontStyle,fontFamily:e.fontFamily}}),a=new bs({style:{fill:"none"},textContent:o,textConfig:{position:"right",distance:10},zlevel:e.zlevel,z:10001});return n.add(a),e.showSpinner&&((i=new Ju({shape:{startAngle:-Bg/2,endAngle:-Bg/2+.1,r:e.spinnerRadius},style:{stroke:e.color,lineCap:"round",lineWidth:e.lineWidth},zlevel:e.zlevel,z:10001})).animateShape(!0).when(1e3,{endAngle:3*Bg/2}).start("circularInOut"),i.animateShape(!0).when(1e3,{startAngle:3*Bg/2}).delay(300).start("circularInOut"),n.add(i)),n.resize=function(){var n=o.getBoundingRect().width,s=e.showSpinner?e.spinnerRadius:0,l=(t.getWidth()-2*s-(e.showSpinner&&n?10:0)-n)/2-(e.showSpinner&&n?0:5+n/2)+(e.showSpinner?0:n/2)+(n?0:s);n=t.getHeight()/2;e.showSpinner&&i.setShape({cx:l,cy:n}),a.setShape({x:l-s,y:n-s,width:2*s,height:2*s}),r.setShape({x:0,y:0,width:t.getWidth(),height:t.getHeight()})},n.resize(),n})),N_({type:Xs,event:Xs,update:Xs},mt),N_({type:js,event:js,update:js},mt),N_({type:Ys,event:Ys,update:Ys},mt),N_({type:Zs,event:Zs,update:Zs},mt),N_({type:qs,event:qs,update:qs},mt),D_("light",Pu),D_("dark",tr);var H_=[],V_={registerPreprocessor:R_,registerProcessor:L_,registerPostInit:O_,registerPostUpdate:P_,registerAction:N_,registerCoordinateSystem:function(t,e){fp.register(t,e)},registerLayout:function(t,e){F_(b_,t,e,1e3,"layout")},registerVisual:k_,registerTransform:f,registerLoading:z_,registerMap:function(t,e,n){nm.registerMap(t,e,n)},PRIORITY:Bo,ComponentModel:Ld,ComponentView:gg,SeriesModel:pg,ChartView:Mg,registerComponentModel:function(t){Ld.registerClass(t)},registerComponentView:function(t){gg.registerClass(t)},registerSeriesModel:function(t){pg.registerClass(t)},registerChartView:function(t){Mg.registerClass(t)},registerSubTypeDefaulter:function(t,e){Ld.registerSubTypeDefaulter(t,e)},registerPainter:function(t,e){ri[t]=e}};function U_(t){X(t)?F(t,(function(t){U_(t)})):0<=P(H_,t)||(H_.push(t),(t=j(t)?{install:t}:t).install(V_))}function G_(t){return null==t?0:t.length||1}function W_(t){return t}function X_(t,e,n,r,i,o){this._old=t,this._new=e,this._oldKeyGetter=n||W_,this._newKeyGetter=r||W_,this.context=i,this._diffModeMultiple="multiple"===o}var j_=(X_.prototype.add=function(t){return this._add=t,this},X_.prototype.update=function(t){return this._update=t,this},X_.prototype.updateManyToOne=function(t){return this._updateManyToOne=t,this},X_.prototype.updateOneToMany=function(t){return this._updateOneToMany=t,this},X_.prototype.remove=function(t){return this._remove=t,this},X_.prototype.execute=function(){this[this._diffModeMultiple?"_executeMultiple":"_executeOneToOne"]()},X_.prototype._executeOneToOne=function(){var t=this._old,e=this._new,n={},r=new Array(t.length),i=new Array(e.length);this._initIndexMap(t,null,r,"_oldKeyGetter"),this._initIndexMap(e,n,i,"_newKeyGetter");for(var o=0;o<t.length;o++){var a,s=r[o],l=n[s],u=G_(l);1<u?(a=l.shift(),1===l.length&&(n[s]=l[0]),this._update&&this._update(a,o)):1===u?(n[s]=null,this._update&&this._update(l,o)):this._remove&&this._remove(o)}this._performRestAdd(i,n)},X_.prototype._executeMultiple=function(){var t=this._old,e=this._new,n={},r={},i=[],o=[];this._initIndexMap(t,n,i,"_oldKeyGetter"),this._initIndexMap(e,r,o,"_newKeyGetter");for(var a=0;a<i.length;a++){var s=i[a],l=n[s],u=r[s],h=G_(l),c=G_(u);if(1<h&&1===c)this._updateManyToOne&&this._updateManyToOne(u,l),r[s]=null;else if(1===h&&1<c)this._updateOneToMany&&this._updateOneToMany(u,l),r[s]=null;else if(1===h&&1===c)this._update&&this._update(u,l),r[s]=null;else if(1<h)for(var d=0;d<h;d++)this._remove&&this._remove(l[d]);else this._remove&&this._remove(l)}this._performRestAdd(o,r)},X_.prototype._performRestAdd=function(t,e){for(var n=0;n<t.length;n++){var r=t[n],i=e[r],o=G_(i);if(1<o)for(var a=0;a<o;a++)this._add&&this._add(i[a]);else 1===o&&this._add&&this._add(i);e[r]=null}},X_.prototype._initIndexMap=function(t,e,n,r){for(var i=this._diffModeMultiple,o=0;o<t.length;o++){var a,s,l="_ec_"+this[r](t[o],o);i||(n[o]=l),e&&(0===(s=G_(a=e[l]))?(e[l]=o,i&&n.push(l)):1===s?e[l]=[a,o]:a.push(o))}},X_);function Y_(t){var e={},n=e.encode={},r=pt(),i=[],o=[],a=e.userOutput={dimensionNames:t.dimensions.slice(),encode:{}};F(t.dimensions,(function(e){var s,l,u=t.getDimensionInfo(e),h=u.coordDim;h&&(s=u.coordDimIndex,Z_(n,h)[s]=e,u.isExtraCoord||(r.set(h,1),"ordinal"===(l=u.type)||"time"===l||(i[0]=e),Z_(a.encode,h)[s]=u.index),u.defaultTooltip&&o.push(e)),Pd.each((function(t,e){var r=Z_(n,e);e=u.otherDims[e];null!=e&&!1!==e&&(r[e]=u.name)}))}));var s=[],l={};r.each((function(t,e){var r=n[e];l[e]=r[0],s=s.concat(r)})),e.dataDimsOnCoord=s,e.encodeFirstDimNotExtra=l;var u=n.label;return u&&u.length&&(i=u.slice()),u=n.tooltip,u&&u.length?o=u.slice():o.length||(o=i.slice()),n.defaultedLabel=i,n.defaultedTooltip=o,e}function Z_(t,e){return t.hasOwnProperty(e)||(t[e]=[]),t[e]}function q_(t){return"category"===t?"ordinal":"time"===t?"time":"float"}var K_,Q_,J_,$_,tv,ev,nv,rv,iv,ov,av,sv,lv,uv,hv=function(t){this.otherDims={},null!=t&&R(this,t)},cv=Math.floor,dv=K,pv=z,fv=(wu="undefined",{float:typeof Float64Array==wu?Array:Float64Array,int:typeof Int32Array==wu?Array:Int32Array,ordinal:Array,number:Array,time:Array}),gv=typeof Uint32Array==wu?Array:Uint32Array,mv=typeof Int32Array==wu?Array:Int32Array,yv=typeof Uint16Array==wu?Array:Uint16Array,_v=["hasItemOption","_nameList","_idList","_invertedIndicesMap","_rawData","_dimValueGetter","_count","_rawCount","_nameDimIdx","_idDimIdx","_nameRepeatCount"],vv=["_extent","_approximateExtent","_rawExtent"];function xv(t,e){this.type="list",this._count=0,this._rawCount=0,this._storage={},this._storageArr=[],this._nameList=[],this._idList=[],this._visual={},this._layout={},this._itemVisuals=[],this._itemLayouts=[],this._graphicEls=[],this._rawExtent={},this._extent={},this._approximateExtent={},this._calculationInfo={},this.hasItemOption=!0,this.TRANSFERABLE_METHODS=["cloneShallow","downSample","lttbDownSample","map"],this.CHANGABLE_METHODS=["filterSelf","selectRange"],this.DOWNSAMPLE_METHODS=["downSample","lttbDownSample"],this.getRawIndex=tv,t=t||["x","y"];for(var n={},r=[],i={},o=0;o<t.length;o++){var a=t[o],s=Y(a)?new hv({name:a}):a instanceof hv?a:new hv(a),l=s.name;s.type=s.type||"float",s.coordDim||(s.coordDim=l,s.coordDimIndex=0),a=s.otherDims=s.otherDims||{},r.push(l),(n[l]=s).index=o,s.createInvertedIndices&&(i[l]=[]),0===a.itemName&&(this._nameDimIdx=o,this._nameOrdinalMeta=s.ordinalMeta),0===a.itemId&&(this._idDimIdx=o,this._idOrdinalMeta=s.ordinalMeta)}this.dimensions=r,this._dimensionInfos=n,this.hostModel=e,this._dimensionsSummary=Y_(this),this._invertedIndicesMap=i,this.userOutput=this._dimensionsSummary.userOutput}function bv(t,e,n,r){return bf(t[r],this._dimensionInfos[e])}var Tv=(xv.prototype.getDimension=function(t){return"number"==typeof t||!isNaN(t)&&!this._dimensionInfos.hasOwnProperty(t)?this.dimensions[t]:t},xv.prototype.getDimensionInfo=function(t){return this._dimensionInfos[this.getDimension(t)]},xv.prototype.getDimensionsOnCoord=function(){return this._dimensionsSummary.dataDimsOnCoord.slice()},xv.prototype.mapDimension=function(t,e){var n=this._dimensionsSummary;return null==e?n.encodeFirstDimNotExtra[t]:(t=n.encode[t],t?t[e]:null)},xv.prototype.mapDimensionsAll=function(t){return(this._dimensionsSummary.encode[t]||[]).slice()},xv.prototype.initData=function(t,e,n){var r=Vp(t)||B(t)?new Zp(t,this.dimensions.length):t;t=(this._rawData=r).getSource().sourceFormat,this._storage={},this._indices=null,this._dontMakeIdFromName=null!=this._idDimIdx||t===zd||!!r.fillStorage,this._nameList=(e||[]).slice(),this._idList=[],this._nameRepeatCount={},n||(this.hasItemOption=!1),this.defaultDimValueGetter=K_[t],this._dimValueGetter=n=n||this.defaultDimValueGetter,this._dimValueGetterArrayRows=K_.arrayRows,this._rawExtent={},this._initDataFromProvider(0,r.count()),r.pure&&(this.hasItemOption=!1)},xv.prototype.getProvider=function(){return this._rawData},xv.prototype.appendData=function(t){var e=this._rawData,n=this.count();e.appendData(t),t=e.count(),e.persistent||(t+=n),this._initDataFromProvider(n,t,!0)},xv.prototype.appendValues=function(t,e){for(var n=this._storage,r=this.dimensions,i=r.length,o=this._rawExtent,a=this.count(),s=a+Math.max(t.length,e?e.length:0),l=0;l<i;l++){var u=r[l];o[u]||(o[u]=sv()),$_(n,this._dimensionInfos[u],s,!0)}for(var h=pv(r,(function(t){return o[t]})),c=this._storageArr=pv(r,(function(t){return n[t]})),d=[],p=a;p<s;p++){for(var f=p-a,g=0;g<i;g++){u=r[g];var m=this._dimValueGetterArrayRows(t[f]||d,u,f,g);c[g][p]=m;var y=h[g];m<y[0]&&(y[0]=m),m>y[1]&&(y[1]=m)}e&&(this._nameList[p]=e[f],this._dontMakeIdFromName||iv(this,p))}this._rawCount=this._count=s,this._extent={},Q_(this)},xv.prototype._initDataFromProvider=function(t,e,n){if(!(e<=t)){for(var r=this._rawData,i=this._storage,o=this.dimensions,a=o.length,s=this._dimensionInfos,l=this._nameList,u=this._idList,h=this._rawExtent,c=r.getSource().sourceFormat===Nd,d=0;d<a;d++){var p=o[d];h[p]||(h[p]=sv()),$_(i,s[p],e,n)}var f=this._storageArr=pv(o,(function(t){return i[t]})),g=pv(o,(function(t){return h[t]}));if(r.fillStorage)r.fillStorage(t,e,f,g);else for(var m=[],y=t;y<e;y++){m=r.getItem(y,m);for(var _,v=0;v<a;v++){p=o[v];var x=f[v],b=this._dimValueGetter(m,p,y,v);x[y]=b,x=g[v],b<x[0]&&(x[0]=b),b>x[1]&&(x[1]=b)}c&&!r.pure&&m&&(_=m.name,null==l[y]&&null!=_&&(l[y]=Hi(_,null)),_=m.id,null==u[y]&&null!=_&&(u[y]=Hi(_,null))),this._dontMakeIdFromName||iv(this,y)}!r.persistent&&r.clean&&r.clean(),this._rawCount=this._count=e,this._extent={},Q_(this)}},xv.prototype.count=function(){return this._count},xv.prototype.getIndices=function(){var t=this._indices;if(t){var e=t.constructor,n=this._count;if(e===Array)for(var r=new e(n),i=0;i<n;i++)r[i]=t[i];else r=new e(t.buffer,0,n)}else for(r=new(e=J_(this))(this.count()),i=0;i<r.length;i++)r[i]=i;return r},xv.prototype.getByDimIdx=function(t,e){return 0<=e&&e<this._count?(t=this._storageArr[t],t?t[this.getRawIndex(e)]:NaN):NaN},xv.prototype.get=function(t,e){return 0<=e&&e<this._count?(t=this._storage[t],t?t[this.getRawIndex(e)]:NaN):NaN},xv.prototype.getByRawIndex=function(t,e){return 0<=e&&e<this._rawCount?(t=this._storage[t],t?t[e]:NaN):NaN},xv.prototype.getValues=function(t,e){var n=[];X(t)||(e=t,t=this.dimensions);for(var r=0,i=t.length;r<i;r++)n.push(this.get(t[r],e));return n},xv.prototype.hasValue=function(t){for(var e=this._dimensionsSummary.dataDimsOnCoord,n=0,r=e.length;n<r;n++)if(isNaN(this.get(e[n],t)))return!1;return!0},xv.prototype.getDataExtent=function(t){t=this.getDimension(t);var e=this._storage[t],n=sv();if(!e)return n;var r=this.count();if(!this._indices)return this._rawExtent[t].slice();if(i=this._extent[t])return i.slice();for(var i,o=(i=n)[0],a=i[1],s=0;s<r;s++){var l=e[this.getRawIndex(s)];l<o&&(o=l),a<l&&(a=l)}return this._extent[t]=[o,a]},xv.prototype.getApproximateExtent=function(t){return t=this.getDimension(t),this._approximateExtent[t]||this.getDataExtent(t)},xv.prototype.setApproximateExtent=function(t,e){e=this.getDimension(e),this._approximateExtent[e]=t.slice()},xv.prototype.getCalculationInfo=function(t){return this._calculationInfo[t]},xv.prototype.setCalculationInfo=function(t,e){dv(t)?R(this._calculationInfo,t):this._calculationInfo[t]=e},xv.prototype.getSum=function(t){var e=0;if(this._storage[t])for(var n=0,r=this.count();n<r;n++){var i=this.get(t,n);isNaN(i)||(e+=i)}return e},xv.prototype.getMedian=function(t){var e=[];this.each(t,(function(t){isNaN(t)||e.push(t)}));var n=e.sort((function(t,e){return t-e}));t=this.count();return 0===t?0:t%2==1?n[(t-1)/2]:(n[t/2]+n[t/2-1])/2},xv.prototype.rawIndexOf=function(t,e){return e=(t&&this._invertedIndicesMap[t])[e],null==e||isNaN(e)?-1:e},xv.prototype.indexOfName=function(t){for(var e=0,n=this.count();e<n;e++)if(this.getName(e)===t)return e;return-1},xv.prototype.indexOfRawIndex=function(t){if(t>=this._rawCount||t<0)return-1;if(!this._indices)return t;var e=this._indices,n=e[t];if(null!=n&&n<this._count&&n===t)return t;for(var r=0,i=this._count-1;r<=i;){var o=(r+i)/2|0;if(e[o]<t)r=1+o;else{if(!(e[o]>t))return o;i=o-1}}return-1},xv.prototype.indicesOfNearest=function(t,e,n){var r=this._storage[t],i=[];if(!r)return i;null==n&&(n=1/0);for(var o=1/0,a=-1,s=0,l=0,u=this.count();l<u;l++){var h=e-r[this.getRawIndex(l)],c=Math.abs(h);c<=n&&((c<o||c===o&&0<=h&&a<0)&&(o=c,a=h,s=0),h===a&&(i[s++]=l))}return i.length=s,i},xv.prototype.getRawDataItem=function(t){if(this._rawData.persistent)return this._rawData.getItem(this.getRawIndex(t));for(var e=[],n=0;n<this.dimensions.length;n++){var r=this.dimensions[n];e.push(this.get(r,t))}return e},xv.prototype.getName=function(t){var e=this.getRawIndex(t);t=this._nameList[e];return null==(t=null==t&&null!=this._nameDimIdx?rv(this,this._nameDimIdx,this._nameOrdinalMeta,e):t)?"":t},xv.prototype.getId=function(t){return nv(this,this.getRawIndex(t))},xv.prototype.each=function(t,e,n,r){var i=this;if(this._count){"function"==typeof t&&(r=n,n=e,e=t,t=[]);for(var o=n||r||this,a=(t=pv(ov(t),this.getDimension,this),t.length),s=pv(t,(function(t){return i._dimensionInfos[t].index})),l=this._storageArr,u=0,h=this.count();u<h;u++){var c=this.getRawIndex(u);switch(a){case 0:e.call(o,u);break;case 1:e.call(o,l[s[0]][c],u);break;case 2:e.call(o,l[s[0]][c],l[s[1]][c],u);break;default:for(var d=0,p=[];d<a;d++)p[d]=l[s[d]][c];p[d]=u,e.apply(o,p)}}}},xv.prototype.filterSelf=function(t,e,n,r){var i=this;if(this._count){"function"==typeof t&&(r=n,n=e,e=t,t=[]);for(var o=n||r||this,a=(t=pv(ov(t),this.getDimension,this),this.count()),s=new(J_(this))(a),l=[],u=t.length,h=0,c=pv(t,(function(t){return i._dimensionInfos[t].index})),d=c[0],p=this._storageArr,f=0;f<a;f++){var g=void 0,m=this.getRawIndex(f);if(0===u)g=e.call(o,f);else if(1===u){var y=p[d][m];g=e.call(o,y,f)}else{for(var _=0;_<u;_++)l[_]=p[c[_]][m];l[_]=f,g=e.apply(o,l)}g&&(s[h++]=m)}return h<a&&(this._indices=s),this._count=h,this._extent={},this.getRawIndex=this._indices?ev:tv,this}},xv.prototype.selectRange=function(t){var e=this,n=this._count;if(n){var r,i=[];for(r in t)t.hasOwnProperty(r)&&i.push(r);var o=i.length;if(o){var a=this.count(),s=new(J_(this))(a),l=0,u=i[0],h=pv(i,(function(t){return e._dimensionInfos[t].index})),c=t[u][0],d=t[u][1],p=this._storageArr;u=!1;if(!this._indices){var f=0;if(1===o){for(var g=p[h[0]],m=0;m<n;m++)(c<=(x=g[m])&&x<=d||isNaN(x))&&(s[l++]=f),f++;u=!0}else if(2===o){g=p[h[0]];var y=p[h[1]],_=t[i[1]][0],v=t[i[1]][1];for(m=0;m<n;m++){var x=g[m],b=y[m];(c<=x&&x<=d||isNaN(x))&&(_<=b&&b<=v||isNaN(b))&&(s[l++]=f),f++}u=!0}}if(!u)if(1===o)for(m=0;m<a;m++){var T=this.getRawIndex(m);(c<=(x=p[h[0]][T])&&x<=d||isNaN(x))&&(s[l++]=T)}else for(m=0;m<a;m++){for(var w=!0,S=(T=this.getRawIndex(m),0);S<o;S++){var M=i[S];((x=p[h[S]][T])<t[M][0]||x>t[M][1])&&(w=!1)}w&&(s[l++]=this.getRawIndex(m))}return l<a&&(this._indices=s),this._count=l,this._extent={},this.getRawIndex=this._indices?ev:tv,this}}},xv.prototype.mapArray=function(t,e,n,r){"function"==typeof t&&(r=n,n=e,e=t,t=[]);var i=[];return this.each(t,(function(){i.push(e&&e.apply(this,arguments))}),n=n||r||this),i},xv.prototype.map=function(t,e,n,r){var i=n||r||this,o=pv(ov(t),this.getDimension,this),a=(t=av(this,o),t._storage);t._indices=this._indices,t.getRawIndex=t._indices?ev:tv;for(var s=[],l=o.length,u=this.count(),h=[],c=t._rawExtent,d=0;d<u;d++){for(var p=0;p<l;p++)h[p]=this.get(o[p],d);h[l]=d;var f=e&&e.apply(i,h);if(null!=f){"object"!=typeof f&&(s[0]=f,f=s);for(var g=this.getRawIndex(d),m=0;m<f.length;m++){var y=o[m],_=f[m],v=c[y];y=a[y];y&&(y[g]=_),_<v[0]&&(v[0]=_),_>v[1]&&(v[1]=_)}}}return t},xv.prototype.downSample=function(t,e,n,r){for(var i=av(this,[t]),o=i._storage,a=[],s=cv(1/e),l=o[t],u=this.count(),h=i._rawExtent[t],c=new(J_(this))(u),d=0,p=0;p<u;p+=s){u-p<s&&(a.length=s=u-p);for(var f=0;f<s;f++){var g=this.getRawIndex(p+f);a[f]=l[g]}var m=n(a),y=this.getRawIndex(Math.min(p+r(a,m)||0,u-1));(l[y]=m)<h[0]&&(h[0]=m),m>h[1]&&(h[1]=m),c[d++]=y}return i._count=d,i._indices=c,i.getRawIndex=ev,i},xv.prototype.lttbDownSample=function(t,e){var n,r=av(this,[]),i=r._storage[t],o=this.count(),a=new(J_(this))(o),s=0,l=cv(1/e),u=this.getRawIndex(0);a[s++]=u;for(var h=1;h<o-1;h+=l){for(var c=Math.min(h+l,o-1),d=Math.min(h+2*l,o),p=(d+c)/2,f=0,g=c;g<d;g++){var m=i[T=this.getRawIndex(g)];isNaN(m)||(f+=m)}f/=d-c;c=h;var y=Math.min(h+l,o),_=h-1,v=i[u],x=-1,b=c;for(g=c;g<y;g++){var T;m=i[T=this.getRawIndex(g)];isNaN(m)||x<(n=Math.abs((_-p)*(m-v)-(_-g)*(f-v)))&&(x=n,b=T)}u=a[s++]=b}return a[s++]=this.getRawIndex(o-1),r._count=s,r._indices=a,r.getRawIndex=ev,r},xv.prototype.getItemModel=function(t){var e=this.hostModel;t=this.getRawDataItem(t);return new xc(t,e,e&&e.ecModel)},xv.prototype.diff=function(t){var e=this;return new j_(t?t.getIndices():[],this.getIndices(),(function(e){return nv(t,e)}),(function(t){return nv(e,t)}))},xv.prototype.getVisual=function(t){var e=this._visual;return e&&e[t]},xv.prototype.setVisual=function(t,e){this._visual=this._visual||{},dv(t)?R(this._visual,t):this._visual[t]=e},xv.prototype.getItemVisual=function(t,e){return t=this._itemVisuals[t],t=t&&t[e],null==t?this.getVisual(e):t},xv.prototype.hasItemVisual=function(){return 0<this._itemVisuals.length},xv.prototype.ensureUniqueItemVisual=function(t,e){var n=this._itemVisuals,r=n[t];t=(r=r||(n[t]={}))[e];return null==t&&(X(t=this.getVisual(e))?t=t.slice():dv(t)&&(t=R({},t)),r[e]=t),t},xv.prototype.setItemVisual=function(t,e,n){var r=this._itemVisuals[t]||{};this._itemVisuals[t]=r,dv(e)?R(r,e):r[e]=n},xv.prototype.clearAllVisual=function(){this._visual={},this._itemVisuals=[]},xv.prototype.setLayout=function(t,e){if(dv(t))for(var n in t)t.hasOwnProperty(n)&&this.setLayout(n,t[n]);else this._layout[t]=e},xv.prototype.getLayout=function(t){return this._layout[t]},xv.prototype.getItemLayout=function(t){return this._itemLayouts[t]},xv.prototype.setItemLayout=function(t,e,n){this._itemLayouts[t]=n?R(this._itemLayouts[t]||{},e):e},xv.prototype.clearItemLayouts=function(){this._itemLayouts.length=0},xv.prototype.setItemGraphicEl=function(t,e){var n,r=this.hostModel;e&&((n=Ps(e)).dataIndex=t,n.dataType=this.dataType,n.seriesIndex=r&&r.seriesIndex,"group"===e.type&&e.traverse(lv,e)),this._graphicEls[t]=e},xv.prototype.getItemGraphicEl=function(t){return this._graphicEls[t]},xv.prototype.eachItemGraphicEl=function(t,e){F(this._graphicEls,(function(n,r){n&&t&&t.call(e,n,r)}))},xv.prototype.cloneShallow=function(t){if((t=t||new xv(pv(this.dimensions,this.getDimensionInfo,this),this.hostModel))._storage=this._storage,t._storageArr=this._storageArr,uv(t,this),this._indices){var e=this._indices.constructor;if(e===Array){var n=this._indices.length;t._indices=new e(n);for(var r=0;r<n;r++)t._indices[r]=this._indices[r]}else t._indices=new e(this._indices)}else t._indices=null;return t.getRawIndex=t._indices?ev:tv,t},xv.prototype.wrapMethod=function(t,e){var n=this[t];"function"==typeof n&&(this.__wrappedMethods=this.__wrappedMethods||[],this.__wrappedMethods.push(t),this[t]=function(){var t=n.apply(this,arguments);return e.apply(this,[t].concat(it(arguments)))})},xv.internalField=(K_={arrayRows:bv,objectRows:function(t,e,n,r){return bf(t[e],this._dimensionInfos[e])},keyedColumns:bv,original:function(t,e,n,r){var i=t&&(null==t.value?t:t.value);return this._rawData.pure||!K(t=t)||t instanceof Array||(this.hasItemOption=!0),bf(i instanceof Array?i[r]:i,this._dimensionInfos[e])},typedArray:function(t,e,n,r){return t[r]}},Q_=function(t){var e=t._invertedIndicesMap;F(e,(function(n,r){var i=t._dimensionInfos[r].ordinalMeta;if(i){n=e[r]=new mv(i.categories.length);for(var o=0;o<n.length;o++)n[o]=-1;for(o=0;o<t._count;o++)n[t.get(r,o)]=o}}))},rv=function(t,e,n,r){var i;e=t._storageArr[e];return e&&(i=e[r],n&&n.categories.length&&(i=n.categories[i])),Hi(i,null)},J_=function(t){return 65535<t._rawCount?gv:yv},$_=function(t,e,n,r){var i=fv[e.type];e=e.name;if(r){var o=t[e],a=o&&o.length;if(a!==n){for(var s=new i(n),l=0;l<a;l++)s[l]=o[l];t[e]=s}}else t[e]=new i(n)},tv=function(t){return t},ev=function(t){return t<this._count&&0<=t?this._indices[t]:-1},nv=function(t,e){var n=t._idList[e];return null==(n=null==n&&null!=t._idDimIdx?rv(t,t._idDimIdx,t._idOrdinalMeta,e):n)?"e\0\0"+e:n},ov=function(t){return X(t)?t:null!=t?[t]:[]},av=function(t,e){var n=t.dimensions,r=new xv(pv(n,t.getDimensionInfo,t),t.hostModel);uv(r,t);for(var i,o,a=r._storage={},s=t._storage,l=r._storageArr=[],u=0;u<n.length;u++){var h=n[u];s[h]&&(0<=P(e,h)?(a[h]=(i=s[h],o=void 0,(o=i.constructor)===Array?i.slice():new o(i)),r._rawExtent[h]=sv(),r._extent[h]=null):a[h]=s[h],l.push(a[h]))}return r},sv=function(){return[1/0,-1/0]},lv=function(t){var e=Ps(t);t=Ps(this);e.seriesIndex=t.seriesIndex,e.dataIndex=t.dataIndex,e.dataType=t.dataType},uv=function(t,e){F(_v.concat(e.__wrappedMethods||[]),(function(n){e.hasOwnProperty(n)&&(t[n]=e[n])})),t.__wrappedMethods=e.__wrappedMethods,F(vv,(function(n){t[n]=I(e[n])})),t._calculationInfo=R({},e._calculationInfo)},void(iv=function(t,e){var n=t._nameList,r=t._idList,i=t._nameDimIdx,o=t._idDimIdx,a=n[e],s=r[e];null==a&&null!=i&&(n[e]=a=rv(t,i,t._nameOrdinalMeta,e)),null==s&&null!=o&&(r[e]=s=rv(t,o,t._idOrdinalMeta,e)),null==s&&null!=a&&(s=a,1<(a=(t=t._nameRepeatCount)[a]=(t[a]||0)+1)&&(s+="__ec__"+a),r[e]=s)})),xv);function wv(t,e,n){if(n||null!=e.get(t)){for(var r=0;null!=e.get(t+r);)r++;t+=r}return e.set(t,!0),t}var Sv=function(t,e,n){Vp(e)||(e=Gp(e)),n=n||{},t=(t||[]).slice();for(var r,i,o,a=(n.dimsDef||[]).slice(),s=pt(),l=pt(),u=[],h=(r=e,g=t,i=n.dimCount,o=Math.max(r.dimensionsDetectedCount||1,g.length,a.length,i||0),F(g,(function(t){var e;K(t)&&(e=t.dimsDef)&&(o=Math.max(o,e.length))})),o),c=0;c<h;c++){var d=a[c],p=a[c]=R({},K(d)?d:{name:d}),f=(d=p.name,u[c]=new hv);null!=d&&null==s.get(d)&&(f.name=f.displayName=d,s.set(d,c)),null!=p.type&&(f.type=p.type),null!=p.displayName&&(f.displayName=p.displayName)}var g=n.encodeDef,m=pt(g=!g&&n.encodeDefaulter?n.encodeDefaulter(e,h):g);m.each((function(t,e){var n;t=Oi(t).slice();1===t.length&&!Y(t[0])&&t[0]<0?m.set(e,!1):(n=m.set(e,[]),F(t,(function(t,r){t=Y(t)?s.get(t):t,null!=t&&t<h&&(n[r]=t,_(u[t],e,r))})))}));var y=0;function _(t,e,n){null!=Pd.get(e)?t.otherDims[e]=n:(t.coordDim=e,t.coordDimIndex=n,l.set(e,!0))}F(t,(function(t){var e,n,r,i;Y(t)?(i=t,r={}):(i=(r=t).name,t=r.ordinalMeta,r.ordinalMeta=null,(r=I(r)).ordinalMeta=t,e=r.dimsDef,n=r.otherDims,r.name=r.coordDim=r.coordDimIndex=r.dimsDef=r.otherDims=null);var o=m.get(i);if(!1!==o){if(!(o=Oi(o)).length)for(var a=0;a<(e&&e.length||1);a++){for(;y<u.length&&null!=u[y].coordDim;)y++;y<u.length&&o.push(y++)}F(o,(function(t,o){t=u[t],_(L(t,r),i,o),null==t.name&&e&&(K(o=e[o])||(o={name:o}),t.name=t.displayName=o.name,t.defaultTooltip=o.defaultTooltip),n&&L(t.otherDims,n)}))}}));for(var v,x,b=n.generateCoord,T=null!=(w=n.generateCoordCount),w=b?w||1:0,S=b||"value",M=0;M<h;M++)null==(f=u[M]=u[M]||new hv).coordDim&&(f.coordDim=wv(S,l,T),f.coordDimIndex=0,(!b||w<=0)&&(f.isExtraCoord=!0),w--),null==f.name&&(f.name=wv(f.coordDim,s,!1)),null==f.type&&(x=M,Zd((v=e).data,v.sourceFormat,v.seriesLayoutBy,v.dimensionsDefine,v.startIndex,x)===Gd.Must||f.isExtraCoord&&(null!=f.otherDims.itemName||null!=f.otherDims.seriesName))&&(f.type="ordinal");return u};function Mv(t,e){return Sv((e=e||{}).coordDimensions||[],t,{dimsDef:e.dimensionsDefine||t.dimensionsDefine,encodeDef:e.encodeDefine||t.encodeDefine,dimCount:e.dimensionsCount,encodeDefaulter:e.encodeDefaulter,generateCoord:e.generateCoord,generateCoordCount:e.generateCoordCount})}var Av=function(t){this.coordSysDims=[],this.axisMap=pt(),this.categoryAxisMap=pt(),this.coordSysName=t},Cv={cartesian2d:function(t,e,n,r){var i=t.getReferringComponents("xAxis",Zi).models[0];t=t.getReferringComponents("yAxis",Zi).models[0];e.coordSysDims=["x","y"],n.set("x",i),n.set("y",t),Ev(i)&&(r.set("x",i),e.firstCategoryDimIndex=0),Ev(t)&&(r.set("y",t),null==e.firstCategoryDimIndex&&(e.firstCategoryDimIndex=1))},singleAxis:function(t,e,n,r){t=t.getReferringComponents("singleAxis",Zi).models[0],e.coordSysDims=["single"],n.set("single",t),Ev(t)&&(r.set("single",t),e.firstCategoryDimIndex=0)},polar:function(t,e,n,r){var i=t.getReferringComponents("polar",Zi).models[0];t=i.findAxisModel("radiusAxis"),i=i.findAxisModel("angleAxis");e.coordSysDims=["radius","angle"],n.set("radius",t),n.set("angle",i),Ev(t)&&(r.set("radius",t),e.firstCategoryDimIndex=0),Ev(i)&&(r.set("angle",i),null==e.firstCategoryDimIndex&&(e.firstCategoryDimIndex=1))},geo:function(t,e,n,r){e.coordSysDims=["lng","lat"]},parallel:function(t,e,n,r){var i=t.ecModel,o=(t=i.getComponent("parallel",t.get("parallelIndex")),e.coordSysDims=t.dimensions.slice());F(t.parallelAxisIndex,(function(t,a){var s=i.getComponent("parallelAxis",t);t=o[a];n.set(t,s),Ev(s)&&(r.set(t,s),null==e.firstCategoryDimIndex&&(e.firstCategoryDimIndex=a))}))}};function Ev(t){return"category"===t.get("type")}function Iv(t,e,n){var r,i,o,a,s,l,u=(n=n||{}).byIndex,h=n.stackedCoordDimension,c=!(!t||!t.get("stack"));return F(e,(function(t,n){Y(t)&&(e[n]=t={name:t}),c&&!t.isExtraCoord&&(u||r||!t.ordinalMeta||(r=t),i||"ordinal"===t.type||"time"===t.type||h&&h!==t.coordDim||(i=t))})),!i||u||r||(u=!0),i&&(o="__\0ecstackresult",a="__\0ecstackedover",r&&(r.createInvertedIndices=!0),s=i.coordDim,t=i.type,l=0,F(e,(function(t){t.coordDim===s&&l++})),e.push({name:o,coordDim:s,coordDimIndex:l,type:t,isExtraCoord:!0,isCalculationCoord:!0}),l++,e.push({name:a,coordDim:a,coordDimIndex:l,type:t,isExtraCoord:!0,isCalculationCoord:!0})),{stackedDimension:i&&i.name,stackedByDimension:r&&r.name,isStackedByIndex:u,stackedOverDimension:a,stackResultDimension:o}}function Dv(t,e){return!!e&&e===t.getCalculationInfo("stackedDimension")}function Rv(t,e){return Dv(t,e)?t.getCalculationInfo("stackResultDimension"):e}var Lv=function(t,e,n){n=n||{},Vp(t)||(t=Gp(t));var r,i,o=e.get("coordinateSystem"),a=(o=fp.get(o),function(t){var e=t.get("coordinateSystem"),n=new Av(e);if(e=Cv[e])return e(t,n,n.axisMap,n.categoryAxisMap),n}(e)),s=(s=a&&a.coordSysDims?z(a.coordSysDims,(function(t){var e={name:t};t=a.axisMap.get(t);return t&&(t=t.get("type"),e.type=q_(t)),e})):s)||o&&(o.getDimensionsInfo?o.getDimensionsInfo():o.dimensions.slice())||["x","y"];o=n.useEncodeDefaulter,o=Mv(t,{coordDimensions:s,generateCoord:n.generateCoord,encodeDefaulter:j(o)?o:o?W(Xd,s,e):null});return a&&F(o,(function(t,e){var o=t.coordDim;o=a.categoryAxisMap.get(o);o&&(null==r&&(r=e),t.ordinalMeta=o.getOrdinalMeta(),n.createInvertedIndices&&(t.createInvertedIndices=!0)),null!=t.otherDims.itemName&&(i=!0)})),i||null==r||(o[r].otherDims.itemName=0),s=Iv(e,o),(e=new Tv(o,e)).setCalculationInfo(s),s=null!=r&&function(t){if(t.sourceFormat===Nd)return t=function(t){for(var e=0;e<t.length&&null==t[e];)e++;return t[e]}(t.data||[]),null!=t&&!X(ki(t))}(t)?function(t,e,n,i){return i===r?n:this.defaultDimValueGetter(t,e,n,i)}:null,e.hasItemOption=!1,e.initData(t,null,s),e};Ov.prototype.getSetting=function(t){return this._setting[t]},Ov.prototype.unionExtent=function(t){var e=this._extent;t[0]<e[0]&&(e[0]=t[0]),t[1]>e[1]&&(e[1]=t[1])},Ov.prototype.unionExtentFromData=function(t,e){this.unionExtent(t.getApproximateExtent(e))},Ov.prototype.getExtent=function(){return this._extent.slice()},Ov.prototype.setExtent=function(t,e){var n=this._extent;isNaN(t)||(n[0]=t),isNaN(e)||(n[1]=e)},Ov.prototype.isInExtentRange=function(t){return this._extent[0]<=t&&this._extent[1]>=t},Ov.prototype.isBlank=function(){return this._isBlank},Ov.prototype.setBlank=function(t){this._isBlank=t},Ql=Ov;function Ov(t){this._setting=t||{},this._extent=[1/0,-1/0]}lo(Ql);var Pv=Ql;function Nv(t){this.categories=t.categories||[],this._needCollect=t.needCollect,this._deduplication=t.deduplication}function kv(t){return K(t)&&null!=t.value?t.value:t+""}var Bv=(Nv.createByAxisModel=function(t){var e=t.option;t=e.data,t=t&&z(t,kv);return new Nv({categories:t,needCollect:!t,deduplication:!1!==e.dedplication})},Nv.prototype.getOrdinal=function(t){return this._getOrCreateMap().get(t)},Nv.prototype.parseAndCollect=function(t){var e=this._needCollect;if("string"!=typeof t&&!e)return t;if(e&&!this._deduplication)return n=this.categories.length,this.categories[n]=t,n;var n,r=this._getOrCreateMap();return null==(n=r.get(t))&&(e?(n=this.categories.length,this.categories[n]=t,r.set(t,n)):n=NaN),n},Nv.prototype._getOrCreateMap=function(){return this._map||(this._map=pt(this.categories))},Nv),Fv=ci;function zv(t,e,n,r){var i={},o=t[1]-t[0];e=i.interval=Si(o/e,!0);return null!=n&&e<n&&(e=i.interval=n),null!=r&&r<e&&(e=i.interval=r),r=i.intervalPrecision=Hv(e),r=i.niceTickExtent=[Fv(Math.ceil(t[0]/e)*e,r),Fv(Math.floor(t[1]/e)*e,r)],r=r,t=t,isFinite(r[0])||(r[0]=t[0]),isFinite(r[1])||(r[1]=t[1]),Vv(r,0,t),Vv(r,1,t),r[0]>r[1]&&(r[0]=r[1]),i}function Hv(t){return fi(t)+2}function Vv(t,e,n){t[e]=Math.max(Math.min(t[e],n[1]),n[0])}function Uv(t,e){return t>=e[0]&&t<=e[1]}function Gv(t,e){return e[1]===e[0]?.5:(t-e[0])/(e[1]-e[0])}function Wv(t,e){return t*(e[1]-e[0])+e[0]}var Xv;h(jv,Xv=Pv),jv.prototype.parse=function(t){return"string"==typeof t?this._ordinalMeta.getOrdinal(t):Math.round(t)},jv.prototype.contain=function(t){return Uv(t=this.parse(t),this._extent)&&null!=this._ordinalMeta.categories[t]},jv.prototype.normalize=function(t){return Gv(t=this._getTickNumber(this.parse(t)),this._extent)},jv.prototype.scale=function(t){return t=Math.round(Wv(t,this._extent)),this.getRawOrdinalNumber(t)},jv.prototype.getTicks=function(){for(var t=[],e=this._extent,n=e[0];n<=e[1];)t.push({value:n}),n++;return t},jv.prototype.getMinorTicks=function(t){},jv.prototype.setSortInfo=function(t){if(null!=t){for(var e=t.ordinalNumbers,n=this._ordinalNumbersByTick=[],r=this._ticksByOrdinalNumber=[],i=0,o=this._ordinalMeta.categories.length,a=Math.min(o,e.length);i<a;++i){var s=e[i];r[n[i]=s]=i}for(var l=0;i<o;++i){for(;null!=r[l];)l++;n.push(l),r[l]=i}}else this._ordinalNumbersByTick=this._ticksByOrdinalNumber=null},jv.prototype._getTickNumber=function(t){var e=this._ticksByOrdinalNumber;return e&&0<=t&&t<e.length?e[t]:t},jv.prototype.getRawOrdinalNumber=function(t){var e=this._ordinalNumbersByTick;return e&&0<=t&&t<e.length?e[t]:t},jv.prototype.getLabel=function(t){if(!this.isBlank())return t=this.getRawOrdinalNumber(t.value),t=this._ordinalMeta.categories[t],null==t?"":t+""},jv.prototype.count=function(){return this._extent[1]-this._extent[0]+1},jv.prototype.unionExtentFromData=function(t,e){this.unionExtent(t.getApproximateExtent(e))},jv.prototype.isInExtentRange=function(t){return t=this._getTickNumber(t),this._extent[0]<=t&&this._extent[1]>=t},jv.prototype.getOrdinalMeta=function(){return this._ordinalMeta},jv.prototype.niceTicks=function(){},jv.prototype.niceExtent=function(){},jv.type="ordinal",ur=jv;function jv(t){var e=Xv.call(this,t)||this;return e.type="ordinal",t=e.getSetting("ordinalMeta"),X(t=t||new Bv({}))&&(t=new Bv({categories:z(t,(function(t){return K(t)?t.value:t}))})),e._ordinalMeta=t,e._extent=e.getSetting("extent")||[0,t.categories.length-1],e}Pv.registerClass(ur);var Yv,Zv=ur,qv=ci;h(Kv,Yv=Pv),Kv.prototype.parse=function(t){return t},Kv.prototype.contain=function(t){return Uv(t,this._extent)},Kv.prototype.normalize=function(t){return Gv(t,this._extent)},Kv.prototype.scale=function(t){return Wv(t,this._extent)},Kv.prototype.setExtent=function(t,e){var n=this._extent;isNaN(t)||(n[0]=parseFloat(t)),isNaN(e)||(n[1]=parseFloat(e))},Kv.prototype.unionExtent=function(t){var e=this._extent;t[0]<e[0]&&(e[0]=t[0]),t[1]>e[1]&&(e[1]=t[1]),this.setExtent(e[0],e[1])},Kv.prototype.getInterval=function(){return this._interval},Kv.prototype.setInterval=function(t){this._interval=t,this._niceExtent=this._extent.slice(),this._intervalPrecision=Hv(t)},Kv.prototype.getTicks=function(t){var e=this._interval,n=this._extent,r=this._niceExtent,i=this._intervalPrecision,o=[];if(!e)return o;n[0]<r[0]&&(t?o.push({value:qv(r[0]-e,i)}):o.push({value:n[0]}));for(var a=r[0];a<=r[1]&&(o.push({value:a}),(a=qv(a+e,i))!==o[o.length-1].value);)if(1e4<o.length)return[];var s=o.length?o[o.length-1].value:r[1];return n[1]>s&&(t?o.push({value:qv(s+e,i)}):o.push({value:n[1]})),o},Kv.prototype.getMinorTicks=function(t){for(var e=this.getTicks(!0),n=[],r=this.getExtent(),i=1;i<e.length;i++){for(var o=e[i],a=e[i-1],s=0,l=[],u=(o.value-a.value)/t;s<t-1;){var h=qv(a.value+(s+1)*u);h>r[0]&&h<r[1]&&l.push(h),s++}n.push(l)}return n},Kv.prototype.getLabel=function(t,e){return null==t?"":(e=e&&e.precision,null==e?e=fi(t.value)||0:"auto"===e&&(e=this._intervalPrecision),rd(qv(t.value,e,!0)))},Kv.prototype.niceTicks=function(t,e,n){t=t||5;var r=this._extent,i=r[1]-r[0];isFinite(i)&&(i<0&&r.reverse(),n=zv(r,t,e,n),this._intervalPrecision=n.intervalPrecision,this._interval=n.interval,this._niceExtent=n.niceTickExtent)},Kv.prototype.niceExtent=function(t){var e=this._extent;e[0]===e[1]&&(0!==e[0]?(n=e[0],t.fixMax||(e[1]+=n/2),e[0]-=n/2):e[1]=1);var n=e[1]-e[0];isFinite(n)||(e[0]=0,e[1]=1),this.niceTicks(t.splitNumber,t.minInterval,t.maxInterval),n=this._interval,t.fixMin||(e[0]=qv(Math.floor(e[0]/n)*n)),t.fixMax||(e[1]=qv(Math.ceil(e[1]/n)*n))},Kv.type="interval",co=Kv;function Kv(){var t=null!==Yv&&Yv.apply(this,arguments)||this;return t.type="interval",t._interval=0,t._intervalPrecision=2,t}Pv.registerClass(co);var Qv=co,Jv="__ec_stack_",$v="undefined"!=typeof Float32Array?Float32Array:Array;function tx(t){return t.get("stack")||Jv+t.seriesIndex}function ex(t){return t.dim+t.index}function nx(t,e){var n=[];return e.eachSeriesByType(t,(function(t){lx(t)&&!ux(t)&&n.push(t)})),n}function rx(t){var e=function(t){var e={};F(t,(function(t){var n=t.coordinateSystem.getBaseAxis();if("time"===n.type||"value"===n.type)for(var r=t.getData(),i=n.dim+"_"+n.index,o=r.mapDimension(n.dim),a=0,s=r.count();a<s;++a){var l=r.get(o,a);e[i]?e[i].push(l):e[i]=[l]}}));var n,r={};for(n in e)if(e.hasOwnProperty(n)){var i=e[n];if(i){i.sort((function(t,e){return t-e}));for(var o=null,a=1;a<i.length;++a){var s=i[a]-i[a-1];0<s&&(o=null===o?s:Math.min(o,s))}r[n]=o}}return r}(t),n=[];return F(t,(function(t){var r,i=t.coordinateSystem.getBaseAxis(),o=i.getExtent();r="category"===i.type?i.getBandWidth():"value"===i.type||"time"===i.type?(a=i.dim+"_"+i.index,s=e[a],l=Math.abs(o[1]-o[0]),r=i.scale.getExtent(),a=Math.abs(r[1]-r[0]),s?l/a*s:l):(u=t.getData(),Math.abs(o[1]-o[0])/u.count());var a=hi(t.get("barWidth"),r),s=hi(t.get("barMaxWidth"),r),l=hi(t.get("barMinWidth")||1,r),u=(o=t.get("barGap"),t.get("barCategoryGap"));n.push({bandWidth:r,barWidth:a,barMaxWidth:s,barMinWidth:l,barGap:o,barCategoryGap:u,axisKey:ex(i),stackId:tx(t)})})),ix(n)}function ix(t){var e={};F(t,(function(t,n){var r=t.axisKey,i=t.bandWidth,o=e[r]||{bandWidth:i,remainedWidth:i,autoWidthCount:0,categoryGap:null,gap:"20%",stacks:{}},a=o.stacks;e[r]=o,i=t.stackId,a[i]||o.autoWidthCount++,a[i]=a[i]||{width:0,maxWidth:0},r=t.barWidth,r&&!a[i].width&&(a[i].width=r,r=Math.min(o.remainedWidth,r),o.remainedWidth-=r),r=t.barMaxWidth,r&&(a[i].maxWidth=r),r=t.barMinWidth,r&&(a[i].minWidth=r),r=t.barGap,null!=r&&(o.gap=r),t=t.barCategoryGap,null!=t&&(o.categoryGap=t)}));var n={};return F(e,(function(t,e){n[e]={};var r,i=t.stacks,o=t.bandWidth,a=t.categoryGap;null==a&&(r=U(i).length,a=Math.max(35-4*r,15)+"%");a=hi(a,o);var s=hi(t.gap,1),l=t.remainedWidth,u=t.autoWidthCount,h=(l-a)/(u+(u-1)*s);h=Math.max(h,0);F(i,(function(t){var e,n=t.maxWidth,r=t.minWidth;t.width?(e=t.width,n&&(e=Math.min(e,n)),r&&(e=Math.max(e,r)),t.width=e,l-=e+s*e,u--):(e=h,n&&n<e&&(e=Math.min(n,l)),(e=r&&e<r?r:e)!==h&&(t.width=e,l-=e+s*e,u--))})),h=(l-a)/(u+(u-1)*s),h=Math.max(h,0);var c,d=0;F(i,(function(t,e){t.width||(t.width=h),d+=(c=t).width*(1+s)})),c&&(d-=c.width*s);var p=-d/2;F(i,(function(t,r){n[e][r]=n[e][r]||{bandWidth:o,offset:p,width:t.width},p+=t.width*(1+s)}))})),n}function ox(t,e,n){if(t&&e)return e=t[ex(e)],null!=e&&null!=n?e[tx(n)]:e}function ax(t,e){e=nx(t,e);var n=rx(e),r={};F(e,(function(t){var e=t.getData(),i=t.coordinateSystem,o=i.getBaseAxis(),a=tx(t),s=n[ex(o)][a],l=s.offset,u=s.width,h=i.getOtherAxis(o),c=t.get("barMinHeight")||0;r[a]=r[a]||[],e.setLayout({bandWidth:s.bandWidth,offset:l,size:u});for(var d=e.mapDimension(h.dim),p=e.mapDimension(o.dim),f=Dv(e,d),g=h.isHorizontal(),m=hx(0,h),y=0,_=e.count();y<_;y++){var v=e.get(d,y),x=e.get(p,y),b=0<=v?"p":"n",T=m;f&&(r[a][x]||(r[a][x]={p:m,n:m}),T=r[a][x][b]);var w,S=void 0,M=void 0,A=void 0,C=void 0;g?(S=T,M=(w=i.dataToPoint([v,x]))[1]+l,A=w[0]-m,C=u,Math.abs(A)<c&&(A=(A<0?-1:1)*c),isNaN(A)||f&&(r[a][x][b]+=A)):(S=(w=i.dataToPoint([x,v]))[0]+l,M=T,A=u,C=w[1]-m,Math.abs(C)<c&&(C=(C<=0?-1:1)*c),isNaN(C)||f&&(r[a][x][b]+=C)),e.setItemLayout(y,{x:S,y:M,width:A,height:C})}}))}var sx={seriesType:"bar",plan:mg(),reset:function(t){if(lx(t)&&ux(t)){var e=t.getData(),n=t.coordinateSystem,r=n.master.getRect(),i=n.getBaseAxis(),o=n.getOtherAxis(i),a=e.mapDimension(o.dim),s=e.mapDimension(i.dim),l=o.isHorizontal(),u=l?0:1,h=ox(rx([t]),i,t).width;return.5<h||(h=.5),{progress:function(t,e){for(var i,c=t.count,d=new $v(2*c),p=new $v(2*c),f=new $v(c),g=[],m=[],y=0,_=0;null!=(i=t.next());)m[u]=e.get(a,i),m[1-u]=e.get(s,i),g=n.dataToPoint(m,null,g),p[y]=l?r.x+r.width:g[0],d[y++]=g[0],p[y]=l?g[1]:r.y+r.height,d[y++]=g[1],f[_++]=i;e.setLayout({largePoints:d,largeDataIndices:f,largeBackgroundPoints:p,barWidth:h,valueAxisStart:hx(0,o),backgroundStart:l?r.x:r.y,valueAxisHorizontal:l})}}}}};function lx(t){return t.coordinateSystem&&"cartesian2d"===t.coordinateSystem.type}function ux(t){return t.pipelineContext&&t.pipelineContext.large}function hx(t,e){return e.toGlobalCoord(e.dataToCoord("log"===e.type?1:0))}var cx;h(dx,cx=Qv),dx.prototype.getLabel=function(t){var e=this.getSetting("useUTC");return Vc(t.value,kc[function(t){switch(t){case"year":case"month":return"day";case"millisecond":return"millisecond";default:return"second"}}(Hc(this._minLevelUnit))]||kc.second,e,this.getSetting("locale"))},dx.prototype.getFormattedLabel=function(t,e,n){var r=this.getSetting("useUTC");return function(t,e,n,r,i){var o=null;if("string"==typeof n)o=n;else if("function"==typeof n)o=n(t.value,e,{level:t.level});else{var a=R({},Nc);if(0<t.level)for(var s=0;s<Bc.length;++s)a[Bc[s]]="{primary|"+a[Bc[s]]+"}";var l=n?!1===n.inherit?n:L(n,a):a,u=Uc(t.value,i);if(l[u])o=l[u];else if(l.inherit){for(s=Fc.indexOf(u)-1;0<=s;--s)if(l[u]){o=l[u];break}o=o||a.none}X(o)&&(n=null==t.level?0:0<=t.level?t.level:o.length+t.level,o=o[n=Math.min(n,o.length-1)])}return Vc(new Date(t.value),o,i,r)}(t,e,n,this.getSetting("locale"),r)},dx.prototype.getTicks=function(t){var e=this._interval,n=this._extent,r=[];return e?(r.push({value:n[0],level:0}),e=this.getSetting("useUTC"),e=function(t,e,n,r){var i=Fc,o=0;function a(t,i,o){var a=[],s=!i.length;if(!function(t,e,n,r){function i(t){return Gc(c,t,r)===Gc(d,t,r)}function o(){return i("year")}function a(){return o()&&i("month")}function s(){return a()&&i("day")}function l(){return s()&&i("hour")}function u(){return l()&&i("minute")}function h(){return u()&&i("second")}var c=bi(e),d=bi(n);switch(t){case"year":return o();case"month":return a();case"day":return s();case"hour":return l();case"minute":return u();case"second":return h();case"millisecond":return h()&&i("millisecond")}}(Hc(t),r[0],r[1],n)){s&&(i=[{value:function(t,e,n){var r=new Date(t);switch(Hc(e)){case"year":case"month":r[Qc(n)](0);case"day":r[Jc(n)](1);case"hour":r[$c(n)](0);case"minute":r[td(n)](0);case"second":r[ed(n)](0),r[nd(n)](0)}return r.getTime()}(new Date(r[0]),t,n)},{value:r[1]}]);for(var l,u,h=0;h<i.length-1;h++){var c=i[h].value,d=i[h+1].value;if(c!==d){var p=void 0,f=void 0,g=void 0;switch(t){case"year":p=Math.max(1,Math.round(e/Pc/365)),f=Wc(n),g=n?"setUTCFullYear":"setFullYear";break;case"half-year":case"quarter":case"month":u=e,p=6<(u/=30*Pc)?6:3<u?3:2<u?2:1,f=Xc(n),g=Qc(n);break;case"week":case"half-week":case"day":l=e,p=16<(l/=Pc)?16:7.5<l?7:3.5<l?4:1.5<l?2:1,f=jc(n),g=Jc(n);break;case"half-day":case"quarter-day":case"hour":l=e,p=12<(l/=Oc)?12:6<l?6:3.5<l?4:2<l?2:1,f=Yc(n),g=$c(n);break;case"minute":p=fx(e,!0),f=Zc(n),g=td(n);break;case"second":p=fx(e,!1),f=qc(n),g=ed(n);break;case"millisecond":p=Si(e,!0),f=Kc(n),g=nd(n)}!function(t,e,n,i,o,a){for(var s=new Date(e),l=e,u=s[i]();l<n&&l<=r[1];)a.push({value:l}),s[o](u+=t),l=s.getTime();a.push({value:l,notAdd:!0})}(p,c,d,f,g,a),"year"===t&&1<o.length&&0===h&&o.unshift({value:o[0].value-p})}}for(h=0;h<a.length;h++)o.push(a[h]);return 1}}for(var s=[],l=[],u=0,h=0,c=0;c<i.length&&o++<1e4;++c){var d=Hc(i[c]);if(function(t){return t===Hc(t)}(i[c])){a(i[c],s[s.length-1]||[],l);var p=i[c+1]?Hc(i[c+1]):null;if(d!==p){if(l.length){h=u,l.sort((function(t,e){return t.value-e.value}));for(var f=[],g=0;g<l.length;++g){var m=l[g].value;0!==g&&l[g-1].value===m||(f.push(l[g]),m>=r[0]&&m<=r[1]&&u++)}if(p=(r[1]-r[0])/e,1.5*p<u&&p/1.5<h)break;if(s.push(f),p<u||t===i[c])break}l=[]}}}var y=V(z(s,(function(t){return V(t,(function(t){return t.value>=r[0]&&t.value<=r[1]&&!t.notAdd}))})),(function(t){return 0<t.length})),_=[],v=y.length-1;for(c=0;c<y.length;++c)for(var x=y[c],b=0;b<x.length;++b)_.push({value:x[b].value,level:v-c});_.sort((function(t,e){return t.value-e.value}));var T=[];for(c=0;c<_.length;++c)0!==c&&_[c].value===_[c-1].value||T.push(_[c]);return T}(this._minLevelUnit,this._approxInterval,e,n),(r=r.concat(e)).push({value:n[1],level:0}),r):r},dx.prototype.niceExtent=function(t){var e,n=this._extent;n[0]===n[1]&&(n[0]-=Pc,n[1]+=Pc),n[1]===-1/0&&n[0]===1/0&&(e=new Date,n[1]=+new Date(e.getFullYear(),e.getMonth(),e.getDate()),n[0]=n[1]-Pc),this.niceTicks(t.splitNumber,t.minInterval,t.maxInterval)},dx.prototype.niceTicks=function(t,e,n){var r=this._extent;r=r[1]-r[0];this._approxInterval=r/(t=t||10),null!=e&&this._approxInterval<e&&(this._approxInterval=e),null!=n&&this._approxInterval>n&&(this._approxInterval=n),n=px.length,n=Math.min(function(t,e,n,r){for(;n<r;){var i=n+r>>>1;t[i][1]<e?n=1+i:r=i}return n}(px,this._approxInterval,0,n),n-1),this._interval=px[n][1],this._minLevelUnit=px[Math.max(n-1,0)][0]},dx.prototype.parse=function(t){return"number"==typeof t?t:+bi(t)},dx.prototype.contain=function(t){return Uv(this.parse(t),this._extent)},dx.prototype.normalize=function(t){return Gv(this.parse(t),this._extent)},dx.prototype.scale=function(t){return Wv(t,this._extent)},dx.type="time",M=dx;function dx(t){return t=cx.call(this,t)||this,t.type="time",t}var px=[["second",Rc],["minute",Lc],["hour",Oc],["quarter-day",6*Oc],["half-day",12*Oc],["day",1.2*Pc],["half-week",3.5*Pc],["week",7*Pc],["month",31*Pc],["quarter",95*Pc],["half-year",$r/2],["year",$r]];function fx(t,e){return 30<(t/=e?Lc:Rc)?30:20<t?20:15<t?15:10<t?10:5<t?5:2<t?2:1}Pv.registerClass(M);var gx,mx=M,yx=Pv.prototype,_x=Qv.prototype,vx=fi,xx=ci,bx=Math.floor,Tx=Math.ceil,Sx=Math.pow,Mx=Math.log;h(Ax,gx=Pv),Ax.prototype.getTicks=function(t){var e=this._originalScale,n=this._extent,r=e.getExtent();return z(_x.getTicks.call(this,t),(function(t){var e=t.value;t=ci(Sx(this.base,e)),t=e===n[0]&&this._fixMin?Cx(t,r[0]):t;return{value:t=e===n[1]&&this._fixMax?Cx(t,r[1]):t}}),this)},Ax.prototype.setExtent=function(t,e){var n=this.base;t=Mx(t)/Mx(n),e=Mx(e)/Mx(n),_x.setExtent.call(this,t,e)},Ax.prototype.getExtent=function(){var t=this.base,e=yx.getExtent.call(this);return e[0]=Sx(t,e[0]),e[1]=Sx(t,e[1]),t=this._originalScale.getExtent(),this._fixMin&&(e[0]=Cx(e[0],t[0])),this._fixMax&&(e[1]=Cx(e[1],t[1])),e},Ax.prototype.unionExtent=function(t){this._originalScale.unionExtent(t);var e=this.base;t[0]=Mx(t[0])/Mx(e),t[1]=Mx(t[1])/Mx(e),yx.unionExtent.call(this,t)},Ax.prototype.unionExtentFromData=function(t,e){this.unionExtent(t.getApproximateExtent(e))},Ax.prototype.niceTicks=function(t){t=t||10;var e=this._extent,n=e[1]-e[0];if(!(n==1/0||n<=0)){var r=Ti(n);for(t/n*r<=.5&&(r*=10);!isNaN(r)&&Math.abs(r)<1&&0<Math.abs(r);)r*=10;e=[ci(Tx(e[0]/r)*r),ci(bx(e[1]/r)*r)],this._interval=r,this._niceExtent=e}},Ax.prototype.niceExtent=function(t){_x.niceExtent.call(this,t),this._fixMin=t.fixMin,this._fixMax=t.fixMax},Ax.prototype.parse=function(t){return t},Ax.prototype.contain=function(t){return Uv(t=Mx(t)/Mx(this.base),this._extent)},Ax.prototype.normalize=function(t){return Gv(t=Mx(t)/Mx(this.base),this._extent)},Ax.prototype.scale=function(t){return t=Wv(t,this._extent),Sx(this.base,t)},Ax.type="log",S=Ax;function Ax(){var t=null!==gx&&gx.apply(this,arguments)||this;return t.type="log",t.base=10,t._originalScale=new Qv,t._interval=0,t}function Cx(t,e){return xx(t,vx(e))}Pu=S.prototype,Pu.getMinorTicks=_x.getMinorTicks,Pu.getLabel=_x.getLabel,Pv.registerClass(S);var Ex=S,Ix=(Dx.prototype._prepareParams=function(t,e,n){n[1]<n[0]&&(n=[NaN,NaN]),this._dataMin=n[0],this._dataMax=n[1];var r=this._isOrdinal="ordinal"===t.type;this._needCrossZero=e.getNeedCrossZero&&e.getNeedCrossZero();var i=this._modelMinRaw=e.get("min",!0);j(i)?this._modelMinNum=Px(t,i({min:n[0],max:n[1]})):"dataMin"!==i&&(this._modelMinNum=Px(t,i)),i=this._modelMaxRaw=e.get("max",!0),j(i)?this._modelMaxNum=Px(t,i({min:n[0],max:n[1]})):"dataMax"!==i&&(this._modelMaxNum=Px(t,i)),r?this._axisDataLen=e.getCategories().length:"boolean"==typeof(e=X(e=e.get("boundaryGap"))?e:[e||0,e||0])[0]||"boolean"==typeof e[1]?this._boundaryGapInner=[0,0]:this._boundaryGapInner=[Jn(e[0],1),Jn(e[1],1)]},Dx.prototype.calculate=function(){var t=this._isOrdinal,e=this._dataMin,n=this._dataMax,r=this._axisDataLen,i=this._boundaryGapInner,o=t?null:n-e||Math.abs(e),a="dataMin"===this._modelMinRaw?e:this._modelMinNum,s="dataMax"===this._modelMaxRaw?n:this._modelMaxNum,l=null!=a,u=null!=s;return null==a&&(a=t?r?0:NaN:e-i[0]*o),null==s&&(s=t?r?r-1:NaN:n+i[1]*o),null!=a&&isFinite(a)||(a=NaN),(s=null!=s&&isFinite(s)?s:NaN)<a&&(s=a=NaN),o=tt(a)||tt(s)||t&&!r,this._needCrossZero&&(a=0<a&&0<s&&!l?0:a)<0&&s<0&&!u&&(s=0),t=this._determinedMin,r=this._determinedMax,null!=t&&(a=t,l=!0),null!=r&&(s=r,u=!0),{min:a,max:s,minFixed:l,maxFixed:u,isBlank:o}},Dx.prototype.modifyDataMinMax=function(t,e){this[Lx[t]]=e},Dx.prototype.setDeterminedMinMax=function(t,e){this[Rx[t]]=e},Dx.prototype.freeze=function(){this.frozen=!0},Dx);function Dx(t,e,n){this._prepareParams(t,e,n)}var Rx={min:"_determinedMin",max:"_determinedMax"},Lx={min:"_dataMin",max:"_dataMax"};function Ox(t,e,n){var r=t.rawExtentInfo;return r||(r=new Ix(t,e,n),t.rawExtentInfo=r)}function Px(t,e){return null==e?null:tt(e)?NaN:t.parse(e)}function Nx(t,e){var n=t.type,r=Ox(t,e,t.getExtent()).calculate();t.setBlank(r.isBlank);var i,o=r.min,a=r.max;t=e.ecModel;return t&&"time"===n&&(t=nx("bar",t),i=!1,F(t,(function(t){i=i||t.getBaseAxis()===e.axis})),i&&(t=rx(t),o=(t=function(t,e,n,r){var i=n.axis.getExtent();i=i[1]-i[0],r=ox(r,n.axis);if(void 0===r)return{min:t,max:e};var o=1/0;F(r,(function(t){o=Math.min(t.offset,o)}));var a=-1/0;return F(r,(function(t){a=Math.max(t.offset+t.width,a)})),o=Math.abs(o),a=Math.abs(a),n=o+a,r=e-t,r=r/(1-(o+a)/i)-r,{min:t-=o/n*r,max:e+=a/n*r}}(o,a,e,t)).min,a=t.max)),{extent:[o,a],fixMin:r.minFixed,fixMax:r.maxFixed}}function kx(t,e){var n=Nx(t,e),r=n.extent,i=e.get("splitNumber");t instanceof Ex&&(t.base=e.get("logBase"));var o=t.type;t.setExtent(r[0],r[1]),t.niceExtent({splitNumber:i,fixMin:n.fixMin,fixMax:n.fixMax,minInterval:"interval"===o||"time"===o?e.get("minInterval"):null,maxInterval:"interval"===o||"time"===o?e.get("maxInterval"):null}),e=e.get("interval"),null!=e&&t.setInterval&&t.setInterval(e)}function Bx(t,e){if(e=e||t.get("type"))switch(e){case"category":return new Zv({ordinalMeta:t.getOrdinalMeta?t.getOrdinalMeta():t.getCategories(),extent:[1/0,-1/0]});case"time":return new mx({locale:t.ecModel.getLocaleModel(),useUTC:t.ecModel.get("useUTC")});default:return new(Pv.getClass(e)||Qv)}}function Fx(t){var e,n,r,i=t.getLabelModel().get("formatter"),o="category"===t.type?t.scale.getExtent()[0]:null;return"time"===t.scale.type?(r=i,function(e,n){return t.scale.getFormattedLabel(e,n,r)}):"string"==typeof i?(n=i,function(e){return e=t.scale.getLabel(e),n.replace("{value}",null!=e?e:"")}):"function"==typeof i?(e=i,function(n,r){return null!=o&&(r=n.value-o),e(zx(t,n),r,null!=n.level?{level:n.level}:null)}):function(e){return t.scale.getLabel(e)}}function zx(t,e){return"category"===t.type?t.scale.getLabel(e):e.value}function Hx(t){var e=t.model,n=t.scale;if(e.get(["axisLabel","show"])&&!n.isBlank()){var r,i,o=n.getExtent(),a=n instanceof Zv?n.count():(r=n.getTicks()).length,s=t.getLabelModel(),l=Fx(t),u=1;40<a&&(u=Math.ceil(a/40));for(var h,c,d=0;d<a;d+=u){var p=l(r?r[d]:{value:o[0]+d},d),f=s.getTextRect(p),g=(h=f,c=s.get("rotate")||0,g=f=p=g=void 0,g=c*Math.PI/180,p=h.width,f=h.height,c=p*Math.abs(Math.cos(g))+Math.abs(f*Math.sin(g)),g=p*Math.abs(Math.sin(g))+Math.abs(f*Math.cos(g)),new Un(h.x,h.y,c,g));i?i.union(g):i=g}return i}}function Vx(t){return t=t.get("interval"),null==t?"auto":t}function Ux(t){return"category"===t.type&&0===Vx(t.getLabelModel())}function Gx(t,e){var n={};return F(t.mapDimensionsAll(e),(function(e){n[Rv(t,e)]=!0})),U(n)}var Wx=(Xx.prototype.getNeedCrossZero=function(){return!this.option.scale},Xx.prototype.getCoordSysModel=function(){},Xx);function Xx(){}function jx(t){return Lv(t.getSource(),t)}var Yx={isDimensionStacked:Dv,enableDataStack:Iv,getStackedDimension:Rv};function Zx(t,e){var n=e;e=Bx(n=e instanceof xc?n:new xc(e));return e.setExtent(t[0],t[1]),kx(e,n),e}function qx(t){k(t,Wx)}function Kx(t,e){return nc(t,null,null,"normal"!==(e=e||{}).state)}var Qx=Xi();function Jx(t){return"category"===t.type?(i=(r=t).getLabelModel(),o=tb(r,i),!i.get("show")||r.scale.isBlank()?{labels:[],labelCategoryInterval:o.labelCategoryInterval}:o):(t=(e=t).scale.getTicks(),n=Fx(e),{labels:z(t,(function(t,r){return{formattedLabel:n(t,r),rawLabel:e.scale.getLabel(t),tickValue:t.value}}))});var e,n,r,i,o}function $x(t,e){return"category"===t.type?function(t,e){var n,r,i=eb(t,"ticks"),o=Vx(e),a=nb(i,o);return a||(e.get("show")&&!t.scale.isBlank()||(n=[]),n=j(o)?ob(t,o,!0):"auto"===o?(e=tb(t,t.getLabelModel()),r=e.labelCategoryInterval,z(e.labels,(function(t){return t.tickValue}))):ib(t,r=o,!0),rb(i,o,{ticks:n,tickCategoryInterval:r}))}(t,e):{ticks:z(t.scale.getTicks(),(function(t){return t.value}))}}function tb(t,e){var n,r=eb(t,"labels"),i=Vx(e);e=nb(r,i);return e||rb(r,i,{labels:j(i)?ob(t,i):ib(t,n="auto"===i?null!=(t=Qx(n=t).autoInterval)?t:Qx(n).autoInterval=n.calculateCategoryInterval():i),labelCategoryInterval:n})}function eb(t,e){return Qx(t)[e]||(Qx(t)[e]=[])}function nb(t,e){for(var n=0;n<t.length;n++)if(t[n].key===e)return t[n].value}function rb(t,e,n){return t.push({key:e,value:n}),n}function ib(t,e,n){var r=Fx(t),i=t.scale,o=i.getExtent(),a=t.getLabelModel(),s=[],l=Math.max((e||0)+1,1),u=o[0];e=i.count();0!==u&&1<l&&2<e/l&&(u=Math.round(Math.ceil(u/l)*l)),e=Ux(t),t=a.get("showMinLabel")||e,e=a.get("showMaxLabel")||e,t&&u!==o[0]&&c(o[0]);for(var h=u;h<=o[1];h+=l)c(h);function c(t){var e={value:t};s.push(n?t:{formattedLabel:r(e),rawLabel:i.getLabel(e),tickValue:t})}return e&&h-l!==o[1]&&c(o[1]),s}function ob(t,e,n){var r=t.scale,i=Fx(t),o=[];return F(r.getTicks(),(function(t){var a=r.getLabel(t),s=t.value;e(t.value,a)&&o.push(n?s:{formattedLabel:i(t),rawLabel:a,tickValue:s})})),o}var ab=[0,1];function sb(t,e,n){this.onBand=!1,this.inverse=!1,this.dim=t,this.scale=e,this._extent=n||[0,0]}function lb(t,e){e=(t[1]-t[0])/e/2,t[0]+=e,t[1]-=e}var ub,hb=(sb.prototype.contain=function(t){var e=this._extent,n=Math.min(e[0],e[1]);e=Math.max(e[0],e[1]);return n<=t&&t<=e},sb.prototype.containData=function(t){return this.scale.contain(t)},sb.prototype.getExtent=function(){return this._extent.slice()},sb.prototype.getPixelPrecision=function(t){return gi(t||this.scale.getExtent(),this._extent)},sb.prototype.setExtent=function(t,e){var n=this._extent;n[0]=t,n[1]=e},sb.prototype.dataToCoord=function(t,e){var n=this._extent,r=this.scale;return t=r.normalize(t),this.onBand&&"ordinal"===r.type&&lb(n=n.slice(),r.count()),ui(t,ab,n,e)},sb.prototype.coordToData=function(t,e){var n=this._extent,r=this.scale;return this.onBand&&"ordinal"===r.type&&lb(n=n.slice(),r.count()),e=ui(t,n,ab,e),this.scale.scale(e)},sb.prototype.pointToData=function(t,e){},sb.prototype.getTicksCoords=function(t){var e,n,r,i,o,a,s=(t=t||{}).tickModel||this.getTickModel(),l=z($x(this,s).ticks,(function(t){return{coord:this.dataToCoord("ordinal"===this.scale.type?this.scale.getRawOrdinalNumber(t):t),tickValue:t}}),this),u=s.get("alignWithLabel");function h(t,e){return t=ci(t),e=ci(e),a?e<t:t<e}return e=this,n=l,r=u,s=t.clamp,u=n.length,e.onBand&&!r&&u&&(t=e.getExtent(),1===u?(n[0].coord=t[0],i=n[1]={coord:t[0]}):(r=n[u-1].tickValue-n[0].tickValue,o=(n[u-1].coord-n[0].coord)/r,F(n,(function(t){t.coord-=o/2})),e=1+(e=e.scale.getExtent())[1]-n[u-1].tickValue,i={coord:n[u-1].coord+o*e},n.push(i)),a=t[0]>t[1],h(n[0].coord,t[0])&&(s?n[0].coord=t[0]:n.shift()),s&&h(t[0],n[0].coord)&&n.unshift({coord:t[0]}),h(t[1],i.coord)&&(s?i.coord=t[1]:n.pop()),s&&h(i.coord,t[1])&&n.push({coord:t[1]})),l},sb.prototype.getMinorTicksCoords=function(){if("ordinal"===this.scale.type)return[];var t=this.model.getModel("minorTick").get("splitNumber");return z(this.scale.getMinorTicks(t=0<t&&t<100?t:5),(function(t){return z(t,(function(t){return{coord:this.dataToCoord(t),tickValue:t}}),this)}),this)},sb.prototype.getViewLabels=function(){return Jx(this).labels},sb.prototype.getLabelModel=function(){return this.model.getModel("axisLabel")},sb.prototype.getTickModel=function(){return this.model.getModel("axisTick")},sb.prototype.getBandWidth=function(){var t=this._extent,e=this.scale.getExtent();e=e[1]-e[0]+(this.onBand?1:0);return 0===e&&(e=1),t=Math.abs(t[1]-t[0]),Math.abs(t)/e},sb.prototype.calculateCategoryInterval=function(){return function(t){var e=(u=(l=t).getLabelModel(),{axisRotate:l.getRotate?l.getRotate():l.isHorizontal&&!l.isHorizontal()?90:0,labelRotate:u.get("rotate")||0,font:u.getFont()}),n=Fx(t),r=(e.axisRotate-e.labelRotate)/180*Math.PI,i=(h=t.scale).getExtent(),o=h.count();if(i[1]-i[0]<1)return 0;var a=1;40<o&&(a=Math.max(1,Math.floor(o/40)));for(var s=i[0],l=t.dataToCoord(s+1)-t.dataToCoord(s),u=Math.abs(l*Math.cos(r)),h=Math.abs(l*Math.sin(r)),c=0,d=0;s<=i[1];s+=a){var p=Zn(n({value:s}),e.font,"center","top"),f=1.3*p.width;p=1.3*p.height,c=Math.max(c,f,7),d=Math.max(d,p,7)}return l=c/u,r=d/h,isNaN(l)&&(l=1/0),isNaN(r)&&(r=1/0),u=Math.max(0,Math.floor(Math.min(l,r))),h=Qx(t.model),l=t.getExtent(),r=h.lastAutoInterval,t=h.lastTickCount,null!=r&&null!=t&&Math.abs(r-u)<=1&&Math.abs(t-o)<=1&&u<r&&h.axisExtent0===l[0]&&h.axisExtent1===l[1]?u=r:(h.lastTickCount=o,h.lastAutoInterval=u,h.axisExtent0=l[0],h.axisExtent1=l[1]),u}(this)},sb);function cb(){return!1}function db(t,e,n){var r=O(),i=e.getWidth(),o=e.getHeight();e=r.style;return e&&(e.position="absolute",e.left="0",e.top="0",e.width=i+"px",e.height=o+"px",r.setAttribute("data-zr-dom-id",t)),r.width=i*n,r.height=o*n,r}function pb(t,e,n){var r,i=ub.call(this)||this;return i.motionBlur=!1,i.lastFrameAlpha=.7,i.dpr=1,i.virtual=!1,i.config={},i.incremental=!1,i.zlevel=0,i.maxRepaintRectCount=5,i.__dirty=!0,i.__firstTimePaint=!0,i.__used=!1,i.__drawIndex=0,i.__startIndex=0,i.__endIndex=0,i.__prevStartIndex=null,i.__prevEndIndex=null,n=n||er,"string"==typeof t?r=db(t,e,n):K(t)&&(t=(r=t).id),i.id=t,t=(i.dom=r).style,t&&(r.onselectstart=cb,t.webkitUserSelect="none",t.userSelect="none",t.webkitTapHighlightColor="rgba(0,0,0,0)",t["-webkit-touch-callout"]="none",t.padding="0",t.margin="0",t.borderWidth="0"),i.domBack=null,i.ctxBack=null,i.painter=e,i.config=null,i.dpr=n,i}var fb=(_t(pb,ub=Bt),pb.prototype.getElementCount=function(){return this.__endIndex-this.__startIndex},pb.prototype.afterBrush=function(){this.__prevStartIndex=this.__startIndex,this.__prevEndIndex=this.__endIndex},pb.prototype.initContext=function(){this.ctx=this.dom.getContext("2d"),this.ctx.dpr=this.dpr},pb.prototype.setUnpainted=function(){this.__firstTimePaint=!0},pb.prototype.createBackBuffer=function(){var t=this.dpr;this.domBack=db("back-"+this.id,this.painter,t),this.ctxBack=this.domBack.getContext("2d"),1!==t&&this.ctxBack.scale(t,t)},pb.prototype.createRepaintRects=function(t,e,n,r){if(this.__firstTimePaint)return this.__firstTimePaint=!1,null;var i=[],o=this.maxRepaintRectCount,a=!1,s=new Un(0,0,0,0);function l(t){if(t.isFinite()&&!t.isZero())if(0===i.length)(e=new Un(0,0,0,0)).copy(t),i.push(e);else{for(var e,n=!1,r=1/0,l=0,u=0;u<i.length;++u){var h=i[u];if(h.intersect(t)){var c=new Un(0,0,0,0);c.copy(h),c.union(t),i[u]=c,n=!0;break}a&&(s.copy(t),s.union(h),c=t.width*t.height,h=h.width*h.height,(h=s.width*s.height-c-h)<r&&(r=h,l=u))}a&&(i[l].union(t),n=!0),n||((e=new Un(0,0,0,0)).copy(t),i.push(e)),a=a||i.length>=o}}for(var u,h=this.__startIndex;h<this.__endIndex;++h)(c=t[h])&&(p=c.shouldBePainted(n,r,!0,!0),(d=c.__isRendered&&(c.__dirty&fr.REDARAW_BIT||!p)?c.getPrevPaintRect():null)&&l(d),(u=p&&(c.__dirty&fr.REDARAW_BIT||!c.__isRendered)?c.getPaintRect():null)&&l(u));for(h=this.__prevStartIndex;h<this.__prevEndIndex;++h){var c,d,p=(c=e[h]).shouldBePainted(n,r,!0,!0);!c||p&&c.__zr||!c.__isRendered||(d=c.getPrevPaintRect())&&l(d)}do{var f=!1;for(h=0;h<i.length;)if(i[h].isZero())i.splice(h,1);else{for(var g=h+1;g<i.length;)i[h].intersect(i[g])?(f=!0,i[h].union(i[g]),i.splice(g,1)):g++;h++}}while(f);return this._paintRects=i},pb.prototype.debugGetPaintRects=function(){return(this._paintRects||[]).slice()},pb.prototype.resize=function(t,e){var n=this.dpr,r=this.dom,i=r.style,o=this.domBack;i&&(i.width=t+"px",i.height=e+"px"),r.width=t*n,r.height=e*n,o&&(o.width=t*n,o.height=e*n,1!==n&&this.ctxBack.scale(n,n))},pb.prototype.clear=function(t,e,n){var r=this.dom,i=this.ctx,o=r.width,a=r.height;e=e||this.clearColor;var s=this.motionBlur&&!t,l=this.lastFrameAlpha,u=this.dpr,h=this;s&&(this.domBack||this.createBackBuffer(),this.ctxBack.globalCompositeOperation="copy",this.ctxBack.drawImage(r,0,0,o/u,a/u));var c=this.domBack;function d(t,n,r,o){var a;i.clearRect(t,n,r,o),e&&"transparent"!==e&&(a=void 0,null!=e.colorStops?(a=e.__canvasGradient||Km(i,e,{x:0,y:0,width:r,height:o}),e.__canvasGradient=a):null!=e.image&&(a=ry(i,e,{dirty:function(){h.setUnpainted(),h.__painter.refresh()}})),i.save(),i.fillStyle=a||e,i.fillRect(t,n,r,o),i.restore()),s&&(i.save(),i.globalAlpha=l,i.drawImage(c,t,n,r,o),i.restore())}!n||s?d(0,0,o,a):n.length&&F(n,(function(t){d(t.x*u,t.y*u,t.width*u,t.height*u)}))},pb),gb=314159;function mb(t){return parseInt(t,10)}function yb(t,e,n,r){this.type="canvas",this._zlevelList=[],this._prevDisplayList=[],this._layers={},this._layerConfig={},this._needsManuallyCompositing=!1,this.type="canvas";var i=!t.nodeName||"CANVAS"===t.nodeName.toUpperCase();this._opts=n=R({},n||{}),this.dpr=n.devicePixelRatio||er,this._singleCanvas=i;var o=(this.root=t).style;o&&(o.webkitTapHighlightColor="transparent",o.webkitUserSelect="none",o.userSelect="none",o["-webkit-touch-callout"]="none",t.innerHTML=""),this.storage=e;var a=this._zlevelList;this._prevDisplayList=[];var s;o=this._layers;i?(e=(s=t).width,i=s.height,null!=n.width&&(e=n.width),null!=n.height&&(i=n.height),this.dpr=n.devicePixelRatio||1,s.width=e*this.dpr,s.height=i*this.dpr,this._width=e,this._height=i,(s=new fb(s,this,this.dpr)).__builtin__=!0,s.initContext(),(o[gb]=s).zlevel=gb,a.push(gb),this._domRoot=t):(this._width=this._getSize(0),this._height=this._getSize(1),a=this._domRoot=(o=this._width,s=this._height,(a=document.createElement("div")).style.cssText=["position:relative","width:"+o+"px","height:"+s+"px","padding:0","margin:0","border-width:0"].join(";")+";",a),t.appendChild(a))}var _b=(yb.prototype.getType=function(){return"canvas"},yb.prototype.isSingleCanvas=function(){return this._singleCanvas},yb.prototype.getViewportRoot=function(){return this._domRoot},yb.prototype.getViewportRootOffset=function(){var t=this.getViewportRoot();if(t)return{offsetLeft:t.offsetLeft||0,offsetTop:t.offsetTop||0}},yb.prototype.refresh=function(t){var e=this.storage.getDisplayList(!0),n=this._prevDisplayList,r=this._zlevelList;this._redrawId=Math.random(),this._paintList(e,n,t,this._redrawId);for(var i=0;i<r.length;i++){var o=r[i],a=this._layers[o];!a.__builtin__&&a.refresh&&(o=0===i?this._backgroundColor:null,a.refresh(o))}return this._opts.useDirtyRect&&(this._prevDisplayList=e.slice()),this},yb.prototype.refreshHover=function(){this._paintHoverList(this.storage.getDisplayList(!1))},yb.prototype._paintHoverList=function(t){var e=t.length,n=this._hoverlayer;if(n&&n.clear(),e){for(var r,i={inHover:!0,viewWidth:this._width,viewHeight:this._height},o=0;o<e;o++){var a=t[o];a.__inHover&&(n=n||(this._hoverlayer=this.getLayer(1e5)),r||(r=n.ctx).save(),my(r,a,i,o===e-1))}r&&r.restore()}},yb.prototype.getHoverLayer=function(){return this.getLayer(1e5)},yb.prototype.paintOne=function(t,e){gy(t,e)},yb.prototype._paintList=function(t,e,n,r){var i,o,a;this._redrawId===r&&(n=n||!1,this._updateLayerStatus(t),i=(o=this._doPaintList(t,e,n)).finished,o=o.needsRefreshHover,this._needsManuallyCompositing&&this._compositeManually(),o&&this._paintHoverList(t),i?this.eachLayer((function(t){t.afterBrush&&t.afterBrush()})):(a=this,Ir((function(){a._paintList(t,e,n,r)}))))},yb.prototype._compositeManually=function(){var t=this.getLayer(gb).ctx,e=this._domRoot.width,n=this._domRoot.height;t.clearRect(0,0,e,n),this.eachBuiltinLayer((function(r){r.virtual&&t.drawImage(r.dom,0,0,e,n)}))},yb.prototype._doPaintList=function(t,e,n){for(var r=this,i=[],o=this._opts.useDirtyRect,a=0;a<this._zlevelList.length;a++){var s=this._zlevelList[a];s=this._layers[s];s.__builtin__&&s!==this._hoverlayer&&(s.__dirty||n)&&i.push(s)}for(var l=!0,u=!1,h=function(a){var s=i[a],h=s.ctx,d=o&&s.createRepaintRects(t,e,c._width,c._height);h.save();var p,f=n?s.__startIndex:s.__drawIndex,g=!n&&s.incremental&&Date.now,m=g&&Date.now(),y=s.zlevel===c._zlevelList[0]?c._backgroundColor:null;function _(e){var n={inHover:!1,allClipped:!1,prevEl:null,viewWidth:r._width,viewHeight:r._height};for(p=f;p<s.__endIndex;p++){var i=t[p];if(i.__inHover&&(u=!0),r._doPaintEl(i,s,o,e,n,p===s.__endIndex-1),g&&15<Date.now()-m)break}n.prevElClipPaths&&h.restore()}if(s.__startIndex===s.__endIndex?s.clear(!1,y,d):f===s.__startIndex&&((a=t[f]).incremental&&a.notClear&&!n||s.clear(!1,y,d)),-1===f&&(console.error("For some unknown reason. drawIndex is -1"),f=s.__startIndex),d)if(0===d.length)p=s.__endIndex;else for(var v=c.dpr,x=0;x<d.length;++x){var b=d[x];h.save(),h.beginPath(),h.rect(b.x*v,b.y*v,b.width*v,b.height*v),h.clip(),_(b),h.restore()}else h.save(),_(),h.restore();s.__drawIndex=p,s.__drawIndex<s.__endIndex&&(l=!1)},c=this,d=0;d<i.length;d++)h(d);return g.wxa&&F(this._layers,(function(t){t&&t.ctx&&t.ctx.draw&&t.ctx.draw()})),{finished:l,needsRefreshHover:u}},yb.prototype._doPaintEl=function(t,e,n,r,i,o){e=e.ctx,n?(n=t.getPaintRect(),(!r||n&&n.intersect(r))&&(my(e,t,i,o),t.setPrevPaintRect(n))):my(e,t,i,o)},yb.prototype.getLayer=function(t,e){this._singleCanvas&&!this._needsManuallyCompositing&&(t=gb);var n=this._layers[t];return n||((n=new fb("zr_"+t,this,this.dpr)).zlevel=t,n.__builtin__=!0,this._layerConfig[t]?D(n,this._layerConfig[t],!0):this._layerConfig[t-.01]&&D(n,this._layerConfig[t-.01],!0),e&&(n.virtual=e),this.insertLayer(t,n),n.initContext()),n},yb.prototype.insertLayer=function(t,e){var n,r=this._layers,i=this._zlevelList,o=i.length,a=this._domRoot,s=null,l=-1;if(r[t])E("ZLevel "+t+" has been used already");else if((n=e)&&(n.__builtin__||"function"==typeof n.resize&&"function"==typeof n.refresh)){if(0<o&&t>i[0]){for(l=0;l<o-1&&!(i[l]<t&&i[l+1]>t);l++);s=r[i[l]]}i.splice(l+1,0,t),(r[t]=e).virtual||(s?(s=s.dom).nextSibling?a.insertBefore(e.dom,s.nextSibling):a.appendChild(e.dom):a.firstChild?a.insertBefore(e.dom,a.firstChild):a.appendChild(e.dom)),e.__painter=this}else E("Layer of zlevel "+t+" is not valid")},yb.prototype.eachLayer=function(t,e){for(var n=this._zlevelList,r=0;r<n.length;r++){var i=n[r];t.call(e,this._layers[i],i)}},yb.prototype.eachBuiltinLayer=function(t,e){for(var n=this._zlevelList,r=0;r<n.length;r++){var i=n[r],o=this._layers[i];o.__builtin__&&t.call(e,o,i)}},yb.prototype.eachOtherLayer=function(t,e){for(var n=this._zlevelList,r=0;r<n.length;r++){var i=n[r],o=this._layers[i];o.__builtin__||t.call(e,o,i)}},yb.prototype.getLayers=function(){return this._layers},yb.prototype._updateLayerStatus=function(t){function e(t){i&&(i.__endIndex!==t&&(i.__dirty=!0),i.__endIndex=t)}if(this.eachBuiltinLayer((function(t,e){t.__dirty=t.__used=!1})),this._singleCanvas)for(var n=1;n<t.length;n++)if((s=t[n]).zlevel!==t[n-1].zlevel||s.incremental){this._needsManuallyCompositing=!0;break}for(var r,i=null,o=0,a=0;a<t.length;a++){var s,l=(s=t[a]).zlevel,u=void 0;r!==l&&(r=l,o=0),s.incremental?((u=this.getLayer(l+.001,this._needsManuallyCompositing)).incremental=!0,o=1):u=this.getLayer(l+(0<o?.01:0),this._needsManuallyCompositing),u.__builtin__||E("ZLevel "+l+" has been used by unkown layer "+u.id),u!==i&&(u.__used=!0,u.__startIndex!==a&&(u.__dirty=!0),u.__startIndex=a,u.incremental?u.__drawIndex=-1:u.__drawIndex=a,e(a),i=u),s.__dirty&fr.REDARAW_BIT&&!s.__inHover&&(u.__dirty=!0,u.incremental&&u.__drawIndex<0&&(u.__drawIndex=a))}e(a),this.eachBuiltinLayer((function(t,e){!t.__used&&0<t.getElementCount()&&(t.__dirty=!0,t.__startIndex=t.__endIndex=t.__drawIndex=0),t.__dirty&&t.__drawIndex<0&&(t.__drawIndex=t.__startIndex)}))},yb.prototype.clear=function(){return this.eachBuiltinLayer(this._clearLayer),this},yb.prototype._clearLayer=function(t){t.clear()},yb.prototype.setBackgroundColor=function(t){this._backgroundColor=t,F(this._layers,(function(t){t.setUnpainted()}))},yb.prototype.configLayer=function(t,e){if(e){var n=this._layerConfig;n[t]?D(n[t],e,!0):n[t]=e;for(var r=0;r<this._zlevelList.length;r++){var i=this._zlevelList[r];i!==t&&i!==t+.01||D(this._layers[i],n[t],!0)}}},yb.prototype.delLayer=function(t){var e=this._layers,n=this._zlevelList,r=e[t];r&&(r.dom.parentNode.removeChild(r.dom),delete e[t],n.splice(P(n,t),1))},yb.prototype.resize=function(t,e){if(this._domRoot.style){var n=this._domRoot;n.style.display="none";var r=this._opts;if(null!=t&&(r.width=t),null!=e&&(r.height=e),t=this._getSize(0),e=this._getSize(1),n.style.display="",this._width!==t||e!==this._height){for(var i in n.style.width=t+"px",n.style.height=e+"px",this._layers)this._layers.hasOwnProperty(i)&&this._layers[i].resize(t,e);this.refresh(!0)}this._width=t,this._height=e}else{if(null==t||null==e)return;this._width=t,this._height=e,this.getLayer(gb).resize(t,e)}return this},yb.prototype.clearLayer=function(t){t=this._layers[t],t&&t.clear()},yb.prototype.dispose=function(){this.root.innerHTML="",this.root=this.storage=this._domRoot=this._layers=null},yb.prototype.getRenderedCanvas=function(t){if(this._singleCanvas&&!this._compositeManually)return this._layers[gb].dom;var e=new fb("image",this,(t=t||{}).pixelRatio||this.dpr);e.initContext(),e.clear(!1,t.backgroundColor||this._backgroundColor);var n=e.ctx;if(t.pixelRatio<=this.dpr){this.refresh();var r=e.dom.width,i=e.dom.height;this.eachLayer((function(t){t.__builtin__?n.drawImage(t.dom,0,0,r,i):t.renderToCanvas&&(n.save(),t.renderToCanvas(n),n.restore())}))}else for(var o={inHover:!1,viewWidth:this._width,viewHeight:this._height},a=this.storage.getDisplayList(!0),s=0,l=a.length;s<l;s++){var u=a[s];my(n,u,o,s===l-1)}return e.dom},yb.prototype.getWidth=function(){return this._width},yb.prototype.getHeight=function(){return this._height},yb.prototype._getSize=function(t){var e=this._opts,n=["width","height"][t],r=["clientWidth","clientHeight"][t],i=["paddingLeft","paddingTop"][t],o=["paddingRight","paddingBottom"][t];return null!=e[n]&&"auto"!==e[n]?parseFloat(e[n]):(t=this.root,e=document.defaultView.getComputedStyle(t),(t[r]||mb(e[n])||mb(t.style[n]))-(mb(e[i])||0)-(mb(e[o])||0)|0)},yb.prototype.pathToImage=function(t,e){e=e||this.dpr;var n=document.createElement("canvas"),r=n.getContext("2d"),i=t.getBoundingRect(),o=t.style,a=o.shadowBlur*e,s=o.shadowOffsetX*e,l=o.shadowOffsetY*e,u=t.hasStroke()?o.lineWidth:0,h=Math.max(u/2,a-s);o=Math.max(u/2,s+a),s=Math.max(u/2,a-l),a=Math.max(u/2,l+a),o=i.width+h+o,a=i.height+s+a;return n.width=o*e,n.height=a*e,r.scale(e,e),r.clearRect(0,0,o,a),r.dpr=e,e={x:t.x,y:t.y,scaleX:t.scaleX,scaleY:t.scaleY,rotation:t.rotation,originX:t.originX,originY:t.originY},t.x=h-i.x,t.y=s-i.y,t.rotation=0,t.scaleX=1,t.scaleY=1,t.updateTransform(),t&&my(r,t,{inHover:!1,viewWidth:this._width,viewHeight:this._height},!0),n=new cs({style:{x:0,y:0,image:n}}),R(t,e),n},yb);function vb(t){t.registerPainter("canvas",_b)}var xb,bb=(h(Tb,xb=Ld),Tb.prototype.init=function(t,e,n){xb.prototype.init.call(this,t,e,n),this._sourceManager=new kf(this),Ff(this)},Tb.prototype.mergeOption=function(t,e){xb.prototype.mergeOption.call(this,t,e),Ff(this)},Tb.prototype.optionUpdated=function(){this._sourceManager.dirty()},Tb.prototype.getSourceManager=function(){return this._sourceManager},Tb.type="dataset",Tb.defaultOption={seriesLayoutBy:Vd},Tb);function Tb(){var t=null!==xb&&xb.apply(this,arguments)||this;return t.type="dataset",t}var wb,Sb=(h(Mb,wb=gg),Mb.type="dataset",Mb);function Mb(){var t=null!==wb&&wb.apply(this,arguments)||this;return t.type="dataset",t}function Ab(t,e,n){"object"==typeof e&&(n=e,e=null);var r,i=this;if(!(t instanceof Function))for(var o in r=[],t)t.hasOwnProperty(o)&&r.push(o);var a=function(e){if(i.apply(this,arguments),t instanceof Function?Cb(this,t.call(this,e)):function(t,e,n){for(var r=0;r<n.length;r++){var i=n[r];t[i]=e[i]}}(this,t,r),this.constructor===a)for(var n=a.__initializers__,o=0;o<n.length;o++)n[o].apply(this,arguments)};return(a.__super__=i).__initializers__?a.__initializers__=i.__initializers__.slice():a.__initializers__=[],e&&a.__initializers__.push(e),e=function(){},e.prototype=i.prototype,a.prototype=new e,Cb((a.prototype.constructor=a).prototype,n),a.extend=i.extend,a.derive=i.extend,a}function Cb(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}function Eb(t,e){this.action=t,this.context=e}U_([vb,function(t){t.registerComponentModel(bb),t.registerComponentView(Sb)}]),tr={extend:Ab,derive:Ab};f={trigger:function(t){if(this.hasOwnProperty("__handlers__")&&this.__handlers__.hasOwnProperty(t)){var e=this.__handlers__[t],n=e.length,r=-1,i=arguments;switch(i.length){case 1:for(;++r<n;)e[r].action.call(e[r].context);return;case 2:for(;++r<n;)e[r].action.call(e[r].context,i[1]);return;case 3:for(;++r<n;)e[r].action.call(e[r].context,i[1],i[2]);return;case 4:for(;++r<n;)e[r].action.call(e[r].context,i[1],i[2],i[3]);return;case 5:for(;++r<n;)e[r].action.call(e[r].context,i[1],i[2],i[3],i[4]);return;default:for(;++r<n;)e[r].action.apply(e[r].context,Array.prototype.slice.call(i,1));return}}},on:function(t,e,n){if(t&&e){var r=this.__handlers__||(this.__handlers__={});if(r[t]){if(this.has(t,e))return}else r[t]=[];return n=new Eb(e,n||this),r[t].push(n),this}},once:function(t,e,n){if(t&&e){var r=this;return this.on(t,(function n(){r.off(t,n),e.apply(this,arguments)}),n)}},before:function(t,e,n){if(t&&e)return this.on(t="before"+t,e,n)},after:function(t,e,n){if(t&&e)return this.on(t="after"+t,e,n)},success:function(t,e){return this.once("success",t,e)},error:function(t,e){return this.once("error",t,e)},off:function(t,e){var n=this.__handlers__||(this.__handlers__={});if(e){if(n[t]){for(var r=n[t],i=[],o=0;o<r.length;o++)e&&r[o].action!==e&&i.push(r[o]);n[t]=i}return this}n[t]=[]},has:function(t,e){var n=this.__handlers__;if(!n||!n[t])return!1;for(var r=n[t],i=0;i<r.length;i++)if(r[i].action===e)return!0}};var Ib=0,Db=Array.prototype.forEach,Rb={genGUID:function(){return++Ib},relative2absolute:function(t,e){if(!e||t.match(/^\//))return t;for(var n=t.split("/"),r=e.split("/"),i=n[0];"."===i||".."===i;)".."===i&&r.pop(),n.shift(),i=n[0];return r.join("/")+"/"+n.join("/")},extend:function(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},defaults:function(t,e){if(e)for(var n in e)void 0===t[n]&&(t[n]=e[n]);return t},extendWithPropList:function(t,e,n){if(e)for(var r=0;r<n.length;r++){var i=n[r];t[i]=e[i]}return t},defaultsWithPropList:function(t,e,n){if(e)for(var r=0;r<n.length;r++){var i=n[r];null==t[i]&&(t[i]=e[i])}return t},each:function(t,e,n){if(t&&e)if(t.forEach&&t.forEach===Db)t.forEach(e,n);else if(t.length===+t.length)for(var r=0,i=t.length;r<i;r++)e.call(n,t[r],r,t);else for(var o in t)t.hasOwnProperty(o)&&e.call(n,t[o],o,t)},isObject:function(t){return t===Object(t)},isArray:function(t){return Array.isArray(t)},isArrayLike:function(t){return!!t&&t.length===+t.length},clone:function(t){if(Rb.isObject(t)){if(Rb.isArray(t))return t.slice();if(Rb.isArrayLike(t)){for(var e=new t.constructor(t.length),n=0;n<t.length;n++)e[n]=t[n];return e}return Rb.extend({},t)}return t}},Lb=Rb;Bo=function(){this.__uid__=Lb.genGUID()};Bo.__initializers__=[function(t){Lb.extend(this,t)}],Lb.extend(Bo,tr),Lb.extend(Bo.prototype,f);wu=Bo;var Ob=["OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear","OES_standard_derivatives","OES_vertex_array_object","OES_element_index_uint","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","EXT_texture_filter_anisotropic","EXT_shader_texture_lod","WEBGL_draw_buffers","EXT_frag_depth","EXT_sRGB","ANGLE_instanced_arrays"],Pb=["MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE"];function Nb(){this.head=null,this.tail=null,this._length=0}var kb=function(t){for(var e={},n={},r=0;r<Ob.length;r++)o(Ob[r]);for(r=0;r<Pb.length;r++){var i=Pb[r];n[i]=t.getParameter(t[i])}function o(n){var r;t.getExtension&&(r=(r=(r=t.getExtension(n))||t.getExtension("MOZ_"+n))||t.getExtension("WEBKIT_"+n),e[n]=r)}this.getExtension=function(t){return t in e||o(t),e[t]},this.getParameter=function(t){return n[t]}},Bb={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},Fb=n("620a");Nb.prototype.insert=function(t){return t=new Nb.Entry(t),this.insertEntry(t),t},Nb.prototype.insertAt=function(t,e){if(!(t<0)){for(var n,r,i=this.head,o=0;i&&o!=t;)i=i.next,o++;i?(n=new Nb.Entry(e),(r=i.prev)?(r.next=n).prev=r:this.head=n,(n.next=i).prev=n):this.insert(e)}},Nb.prototype.insertBeforeEntry=function(t,e){var n=new Nb.Entry(t);t=e.prev;t?(t.next=n).prev=t:this.head=n,(n.next=e).prev=n,this._length++},Nb.prototype.insertEntry=function(t){this.head?((this.tail.next=t).prev=this.tail,this.tail=t):this.head=this.tail=t,this._length++},Nb.prototype.remove=function(t){var e=t.prev,n=t.next;e?e.next=n:this.head=n,n?n.prev=e:this.tail=e,t.next=t.prev=null,this._length--},Nb.prototype.removeAt=function(t){if(!(t<0)){for(var e=this.head,n=0;e&&n!=t;)e=e.next,n++;return e?(this.remove(e),e.value):void 0}},Nb.prototype.getHead=function(){if(this.head)return this.head.value},Nb.prototype.getTail=function(){if(this.tail)return this.tail.value},Nb.prototype.getAt=function(t){if(!(t<0)){for(var e=this.head,n=0;e&&n!=t;)e=e.next,n++;return e.value}},Nb.prototype.indexOf=function(t){for(var e=this.head,n=0;e;){if(e.value===t)return n;e=e.next,n++}},Nb.prototype.length=function(){return this._length},Nb.prototype.isEmpty=function(){return 0===this._length},Nb.prototype.forEach=function(t,e){for(var n=this.head,r=0,i=void 0!==e;n;)i?t.call(e,n.value,r):t(n.value,r),n=n.next,r++},Nb.prototype.clear=function(){this.tail=this.head=null,this._length=0},Nb.Entry=function(t){this.value=t,this.next=null,this.prev=null};var zb=Nb;Ql=function(t){this._list=new zb,this._map={},this._maxSize=t||10};Ql.prototype.setMaxSize=function(t){this._maxSize=t},Ql.prototype.put=function(t,e){var n;this._map.hasOwnProperty(t)||((n=this._list.length())>=this._maxSize&&0<n&&(n=this._list.head,this._list.remove(n),delete this._map[n.key]),(e=this._list.insert(e)).key=t,this._map[t]=e)},Ql.prototype.get=function(t){var e=this._map[t];if(this._map.hasOwnProperty(t))return e!==this._list.tail&&(this._list.remove(e),this._list.insertEntry(e)),e.value},Ql.prototype.remove=function(t){var e=this._map[t];void 0!==e&&(delete this._map[t],this._list.remove(e))},Ql.prototype.clear=function(){this._list.clear(),this._map={}};var Hb=Ql,Vb={},Ub={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Gb(t){return(t=Math.round(t))<0?0:255<t?255:t}function Wb(t){return t<0?0:1<t?1:t}function Xb(t){return t.length&&"%"===t.charAt(t.length-1)?Gb(parseFloat(t)/100*255):Gb(parseInt(t,10))}function jb(t){return t.length&&"%"===t.charAt(t.length-1)?Wb(parseFloat(t)/100):Wb(parseFloat(t))}function Yb(t,e,n){return n<0?n+=1:1<n&&--n,6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}function Zb(t,e,n){return t+(e-t)*n}function qb(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function Kb(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}var Qb=new Hb(20),Jb=null;function $b(t,e){Jb&&Kb(Jb,e),Jb=Qb.put(t,Jb||e.slice())}function tT(t,e){var n=(parseFloat(t[0])%360+360)%360/360,r=jb(t[1]),i=jb(t[2]);r=i<=.5?i*(r+1):i+r-i*r,i=2*i-r;return qb(e=e||[],Gb(255*Yb(i,r,n+1/3)),Gb(255*Yb(i,r,n)),Gb(255*Yb(i,r,n-1/3)),1),4===t.length&&(e[3]=t[3]),e}Vb.parse=function(t,e){if(t){e=e||[];var n=Qb.get(t);if(n)return Kb(e,n);var r=(t+="").replace(/ /g,"").toLowerCase();if(r in Ub)return Kb(e,Ub[r]),$b(t,e),e;if("#"===r.charAt(0))return 4===r.length?0<=(o=parseInt(r.substr(1),16))&&o<=4095?(qb(e,(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1),$b(t,e),e):void qb(e,0,0,0,1):7===r.length?0<=(o=parseInt(r.substr(1),16))&&o<=16777215?(qb(e,(16711680&o)>>16,(65280&o)>>8,255&o,1),$b(t,e),e):void qb(e,0,0,0,1):void 0;var i=r.indexOf("(");n=r.indexOf(")");if(-1!==i&&n+1===r.length){var o=r.substr(0,i),a=r.substr(i+1,n-(i+1)).split(","),s=1;switch(o){case"rgba":if(4!==a.length)return void qb(e,0,0,0,1);s=jb(a.pop());case"rgb":return 3!==a.length?void qb(e,0,0,0,1):(qb(e,Xb(a[0]),Xb(a[1]),Xb(a[2]),s),$b(t,e),e);case"hsla":return 4!==a.length?void qb(e,0,0,0,1):(a[3]=jb(a[3]),tT(a,e),$b(t,e),e);case"hsl":return 3!==a.length?void qb(e,0,0,0,1):(tT(a,e),$b(t,e),e);default:return}}qb(e,0,0,0,1)}},Vb.parseToFloat=function(t,e){if(e=Vb.parse(t,e))return e[0]/=255,e[1]/=255,e[2]/=255,e},Vb.lift=function(t,e){var n=Vb.parse(t);if(n){for(var r=0;r<3;r++)n[r]=e<0?n[r]*(1-e)|0:(255-n[r])*e+n[r]|0;return Vb.stringify(n,4===n.length?"rgba":"rgb")}},Vb.toHex=function(t){if(t=Vb.parse(t),t)return((1<<24)+(t[0]<<16)+(t[1]<<8)+ +t[2]).toString(16).slice(1)},Vb.fastLerp=function(t,e,n){if(e&&e.length&&0<=t&&t<=1){n=n||[];var r=t*(e.length-1),i=Math.floor(r),o=Math.ceil(r);t=e[i],o=e[o],i=r-i;return n[0]=Gb(Zb(t[0],o[0],i)),n[1]=Gb(Zb(t[1],o[1],i)),n[2]=Gb(Zb(t[2],o[2],i)),n[3]=Wb(Zb(t[3],o[3],i)),n}},Vb.fastMapToColor=Vb.fastLerp,Vb.lerp=function(t,e,n){if(e&&e.length&&0<=t&&t<=1){var r=t*(e.length-1),i=Math.floor(r),o=Math.ceil(r),a=Vb.parse(e[i]);t=Vb.parse(e[o]),e=r-i,e=Vb.stringify([Gb(Zb(a[0],t[0],e)),Gb(Zb(a[1],t[1],e)),Gb(Zb(a[2],t[2],e)),Wb(Zb(a[3],t[3],e))],"rgba");return n?{color:e,leftIndex:i,rightIndex:o,value:r}:e}},Vb.mapToColor=Vb.lerp,Vb.modifyHSL=function(t,e,n,r){if(t=Vb.parse(t))return t=function(t){if(t){var e,n,r,i=t[0]/255,o=t[1]/255,a=t[2]/255,s=Math.min(i,o,a),l=Math.max(i,o,a),u=l-s,h=(l+s)/2;return 0==u?n=e=0:(n=h<.5?u/(l+s):u/(2-l-s),r=((l-i)/6+u/2)/u,s=((l-o)/6+u/2)/u,u=((l-a)/6+u/2)/u,i===l?e=u-s:o===l?e=1/3+r-u:a===l&&(e=2/3+s-r),e<0&&(e+=1),1<e&&--e),h=[360*e,n,h],null!=t[3]&&h.push(t[3]),h}}(t),null!=e&&(t[0]=(e=e,(e=Math.round(e))<0?0:360<e?360:e)),null!=n&&(t[1]=jb(n)),null!=r&&(t[2]=jb(r)),Vb.stringify(tT(t),"rgba")},Vb.modifyAlpha=function(t,e){if((t=Vb.parse(t))&&null!=e)return t[3]=Wb(e),Vb.stringify(t,"rgba")},Vb.stringify=function(t,e){if(t&&t.length){var n=t[0]+","+t[1]+","+t[2];return"rgba"!==e&&"hsva"!==e&&"hsla"!==e||(n+=","+t[3]),e+"("+n+")"}};var eT=Vb.parseToFloat,nT={};function rT(t){var e=Object.keys(t);e.sort();for(var n=[],r=0;r<e.length;r++){var i=e[r],o=t[i];null===o?n.push(i):n.push(i+" "+o.toString())}return n.join("\n")}var iT,oT=wu.extend((function(){return{name:"",depthTest:!0,depthMask:!0,transparent:!1,blend:null,autoUpdateTextureStatus:!0,uniforms:{},vertexDefines:{},fragmentDefines:{},_textureStatus:{},_enabledUniforms:null}}),(function(){this.name||(this.name="MATERIAL_"+this.__uid__),this.shader&&this.attachShader(this.shader,!0)}),{precision:"highp",setUniform:function(t,e){void 0===e&&console.warn('Uniform value "'+t+'" is undefined');var n=this.uniforms[t];n&&("string"==typeof e&&(e=eT(e)||e),n.value=e,this.autoUpdateTextureStatus&&"t"===n.type&&(e?this.enableTexture(t):this.disableTexture(t)))},setUniforms:function(t){for(var e in t){var n=t[e];this.setUniform(e,n)}},isUniformEnabled:function(t){return 0<=this._enabledUniforms.indexOf(t)},getEnabledUniforms:function(){return this._enabledUniforms},getTextureUniforms:function(){return this._textureUniforms},set:function(t,e){if("object"==typeof t)for(var n in t){var r=t[n];this.setUniform(n,r)}else this.setUniform(t,e)},get:function(t){if(t=this.uniforms[t],t)return t.value},attachShader:function(t,e){var n=this.uniforms;this.uniforms=t.createUniforms(),this.shader=t;var r=this.uniforms;this._enabledUniforms=Object.keys(r),this._enabledUniforms.sort(),this._textureUniforms=this._enabledUniforms.filter((function(t){return t=this.uniforms[t].type,"t"===t||"tv"===t}),this);var i=this.vertexDefines,o=this.fragmentDefines;if(this.vertexDefines=Lb.clone(t.vertexDefines),this.fragmentDefines=Lb.clone(t.fragmentDefines),e){for(var a in n)r[a]&&(r[a].value=n[a].value);Lb.defaults(this.vertexDefines,i),Lb.defaults(this.fragmentDefines,o)}var s,l={};for(s in t.textures)l[s]={shaderType:t.textures[s].shaderType,type:t.textures[s].type,enabled:!(!e||!this._textureStatus[s])&&this._textureStatus[s].enabled};this._textureStatus=l,this._programKey=""},clone:function(){var t,e=new this.constructor({name:this.name,shader:this.shader});for(t in this.uniforms)e.uniforms[t].value=this.uniforms[t].value;return e.depthTest=this.depthTest,e.depthMask=this.depthMask,e.transparent=this.transparent,e.blend=this.blend,e.vertexDefines=Lb.clone(this.vertexDefines),e.fragmentDefines=Lb.clone(this.fragmentDefines),e.enableTexture(this.getEnabledTextures()),e.precision=this.precision,e},define:function(t,e,n){var r=this.vertexDefines,i=this.fragmentDefines;"vertex"!==t&&"fragment"!==t&&"both"!==t&&arguments.length<3&&(n=e,e=t,t="both"),n=null!=n?n:null,"vertex"!==t&&"both"!==t||r[e]!==n&&(r[e]=n,this._programKey=""),"fragment"!==t&&"both"!==t||i[e]!==n&&(i[e]=n,"both"!==t&&(this._programKey=""))},undefine:function(t,e){"vertex"!==t&&"fragment"!==t&&"both"!==t&&arguments.length<2&&(e=t,t="both"),"vertex"!==t&&"both"!==t||this.isDefined("vertex",e)&&(delete this.vertexDefines[e],this._programKey=""),"fragment"!==t&&"both"!==t||this.isDefined("fragment",e)&&(delete this.fragmentDefines[e],"both"!==t&&(this._programKey=""))},isDefined:function(t,e){switch(t){case"vertex":return void 0!==this.vertexDefines[e];case"fragment":return void 0!==this.fragmentDefines[e]}},getDefine:function(t,e){switch(t){case"vertex":return this.vertexDefines[e];case"fragment":return this.fragmentDefines[e]}},enableTexture:function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)this.enableTexture(t[e]);else{var n=this._textureStatus[t];n&&(n.enabled||(n.enabled=!0,this._programKey=""))}},enableTexturesAll:function(){var t,e=this._textureStatus;for(t in e)e[t].enabled=!0;this._programKey=""},disableTexture:function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)this.disableTexture(t[e]);else{var n=this._textureStatus[t];!n||n.enabled&&(n.enabled=!1,this._programKey="")}},disableTexturesAll:function(){var t,e=this._textureStatus;for(t in e)e[t].enabled=!1;this._programKey=""},isTextureEnabled:function(t){var e=this._textureStatus;return!!e[t]&&e[t].enabled},getEnabledTextures:function(){var t,e=[],n=this._textureStatus;for(t in n)n[t].enabled&&e.push(t);return e},dirtyDefines:function(){this._programKey=""},getProgramKey:function(){return this._programKey||(this._programKey=function(t,e,n){n.sort();for(var r=[],i=0;i<n.length;i++){var o=n[i];r.push(o)}return t=rT(t)+"\n"+rT(e)+"\n"+r.join("\n"),nT[t]||(e=Lb.genGUID(),nT[t]=e)}(this.vertexDefines,this.fragmentDefines,this.getEnabledTextures())),this._programKey}}),aT=Array,sT=Math.random;ur={create:function(){var t=new aT(2);return t[0]=0,t[1]=0,t},clone:function(t){var e=new aT(2);return e[0]=t[0],e[1]=t[1],e},fromValues:function(t,e){var n=new aT(2);return n[0]=t,n[1]=e,n},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t},set:function(t,e,n){return t[0]=e,t[1]=n,t},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},subtract:function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}};function lT(t,e){this.array=uT.fromValues(t=t||0,e=e||0),this._dirty=!0}ur.sub=ur.subtract,ur.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t},ur.mul=ur.multiply,ur.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t},ur.div=ur.divide,ur.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},ur.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},ur.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},ur.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t},ur.distance=function(t,e){var n=e[0]-t[0];t=e[1]-t[1];return Math.sqrt(n*n+t*t)},ur.dist=ur.distance,ur.squaredDistance=function(t,e){var n=e[0]-t[0];t=e[1]-t[1];return n*n+t*t},ur.sqrDist=ur.squaredDistance,ur.length=function(t){var e=t[0];t=t[1];return Math.sqrt(e*e+t*t)},ur.len=ur.length,ur.squaredLength=function(t){var e=t[0];t=t[1];return e*e+t*t},ur.sqrLen=ur.squaredLength,ur.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},ur.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},ur.normalize=function(t,e){var n=e[0],r=e[1];r=n*n+r*r;return 0<r&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r),t},ur.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},ur.cross=function(t,e,n){return n=e[0]*n[1]-e[1]*n[0],t[0]=t[1]=0,t[2]=n,t},ur.lerp=function(t,e,n,r){var i=e[0];e=e[1];return t[0]=i+r*(n[0]-i),t[1]=e+r*(n[1]-e),t},ur.random=function(t,e){e=e||1;var n=2*GLMAT_RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},ur.transformMat2=function(t,e,n){var r=e[0];e=e[1];return t[0]=n[0]*r+n[2]*e,t[1]=n[1]*r+n[3]*e,t},ur.transformMat2d=function(t,e,n){var r=e[0];e=e[1];return t[0]=n[0]*r+n[2]*e+n[4],t[1]=n[1]*r+n[3]*e+n[5],t},ur.transformMat3=function(t,e,n){var r=e[0];e=e[1];return t[0]=n[0]*r+n[3]*e+n[6],t[1]=n[1]*r+n[4]*e+n[7],t},ur.transformMat4=function(t,e,n){var r=e[0];e=e[1];return t[0]=n[0]*r+n[4]*e+n[12],t[1]=n[1]*r+n[5]*e+n[13],t},ur.forEach=(iT=ur.create(),function(t,e,n,r,i,o){var a,s;for(e=e||2,n=n||0,s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)iT[0]=t[a],iT[1]=t[a+1],i(iT,iT,o),t[a]=iT[0],t[a+1]=iT[1];return t});var uT=ur;lT.prototype={constructor:lT,add:function(t){return uT.add(this.array,this.array,t.array),this._dirty=!0,this},set:function(t,e){return this.array[0]=t,this.array[1]=e,this._dirty=!0,this},setArray:function(t){return this.array[0]=t[0],this.array[1]=t[1],this._dirty=!0,this},clone:function(){return new lT(this.x,this.y)},copy:function(t){return uT.copy(this.array,t.array),this._dirty=!0,this},cross:function(t,e){return uT.cross(t.array,this.array,e.array),t._dirty=!0,this},dist:function(t){return uT.dist(this.array,t.array)},distance:function(t){return uT.distance(this.array,t.array)},div:function(t){return uT.div(this.array,this.array,t.array),this._dirty=!0,this},divide:function(t){return uT.divide(this.array,this.array,t.array),this._dirty=!0,this},dot:function(t){return uT.dot(this.array,t.array)},len:function(){return uT.len(this.array)},length:function(){return uT.length(this.array)},lerp:function(t,e,n){return uT.lerp(this.array,t.array,e.array,n),this._dirty=!0,this},min:function(t){return uT.min(this.array,this.array,t.array),this._dirty=!0,this},max:function(t){return uT.max(this.array,this.array,t.array),this._dirty=!0,this},mul:function(t){return uT.mul(this.array,this.array,t.array),this._dirty=!0,this},multiply:function(t){return uT.multiply(this.array,this.array,t.array),this._dirty=!0,this},negate:function(){return uT.negate(this.array,this.array),this._dirty=!0,this},normalize:function(){return uT.normalize(this.array,this.array),this._dirty=!0,this},random:function(t){return uT.random(this.array,t),this._dirty=!0,this},scale:function(t){return uT.scale(this.array,this.array,t),this._dirty=!0,this},scaleAndAdd:function(t,e){return uT.scaleAndAdd(this.array,this.array,t.array,e),this._dirty=!0,this},sqrDist:function(t){return uT.sqrDist(this.array,t.array)},squaredDistance:function(t){return uT.squaredDistance(this.array,t.array)},sqrLen:function(){return uT.sqrLen(this.array)},squaredLength:function(){return uT.squaredLength(this.array)},sub:function(t){return uT.sub(this.array,this.array,t.array),this._dirty=!0,this},subtract:function(t){return uT.subtract(this.array,this.array,t.array),this._dirty=!0,this},transformMat2:function(t){return uT.transformMat2(this.array,this.array,t.array),this._dirty=!0,this},transformMat2d:function(t){return uT.transformMat2d(this.array,this.array,t.array),this._dirty=!0,this},transformMat3:function(t){return uT.transformMat3(this.array,this.array,t.array),this._dirty=!0,this},transformMat4:function(t){return uT.transformMat4(this.array,this.array,t.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}},Object.defineProperty&&(fS=lT.prototype,Object.defineProperty(fS,"x",{get:function(){return this.array[0]},set:function(t){this.array[0]=t,this._dirty=!0}}),Object.defineProperty(fS,"y",{get:function(){return this.array[1]},set:function(t){this.array[1]=t,this._dirty=!0}})),lT.add=function(t,e,n){return uT.add(t.array,e.array,n.array),t._dirty=!0,t},lT.set=function(t,e,n){return uT.set(t.array,e,n),t._dirty=!0,t},lT.copy=function(t,e){return uT.copy(t.array,e.array),t._dirty=!0,t},lT.cross=function(t,e,n){return uT.cross(t.array,e.array,n.array),t._dirty=!0,t},lT.distance=lT.dist=function(t,e){return uT.distance(t.array,e.array)},lT.divide=lT.div=function(t,e,n){return uT.divide(t.array,e.array,n.array),t._dirty=!0,t},lT.dot=function(t,e){return uT.dot(t.array,e.array)},lT.len=function(t){return uT.length(t.array)},lT.lerp=function(t,e,n,r){return uT.lerp(t.array,e.array,n.array,r),t._dirty=!0,t},lT.min=function(t,e,n){return uT.min(t.array,e.array,n.array),t._dirty=!0,t},lT.max=function(t,e,n){return uT.max(t.array,e.array,n.array),t._dirty=!0,t},lT.multiply=lT.mul=function(t,e,n){return uT.multiply(t.array,e.array,n.array),t._dirty=!0,t},lT.negate=function(t,e){return uT.negate(t.array,e.array),t._dirty=!0,t},lT.normalize=function(t,e){return uT.normalize(t.array,e.array),t._dirty=!0,t},lT.random=function(t,e){return uT.random(t.array,e),t._dirty=!0,t},lT.scale=function(t,e,n){return uT.scale(t.array,e.array,n),t._dirty=!0,t},lT.scaleAndAdd=function(t,e,n,r){return uT.scaleAndAdd(t.array,e.array,n.array,r),t._dirty=!0,t},lT.squaredDistance=lT.sqrDist=function(t,e){return uT.sqrDist(t.array,e.array)},lT.squaredLength=lT.sqrLen=function(t){return uT.sqrLen(t.array)},lT.subtract=lT.sub=function(t,e,n){return uT.subtract(t.array,e.array,n.array),t._dirty=!0,t},lT.transformMat2=function(t,e,n){return uT.transformMat2(t.array,e.array,n.array),t._dirty=!0,t},lT.transformMat2d=function(t,e,n){return uT.transformMat2d(t.array,e.array,n.array),t._dirty=!0,t},lT.transformMat3=function(t,e,n){return uT.transformMat3(t.array,e.array,n.array),t._dirty=!0,t},lT.transformMat4=function(t,e,n){return uT.transformMat4(t.array,e.array,n.array),t._dirty=!0,t};var hT=lT,cT={};function dT(t,e,n){if(!t.getShaderParameter(e,t.COMPILE_STATUS))return[t.getShaderInfoLog(e),function(t){for(var e=t.split("\n"),n=0,r=e.length;n<r;n++)e[n]=n+1+": "+e[n];return e.join("\n")}(n)].join("\n")}var pT=new Fb.a.Float32Array(16),fT=wu.extend({uniformSemantics:{},attributes:{}},(function(){this._locations={},this._textureSlot=0,this._program=null}),{bind:function(t){this._textureSlot=0,t.gl.useProgram(this._program)},hasUniform:function(t){return t=this._locations[t],null!=t},useTextureSlot:function(t,e,n){e&&(t.gl.activeTexture(t.gl.TEXTURE0+n),e.isRenderable()?e.bind(t):e.unbind(t))},currentTextureSlot:function(){return this._textureSlot},resetTextureSlot:function(t){this._textureSlot=t||0},takeCurrentTextureSlot:function(t,e){var n=this._textureSlot;return this.useTextureSlot(t,e,n),this._textureSlot++,n},setUniform:function(t,e,n,r){var i=this._locations[n];if(null==i)return!1;switch(e){case"m4":if(!(r instanceof Float32Array)){for(var o=0;o<r.length;o++)pT[o]=r[o];r=pT}t.uniformMatrix4fv(i,!1,r);break;case"2i":t.uniform2i(i,r[0],r[1]);break;case"2f":t.uniform2f(i,r[0],r[1]);break;case"3i":t.uniform3i(i,r[0],r[1],r[2]);break;case"3f":t.uniform3f(i,r[0],r[1],r[2]);break;case"4i":t.uniform4i(i,r[0],r[1],r[2],r[3]);break;case"4f":t.uniform4f(i,r[0],r[1],r[2],r[3]);break;case"1i":t.uniform1i(i,r);break;case"1f":t.uniform1f(i,r);break;case"1fv":t.uniform1fv(i,r);break;case"1iv":t.uniform1iv(i,r);break;case"2iv":t.uniform2iv(i,r);break;case"2fv":t.uniform2fv(i,r);break;case"3iv":t.uniform3iv(i,r);break;case"3fv":t.uniform3fv(i,r);break;case"4iv":t.uniform4iv(i,r);break;case"4fv":t.uniform4fv(i,r);break;case"m2":case"m2v":t.uniformMatrix2fv(i,!1,r);break;case"m3":case"m3v":t.uniformMatrix3fv(i,!1,r);break;case"m4v":if(Array.isArray(r)&&Array.isArray(r[0])){var a=new Fb.a.Float32Array(16*r.length),s=0;for(o=0;o<r.length;o++)for(var l=r[o],u=0;u<16;u++)a[s++]=l[u];t.uniformMatrix4fv(i,!1,a)}else t.uniformMatrix4fv(i,!1,r)}return!0},setUniformOfSemantic:function(t,e,n){return e=this.uniformSemantics[e],!!e&&this.setUniform(t,e.type,e.symbol,n)},enableAttributes:function(t,e,n){var r=t.gl,i=this._program,o=this._locations,a=n?n.__enabledAttributeList:cT[t.__uid__];a=a||(n?n.__enabledAttributeList=[]:cT[t.__uid__]=[]);for(var s=[],l=0;l<e.length;l++){var u=e[l];if(this.attributes[u]){var h=o[u];if(null==h){if(-1===(h=r.getAttribLocation(i,u))){s[l]=-1;continue}o[u]=h}a[s[l]=h]?a[h]=2:a[h]=1}else s[l]=-1}for(l=0;l<a.length;l++)switch(a[l]){case 1:r.enableVertexAttribArray(l),a[l]=3;break;case 2:a[l]=3;break;case 3:r.disableVertexAttribArray(l),a[l]=0}return s},getAttribLocation:function(t,e){var n=this._locations,r=n[e];return null==r&&(r=t.getAttribLocation(this._program,e),n[e]=r),r},buildProgram:function(t,e,n,r){var i=t.createShader(t.VERTEX_SHADER),o=t.createProgram();t.shaderSource(i,n),t.compileShader(i);var a=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(a,r),t.compileShader(a);var s=dT(t,i,n);if(s)return s;if(s=dT(t,a,r))return s;if(t.attachShader(o,i),t.attachShader(o,a),e.attributeSemantics.POSITION?t.bindAttribLocation(o,0,e.attributeSemantics.POSITION.symbol):(s=Object.keys(this.attributes),t.bindAttribLocation(o,0,s[0])),t.linkProgram(o),t.deleteShader(i),t.deleteShader(a),this._program=o,this.vertexCode=n,this.fragmentCode=r,!t.getProgramParameter(o,t.LINK_STATUS))return"Could not link program\n"+t.getProgramInfoLog(o);for(var l=0;l<e.uniforms.length;l++){var u=e.uniforms[l];this._locations[u]=t.getUniformLocation(o,u)}}}),gT=/for\s*?\(int\s*?_idx_\s*\=\s*([\w-]+)\;\s*_idx_\s*<\s*([\w-]+);\s*_idx_\s*\+\+\s*\)\s*\{\{([\s\S]+?)(?=\}\})\}\}/g;function mT(t,e,n){var r,i={};for(r in n)i[r+"_COUNT"]=n[r];return t.replace(gT,(function(t,n,r,o){var a="";isNaN(n)&&(n=(n in e?e:i)[n]),isNaN(r)&&(r=(r in e?e:i)[r]);for(var s=parseInt(n);s<parseInt(r);s++)a+="{"+o.replace(/float\s*\(\s*_idx_\s*\)/g,s.toFixed(1)).replace(/_idx_/g,s)+"}";return a}))}function yT(t,e,n){var r=[];if(e)for(var i in e){var o=e[i];0<o&&r.push("#define "+i.toUpperCase()+"_COUNT "+o)}if(n)for(var a=0;a<n.length;a++){var s=n[a];r.push("#define "+s.toUpperCase()+"_ENABLED")}for(s in t){var l=t[s];null===l?r.push("#define "+s):r.push("#define "+s+" "+l.toString())}return r.join("\n")}function _T(t){this._renderer=t,this._cache={}}_T.prototype.getProgram=function(t,e,n){var r=this._cache,i=t.isSkinnedMesh&&t.isSkinnedMesh(),o=t.isInstancedMesh&&t.isInstancedMesh(),a="s"+e.shader.shaderID+"m"+e.getProgramKey();n&&(a+="se"+n.getProgramKey(t.lightGroup)),i&&(a+=",sk"+t.joints.length),o&&(a+=",is");var s=r[a];if(s)return s;var l=n?n.getLightsNumbers(t.lightGroup):{},u=this._renderer,h=u.gl,c=e.getEnabledTextures();n="";return i&&(i={SKINNING:null,JOINT_COUNT:t.joints.length},t.joints.length>u.getMaxJointNumber()&&(i.USE_SKIN_MATRICES_TEXTURE=null),n+="\n"+yT(i)+"\n"),o&&(n+="\n#define INSTANCING\n"),o=n+yT(e.vertexDefines,l,c),n+=yT(e.fragmentDefines,l,c),c=o+"\n"+e.shader.vertex,o=["OES_standard_derivatives","EXT_shader_texture_lod"].filter((function(t){return null!=u.getGLExtension(t)})),0<=o.indexOf("EXT_shader_texture_lod")&&(n+="\n#define SUPPORT_TEXTURE_LOD"),0<=o.indexOf("OES_standard_derivatives")&&(n+="\n#define SUPPORT_STANDARD_DERIVATIVES"),n=function(t){for(var e=[],n=0;n<t.length;n++)e.push("#extension GL_"+t[n]+" : enable");return e.join("\n")}(o)+"\n"+["precision",o=e.precision,"float"].join(" ")+";\n"+["precision",o,"int"].join(" ")+";\n"+["precision",o,"sampler2D"].join(" ")+";\n\n"+n+"\n"+e.shader.fragment,c=mT(c,e.vertexDefines,l),l=mT(n,e.fragmentDefines,l),(s=new fT).uniformSemantics=e.shader.uniformSemantics,s.attributes=e.shader.attributes,l=s.buildProgram(h,e.shader,c,l),s.__error=l,r[a]=s};var vT=_T,xT=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g,bT=/attribute\s+(float|int|vec2|vec3|vec4)\s+([\s\S]*?);/g,TT=/#define\s+(\w+)?(\s+[\d-.]+)?\s*;?\s*\n/g,wT={bool:"1i",int:"1i",sampler2D:"t",samplerCube:"t",float:"1f",vec2:"2f",vec3:"3f",vec4:"4f",ivec2:"2i",ivec3:"3i",ivec4:"4i",mat2:"m2",mat3:"m3",mat4:"m4"};function ST(t){for(var e=[],n=0;n<t;n++)e[n]=0;return e}var MT={bool:function(){return!0},int:function(){return 0},float:function(){return 0},sampler2D:function(){return null},samplerCube:function(){return null},vec2:function(){return ST(2)},vec3:function(){return ST(3)},vec4:function(){return ST(4)},ivec2:function(){return ST(2)},ivec3:function(){return ST(3)},ivec4:function(){return ST(4)},mat2:function(){return ST(4)},mat3:function(){return ST(9)},mat4:function(){return ST(16)},array:function(){return[]}},AT=["POSITION","NORMAL","BINORMAL","TANGENT","TEXCOORD","TEXCOORD_0","TEXCOORD_1","COLOR","JOINT","WEIGHT"],CT=["SKIN_MATRIX","VIEWPORT_SIZE","VIEWPORT","DEVICEPIXELRATIO","WINDOW_SIZE","NEAR","FAR","TIME"],ET=["WORLD","VIEW","PROJECTION","WORLDVIEW","VIEWPROJECTION","WORLDVIEWPROJECTION","WORLDINVERSE","VIEWINVERSE","PROJECTIONINVERSE","WORLDVIEWINVERSE","VIEWPROJECTIONINVERSE","WORLDVIEWPROJECTIONINVERSE","WORLDTRANSPOSE","VIEWTRANSPOSE","PROJECTIONTRANSPOSE","WORLDVIEWTRANSPOSE","VIEWPROJECTIONTRANSPOSE","WORLDVIEWPROJECTIONTRANSPOSE","WORLDINVERSETRANSPOSE","VIEWINVERSETRANSPOSE","PROJECTIONINVERSETRANSPOSE","WORLDVIEWINVERSETRANSPOSE","VIEWPROJECTIONINVERSETRANSPOSE","WORLDVIEWPROJECTIONINVERSETRANSPOSE"],IT={vec4:4,vec3:3,vec2:2,float:1},DT={},RT={};function LT(t){return t.replace(/[ \t]*\/\/.*\n/g,"").replace(/[ \t]*\/\*[\s\S]*?\*\//g,"")}function OT(){console.error("Wrong uniform/attributes syntax")}function PT(t,e){for(var n=/[,=\(\):]/,r=e.replace(/:\s*\[\s*(.*)\s*\]/g,"="+t+"($1)").replace(/\s+/g,"").split(/(?=[,=\(\):])/g),i=[],o=0;o<r.length;o++)r[o].match(n)?i.push(r[o].charAt(0),r[o].slice(1)):i.push(r[o]);var a,s=0,l={},u=null;function h(t){t||OT();var e=t.match(/\[(.*?)\]/);a=t.replace(/\[(.*?)\]/,""),l[a]={},e&&(l[a].isArray=!0,l[a].arraySize=e[1])}for(h((r=i)[0]),o=1;o<r.length;o++){var c,d=r[o];if(d)if("="!==d)if(":"!==d)if(","!==d)if(")"!==d)if("("!==d)if(0<=d.indexOf("vec")){if(1!==s&&4!==s){OT();break}s=2,u=[]}else 1!==s?4!==s?(h(d),s=0):0<=AT.indexOf(c=d)||0<=CT.indexOf(c)||0<=ET.indexOf(c)?l[a].semantic=c:"ignore"===c||"unconfigurable"===c?l[a].ignore=!0:l[a].value="bool"===t?"true"===c:parseFloat(c):(l[a].value="bool"===t?"true"===d:parseFloat(d),u=null);else{if(2!==s){OT();break}if(!(u instanceof Array)){OT();break}u.push(+r[++o])}else l[a].value=new Fb.a.Float32Array(u),u=null,s=5;else if(2===s){if(!(u instanceof Array)){OT();break}u.push(+r[++o])}else s=5;else s=4;else{if(0!==s&&3!==s){OT();break}s=1}}return l}function NT(t,e){"object"==typeof t&&(e=t.fragment,t=t.vertex),t=LT(t),e=LT(e),this._shaderID=function(t,e){var n="vertex:"+t+"fragment:"+e;if(DT[n])return DT[n];var r=Lb.genGUID();return DT[n]=r,RT[r]={vertex:t,fragment:e},r}(t,e),this._vertexCode=NT.parseImport(t),this._fragmentCode=NT.parseImport(e),this.attributeSemantics={},this.matrixSemantics={},this.uniformSemantics={},this.matrixSemanticKeys=[],this.uniformTemplates={},this.attributes={},this.textures={},this.vertexDefines={},this.fragmentDefines={},this._parseAttributes(),this._parseUniforms(),this._parseDefines()}NT.prototype={constructor:NT,createUniforms:function(){var t,e={};for(t in this.uniformTemplates){var n=this.uniformTemplates[t];e[t]={type:n.type,value:n.value()}}return e},_parseImport:function(){this._vertexCode=NT.parseImport(this.vertex),this._fragmentCode=NT.parseImport(this.fragment)},_addSemanticUniform:function(t,e,n){var r,i;0<=AT.indexOf(n)?this.attributeSemantics[n]={symbol:t,type:e}:0<=ET.indexOf(n)?(r=!1,(i=n).match(/TRANSPOSE$/)&&(r=!0,i=n.slice(0,-9)),this.matrixSemantics[n]={symbol:t,type:e,isTranspose:r,semanticNoTranspose:i}):0<=CT.indexOf(n)&&(this.uniformSemantics[n]={symbol:t,type:e})},_addMaterialUniform:function(t,e,n,r,i,o){o[t]={type:n,value:i?MT.array:r||MT[e],semantic:null}},_parseUniforms:function(){var t={},e=this,n="vertex";function r(r,i,o){var a,s=PT(i,o),l=[];for(a in s){var u=s[a],h=u.semantic,c=a,d=wT[i],p=function(t){return null!=t?function(){return t}:null}(s[a].value);s[a].isArray&&(c+="["+s[a].arraySize+"]",d+="v"),l.push(c),e._uniformList.push(a),u.ignore||("sampler2D"!==i&&"samplerCube"!==i||(e.textures[a]={shaderType:n,type:i}),h?e._addSemanticUniform(a,d,h):e._addMaterialUniform(a,i,d,p,s[a].isArray,t))}return 0<l.length?"uniform "+i+" "+l.join(",")+";\n":""}this._uniformList=[],this._vertexCode=this._vertexCode.replace(xT,r),n="fragment",this._fragmentCode=this._fragmentCode.replace(xT,r),e.matrixSemanticKeys=Object.keys(this.matrixSemantics),this.uniformTemplates=t},_parseAttributes:function(){var t={},e=this;this._vertexCode=this._vertexCode.replace(bT,(function(n,r,i){var o,a=PT(r,i),s=IT[r]||1,l=[];for(o in a){var u=a[o].semantic;if(t[o]={type:"float",size:s,semantic:u||null},u){if(AT.indexOf(u)<0)throw new Error('Unkown semantic "'+u+'"');e.attributeSemantics[u]={symbol:o,type:r}}l.push(o)}return"attribute "+r+" "+l.join(",")+";\n"})),this.attributes=t},_parseDefines:function(){var t=this,e="vertex";function n(n,r,i){var o="vertex"===e?t.vertexDefines:t.fragmentDefines;return o[r]||(o[r]="false"!==i&&("true"===i||(i?isNaN(parseFloat(i))?i.trim():parseFloat(i):null))),""}this._vertexCode=this._vertexCode.replace(TT,n),e="fragment",this._fragmentCode=this._fragmentCode.replace(TT,n)},clone:function(){var t=RT[this._shaderID];return new NT(t.vertex,t.fragment)}},Object.defineProperty&&(Object.defineProperty(NT.prototype,"shaderID",{get:function(){return this._shaderID}}),Object.defineProperty(NT.prototype,"vertex",{get:function(){return this._vertexCode}}),Object.defineProperty(NT.prototype,"fragment",{get:function(){return this._fragmentCode}}),Object.defineProperty(NT.prototype,"uniforms",{get:function(){return this._uniformList}}));var kT=/(@import)\s*([0-9a-zA-Z_\-\.]*)/g;NT.parseImport=function(t){return t.replace(kT,(function(t,e,n){return(t=NT.source(n))?NT.parseImport(t):(console.error('Shader chunk "'+n+'" not existed in library'),"")}))};var BT=/(@export)\s*([0-9a-zA-Z_\-\.]*)\s*\n([\s\S]*?)@end/g;NT.import=function(t){t.replace(BT,(function(t,e,n,r){if(r=r.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+\x24)/g,"")){for(var i,o=n.split("."),a=NT.codes,s=0;s<o.length-1;)a[i=o[s++]]||(a[i]={}),a=a[i];a[i=o[s]]=r}return r}))},NT.codes={},NT.source=function(t){for(var e=t.split("."),n=NT.codes,r=0;n&&r<e.length;)n=n[e[r++]];return"string"!=typeof n?(console.error('Shader "'+t+'" not existed in library'),""):n};var FT=NT,zT=(co="@export clay.prez.vertex\nuniform mat4 WVP : WORLDVIEWPROJECTION;\nattribute vec3 pos : POSITION;\nattribute vec2 uv : TEXCOORD_0;\nuniform vec2 uvRepeat : [1.0, 1.0];\nuniform vec2 uvOffset : [0.0, 0.0];\n@import clay.chunk.skinning_header\n@import clay.chunk.instancing_header\nvarying vec2 v_Texcoord;\nvoid main()\n{\n vec4 P = vec4(pos, 1.0);\n#ifdef SKINNING\n @import clay.chunk.skin_matrix\n P = skinMatrixWS * P;\n#endif\n#ifdef INSTANCING\n @import clay.chunk.instancing_matrix\n P = instanceMat * P;\n#endif\n gl_Position = WVP * P;\n v_Texcoord = uv * uvRepeat + uvOffset;\n}\n@end\n@export clay.prez.fragment\nuniform sampler2D alphaMap;\nuniform float alphaCutoff: 0.0;\nvarying vec2 v_Texcoord;\nvoid main()\n{\n if (alphaCutoff > 0.0) {\n if (texture2D(alphaMap, v_Texcoord).a <= alphaCutoff) {\n discard;\n }\n }\n gl_FragColor = vec4(0.0,0.0,0.0,1.0);\n}\n@end",{create:function(){var t=new aT(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},clone:function(t){var e=new aT(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},transpose:function(t,e){var n,r,i,o,a,s;return t===e?(n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s):(t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]),t},invert:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],h=e[8],c=e[9],d=e[10],p=e[11],f=e[12],g=e[13],m=e[14],y=e[15],_=n*s-r*a,v=n*l-i*a,x=n*u-o*a,b=r*l-i*s,T=r*u-o*s,w=i*u-o*l,S=h*g-c*f,M=h*m-d*f,A=h*y-p*f,C=c*m-d*g,E=c*y-p*g,I=d*y-p*m;e=_*I-v*E+x*C+b*A-T*M+w*S;return e?(t[0]=(s*I-l*E+u*C)*(e=1/e),t[1]=(i*E-r*I-o*C)*e,t[2]=(g*w-m*T+y*b)*e,t[3]=(d*T-c*w-p*b)*e,t[4]=(l*A-a*I-u*M)*e,t[5]=(n*I-i*A+o*M)*e,t[6]=(m*x-f*w-y*v)*e,t[7]=(h*w-d*x+p*v)*e,t[8]=(a*E-s*A+u*S)*e,t[9]=(r*A-n*E-o*S)*e,t[10]=(f*T-g*x+y*_)*e,t[11]=(c*x-h*T-p*_)*e,t[12]=(s*M-a*C-l*S)*e,t[13]=(n*C-r*M+i*S)*e,t[14]=(g*v-f*b-m*_)*e,t[15]=(h*b-c*v+d*_)*e,t):null},adjoint:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],h=e[8],c=e[9],d=e[10],p=e[11],f=e[12],g=e[13],m=e[14];e=e[15];return t[0]=s*(d*e-p*m)-c*(l*e-u*m)+g*(l*p-u*d),t[1]=-(r*(d*e-p*m)-c*(i*e-o*m)+g*(i*p-o*d)),t[2]=r*(l*e-u*m)-s*(i*e-o*m)+g*(i*u-o*l),t[3]=-(r*(l*p-u*d)-s*(i*p-o*d)+c*(i*u-o*l)),t[4]=-(a*(d*e-p*m)-h*(l*e-u*m)+f*(l*p-u*d)),t[5]=n*(d*e-p*m)-h*(i*e-o*m)+f*(i*p-o*d),t[6]=-(n*(l*e-u*m)-a*(i*e-o*m)+f*(i*u-o*l)),t[7]=n*(l*p-u*d)-a*(i*p-o*d)+h*(i*u-o*l),t[8]=a*(c*e-p*g)-h*(s*e-u*g)+f*(s*p-u*c),t[9]=-(n*(c*e-p*g)-h*(r*e-o*g)+f*(r*p-o*c)),t[10]=n*(s*e-u*g)-a*(r*e-o*g)+f*(r*u-o*s),t[11]=-(n*(s*p-u*c)-a*(r*p-o*c)+h*(r*u-o*s)),t[12]=-(a*(c*m-d*g)-h*(s*m-l*g)+f*(s*d-l*c)),t[13]=n*(c*m-d*g)-h*(r*m-i*g)+f*(r*d-i*c),t[14]=-(n*(s*m-l*g)-a*(r*m-i*g)+f*(r*l-i*s)),t[15]=n*(s*d-l*c)-a*(r*d-i*c)+h*(r*l-i*s),t},determinant:function(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],l=t[7],u=t[8],h=t[9],c=t[10],d=t[11],p=t[12],f=t[13],g=t[14];t=t[15];return(e*a-n*o)*(c*t-d*g)-(e*s-r*o)*(h*t-d*f)+(e*l-i*o)*(h*g-c*f)+(n*s-r*a)*(u*t-d*p)-(n*l-i*a)*(u*g-c*p)+(r*l-i*s)*(u*f-h*p)},multiply:function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],h=e[7],c=e[8],d=e[9],p=e[10],f=e[11],g=e[12],m=e[13],y=e[14],_=e[15],v=n[0],x=n[1],b=n[2];e=n[3];return t[0]=v*r+x*s+b*c+e*g,t[1]=v*i+x*l+b*d+e*m,t[2]=v*o+x*u+b*p+e*y,t[3]=v*a+x*h+b*f+e*_,v=n[4],x=n[5],b=n[6],e=n[7],t[4]=v*r+x*s+b*c+e*g,t[5]=v*i+x*l+b*d+e*m,t[6]=v*o+x*u+b*p+e*y,t[7]=v*a+x*h+b*f+e*_,v=n[8],x=n[9],b=n[10],e=n[11],t[8]=v*r+x*s+b*c+e*g,t[9]=v*i+x*l+b*d+e*m,t[10]=v*o+x*u+b*p+e*y,t[11]=v*a+x*h+b*f+e*_,v=n[12],x=n[13],b=n[14],e=n[15],t[12]=v*r+x*s+b*c+e*g,t[13]=v*i+x*l+b*d+e*m,t[14]=v*o+x*u+b*p+e*y,t[15]=v*a+x*h+b*f+e*_,t},multiplyAffine:function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[4],s=e[5],l=e[6],u=e[8],h=e[9],c=e[10],d=e[12],p=e[13],f=e[14],g=n[0],m=n[1];e=n[2];return t[0]=g*r+m*a+e*u,t[1]=g*i+m*s+e*h,t[2]=g*o+m*l+e*c,g=n[4],m=n[5],e=n[6],t[4]=g*r+m*a+e*u,t[5]=g*i+m*s+e*h,t[6]=g*o+m*l+e*c,g=n[8],m=n[9],e=n[10],t[8]=g*r+m*a+e*u,t[9]=g*i+m*s+e*h,t[10]=g*o+m*l+e*c,g=n[12],m=n[13],e=n[14],t[12]=g*r+m*a+e*u+d,t[13]=g*i+m*s+e*h+p,t[14]=g*o+m*l+e*c+f,t}});zT.mul=zT.multiply,zT.mulAffine=zT.multiplyAffine,zT.translate=function(t,e,n){var r,i,o,a,s,l,u,h,c,d,p,f=n[0],g=n[1],m=n[2];return e===t?(t[12]=e[0]*f+e[4]*g+e[8]*m+e[12],t[13]=e[1]*f+e[5]*g+e[9]*m+e[13],t[14]=e[2]*f+e[6]*g+e[10]*m+e[14],t[15]=e[3]*f+e[7]*g+e[11]*m+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],h=e[7],c=e[8],d=e[9],p=e[10],n=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=u,t[7]=h,t[8]=c,t[9]=d,t[10]=p,t[11]=n,t[12]=r*f+s*g+c*m+e[12],t[13]=i*f+l*g+d*m+e[13],t[14]=o*f+u*g+p*m+e[14],t[15]=a*f+h*g+n*m+e[15]),t},zT.scale=function(t,e,n){var r=n[0],i=n[1];n=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},zT.rotate=function(t,e,n,r){var i,o,a,s,l,u,h,c,d,p,f,g,m,y,_,v,x,b,T,w=r[0],S=r[1],M=r[2],A=Math.sqrt(w*w+S*S+M*M);return Math.abs(A)<1e-6?null:(w*=A=1/A,S*=A,M*=A,_=Math.sin(n),y=Math.cos(n),o=e[0],a=e[1],s=e[2],l=e[3],u=e[4],h=e[5],c=e[6],d=e[7],p=e[8],f=e[9],g=e[10],m=e[11],v=w*S*(i=1-y)-M*_,x=S*S*i+y,b=M*S*i+w*_,T=w*M*i+S*_,r=S*M*i-w*_,A=M*M*i+y,t[0]=o*(n=w*w*i+y)+u*(y=S*w*i+M*_)+p*(_=M*w*i-S*_),t[1]=a*n+h*y+f*_,t[2]=s*n+c*y+g*_,t[3]=l*n+d*y+m*_,t[4]=o*v+u*x+p*b,t[5]=a*v+h*x+f*b,t[6]=s*v+c*x+g*b,t[7]=l*v+d*x+m*b,t[8]=o*T+u*r+p*A,t[9]=a*T+h*r+f*A,t[10]=s*T+c*r+g*A,t[11]=l*T+d*r+m*A,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},zT.rotateX=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],l=e[7],u=e[8],h=e[9],c=e[10];n=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+u*r,t[5]=a*i+h*r,t[6]=s*i+c*r,t[7]=l*i+n*r,t[8]=u*i-o*r,t[9]=h*i-a*r,t[10]=c*i-s*r,t[11]=n*i-l*r,t},zT.rotateY=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],l=e[3],u=e[8],h=e[9],c=e[10];n=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-u*r,t[1]=a*i-h*r,t[2]=s*i-c*r,t[3]=l*i-n*r,t[8]=o*r+u*i,t[9]=a*r+h*i,t[10]=s*r+c*i,t[11]=l*r+n*i,t},zT.rotateZ=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],l=e[3],u=e[4],h=e[5],c=e[6];n=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+u*r,t[1]=a*i+h*r,t[2]=s*i+c*r,t[3]=l*i+n*r,t[4]=u*i-o*r,t[5]=h*i-a*r,t[6]=c*i-s*r,t[7]=n*i-l*r,t},zT.fromRotationTranslation=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=r+r,l=i+i,u=o+o,h=r*s,c=r*l;e=r*u,r=i*l,i*=u,o*=u,s*=a,l*=a,u*=a;return t[0]=1-(r+o),t[1]=c+u,t[2]=e-l,t[3]=0,t[4]=c-u,t[5]=1-(h+o),t[6]=i+s,t[7]=0,t[8]=e+l,t[9]=i-s,t[10]=1-(h+r),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},zT.fromQuat=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,l=i+i,u=n*a,h=r*a;e=r*s,n=i*a,r=i*s,i*=l,a*=o,s*=o,l*=o;return t[0]=1-e-i,t[1]=h+l,t[2]=n-s,t[3]=0,t[4]=h-l,t[5]=1-u-i,t[6]=r+a,t[7]=0,t[8]=n+s,t[9]=r-a,t[10]=1-u-e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},zT.frustum=function(t,e,n,r,i,o,a){var s=1/(n-e),l=1/(i-r),u=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*l,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*l,t[10]=(a+o)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*u,t[15]=0,t},zT.perspective=function(t,e,n,r,i){var o=1/Math.tan(e/2);e=1/(r-i);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+r)*e,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*r*e,t[15]=0,t},zT.ortho=function(t,e,n,r,i,o,a){var s=1/(e-n),l=1/(r-i),u=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*l,t[14]=(a+o)*u,t[15]=1,t},zT.lookAt=function(t,e,n,r){var i,o=e[0],a=e[1],s=e[2],l=r[0],u=r[1],h=r[2],c=n[0],d=n[1],p=n[2];return Math.abs(o-c)<1e-6&&Math.abs(a-d)<1e-6&&Math.abs(s-p)<1e-6?zT.identity(t):(i=o-c,e=a-d,r=s-p,c=u*(r*=n=1/Math.sqrt(i*i+e*e+r*r))-h*(e*=n),d=h*(i*=n)-l*r,p=l*e-u*i,(n=Math.sqrt(c*c+d*d+p*p))?(c*=n=1/n,d*=n,p*=n):p=d=c=0,h=e*p-r*d,l=r*c-i*p,u=i*d-e*c,(n=Math.sqrt(h*h+l*l+u*u))?(h*=n=1/n,l*=n,u*=n):u=l=h=0,t[0]=c,t[1]=h,t[2]=i,t[3]=0,t[4]=d,t[5]=l,t[6]=e,t[7]=0,t[8]=p,t[9]=u,t[10]=r,t[11]=0,t[12]=-(c*o+d*a+p*s),t[13]=-(h*o+l*a+u*s),t[14]=-(i*o+e*a+r*s),t[15]=1,t)},zT.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))};var HT,VT=zT,UT={create:function(){var t=new aT(3);return t[0]=0,t[1]=0,t[2]=0,t},clone:function(t){var e=new aT(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},fromValues:function(t,e,n){var r=new aT(3);return r[0]=t,r[1]=e,r[2]=n,r},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},set:function(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},subtract:function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}};UT.sub=UT.subtract,UT.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t},UT.mul=UT.multiply,UT.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},UT.div=UT.divide,UT.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},UT.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},UT.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},UT.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t},UT.distance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1];t=e[2]-t[2];return Math.sqrt(n*n+r*r+t*t)},UT.dist=UT.distance,UT.squaredDistance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1];t=e[2]-t[2];return n*n+r*r+t*t},UT.sqrDist=UT.squaredDistance,UT.length=function(t){var e=t[0],n=t[1];t=t[2];return Math.sqrt(e*e+n*n+t*t)},UT.len=UT.length,UT.squaredLength=function(t){var e=t[0],n=t[1];t=t[2];return e*e+n*n+t*t},UT.sqrLen=UT.squaredLength,UT.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},UT.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},UT.normalize=function(t,e){var n=e[0],r=e[1],i=e[2];i=n*n+r*r+i*i;return 0<i&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i),t},UT.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},UT.cross=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0];e=n[1],n=n[2];return t[0]=i*n-o*e,t[1]=o*a-r*n,t[2]=r*e-i*a,t},UT.lerp=function(t,e,n,r){var i=e[0],o=e[1];e=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=e+r*(n[2]-e),t},UT.random=function(t,e){e=e||1;var n=2*sT()*Math.PI,r=2*sT()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t},UT.transformMat4=function(t,e,n){var r=e[0],i=e[1],o=e[2];e=n[3]*r+n[7]*i+n[11]*o+n[15];return t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/(e=e||1),t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/e,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/e,t},UT.transformMat3=function(t,e,n){var r=e[0],i=e[1];e=e[2];return t[0]=r*n[0]+i*n[3]+e*n[6],t[1]=r*n[1]+i*n[4]+e*n[7],t[2]=r*n[2]+i*n[5]+e*n[8],t},UT.transformQuat=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],l=n[2],u=n[3],h=u*r+s*o-l*i;e=u*i+l*r-a*o,n=u*o+a*i-s*r,o=-a*r-s*i-l*o;return t[0]=h*u+o*-a+e*-l-n*-s,t[1]=e*u+o*-s+n*-a-h*-l,t[2]=n*u+o*-l+h*-s-e*-a,t},UT.rotateX=function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},UT.rotateY=function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},UT.rotateZ=function(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},UT.forEach=(HT=UT.create(),function(t,e,n,r,i,o){var a,s;for(e=e||3,n=n||0,s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)HT[0]=t[a],HT[1]=t[a+1],HT[2]=t[a+2],i(HT,HT,o),t[a]=HT[0],t[a+1]=HT[1],t[a+2]=HT[2];return t}),UT.angle=function(t,e){return t=UT.fromValues(t[0],t[1],t[2]),e=UT.fromValues(e[0],e[1],e[2]),UT.normalize(t,t),UT.normalize(e,e),e=UT.dot(t,e),1<e?0:Math.acos(e)};var GT=UT;FT.import(co);var WT=VT.create,XT={};function jT(t){return t.material}function YT(t,e,n){return e.uniforms[n].value}function ZT(t,e,n,r){return n!==r}function qT(t){return!0}function KT(){}var QT={float:Bb.FLOAT,byte:Bb.BYTE,ubyte:Bb.UNSIGNED_BYTE,short:Bb.SHORT,ushort:Bb.UNSIGNED_SHORT};function JT(t,e,n){this.availableAttributes=t,this.availableAttributeSymbols=e,this.indicesBuffer=n,this.vao=null}function $T(t){var e,n;this.bind=function(t){e||((e=Fb.a.createCanvas()).width=e.height=1,e.getContext("2d"));var r=t.gl;t=!n;t&&(n=r.createTexture()),r.bindTexture(r.TEXTURE_2D,n),t&&r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e)},this.unbind=function(t){t.gl.bindTexture(t.gl.TEXTURE_2D,null)},this.isRenderable=function(){return!0}}$r=wu.extend((function(){return{canvas:null,_width:100,_height:100,devicePixelRatio:"undefined"!=typeof window&&window.devicePixelRatio||1,clearColor:[0,0,0,0],clearBit:17664,alpha:!0,depth:!0,stencil:!1,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,throwError:!0,gl:null,viewport:{},maxJointNumber:20,__currentFrameBuffer:null,_viewportStack:[],_clearStack:[],_sceneRendering:null}}),(function(){this.canvas||(this.canvas=Fb.a.createCanvas());var t=this.canvas;try{var e={alpha:this.alpha,depth:this.depth,stencil:this.stencil,antialias:this.antialias,premultipliedAlpha:this.premultipliedAlpha,preserveDrawingBuffer:this.preserveDrawingBuffer};if(this.gl=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!this.gl)throw new Error;this._glinfo=new kb(this.gl),this.gl.targetRenderer&&console.error("Already created a renderer"),(this.gl.targetRenderer=this).resize()}catch(t){throw"Error creating WebGL Context "+t}this._programMgr=new vT(this),this._placeholderTexture=new $T}),{resize:function(t,e){var n=this.canvas,r=this.devicePixelRatio;null!=t?(n.style&&(n.style.width=t+"px",n.style.height=e+"px"),n.width=t*r,n.height=e*r,this._width=t,this._height=e):(this._width=n.width/r,this._height=n.height/r),this.setViewport(0,0,this._width,this._height)},getWidth:function(){return this._width},getHeight:function(){return this._height},getViewportAspect:function(){var t=this.viewport;return t.width/t.height},setDevicePixelRatio:function(t){this.devicePixelRatio=t,this.resize(this._width,this._height)},getDevicePixelRatio:function(){return this.devicePixelRatio},getGLExtension:function(t){return this._glinfo.getExtension(t)},getGLParameter:function(t){return this._glinfo.getParameter(t)},setViewport:function(t,e,n,r,i){var o;"object"==typeof t&&(t=(o=t).x,e=o.y,n=o.width,r=o.height,i=o.devicePixelRatio),i=i||this.devicePixelRatio,this.gl.viewport(t*i,e*i,n*i,r*i),this.viewport={x:t,y:e,width:n,height:r,devicePixelRatio:i}},saveViewport:function(){this._viewportStack.push(this.viewport)},restoreViewport:function(){0<this._viewportStack.length&&this.setViewport(this._viewportStack.pop())},saveClear:function(){this._clearStack.push({clearBit:this.clearBit,clearColor:this.clearColor})},restoreClear:function(){var t;0<this._clearStack.length&&(t=this._clearStack.pop(),this.clearColor=t.clearColor,this.clearBit=t.clearBit)},bindSceneRendering:function(t){this._sceneRendering=t},render:function(t,e,n,r){var i,o,a=this.gl,s=this.clearColor;if(this.clearBit&&(a.colorMask(!0,!0,!0,!0),a.depthMask(!0),l=!1,o=(i=this.viewport).devicePixelRatio,(i.width!==this._width||i.height!==this._height||o&&o!==this.devicePixelRatio||i.x||i.y)&&(l=!0,a.enable(a.SCISSOR_TEST),a.scissor(i.x*o,i.y*o,i.width*o,i.height*o)),a.clearColor(s[0],s[1],s[2],s[3]),a.clear(this.clearBit),l&&a.disable(a.SCISSOR_TEST)),n||t.update(!1),t.updateLights(),e=e||t.getMainCamera()){e.update();var l=t.updateRenderList(e,!0);this._sceneRendering=t;n=l.opaque;var u=l.transparent,h=t.material;t.trigger("beforerender",this,t,e,l),r?(this.renderPreZ(n,t,e),a.depthFunc(a.LEQUAL)):a.depthFunc(a.LESS);for(var c=WT(),d=GT.create(),p=0;p<u.length;p++){var f=u[p];VT.multiplyAffine(c,e.viewMatrix.array,f.worldTransform.array),GT.transformMat4(d,f.position.array,c),f.__depth=d[2]}this.renderPass(n,e,{getMaterial:function(t){return h||t.material},sortCompare:this.opaqueSortCompare}),this.renderPass(u,e,{getMaterial:function(t){return h||t.material},sortCompare:this.transparentSortCompare}),t.trigger("afterrender",this,t,e,l),this._sceneRendering=null}else console.error("Can't find camera in the scene.")},getProgram:function(t,e,n){return e=e||t.material,this._programMgr.getProgram(t,e,n)},validateProgram:function(t){if(t.__error){var e=t.__error;if(!XT[t.__uid__]){if(XT[t.__uid__]=!0,this.throwError)throw new Error(e);this.trigger("error",e)}}},updatePrograms:function(t,e,n){var r=n&&n.getMaterial||jT;e=e||null;for(var i=0;i<t.length;i++){var o=t[i],a=r.call(this,o);if(0<i){var s=t[i-1],l=s.joints?s.joints.length:0;if((o.joints?o.joints.length:0)===l&&o.material===s.material&&o.lightGroup===s.lightGroup){o.__program=s.__program;continue}}a=this._programMgr.getProgram(o,a,e),this.validateProgram(a),o.__program=a}},renderPass:function(t,e,n){this.trigger("beforerenderpass",this,t,e,n),(n=n||{}).getMaterial=n.getMaterial||jT,n.getUniform=n.getUniform||YT,n.isMaterialChanged=n.isMaterialChanged||ZT,n.beforeRender=n.beforeRender||KT,n.afterRender=n.afterRender||KT;var r=n.ifRender||qT;this.updatePrograms(t,this._sceneRendering,n),n.sortCompare&&t.sort(n.sortCompare);var i=this.viewport,o=i.devicePixelRatio,a=[i.x*o,i.y*o,i.width*o,i.height*o],s=(i=this.devicePixelRatio,this.__currentFrameBuffer?[this.__currentFrameBuffer.getTextureWidth(),this.__currentFrameBuffer.getTextureHeight()]:[this._width*i,this._height*i]),l=[a[2],a[3]],u=Date.now();e?(VT.copy(tw.VIEW,e.viewMatrix.array),VT.copy(tw.PROJECTION,e.projectionMatrix.array),VT.copy(tw.VIEWINVERSE,e.worldTransform.array)):(VT.identity(tw.VIEW),VT.identity(tw.PROJECTION),VT.identity(tw.VIEWINVERSE)),VT.multiply(tw.VIEWPROJECTION,tw.PROJECTION,tw.VIEW),VT.invert(tw.PROJECTIONINVERSE,tw.PROJECTION),VT.invert(tw.VIEWPROJECTIONINVERSE,tw.VIEWPROJECTION);for(var h,c,d,p,f,g,m,y,_,v,x,b=this.gl,T=this._sceneRendering,w=null,S=0;S<t.length;S++){var M,A=t[S],C=null!=A.worldTransform;if(r(A)){C&&(M=A.isSkinnedMesh&&A.isSkinnedMesh()?A.offsetMatrix?A.offsetMatrix.array:tw.IDENTITY:A.worldTransform.array);var E=A.geometry,I=n.getMaterial.call(this,A),D=A.__program,R=I.shader,L=E.__uid__+"-"+D.__uid__,O=L!==P,P=L;C&&(VT.copy(tw.WORLD,M),VT.multiply(tw.WORLDVIEWPROJECTION,tw.VIEWPROJECTION,M),VT.multiplyAffine(tw.WORLDVIEW,tw.VIEW,M),(R.matrixSemantics.WORLDINVERSE||R.matrixSemantics.WORLDINVERSETRANSPOSE)&&VT.invert(tw.WORLDINVERSE,M),(R.matrixSemantics.WORLDVIEWINVERSE||R.matrixSemantics.WORLDVIEWINVERSETRANSPOSE)&&VT.invert(tw.WORLDVIEWINVERSE,tw.WORLDVIEW),(R.matrixSemantics.WORLDVIEWPROJECTIONINVERSE||R.matrixSemantics.WORLDVIEWPROJECTIONINVERSETRANSPOSE)&&VT.invert(tw.WORLDVIEWPROJECTIONINVERSE,tw.WORLDVIEWPROJECTION)),A.beforeRender&&A.beforeRender(this),n.beforeRender.call(this,A,I,h),L=D!==c,L?(D.bind(this),D.setUniformOfSemantic(b,"VIEWPORT",a),D.setUniformOfSemantic(b,"WINDOW_SIZE",s),e&&(D.setUniformOfSemantic(b,"NEAR",e.near),D.setUniformOfSemantic(b,"FAR",e.far)),D.setUniformOfSemantic(b,"DEVICEPIXELRATIO",o),D.setUniformOfSemantic(b,"TIME",u),D.setUniformOfSemantic(b,"VIEWPORT_SIZE",l),T&&T.setLightUniforms(D,A.lightGroup,this)):D=c,(L||n.isMaterialChanged(A,d,I,h))&&(I.depthTest!==p&&(I.depthTest?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST),p=I.depthTest),I.depthMask!==f&&(b.depthMask(I.depthMask),f=I.depthMask),I.transparent!==_&&(I.transparent?b.enable(b.BLEND):b.disable(b.BLEND),_=I.transparent),I.transparent&&(I.blend?I.blend(b):(b.blendEquationSeparate(b.FUNC_ADD,b.FUNC_ADD),b.blendFuncSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA))),x=this._bindMaterial(A,I,D,d||null,h||null,c||null,n.getUniform),h=I);var N=R.matrixSemanticKeys;if(C)for(var k=0;k<N.length;k++){var B=N[k],F=R.matrixSemantics[B],z=tw[B];F.isTranspose&&(B=tw[F.semanticNoTranspose],VT.transpose(z,B)),D.setUniform(b,F.type,F.symbol,z)}A.cullFace!==m&&(m=A.cullFace,b.cullFace(m)),A.frontFace!==y&&(y=A.frontFace,b.frontFace(y)),A.culling!==g&&((g=A.culling)?b.enable(b.CULL_FACE):b.disable(b.CULL_FACE)),this._updateSkeleton(A,D,x),O&&(v=this._bindVAO(w,R,E,D)),this._renderObject(A,v,D),n.afterRender(this,A),A.afterRender&&A.afterRender(this),c=D,d=A}}this.trigger("afterrenderpass",this,t,e,n)},getMaxJointNumber:function(){return this.maxJointNumber},_updateSkeleton:function(t,e,n){var r,i=this.gl,o=t.skeleton;o&&(o.update(),t.joints.length>this.getMaxJointNumber()?(r=o.getSubSkinMatricesTexture(t.__uid__,t.joints),e.useTextureSlot(this,r,n),e.setUniform(i,"1i","skinMatricesTexture",n),e.setUniform(i,"1f","skinMatricesTextureSize",r.width)):(t=o.getSubSkinMatrices(t.__uid__,t.joints),e.setUniformOfSemantic(i,"SKIN_MATRIX",t)))},_renderObject:function(t,e,n){var r=this.gl,i=t.geometry,o=t.mode;null==o&&(o=4);var a,s=null,l=t.isInstancedMesh&&t.isInstancedMesh();if(!l||(s=this.getGLExtension("ANGLE_instanced_arrays"))){if(l&&(a=this._bindInstancedAttributes(t,n,s)),e.indicesBuffer?(n=this.getGLExtension("OES_element_index_uint")&&i.indices instanceof Uint32Array?r.UNSIGNED_INT:r.UNSIGNED_SHORT,l?s.drawElementsInstancedANGLE(o,e.indicesBuffer.count,n,0,t.getInstanceCount()):r.drawElements(o,e.indicesBuffer.count,n,0)):l?s.drawArraysInstancedANGLE(o,0,i.vertexCount,t.getInstanceCount()):r.drawArrays(o,0,i.vertexCount),l)for(var u=0;u<a.length;u++)r.disableVertexAttribArray(a[u])}else console.warn("Device not support ANGLE_instanced_arrays extension")},_bindInstancedAttributes:function(t,e,n){for(var r=this.gl,i=t.getInstancedAttributesBuffers(this),o=[],a=0;a<i.length;a++){var s,l=i[a],u=e.getAttribLocation(r,l.symbol);u<0||(s=QT[l.type]||r.FLOAT,r.enableVertexAttribArray(u),r.bindBuffer(r.ARRAY_BUFFER,l.buffer),r.vertexAttribPointer(u,l.size,s,!1,0,0),n.vertexAttribDivisorANGLE(u,l.divisor),o.push(u))}return o},_bindMaterial:function(t,e,n,r,i,o,a){for(var s=this.gl,l=o===n,u=n.currentTextureSlot(),h=e.getEnabledUniforms(),c=e.getTextureUniforms(),d=this._placeholderTexture,p=0;p<c.length;p++){var f=a(t,e,y=c[p]);if("t"===(m=e.uniforms[y].type)&&f)f.__slot=-1;else if("tv"===m)for(var g=0;g<f.length;g++)f[g]&&(f[g].__slot=-1)}for(d.__slot=-1,p=0;p<h.length;p++){var m,y=h[p],_=e.uniforms[y],v=(f=a(t,e,y),"t"===(m=_.type));if(v&&(f&&f.isRenderable()||(f=d)),i&&l){var x=a(r,i,y);if(v&&(x&&x.isRenderable()||(x=d)),x===f){if(v)n.takeCurrentTextureSlot(this,null);else if("tv"===m&&f)for(g=0;g<f.length;g++)n.takeCurrentTextureSlot(this,null);continue}}if(null!=f)if(v)f.__slot<0?(T=n.currentTextureSlot(),n.setUniform(s,"1i",y,T)&&(n.takeCurrentTextureSlot(this,f),f.__slot=T)):n.setUniform(s,"1i",y,f.__slot);else if(Array.isArray(f)){if(0!==f.length)if("tv"===m){if(n.hasUniform(y)){var b=[];for(g=0;g<f.length;g++){var T,w=f[g];w.__slot<0?(T=n.currentTextureSlot(),b.push(T),n.takeCurrentTextureSlot(this,w),w.__slot=T):b.push(w.__slot)}n.setUniform(s,"1iv",y,b)}}else n.setUniform(s,_.type,y,f)}else n.setUniform(s,_.type,y,f)}return o=n.currentTextureSlot(),n.resetTextureSlot(u),o},_bindVAO:function(t,e,n,r){var i=!n.dynamic,o=this.gl,a=this.__uid__+"-"+r.__uid__,s=n.__vaoCache[a];if(!s){var l=n.getBufferChunks(this);if(!l||!l.length)return;l=l[0];for(var u=l.attributeBuffers,h=(l=l.indicesBuffer,[]),c=[],d=0;d<u.length;d++){var p=(m=u[d]).name,f=m.semantic;(p=f?(f=e.attributeSemantics[f])&&f.symbol:p)&&r.attributes[p]&&(h.push(m),c.push(p))}s=new JT(h,c,l),i&&(n.__vaoCache[a]=s)}if(a=!0,t&&i&&(null==s.vao?s.vao=t.createVertexArrayOES():a=!1,t.bindVertexArrayOES(s.vao)),h=s.availableAttributes,l=s.indicesBuffer,a){var g=r.enableAttributes(this,s.availableAttributeSymbols,t&&i&&s);for(d=0;d<h.length;d++){var m,y,_,v,x=g[d];-1!==x&&(y=(m=h[d]).buffer,_=m.size,v=QT[m.type]||o.FLOAT,o.bindBuffer(o.ARRAY_BUFFER,y),o.vertexAttribPointer(x,_,v,!1,0,0))}n.isUseIndices()&&o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,l.buffer)}return s},renderPreZ:function(t,e,n){var r=this.gl,i=this._prezMaterial||new oT({shader:new FT(FT.source("clay.prez.vertex"),FT.source("clay.prez.fragment"))});this._prezMaterial=i,r.colorMask(!1,!1,!1,!1),r.depthMask(!0),this.renderPass(t,n,{ifRender:function(t){return!t.ignorePreZ},isMaterialChanged:function(t,e){return t=t.material,e=e.material,t.get("diffuseMap")!==e.get("diffuseMap")||(t.get("alphaCutoff")||0)!==(e.get("alphaCutoff")||0)},getUniform:function(t,e,n){return"alphaMap"===n?t.material.get("diffuseMap"):"alphaCutoff"!==n?"uvRepeat"===n?t.material.get("uvRepeat"):"uvOffset"===n?t.material.get("uvOffset"):e.get(n):t.material.isDefined("fragment","ALPHA_TEST")&&t.material.get("diffuseMap")&&t.material.get("alphaCutoff")||0},getMaterial:function(){return i},sort:this.opaqueSortCompare}),r.colorMask(!0,!0,!0,!0),r.depthMask(!0)},disposeScene:function(t){this.disposeNode(t,!0,!0),t.dispose()},disposeNode:function(t,e,n){t.getParent()&&t.getParent().remove(t);var r={};t.traverse((function(t){var i=t.material;if(t.geometry&&e&&t.geometry.dispose(this),n&&i&&!r[i.__uid__]){for(var o=i.getTextureUniforms(),a=0;a<o.length;a++){var s=o[a],l=i.uniforms[s].value;s=i.uniforms[s].type;if(l)if("t"===s)l.dispose&&l.dispose(this);else if("tv"===s)for(var u=0;u<l.length;u++)l[u]&&l[u].dispose&&l[u].dispose(this)}r[i.__uid__]=!0}t.dispose&&t.dispose(this)}),this)},disposeGeometry:function(t){t.dispose(this)},disposeTexture:function(t){t.dispose(this)},disposeFrameBuffer:function(t){t.dispose(this)},dispose:function(){},screenToNDC:function(t,e,n){n=n||new hT,e=this._height-e;var r=this.viewport,i=n.array;return i[0]=(t-r.x)/r.width,i[0]=2*i[0]-1,i[1]=(e-r.y)/r.height,i[1]=2*i[1]-1,n}}),$r.opaqueSortCompare=$r.prototype.opaqueSortCompare=function(t,e){return t.renderOrder===e.renderOrder?t.__program===e.__program?t.material===e.material?t.geometry.__uid__-e.geometry.__uid__:t.material.__uid__-e.material.__uid__:t.__program&&e.__program?t.__program.__uid__-e.__program.__uid__:0:t.renderOrder-e.renderOrder},$r.transparentSortCompare=$r.prototype.transparentSortCompare=function(t,e){return t.renderOrder===e.renderOrder?t.__depth===e.__depth?t.__program===e.__program?t.material===e.material?t.geometry.__uid__-e.geometry.__uid__:t.material.__uid__-e.material.__uid__:t.__program&&e.__program?t.__program.__uid__-e.__program.__uid__:0:t.__depth-e.__depth:t.renderOrder-e.renderOrder};var tw={IDENTITY:WT(),WORLD:WT(),VIEW:WT(),PROJECTION:WT(),WORLDVIEW:WT(),VIEWPROJECTION:WT(),WORLDVIEWPROJECTION:WT(),WORLDINVERSE:WT(),VIEWINVERSE:WT(),PROJECTIONINVERSE:WT(),WORLDVIEWINVERSE:WT(),VIEWPROJECTIONINVERSE:WT(),WORLDVIEWPROJECTIONINVERSE:WT(),WORLDTRANSPOSE:WT(),VIEWTRANSPOSE:WT(),PROJECTIONTRANSPOSE:WT(),WORLDVIEWTRANSPOSE:WT(),VIEWPROJECTIONTRANSPOSE:WT(),WORLDVIEWPROJECTIONTRANSPOSE:WT(),WORLDINVERSETRANSPOSE:WT(),VIEWINVERSETRANSPOSE:WT(),PROJECTIONINVERSETRANSPOSE:WT(),WORLDVIEWINVERSETRANSPOSE:WT(),VIEWPROJECTIONINVERSETRANSPOSE:WT(),WORLDVIEWPROJECTIONINVERSETRANSPOSE:WT()};function ew(t,e,n){this.array=GT.fromValues(t=t||0,e=e||0,n=n||0),this._dirty=!0}$r.COLOR_BUFFER_BIT=Bb.COLOR_BUFFER_BIT,$r.DEPTH_BUFFER_BIT=Bb.DEPTH_BUFFER_BIT,$r.STENCIL_BUFFER_BIT=Bb.STENCIL_BUFFER_BIT;var nw=$r;function rw(t,e,n){return t<e?e:n<t?n:t}ew.prototype={constructor:ew,add:function(t){return GT.add(this.array,this.array,t.array),this._dirty=!0,this},set:function(t,e,n){return this.array[0]=t,this.array[1]=e,this.array[2]=n,this._dirty=!0,this},setArray:function(t){return this.array[0]=t[0],this.array[1]=t[1],this.array[2]=t[2],this._dirty=!0,this},clone:function(){return new ew(this.x,this.y,this.z)},copy:function(t){return GT.copy(this.array,t.array),this._dirty=!0,this},cross:function(t,e){return GT.cross(this.array,t.array,e.array),this._dirty=!0,this},dist:function(t){return GT.dist(this.array,t.array)},distance:function(t){return GT.distance(this.array,t.array)},div:function(t){return GT.div(this.array,this.array,t.array),this._dirty=!0,this},divide:function(t){return GT.divide(this.array,this.array,t.array),this._dirty=!0,this},dot:function(t){return GT.dot(this.array,t.array)},len:function(){return GT.len(this.array)},length:function(){return GT.length(this.array)},lerp:function(t,e,n){return GT.lerp(this.array,t.array,e.array,n),this._dirty=!0,this},min:function(t){return GT.min(this.array,this.array,t.array),this._dirty=!0,this},max:function(t){return GT.max(this.array,this.array,t.array),this._dirty=!0,this},mul:function(t){return GT.mul(this.array,this.array,t.array),this._dirty=!0,this},multiply:function(t){return GT.multiply(this.array,this.array,t.array),this._dirty=!0,this},negate:function(){return GT.negate(this.array,this.array),this._dirty=!0,this},normalize:function(){return GT.normalize(this.array,this.array),this._dirty=!0,this},random:function(t){return GT.random(this.array,t),this._dirty=!0,this},scale:function(t){return GT.scale(this.array,this.array,t),this._dirty=!0,this},scaleAndAdd:function(t,e){return GT.scaleAndAdd(this.array,this.array,t.array,e),this._dirty=!0,this},sqrDist:function(t){return GT.sqrDist(this.array,t.array)},squaredDistance:function(t){return GT.squaredDistance(this.array,t.array)},sqrLen:function(){return GT.sqrLen(this.array)},squaredLength:function(){return GT.squaredLength(this.array)},sub:function(t){return GT.sub(this.array,this.array,t.array),this._dirty=!0,this},subtract:function(t){return GT.subtract(this.array,this.array,t.array),this._dirty=!0,this},transformMat3:function(t){return GT.transformMat3(this.array,this.array,t.array),this._dirty=!0,this},transformMat4:function(t){return GT.transformMat4(this.array,this.array,t.array),this._dirty=!0,this},transformQuat:function(t){return GT.transformQuat(this.array,this.array,t.array),this._dirty=!0,this},applyProjection:function(t){var e,n=this.array;return 0===(t=t.array)[15]?(e=-1/n[2],n[0]=t[0]*n[0]*e,n[1]=t[5]*n[1]*e,n[2]=(t[10]*n[2]+t[14])*e):(n[0]=t[0]*n[0]+t[12],n[1]=t[5]*n[1]+t[13],n[2]=t[10]*n[2]+t[14]),this._dirty=!0,this},eulerFromQuat:function(t,e){ew.eulerFromQuat(this,t,e)},eulerFromMat3:function(t,e){ew.eulerFromMat3(this,t,e)},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}},M=Object.defineProperty,M&&(M(yS=ew.prototype,"x",{get:function(){return this.array[0]},set:function(t){this.array[0]=t,this._dirty=!0}}),M(yS,"y",{get:function(){return this.array[1]},set:function(t){this.array[1]=t,this._dirty=!0}}),M(yS,"z",{get:function(){return this.array[2]},set:function(t){this.array[2]=t,this._dirty=!0}})),ew.add=function(t,e,n){return GT.add(t.array,e.array,n.array),t._dirty=!0,t},ew.set=function(t,e,n,r){GT.set(t.array,e,n,r),t._dirty=!0},ew.copy=function(t,e){return GT.copy(t.array,e.array),t._dirty=!0,t},ew.cross=function(t,e,n){return GT.cross(t.array,e.array,n.array),t._dirty=!0,t},ew.distance=ew.dist=function(t,e){return GT.distance(t.array,e.array)},ew.divide=ew.div=function(t,e,n){return GT.divide(t.array,e.array,n.array),t._dirty=!0,t},ew.dot=function(t,e){return GT.dot(t.array,e.array)},ew.len=function(t){return GT.length(t.array)},ew.lerp=function(t,e,n,r){return GT.lerp(t.array,e.array,n.array,r),t._dirty=!0,t},ew.min=function(t,e,n){return GT.min(t.array,e.array,n.array),t._dirty=!0,t},ew.max=function(t,e,n){return GT.max(t.array,e.array,n.array),t._dirty=!0,t},ew.multiply=ew.mul=function(t,e,n){return GT.multiply(t.array,e.array,n.array),t._dirty=!0,t},ew.negate=function(t,e){return GT.negate(t.array,e.array),t._dirty=!0,t},ew.normalize=function(t,e){return GT.normalize(t.array,e.array),t._dirty=!0,t},ew.random=function(t,e){return GT.random(t.array,e),t._dirty=!0,t},ew.scale=function(t,e,n){return GT.scale(t.array,e.array,n),t._dirty=!0,t},ew.scaleAndAdd=function(t,e,n,r){return GT.scaleAndAdd(t.array,e.array,n.array,r),t._dirty=!0,t},ew.squaredDistance=ew.sqrDist=function(t,e){return GT.sqrDist(t.array,e.array)},ew.squaredLength=ew.sqrLen=function(t){return GT.sqrLen(t.array)},ew.subtract=ew.sub=function(t,e,n){return GT.subtract(t.array,e.array,n.array),t._dirty=!0,t},ew.transformMat3=function(t,e,n){return GT.transformMat3(t.array,e.array,n.array),t._dirty=!0,t},ew.transformMat4=function(t,e,n){return GT.transformMat4(t.array,e.array,n.array),t._dirty=!0,t},ew.transformQuat=function(t,e,n){return GT.transformQuat(t.array,e.array,n.array),t._dirty=!0,t};var iw=Math.atan2,ow=Math.asin,aw=Math.abs;function sw(t,e){this.origin=t||new fw,this.direction=e||new fw}ew.eulerFromQuat=function(t,e,n){t._dirty=!0,e=e.array;var r=t.array,i=e[0],o=e[1],a=e[2],s=e[3],l=i*i,u=o*o,h=a*a,c=s*s;switch(n=(n||"XYZ").toUpperCase()){case"XYZ":r[0]=iw(2*(i*s-o*a),c-l-u+h),r[1]=ow(rw(2*(i*a+o*s),-1,1)),r[2]=iw(2*(a*s-i*o),c+l-u-h);break;case"YXZ":r[0]=ow(rw(2*(i*s-o*a),-1,1)),r[1]=iw(2*(i*a+o*s),c-l-u+h),r[2]=iw(2*(i*o+a*s),c-l+u-h);break;case"ZXY":r[0]=ow(rw(2*(i*s+o*a),-1,1)),r[1]=iw(2*(o*s-a*i),c-l-u+h),r[2]=iw(2*(a*s-i*o),c-l+u-h);break;case"ZYX":r[0]=iw(2*(i*s+a*o),c-l-u+h),r[1]=ow(rw(2*(o*s-i*a),-1,1)),r[2]=iw(2*(i*o+a*s),c+l-u-h);break;case"YZX":r[0]=iw(2*(i*s-a*o),c-l+u-h),r[1]=iw(2*(o*s-i*a),c+l-u-h),r[2]=ow(rw(2*(i*o+a*s),-1,1));break;case"XZY":r[0]=iw(2*(i*s+o*a),c-l+u-h),r[1]=iw(2*(i*a+o*s),c+l-u-h),r[2]=ow(rw(2*(a*s-i*o),-1,1));break;default:console.warn("Unkown order: "+n)}return t},ew.eulerFromMat3=function(t,e,n){e=e.array;var r=e[0],i=e[3],o=e[6],a=e[1],s=e[4],l=e[7],u=e[2],h=e[5],c=e[8],d=t.array;switch(n=(n||"XYZ").toUpperCase()){case"XYZ":d[1]=ow(rw(o,-1,1)),aw(o)<.99999?(d[0]=iw(-l,c),d[2]=iw(-i,r)):(d[0]=iw(h,s),d[2]=0);break;case"YXZ":d[0]=ow(-rw(l,-1,1)),aw(l)<.99999?(d[1]=iw(o,c),d[2]=iw(a,s)):(d[1]=iw(-u,r),d[2]=0);break;case"ZXY":d[0]=ow(rw(h,-1,1)),aw(h)<.99999?(d[1]=iw(-u,c),d[2]=iw(-i,s)):(d[1]=0,d[2]=iw(a,r));break;case"ZYX":d[1]=ow(-rw(u,-1,1)),aw(u)<.99999?(d[0]=iw(h,c),d[2]=iw(a,r)):(d[0]=0,d[2]=iw(-i,s));break;case"YZX":d[2]=ow(rw(a,-1,1)),aw(a)<.99999?(d[0]=iw(-l,s),d[1]=iw(-u,r)):(d[0]=0,d[1]=iw(o,c));break;case"XZY":d[2]=ow(-rw(i,-1,1)),aw(i)<.99999?(d[0]=iw(h,s),d[1]=iw(o,r)):(d[0]=iw(-l,c),d[1]=0);break;default:console.warn("Unkown order: "+n)}return t._dirty=!0,t},Object.defineProperties(ew,{POSITIVE_X:{get:function(){return new ew(1,0,0)}},NEGATIVE_X:{get:function(){return new ew(-1,0,0)}},POSITIVE_Y:{get:function(){return new ew(0,1,0)}},NEGATIVE_Y:{get:function(){return new ew(0,-1,0)}},POSITIVE_Z:{get:function(){return new ew(0,0,1)}},NEGATIVE_Z:{get:function(){return new ew(0,0,-1)}},UP:{get:function(){return new ew(0,1,0)}},ZERO:{get:function(){return new ew}}});var lw,uw,hw,cw,dw,pw,fw=ew;sw.prototype={constructor:sw,intersectPlane:function(t,e){var n=t.normal.array,r=t.distance,i=this.origin.array,o=this.direction.array;t=GT.dot(n,o);return 0===t?null:(e=e||new fw,t=(GT.dot(n,i)-r)/t,GT.scaleAndAdd(e.array,i,o,-t),e._dirty=!0,e)},mirrorAgainstPlane:function(t){var e=GT.dot(t.normal.array,this.direction.array);GT.scaleAndAdd(this.direction.array,this.direction.array,t.normal.array,2*-e),this.direction._dirty=!0},distanceToPoint:(pw=GT.create(),function(t){GT.sub(pw,t,this.origin.array);var e=GT.dot(pw,this.direction.array);return e<0?GT.distance(this.origin.array,t):(t=GT.lenSquared(pw),Math.sqrt(t-e*e))}),intersectSphere:(dw=GT.create(),function(t,e,n){var r=this.origin.array,i=this.direction.array;t=t.array,GT.sub(dw,t,r);var o=GT.dot(dw,i);t=GT.squaredLength(dw)-o*o,e*=e;if(!(e<t))return e=Math.sqrt(e-t),t=o-e,e=o+e,n=n||new fw,t<0?e<0?null:(GT.scaleAndAdd(n.array,r,i,e),n):(GT.scaleAndAdd(n.array,r,i,t),n)}),intersectBoundingBox:function(t,e){var n,r,i,o,a,s=this.direction.array,l=this.origin.array,u=t.min.array,h=t.max.array,c=1/s[0],d=1/s[1];t=1/s[2];if(0<=c?(n=(u[0]-l[0])*c,p=(h[0]-l[0])*c):(p=(u[0]-l[0])*c,n=(h[0]-l[0])*c),0<=d?(r=(u[1]-l[1])*d,i=(h[1]-l[1])*d):(i=(u[1]-l[1])*d,r=(h[1]-l[1])*d),i<n||p<r)return null;if((n<r||n!=n)&&(n=r),(i<p||p!=p)&&(p=i),0<=t?(o=(u[2]-l[2])*t,a=(h[2]-l[2])*t):(a=(u[2]-l[2])*t,o=(h[2]-l[2])*t),a<n||p<o)return null;if((p=a<p||p!=p?a:p)<0)return null;var p=0<=(n=n<o||n!=n?o:n)?n:p;return e=e||new fw,GT.scaleAndAdd(e.array,l,s,p),e},intersectTriangle:(lw=GT.create(),uw=GT.create(),hw=GT.create(),cw=GT.create(),function(t,e,n,r,i,o){var a=this.direction.array,s=this.origin.array;if(t=t.array,e=e.array,n=n.array,GT.sub(lw,e,t),GT.sub(uw,n,t),GT.cross(cw,uw,a),n=GT.dot(lw,cw),r){if(-1e-5<n)return null}else if(-1e-5<n&&n<1e-5)return null;return GT.sub(hw,s,t),r=GT.dot(cw,hw)/n,r<0||1<r?null:(GT.cross(cw,lw,hw),t=GT.dot(a,cw)/n,t<0||1<t||1<r+t?null:(GT.cross(cw,lw,uw),n=-GT.dot(hw,cw)/n,n<0?null:(i=i||new fw,o&&fw.set(o,1-r-t,r,t),GT.scaleAndAdd(i.array,s,a,n),i)))}),applyTransform:function(t){fw.add(this.direction,this.direction,this.origin),fw.transformMat4(this.origin,this.origin,t),fw.transformMat4(this.direction,this.direction,t),fw.sub(this.direction,this.direction,this.origin),fw.normalize(this.direction,this.direction)},copy:function(t){fw.copy(this.origin,t.origin),fw.copy(this.direction,t.direction)},clone:function(){var t=new sw;return t.copy(this),t}};var gw,mw=sw,yw={create:function(){var t=new aT(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},clone:function(t){var e=new aT(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},fromValues:function(t,e,n,r){var i=new aT(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},set:function(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},subtract:function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}};yw.sub=yw.subtract,yw.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t},yw.mul=yw.multiply,yw.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t},yw.div=yw.divide,yw.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},yw.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},yw.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},yw.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t},yw.distance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];t=e[3]-t[3];return Math.sqrt(n*n+r*r+i*i+t*t)},yw.dist=yw.distance,yw.squaredDistance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];t=e[3]-t[3];return n*n+r*r+i*i+t*t},yw.sqrDist=yw.squaredDistance,yw.length=function(t){var e=t[0],n=t[1],r=t[2];t=t[3];return Math.sqrt(e*e+n*n+r*r+t*t)},yw.len=yw.length,yw.squaredLength=function(t){var e=t[0],n=t[1],r=t[2];t=t[3];return e*e+n*n+r*r+t*t},yw.sqrLen=yw.squaredLength,yw.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},yw.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},yw.normalize=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3];o=n*n+r*r+i*i+o*o;return 0<o&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o),t},yw.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},yw.lerp=function(t,e,n,r){var i=e[0],o=e[1],a=e[2];e=e[3];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t[3]=e+r*(n[3]-e),t},yw.random=function(t,e){return e=e||1,t[0]=sT(),t[1]=sT(),t[2]=sT(),t[3]=sT(),yw.normalize(t,t),yw.scale(t,t,e),t},yw.transformMat4=function(t,e,n){var r=e[0],i=e[1],o=e[2];e=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*e,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*e,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*e,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*e,t},yw.transformQuat=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],l=n[2],u=n[3],h=u*r+s*o-l*i;e=u*i+l*r-a*o,n=u*o+a*i-s*r,o=-a*r-s*i-l*o;return t[0]=h*u+o*-a+e*-l-n*-s,t[1]=e*u+o*-s+n*-a-h*-l,t[2]=n*u+o*-l+h*-s-e*-a,t},yw.forEach=(gw=yw.create(),function(t,e,n,r,i,o){var a,s;for(e=e||4,n=n||0,s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)gw[0]=t[a],gw[1]=t[a+1],gw[2]=t[a+2],gw[3]=t[a+3],i(gw,gw,o),t[a]=gw[0],t[a+1]=gw[1],t[a+2]=gw[2],t[a+3]=gw[3];return t});var _w=yw;Pu={create:function(){var t=new aT(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromMat4:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},clone:function(t){var e=new aT(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:function(t,e){var n,r,i;return t===e?(n=e[1],r=e[2],i=e[5],t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i):(t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8]),t},invert:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],h=e[8],c=h*a-s*u,d=-h*o+s*l,p=u*o-a*l;e=n*c+r*d+i*p;return e?(t[0]=c*(e=1/e),t[1]=(-h*r+i*u)*e,t[2]=(s*r-i*a)*e,t[3]=d*e,t[4]=(h*n-i*l)*e,t[5]=(-s*n+i*o)*e,t[6]=p*e,t[7]=(-u*n+r*l)*e,t[8]=(a*n-r*o)*e,t):null},adjoint:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7];e=e[8];return t[0]=a*e-s*u,t[1]=i*u-r*e,t[2]=r*s-i*a,t[3]=s*l-o*e,t[4]=n*e-i*l,t[5]=i*o-n*s,t[6]=o*u-a*l,t[7]=r*l-n*u,t[8]=n*a-r*o,t},determinant:function(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],l=t[7];t=t[8];return e*(t*o-a*l)+n*(-t*i+a*s)+r*(l*i-o*s)},multiply:function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],h=e[7],c=e[8],d=n[0],p=n[1],f=n[2],g=n[3],m=n[4],y=n[5],_=n[6];e=n[7],n=n[8];return t[0]=d*r+p*a+f*u,t[1]=d*i+p*s+f*h,t[2]=d*o+p*l+f*c,t[3]=g*r+m*a+y*u,t[4]=g*i+m*s+y*h,t[5]=g*o+m*l+y*c,t[6]=_*r+e*a+n*u,t[7]=_*i+e*s+n*h,t[8]=_*o+e*l+n*c,t}};Pu.mul=Pu.multiply,Pu.translate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],h=e[7],c=e[8];e=n[0],n=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=e*r+n*a+u,t[7]=e*i+n*s+h,t[8]=e*o+n*l+c,t},Pu.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],h=e[7],c=e[8];e=Math.sin(n),n=Math.cos(n);return t[0]=n*r+e*a,t[1]=n*i+e*s,t[2]=n*o+e*l,t[3]=n*a-e*r,t[4]=n*s-e*i,t[5]=n*l-e*o,t[6]=u,t[7]=h,t[8]=c,t},Pu.scale=function(t,e,n){var r=n[0];n=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Pu.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},Pu.fromQuat=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,l=i+i,u=n*a,h=r*a;e=r*s,n=i*a,r=i*s,i*=l,a*=o,s*=o,l*=o;return t[0]=1-e-i,t[3]=h-l,t[6]=n+s,t[1]=h+l,t[4]=1-u-i,t[7]=r-a,t[2]=n-s,t[5]=r+a,t[8]=1-u-e,t},Pu.normalFromMat4=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],h=e[8],c=e[9],d=e[10],p=e[11],f=e[12],g=e[13],m=e[14],y=e[15],_=n*s-r*a,v=n*l-i*a,x=n*u-o*a,b=r*l-i*s,T=r*u-o*s,w=i*u-o*l,S=h*g-c*f,M=h*m-d*f;e=h*y-p*f,h=c*m-d*g,c=c*y-p*g,d=d*y-p*m,p=_*d-v*c+x*h+b*e-T*M+w*S;return p?(t[0]=(s*d-l*c+u*h)*(p=1/p),t[1]=(l*e-a*d-u*M)*p,t[2]=(a*c-s*e+u*S)*p,t[3]=(i*c-r*d-o*h)*p,t[4]=(n*d-i*e+o*M)*p,t[5]=(r*e-n*c-o*S)*p,t[6]=(g*w-m*T+y*b)*p,t[7]=(m*x-f*w-y*v)*p,t[8]=(f*T-g*x+y*_)*p,t):null},Pu.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))};var vw,xw,bw,Tw,ww=Pu,Sw={create:function(){var t=new aT(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}};function Mw(){this._axisX=new fw,this._axisY=new fw,this._axisZ=new fw,this.array=VT.create(),this._dirty=!0}Sw.rotationTo=(vw=GT.create(),xw=GT.fromValues(1,0,0),bw=GT.fromValues(0,1,0),function(t,e,n){var r=GT.dot(e,n);return r<-.999999?(GT.cross(vw,xw,e),GT.length(vw)<1e-6&&GT.cross(vw,bw,e),GT.normalize(vw,vw),Sw.setAxisAngle(t,vw,Math.PI),t):.999999<r?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(GT.cross(vw,e,n),t[0]=vw[0],t[1]=vw[1],t[2]=vw[2],t[3]=1+r,Sw.normalize(t,t))}),Sw.setAxes=(Tw=ww.create(),function(t,e,n,r){return Tw[0]=n[0],Tw[3]=n[1],Tw[6]=n[2],Tw[1]=r[0],Tw[4]=r[1],Tw[7]=r[2],Tw[2]=-e[0],Tw[5]=-e[1],Tw[8]=-e[2],Sw.normalize(t,Sw.fromMat3(t,Tw))}),Sw.clone=_w.clone,Sw.fromValues=_w.fromValues,Sw.copy=_w.copy,Sw.set=_w.set,Sw.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Sw.setAxisAngle=function(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t},Sw.add=_w.add,Sw.multiply=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],l=n[1];e=n[2],n=n[3];return t[0]=r*n+a*s+i*e-o*l,t[1]=i*n+a*l+o*s-r*e,t[2]=o*n+a*e+r*l-i*s,t[3]=a*n-r*s-i*l-o*e,t},Sw.mul=Sw.multiply,Sw.scale=_w.scale,Sw.rotateX=function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3];e=Math.sin(n),n=Math.cos(n);return t[0]=r*n+a*e,t[1]=i*n+o*e,t[2]=o*n-i*e,t[3]=a*n-r*e,t},Sw.rotateY=function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3];e=Math.sin(n),n=Math.cos(n);return t[0]=r*n-o*e,t[1]=i*n+a*e,t[2]=o*n+r*e,t[3]=a*n-i*e,t},Sw.rotateZ=function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3];e=Math.sin(n),n=Math.cos(n);return t[0]=r*n+i*e,t[1]=i*n-r*e,t[2]=o*n+a*e,t[3]=a*n-o*e,t},Sw.calculateW=function(t,e){var n=e[0],r=e[1];e=e[2];return t[0]=n,t[1]=r,t[2]=e,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-e*e)),t},Sw.dot=_w.dot,Sw.lerp=_w.lerp,Sw.slerp=function(t,e,n,r){var i,o=e[0],a=e[1],s=e[2],l=e[3],u=n[0],h=n[1],c=n[2],d=n[3];e=o*u+a*h+s*c+l*d;return e<0&&(e=-e,u=-u,h=-h,c=-c,d=-d),r=1e-6<1-e?(n=Math.acos(e),e=Math.sin(n),i=Math.sin((1-r)*n)/e,Math.sin(r*n)/e):(i=1-r,r),t[0]=i*o+r*u,t[1]=i*a+r*h,t[2]=i*s+r*c,t[3]=i*l+r*d,t},Sw.invert=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3];e=n*n+r*r+i*i+o*o,e=e?1/e:0;return t[0]=-n*e,t[1]=-r*e,t[2]=-i*e,t[3]=o*e,t},Sw.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Sw.length=_w.length,Sw.len=Sw.length,Sw.squaredLength=_w.squaredLength,Sw.sqrLen=Sw.squaredLength,Sw.normalize=_w.normalize,Sw.fromMat3=function(t,e){var n,r,i,o=e[0]+e[4]+e[8];return 0<o?(i=Math.sqrt(o+1),t[3]=.5*i,t[0]=(e[5]-e[7])*(i=.5/i),t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i):(e[4]>e[n=0]&&(n=1),r=((n=e[8]>e[3*n+n]?2:n)+1)%3,o=(n+2)%3,i=Math.sqrt(e[3*n+n]-e[3*r+r]-e[3*o+o]+1),t[n]=.5*i,t[3]=(e[3*r+o]-e[3*o+r])*(i=.5/i),t[r]=(e[3*r+n]+e[3*n+r])*i,t[o]=(e[3*o+n]+e[3*n+o])*i),t};var Aw,Cw,Ew,Iw,Dw=Sw;function Rw(t,e,n,r){this.array=Dw.fromValues(t=t||0,e=e||0,n=n||0,r=void 0===r?1:r),this._dirty=!0}Mw.prototype={constructor:Mw,setArray:function(t){for(var e=0;e<this.array.length;e++)this.array[e]=t[e];return this._dirty=!0,this},adjoint:function(){return VT.adjoint(this.array,this.array),this._dirty=!0,this},clone:function(){return(new Mw).copy(this)},copy:function(t){return VT.copy(this.array,t.array),this._dirty=!0,this},determinant:function(){return VT.determinant(this.array)},fromQuat:function(t){return VT.fromQuat(this.array,t.array),this._dirty=!0,this},fromRotationTranslation:function(t,e){return VT.fromRotationTranslation(this.array,t.array,e.array),this._dirty=!0,this},fromMat2d:function(t){return Mw.fromMat2d(this,t),this},frustum:function(t,e,n,r,i,o){return VT.frustum(this.array,t,e,n,r,i,o),this._dirty=!0,this},identity:function(){return VT.identity(this.array),this._dirty=!0,this},invert:function(){return VT.invert(this.array,this.array),this._dirty=!0,this},lookAt:function(t,e,n){return VT.lookAt(this.array,t.array,e.array,n.array),this._dirty=!0,this},mul:function(t){return VT.mul(this.array,this.array,t.array),this._dirty=!0,this},mulLeft:function(t){return VT.mul(this.array,t.array,this.array),this._dirty=!0,this},multiply:function(t){return VT.multiply(this.array,this.array,t.array),this._dirty=!0,this},multiplyLeft:function(t){return VT.multiply(this.array,t.array,this.array),this._dirty=!0,this},ortho:function(t,e,n,r,i,o){return VT.ortho(this.array,t,e,n,r,i,o),this._dirty=!0,this},perspective:function(t,e,n,r){return VT.perspective(this.array,t,e,n,r),this._dirty=!0,this},rotate:function(t,e){return VT.rotate(this.array,this.array,t,e.array),this._dirty=!0,this},rotateX:function(t){return VT.rotateX(this.array,this.array,t),this._dirty=!0,this},rotateY:function(t){return VT.rotateY(this.array,this.array,t),this._dirty=!0,this},rotateZ:function(t){return VT.rotateZ(this.array,this.array,t),this._dirty=!0,this},scale:function(t){return VT.scale(this.array,this.array,t.array),this._dirty=!0,this},translate:function(t){return VT.translate(this.array,this.array,t.array),this._dirty=!0,this},transpose:function(){return VT.transpose(this.array,this.array),this._dirty=!0,this},decomposeMatrix:(Aw=GT.create(),Cw=GT.create(),Ew=GT.create(),Iw=ww.create(),function(t,e,n){var r=this.array;GT.set(Aw,r[0],r[1],r[2]),GT.set(Cw,r[4],r[5],r[6]),GT.set(Ew,r[8],r[9],r[10]);var i=GT.length(Aw),o=GT.length(Cw),a=GT.length(Ew);this.determinant()<0&&(i=-i),t&&t.set(i,o,a),n.set(r[12],r[13],r[14]),ww.fromMat4(Iw,r),Iw[0]/=i,Iw[1]/=i,Iw[2]/=i,Iw[3]/=o,Iw[4]/=o,Iw[5]/=o,Iw[6]/=a,Iw[7]/=a,Iw[8]/=a,Dw.fromMat3(e.array,Iw),Dw.normalize(e.array,e.array),e._dirty=!0,n._dirty=!0}),toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}},S=Object.defineProperty,S&&(S(ES=Mw.prototype,"z",{get:function(){var t=this.array;return this._axisZ.set(t[8],t[9],t[10]),this._axisZ},set:function(t){var e=this.array;t=t.array,e[8]=t[0],e[9]=t[1],e[10]=t[2],this._dirty=!0}}),S(ES,"y",{get:function(){var t=this.array;return this._axisY.set(t[4],t[5],t[6]),this._axisY},set:function(t){var e=this.array;t=t.array,e[4]=t[0],e[5]=t[1],e[6]=t[2],this._dirty=!0}}),S(ES,"x",{get:function(){var t=this.array;return this._axisX.set(t[0],t[1],t[2]),this._axisX},set:function(t){var e=this.array;t=t.array,e[0]=t[0],e[1]=t[1],e[2]=t[2],this._dirty=!0}})),Mw.adjoint=function(t,e){return VT.adjoint(t.array,e.array),t._dirty=!0,t},Mw.copy=function(t,e){return VT.copy(t.array,e.array),t._dirty=!0,t},Mw.determinant=function(t){return VT.determinant(t.array)},Mw.identity=function(t){return VT.identity(t.array),t._dirty=!0,t},Mw.ortho=function(t,e,n,r,i,o,a){return VT.ortho(t.array,e,n,r,i,o,a),t._dirty=!0,t},Mw.perspective=function(t,e,n,r,i){return VT.perspective(t.array,e,n,r,i),t._dirty=!0,t},Mw.lookAt=function(t,e,n,r){return VT.lookAt(t.array,e.array,n.array,r.array),t._dirty=!0,t},Mw.invert=function(t,e){return VT.invert(t.array,e.array),t._dirty=!0,t},Mw.multiply=Mw.mul=function(t,e,n){return VT.mul(t.array,e.array,n.array),t._dirty=!0,t},Mw.fromQuat=function(t,e){return VT.fromQuat(t.array,e.array),t._dirty=!0,t},Mw.fromRotationTranslation=function(t,e,n){return VT.fromRotationTranslation(t.array,e.array,n.array),t._dirty=!0,t},Mw.fromMat2d=function(t,e){return t._dirty=!0,e=e.array,(t=t.array)[0]=e[0],t[4]=e[2],t[12]=e[4],t[1]=e[1],t[5]=e[3],t[13]=e[5],t},Mw.rotate=function(t,e,n,r){return VT.rotate(t.array,e.array,n,r.array),t._dirty=!0,t},Mw.rotateX=function(t,e,n){return VT.rotateX(t.array,e.array,n),t._dirty=!0,t},Mw.rotateY=function(t,e,n){return VT.rotateY(t.array,e.array,n),t._dirty=!0,t},Mw.rotateZ=function(t,e,n){return VT.rotateZ(t.array,e.array,n),t._dirty=!0,t},Mw.scale=function(t,e,n){return VT.scale(t.array,e.array,n.array),t._dirty=!0,t},Mw.transpose=function(t,e){return VT.transpose(t.array,e.array),t._dirty=!0,t},Mw.translate=function(t,e,n){return VT.translate(t.array,e.array,n.array),t._dirty=!0,t};var Lw,Ow=Mw;function Pw(t,e){this.min=t||new fw(1/0,1/0,1/0),this.max=e||new fw(-1/0,-1/0,-1/0),this.vertices=null}Rw.prototype={constructor:Rw,add:function(t){return Dw.add(this.array,this.array,t.array),this._dirty=!0,this},calculateW:function(){return Dw.calculateW(this.array,this.array),this._dirty=!0,this},set:function(t,e,n,r){return this.array[0]=t,this.array[1]=e,this.array[2]=n,this.array[3]=r,this._dirty=!0,this},setArray:function(t){return this.array[0]=t[0],this.array[1]=t[1],this.array[2]=t[2],this.array[3]=t[3],this._dirty=!0,this},clone:function(){return new Rw(this.x,this.y,this.z,this.w)},conjugate:function(){return Dw.conjugate(this.array,this.array),this._dirty=!0,this},copy:function(t){return Dw.copy(this.array,t.array),this._dirty=!0,this},dot:function(t){return Dw.dot(this.array,t.array)},fromMat3:function(t){return Dw.fromMat3(this.array,t.array),this._dirty=!0,this},fromMat4:(Lw=ww.create(),function(t){return ww.fromMat4(Lw,t.array),ww.transpose(Lw,Lw),Dw.fromMat3(this.array,Lw),this._dirty=!0,this}),identity:function(){return Dw.identity(this.array),this._dirty=!0,this},invert:function(){return Dw.invert(this.array,this.array),this._dirty=!0,this},len:function(){return Dw.len(this.array)},length:function(){return Dw.length(this.array)},lerp:function(t,e,n){return Dw.lerp(this.array,t.array,e.array,n),this._dirty=!0,this},mul:function(t){return Dw.mul(this.array,this.array,t.array),this._dirty=!0,this},mulLeft:function(t){return Dw.multiply(this.array,t.array,this.array),this._dirty=!0,this},multiply:function(t){return Dw.multiply(this.array,this.array,t.array),this._dirty=!0,this},multiplyLeft:function(t){return Dw.multiply(this.array,t.array,this.array),this._dirty=!0,this},normalize:function(){return Dw.normalize(this.array,this.array),this._dirty=!0,this},rotateX:function(t){return Dw.rotateX(this.array,this.array,t),this._dirty=!0,this},rotateY:function(t){return Dw.rotateY(this.array,this.array,t),this._dirty=!0,this},rotateZ:function(t){return Dw.rotateZ(this.array,this.array,t),this._dirty=!0,this},rotationTo:function(t,e){return Dw.rotationTo(this.array,t.array,e.array),this._dirty=!0,this},setAxes:function(t,e,n){return Dw.setAxes(this.array,t.array,e.array,n.array),this._dirty=!0,this},setAxisAngle:function(t,e){return Dw.setAxisAngle(this.array,t.array,e),this._dirty=!0,this},slerp:function(t,e,n){return Dw.slerp(this.array,t.array,e.array,n),this._dirty=!0,this},sqrLen:function(){return Dw.sqrLen(this.array)},squaredLength:function(){return Dw.squaredLength(this.array)},fromEuler:function(t,e){return Rw.fromEuler(this,t,e)},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}},tr=Object.defineProperty,tr&&(tr(IS=Rw.prototype,"x",{get:function(){return this.array[0]},set:function(t){this.array[0]=t,this._dirty=!0}}),tr(IS,"y",{get:function(){return this.array[1]},set:function(t){this.array[1]=t,this._dirty=!0}}),tr(IS,"z",{get:function(){return this.array[2]},set:function(t){this.array[2]=t,this._dirty=!0}}),tr(IS,"w",{get:function(){return this.array[3]},set:function(t){this.array[3]=t,this._dirty=!0}})),Rw.add=function(t,e,n){return Dw.add(t.array,e.array,n.array),t._dirty=!0,t},Rw.set=function(t,e,n,r,i){Dw.set(t.array,e,n,r,i),t._dirty=!0},Rw.copy=function(t,e){return Dw.copy(t.array,e.array),t._dirty=!0,t},Rw.calculateW=function(t,e){return Dw.calculateW(t.array,e.array),t._dirty=!0,t},Rw.conjugate=function(t,e){return Dw.conjugate(t.array,e.array),t._dirty=!0,t},Rw.identity=function(t){return Dw.identity(t.array),t._dirty=!0,t},Rw.invert=function(t,e){return Dw.invert(t.array,e.array),t._dirty=!0,t},Rw.dot=function(t,e){return Dw.dot(t.array,e.array)},Rw.len=function(t){return Dw.length(t.array)},Rw.lerp=function(t,e,n,r){return Dw.lerp(t.array,e.array,n.array,r),t._dirty=!0,t},Rw.slerp=function(t,e,n,r){return Dw.slerp(t.array,e.array,n.array,r),t._dirty=!0,t},Rw.multiply=Rw.mul=function(t,e,n){return Dw.multiply(t.array,e.array,n.array),t._dirty=!0,t},Rw.rotateX=function(t,e,n){return Dw.rotateX(t.array,e.array,n),t._dirty=!0,t},Rw.rotateY=function(t,e,n){return Dw.rotateY(t.array,e.array,n),t._dirty=!0,t},Rw.rotateZ=function(t,e,n){return Dw.rotateZ(t.array,e.array,n),t._dirty=!0,t},Rw.setAxisAngle=function(t,e,n){return Dw.setAxisAngle(t.array,e.array,n),t._dirty=!0,t},Rw.normalize=function(t,e){return Dw.normalize(t.array,e.array),t._dirty=!0,t},Rw.squaredLength=Rw.sqrLen=function(t){return Dw.sqrLen(t.array)},Rw.fromMat3=function(t,e){return Dw.fromMat3(t.array,e.array),t._dirty=!0,t},Rw.setAxes=function(t,e,n,r){return Dw.setAxes(t.array,e.array,n.array,r.array),t._dirty=!0,t},Rw.rotationTo=function(t,e,n){return Dw.rotationTo(t.array,e.array,n.array),t._dirty=!0,t},Rw.fromEuler=function(t,e,n){t._dirty=!0,e=e.array;var r=t.array,i=Math.cos(e[0]/2),o=Math.cos(e[1]/2),a=Math.cos(e[2]/2),s=Math.sin(e[0]/2),l=Math.sin(e[1]/2),u=Math.sin(e[2]/2);switch(n=(n||"XYZ").toUpperCase()){case"XYZ":r[0]=s*o*a+i*l*u,r[1]=i*l*a-s*o*u,r[2]=i*o*u+s*l*a,r[3]=i*o*a-s*l*u;break;case"YXZ":r[0]=s*o*a+i*l*u,r[1]=i*l*a-s*o*u,r[2]=i*o*u-s*l*a,r[3]=i*o*a+s*l*u;break;case"ZXY":r[0]=s*o*a-i*l*u,r[1]=i*l*a+s*o*u,r[2]=i*o*u+s*l*a,r[3]=i*o*a-s*l*u;break;case"ZYX":r[0]=s*o*a-i*l*u,r[1]=i*l*a+s*o*u,r[2]=i*o*u-s*l*a,r[3]=i*o*a+s*l*u;break;case"YZX":r[0]=s*o*a+i*l*u,r[1]=i*l*a+s*o*u,r[2]=i*o*u-s*l*a,r[3]=i*o*a-s*l*u;break;case"XZY":r[0]=s*o*a-i*l*u,r[1]=i*l*a-s*o*u,r[2]=i*o*u+s*l*a,r[3]=i*o*a+s*l*u}};var Nw,kw,Bw,Fw,zw,Hw,Vw=Rw,Uw=GT.set,Gw=GT.copy;Pw.prototype={constructor:Pw,updateFromVertices:function(t){if(0<t.length){var e=this.min,n=this.max,r=e.array,i=n.array;Gw(r,t[0]),Gw(i,t[0]);for(var o=1;o<t.length;o++){var a=t[o];a[0]<r[0]&&(r[0]=a[0]),a[1]<r[1]&&(r[1]=a[1]),a[2]<r[2]&&(r[2]=a[2]),a[0]>i[0]&&(i[0]=a[0]),a[1]>i[1]&&(i[1]=a[1]),a[2]>i[2]&&(i[2]=a[2])}e._dirty=!0,n._dirty=!0}},union:function(t){var e=this.min,n=this.max;return GT.min(e.array,e.array,t.min.array),GT.max(n.array,n.array,t.max.array),e._dirty=!0,n._dirty=!0,this},intersection:function(t){var e=this.min,n=this.max;return GT.max(e.array,e.array,t.min.array),GT.min(n.array,n.array,t.max.array),e._dirty=!0,n._dirty=!0,this},intersectBoundingBox:function(t){var e=this.min.array,n=this.max.array,r=t.min.array;t=t.max.array;return!(e[0]>t[0]||e[1]>t[1]||e[2]>t[2]||n[0]<r[0]||n[1]<r[1]||n[2]<r[2])},containBoundingBox:function(t){var e=this.min.array,n=this.max.array,r=t.min.array;t=t.max.array;return e[0]<=r[0]&&e[1]<=r[1]&&e[2]<=r[2]&&n[0]>=t[0]&&n[1]>=t[1]&&n[2]>=t[2]},containPoint:function(t){var e=this.min.array,n=this.max.array;t=t.array;return e[0]<=t[0]&&e[1]<=t[1]&&e[2]<=t[2]&&n[0]>=t[0]&&n[1]>=t[1]&&n[2]>=t[2]},isFinite:function(){var t=this.min.array,e=this.max.array;return isFinite(t[0])&&isFinite(t[1])&&isFinite(t[2])&&isFinite(e[0])&&isFinite(e[1])&&isFinite(e[2])},applyTransform:function(t){this.transformFrom(this,t)},transformFrom:(Nw=GT.create(),kw=GT.create(),Bw=GT.create(),Fw=GT.create(),zw=GT.create(),Hw=GT.create(),function(t,e){var n=t.min.array;t=t.max.array,e=e.array;return Nw[0]=e[0]*n[0],Nw[1]=e[1]*n[0],Nw[2]=e[2]*n[0],kw[0]=e[0]*t[0],kw[1]=e[1]*t[0],kw[2]=e[2]*t[0],Bw[0]=e[4]*n[1],Bw[1]=e[5]*n[1],Bw[2]=e[6]*n[1],Fw[0]=e[4]*t[1],Fw[1]=e[5]*t[1],Fw[2]=e[6]*t[1],zw[0]=e[8]*n[2],zw[1]=e[9]*n[2],zw[2]=e[10]*n[2],Hw[0]=e[8]*t[2],Hw[1]=e[9]*t[2],Hw[2]=e[10]*t[2],n=this.min.array,t=this.max.array,n[0]=Math.min(Nw[0],kw[0])+Math.min(Bw[0],Fw[0])+Math.min(zw[0],Hw[0])+e[12],n[1]=Math.min(Nw[1],kw[1])+Math.min(Bw[1],Fw[1])+Math.min(zw[1],Hw[1])+e[13],n[2]=Math.min(Nw[2],kw[2])+Math.min(Bw[2],Fw[2])+Math.min(zw[2],Hw[2])+e[14],t[0]=Math.max(Nw[0],kw[0])+Math.max(Bw[0],Fw[0])+Math.max(zw[0],Hw[0])+e[12],t[1]=Math.max(Nw[1],kw[1])+Math.max(Bw[1],Fw[1])+Math.max(zw[1],Hw[1])+e[13],t[2]=Math.max(Nw[2],kw[2])+Math.max(Bw[2],Fw[2])+Math.max(zw[2],Hw[2])+e[14],this.min._dirty=!0,this.max._dirty=!0,this}),applyProjection:function(t){var e=this.min.array,n=this.max.array,r=t.array,i=e[0],o=e[1],a=e[2],s=n[0],l=n[1],u=e[2],h=n[0],c=n[1];t=n[2];return 1===r[15]?(e[0]=r[0]*i+r[12],e[1]=r[5]*o+r[13],n[2]=r[10]*a+r[14],n[0]=r[0]*h+r[12],n[1]=r[5]*c+r[13],e[2]=r[10]*t+r[14]):(e[0]=r[0]*i*(i=-1/a),e[1]=r[5]*o*i,n[2]=(r[10]*a+r[14])*i,n[0]=r[0]*s*(i=-1/u),n[1]=r[5]*l*i,e[2]=(r[10]*t+r[14])*(i=-1/t)),this.min._dirty=!0,this.max._dirty=!0,this},updateVertices:function(){if(!(t=this.vertices)){for(var t=[],e=0;e<8;e++)t[e]=GT.fromValues(0,0,0);this.vertices=t}var n=this.min.array,r=this.max.array;return Uw(t[0],n[0],n[1],n[2]),Uw(t[1],n[0],r[1],n[2]),Uw(t[2],r[0],n[1],n[2]),Uw(t[3],r[0],r[1],n[2]),Uw(t[4],n[0],n[1],r[2]),Uw(t[5],n[0],r[1],r[2]),Uw(t[6],r[0],n[1],r[2]),Uw(t[7],r[0],r[1],r[2]),this},copy:function(t){var e=this.min,n=this.max;return Gw(e.array,t.min.array),Gw(n.array,t.max.array),e._dirty=!0,n._dirty=!0,this},clone:function(){var t=new Pw;return t.copy(this),t}};var Ww,Xw,jw,Yw,Zw,qw,Kw,Qw=Pw,Jw=0;function $w(t){return!t.invisible&&t.geometry}var tS,eS=wu.extend({name:"",position:null,rotation:null,scale:null,worldTransform:null,localTransform:null,autoUpdateLocalTransform:!0,_parent:null,_scene:null,_needsUpdateWorldTransform:!0,_inIterating:!1,__depth:0},(function(){this.name||(this.name=(this.type||"NODE")+"_"+Jw++),this.position||(this.position=new fw),this.rotation||(this.rotation=new Vw),this.scale||(this.scale=new fw(1,1,1)),this.worldTransform=new Ow,this.localTransform=new Ow,this._children=[]}),{target:null,invisible:!1,isSkinnedMesh:function(){return!1},isRenderable:function(){return!1},setName:function(t){var e=this._scene;e&&(delete(e=e._nodeRepository)[this.name],e[t]=this),this.name=t},add:function(t){var e=t._parent;e!==this&&(e&&e.remove(t),(t._parent=this)._children.push(t),(e=this._scene)&&e!==t.scene&&t.traverse(this._addSelfToScene,this),t._needsUpdateWorldTransform=!0)},remove:function(t){var e=this._children,n=e.indexOf(t);n<0||(e.splice(n,1),t._parent=null,this._scene&&t.traverse(this._removeSelfFromScene,this))},removeAll:function(){for(var t=this._children,e=0;e<t.length;e++)t[e]._parent=null,this._scene&&t[e].traverse(this._removeSelfFromScene,this);this._children=[]},getScene:function(){return this._scene},getParent:function(){return this._parent},_removeSelfFromScene:function(t){t._scene.removeFromScene(t),t._scene=null},_addSelfToScene:function(t){this._scene.addToScene(t),t._scene=this._scene},isAncestor:function(t){for(var e=t._parent;e;){if(e===this)return!0;e=e._parent}return!1},children:function(){return this._children.slice()},childAt:function(t){return this._children[t]},getChildByName:function(t){for(var e=this._children,n=0;n<e.length;n++)if(e[n].name===t)return e[n]},getDescendantByName:function(t){for(var e=this._children,n=0;n<e.length;n++){var r=e[n];if(r.name===t)return r;if(r=r.getDescendantByName(t),r)return r}},queryNode:function(t){if(t){for(var e=t.split("/"),n=this,r=0;r<e.length;r++){var i=e[r];if(i){for(var o=!1,a=n._children,s=0;s<a.length;s++){var l=a[s];if(l.name===i){n=l,o=!0;break}}if(!o)return}}return n}},getPath:function(t){if(!this._parent)return"/";for(var e=this._parent,n=this.name;e._parent&&(n=e.name+"/"+n,e._parent!=t);)e=e._parent;return!e._parent&&t?null:n},traverse:function(t,e){t.call(e,this);for(var n=this._children,r=0,i=n.length;r<i;r++)n[r].traverse(t,e)},eachChild:function(t,e){for(var n=this._children,r=0,i=n.length;r<i;r++){var o=n[r];t.call(e,o,r)}},setLocalTransform:function(t){VT.copy(this.localTransform.array,t.array),this.decomposeLocalTransform()},decomposeLocalTransform:function(t){t=t?null:this.scale,this.localTransform.decomposeMatrix(t,this.rotation,this.position)},setWorldTransform:function(t){VT.copy(this.worldTransform.array,t.array),this.decomposeWorldTransform()},decomposeWorldTransform:(Kw=VT.create(),function(t){var e=this.localTransform,n=this.worldTransform;this._parent?(VT.invert(Kw,this._parent.worldTransform.array),VT.multiply(e.array,Kw,n.array)):VT.copy(e.array,n.array),t=t?null:this.scale,e.decomposeMatrix(t,this.rotation,this.position)}),transformNeedsUpdate:function(){return this.position._dirty||this.rotation._dirty||this.scale._dirty},updateLocalTransform:function(){var t,e=this.position,n=this.rotation,r=this.scale;this.transformNeedsUpdate()&&(t=this.localTransform.array,VT.fromRotationTranslation(t,n.array,e.array),VT.scale(t,t,r.array),n._dirty=!1,r._dirty=!1,e._dirty=!1,this._needsUpdateWorldTransform=!0)},_updateWorldTransformTopDown:function(){var t=this.localTransform.array,e=this.worldTransform.array;this._parent?VT.multiplyAffine(e,this._parent.worldTransform.array,t):VT.copy(e,t)},updateWorldTransform:function(){for(var t=this;t&&t.getParent()&&t.getParent().transformNeedsUpdate();)t=t.getParent();t.update()},update:function(t){this.autoUpdateLocalTransform?this.updateLocalTransform():t=!0,(t||this._needsUpdateWorldTransform)&&(this._updateWorldTransformTopDown(),this._needsUpdateWorldTransform=!(t=!0));for(var e=this._children,n=0,r=e.length;n<r;n++)e[n].update(t)},getBoundingBox:(Yw=new Qw,Zw=new Ow,qw=new Ow,function(t,e){return e=e||new Qw,this._parent?Ow.invert(qw,this._parent.worldTransform):Ow.identity(qw),this.traverse((function(t){t.geometry&&t.geometry.boundingBox&&(Yw.copy(t.geometry.boundingBox),Ow.multiply(Zw,qw,t.worldTransform),Yw.applyTransform(Zw),e.union(Yw))}),this,$w),e}),getWorldPosition:function(t){this.transformNeedsUpdate()&&this.updateWorldTransform();var e=this.worldTransform.array;if(t){var n=t.array;return n[0]=e[12],n[1]=e[13],n[2]=e[14],t}return new fw(e[12],e[13],e[14])},clone:function(){var t=new this.constructor,e=this._children;t.setName(this.name),t.position.copy(this.position),t.rotation.copy(this.rotation),t.scale.copy(this.scale);for(var n=0;n<e.length;n++)t.add(e[n].clone());return t},rotateAround:(Xw=new fw,jw=new Ow,function(t,e,n){Xw.copy(this.position).subtract(t);var r=this.localTransform;r.identity(),r.translate(t),r.rotate(n,e),jw.fromRotationTranslation(this.rotation,Xw),r.multiply(jw),r.scale(this.scale),this.decomposeLocalTransform(),this._needsUpdateWorldTransform=!0}),lookAt:(Ww=new Ow,function(t,e){Ww.lookAt(this.position,t,e||this.localTransform.y).invert(),this.setLocalTransform(Ww),this.target=t})});Bo=eS.extend({material:null,geometry:null,mode:Bb.TRIANGLES,_renderInfo:null},{__program:null,lightGroup:0,renderOrder:0,culling:!0,cullFace:Bb.BACK,frontFace:Bb.CCW,frustumCulling:!0,receiveShadow:!0,castShadow:!0,ignorePicking:!1,ignorePreZ:!1,ignoreGBuffer:!1,isRenderable:function(){return this.geometry&&this.material&&this.material.shader&&!this.invisible&&0<this.geometry.vertexCount},beforeRender:function(t){},afterRender:function(t,e){},getBoundingBox:function(t,e){return e=eS.prototype.getBoundingBox.call(this,t,e),this.geometry&&this.geometry.boundingBox&&e.union(this.geometry.boundingBox),e},clone:(tS=["castShadow","receiveShadow","mode","culling","cullFace","frontFace","frustumCulling","renderOrder","lineWidth","ignorePicking","ignorePreZ","ignoreGBuffer"],function(){var t=eS.prototype.clone.call(this);t.geometry=this.geometry,t.material=this.material;for(var e=0;e<tS.length;e++){var n=tS[e];t[n]!==this[n]&&(t[n]=this[n])}return t})});Bo.POINTS=Bb.POINTS,Bo.LINES=Bb.LINES,Bo.LINE_LOOP=Bb.LINE_LOOP,Bo.LINE_STRIP=Bb.LINE_STRIP,Bo.TRIANGLES=Bb.TRIANGLES,Bo.TRIANGLE_STRIP=Bb.TRIANGLE_STRIP,Bo.TRIANGLE_FAN=Bb.TRIANGLE_FAN,Bo.BACK=Bb.BACK,Bo.FRONT=Bb.FRONT,Bo.FRONT_AND_BACK=Bb.FRONT_AND_BACK,Bo.CW=Bb.CW,Bo.CCW=Bb.CCW;var nS,rS,iS,oS,aS,sS=Bo,lS=wu.extend({scene:null,camera:null,renderer:null},(function(){this._ray=new mw,this._ndc=new hT}),{pick:function(t,e,n){return this.pickAll(t,e,[],n)[0]||null},pickAll:function(t,e,n,r){return this.renderer.screenToNDC(t,e,this._ndc),this.camera.castRay(this._ndc,this._ray),this._intersectNode(this.scene,n=n||[],r||!1),n.sort(this._intersectionCompareFunc),n},_intersectNode:function(t,e,n){t instanceof sS&&t.isRenderable()&&(t.ignorePicking&&!n||!(t.mode===Bb.TRIANGLES&&t.geometry.isUseIndices()||t.geometry.pickByRay||t.geometry.pick)||this._intersectRenderable(t,e));for(var r=0;r<t._children.length;r++)this._intersectNode(t._children[r],e,n)},_intersectRenderable:(nS=new fw,rS=new fw,iS=new fw,oS=new mw,aS=new Ow,function(t,e){var n=t.isSkinnedMesh();oS.copy(this._ray),Ow.invert(aS,t.worldTransform),n||oS.applyTransform(aS);var r=t.geometry,i=(n?t.skeleton:r).boundingBox;if(!i||oS.intersectBoundingBox(i))if(r.pick)r.pick(this._ndc.x,this._ndc.y,this.renderer,this.camera,t,e);else if(r.pickByRay)r.pickByRay(oS,t,e);else{var o,a=t.cullFace===Bb.BACK&&t.frontFace===Bb.CCW||t.cullFace===Bb.FRONT&&t.frontFace===Bb.CW,s=r.indices,l=r.attributes.position,u=r.attributes.weight,h=r.attributes.joint,c=[];if(l&&l.value&&s){if(n){for(var d=t.skeleton.getSubSkinMatrices(t.__uid__,t.joints),p=0;p<t.joints.length;p++){c[p]=c[p]||[];for(var f=0;f<16;f++)c[p][f]=d[16*p+f]}var g=[],m=[],y=[],_=[],v=[],x=r.attributes.skinnedPosition;for(x&&x.value||(r.createAttribute("skinnedPosition","f",3),(x=r.attributes.skinnedPosition).init(r.vertexCount)),p=0;p<r.vertexCount;p++){for(l.get(p,g),u.get(p,m),h.get(p,y),m[3]=1-m[0]-m[1]-m[2],GT.set(_,0,0,0),f=0;f<4;f++)0<=y[f]&&1e-4<m[f]&&(GT.transformMat4(v,g,c[y[f]]),GT.scaleAndAdd(_,_,v,m[f]));x.set(p,_)}}for(p=0;p<s.length;p+=3){var b=s[p],T=s[p+1],w=s[p+2],S=n?r.attributes.skinnedPosition:l;S.get(b,nS.array),S.get(T,rS.array),S.get(w,iS.array),(o=a?oS.intersectTriangle(nS,rS,iS,t.culling):oS.intersectTriangle(nS,iS,rS,t.culling))&&(S=new fw,n?fw.copy(S,o):fw.transformMat4(S,o,t.worldTransform),e.push(new lS.Intersection(o,S,t,[b,T,w],p/3,fw.dist(S,this._ray.origin))))}}}}),_intersectionCompareFunc:function(t,e){return t.distance-e.distance}});lS.Intersection=function(t,e,n,r,i,o){this.point=t,this.pointWorld=e,this.target=n,this.triangle=r,this.triangleIndex=i,this.distance=o};var uS=lS,hS="__dt__",cS=(Ql=function(){this._contextId=0,this._caches=[],this._context={}},(Ql.prototype={use:function(t,e){var n=this._caches;n[t]||(n[t]={},e&&(n[t]=e())),this._contextId=t,this._context=n[t]},put:function(t,e){this._context[t]=e},get:function(t){return this._context[t]},dirty:function(t){this.put(hS+(t=t||""),!0)},dirtyAll:function(t){for(var e=hS+(t=t||""),n=this._caches,r=0;r<n.length;r++)n[r]&&(n[r][e]=!0)},fresh:function(t){this.put(hS+(t=t||""),!1)},freshAll:function(t){for(var e=hS+(t=t||""),n=this._caches,r=0;r<n.length;r++)n[r]&&(n[r][e]=!1)},isDirty:function(t){var e=hS+(t=t||"");t=this._context;return!t.hasOwnProperty(e)||!0===t[e]},deleteContext:function(t){delete this._caches[t],this._context={}},delete:function(t){delete this._context[t]},clearAll:function(){this._caches={}},getContext:function(){return this._context},eachContext:function(t,e){Object.keys(this._caches).forEach((function(n){t&&t.call(e,n)}))},miss:function(t){return!this._context.hasOwnProperty(t)}}).constructor=Ql),dS=wu.extend({width:512,height:512,type:Bb.UNSIGNED_BYTE,format:Bb.RGBA,wrapS:Bb.REPEAT,wrapT:Bb.REPEAT,minFilter:Bb.LINEAR_MIPMAP_LINEAR,magFilter:Bb.LINEAR,useMipmap:!0,anisotropic:1,flipY:!0,sRGB:!0,unpackAlignment:4,premultiplyAlpha:!1,dynamic:!1,NPOT:!1,__used:0},(function(){this._cache=new cS}),{getWebGLTexture:function(t){var e=t.gl,n=this._cache;return n.use(t.__uid__),n.miss("webgl_texture")&&n.put("webgl_texture",e.createTexture()),this.dynamic?this.update(t):n.isDirty()&&(this.update(t),n.fresh()),n.get("webgl_texture")},bind:function(){},unbind:function(){},dirty:function(){this._cache&&this._cache.dirtyAll()},update:function(t){},updateCommon:function(t){var e=t.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,this.unpackAlignment),this.format===Bb.DEPTH_COMPONENT&&(this.useMipmap=!1),t=t.getGLExtension("EXT_sRGB"),this.format!==dS.SRGB||t||(this.format=dS.RGB),this.format!==dS.SRGB_ALPHA||t||(this.format=dS.RGBA),this.NPOT=!this.isPowerOfTwo()},getAvailableWrapS:function(){return this.NPOT?Bb.CLAMP_TO_EDGE:this.wrapS},getAvailableWrapT:function(){return this.NPOT?Bb.CLAMP_TO_EDGE:this.wrapT},getAvailableMinFilter:function(){var t=this.minFilter;return this.NPOT||!this.useMipmap?t===Bb.NEAREST_MIPMAP_NEAREST||t===Bb.NEAREST_MIPMAP_LINEAR?Bb.NEAREST:t===Bb.LINEAR_MIPMAP_LINEAR||t===Bb.LINEAR_MIPMAP_NEAREST?Bb.LINEAR:t:t},getAvailableMagFilter:function(){return this.magFilter},nextHighestPowerOfTwo:function(t){--t;for(var e=1;e<32;e<<=1)t|=t>>e;return t+1},dispose:function(t){var e=this._cache;e.use(t.__uid__);var n=e.get("webgl_texture");n&&t.gl.deleteTexture(n),e.deleteContext(t.__uid__)},isRenderable:function(){},isPowerOfTwo:function(){}});Object.defineProperty(dS.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}}),Object.defineProperty(dS.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}}),dS.BYTE=Bb.BYTE,dS.UNSIGNED_BYTE=Bb.UNSIGNED_BYTE,dS.SHORT=Bb.SHORT,dS.UNSIGNED_SHORT=Bb.UNSIGNED_SHORT,dS.INT=Bb.INT,dS.UNSIGNED_INT=Bb.UNSIGNED_INT,dS.FLOAT=Bb.FLOAT,dS.HALF_FLOAT=36193,dS.UNSIGNED_INT_24_8_WEBGL=34042,dS.DEPTH_COMPONENT=Bb.DEPTH_COMPONENT,dS.DEPTH_STENCIL=Bb.DEPTH_STENCIL,dS.ALPHA=Bb.ALPHA,dS.RGB=Bb.RGB,dS.RGBA=Bb.RGBA,dS.LUMINANCE=Bb.LUMINANCE,dS.LUMINANCE_ALPHA=Bb.LUMINANCE_ALPHA,dS.SRGB=35904,dS.SRGB_ALPHA=35906,dS.COMPRESSED_RGB_S3TC_DXT1_EXT=33776,dS.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777,dS.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778,dS.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779,dS.NEAREST=Bb.NEAREST,dS.LINEAR=Bb.LINEAR,dS.NEAREST_MIPMAP_NEAREST=Bb.NEAREST_MIPMAP_NEAREST,dS.LINEAR_MIPMAP_NEAREST=Bb.LINEAR_MIPMAP_NEAREST,dS.NEAREST_MIPMAP_LINEAR=Bb.NEAREST_MIPMAP_LINEAR,dS.LINEAR_MIPMAP_LINEAR=Bb.LINEAR_MIPMAP_LINEAR,dS.REPEAT=Bb.REPEAT,dS.CLAMP_TO_EDGE=Bb.CLAMP_TO_EDGE,dS.MIRRORED_REPEAT=Bb.MIRRORED_REPEAT;var pS=dS;ur=sS.extend({skeleton:null,joints:null},(function(){this.joints||(this.joints=[])}),{offsetMatrix:null,isInstancedMesh:function(){return!1},isSkinnedMesh:function(){return!!(this.skeleton&&this.joints&&0<this.joints.length)},clone:function(){var t=sS.prototype.clone.call(this);return t.skeleton=this.skeleton,this.joints&&(t.joints=this.joints.slice()),t}});ur.POINTS=Bb.POINTS,ur.LINES=Bb.LINES,ur.LINE_LOOP=Bb.LINE_LOOP,ur.LINE_STRIP=Bb.LINE_STRIP,ur.TRIANGLES=Bb.TRIANGLES,ur.TRIANGLE_STRIP=Bb.TRIANGLE_STRIP,ur.TRIANGLE_FAN=Bb.TRIANGLE_FAN,ur.BACK=Bb.BACK,ur.FRONT=Bb.FRONT,ur.FRONT_AND_BACK=Bb.FRONT_AND_BACK,ur.CW=Bb.CW,ur.CCW=Bb.CCW;var fS=ur,gS=($r={isPowerOfTwo:function(t){return 0==(t&t-1)},nextPowerOfTwo:function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},nearestPowerOfTwo:function(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))}},M=$r,M.isPowerOfTwo);function mS(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))}var yS=pS.extend((function(){return{image:null,pixels:null,mipmaps:[],convertToPOT:!1}}),{textureType:"texture2D",update:function(t){var e=t.gl;e.bindTexture(e.TEXTURE_2D,this._cache.get("webgl_texture")),this.updateCommon(t);var n=this.format,r=this.type,i=!(!this.convertToPOT||this.mipmaps.length||!this.image||this.wrapS!==pS.REPEAT&&this.wrapT!==pS.REPEAT||!this.NPOT);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,i?this.wrapS:this.getAvailableWrapS()),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,i?this.wrapT:this.getAvailableWrapT()),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i?this.magFilter:this.getAvailableMagFilter()),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i?this.minFilter:this.getAvailableMinFilter());var o=t.getGLExtension("EXT_texture_filter_anisotropic");if(o&&1<this.anisotropic&&e.texParameterf(e.TEXTURE_2D,o.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic),36193===r&&(t.getGLExtension("OES_texture_half_float")||(r=Bb.FLOAT)),this.mipmaps.length)for(var a=this.width,s=this.height,l=0;l<this.mipmaps.length;l++){var u=this.mipmaps[l];this._updateTextureData(e,u,l,a,s,n,r,!1),a/=2,s/=2}else this._updateTextureData(e,this,0,this.width,this.height,n,r,i),!this.useMipmap||this.NPOT&&!i||e.generateMipmap(e.TEXTURE_2D);e.bindTexture(e.TEXTURE_2D,null)},_updateTextureData:function(t,e,n,r,i,o,a,s){var l,u,h,c;e.image?(l=e.image,s&&(this._potCanvas=(h=(u=this)._potCanvas,c=mS(u.width),s=mS(u.height),(h=h||document.createElement("canvas")).width=c,h.height=s,h.getContext("2d").drawImage(u.image,0,0,c,s),h),l=this._potCanvas),t.texImage2D(t.TEXTURE_2D,n,o,o,a,l)):o<=pS.COMPRESSED_RGBA_S3TC_DXT5_EXT&&o>=pS.COMPRESSED_RGB_S3TC_DXT1_EXT?t.compressedTexImage2D(t.TEXTURE_2D,n,o,r,i,0,e.pixels):t.texImage2D(t.TEXTURE_2D,n,o,r,i,0,o,a,e.pixels)},generateMipmap:function(t){t=t.gl,this.useMipmap&&!this.NPOT&&(t.bindTexture(t.TEXTURE_2D,this._cache.get("webgl_texture")),t.generateMipmap(t.TEXTURE_2D))},isPowerOfTwo:function(){return gS(this.width)&&gS(this.height)},isRenderable:function(){return this.image?0<this.image.width&&0<this.image.height:!(!this.width||!this.height)},bind:function(t){t.gl.bindTexture(t.gl.TEXTURE_2D,this.getWebGLTexture(t))},unbind:function(t){t.gl.bindTexture(t.gl.TEXTURE_2D,null)},load:function(t,e){var n=Fb.a.createImage();e&&(n.crossOrigin=e);var r=this;return n.onload=function(){r.dirty(),r.trigger("success",r)},n.onerror=function(){r.trigger("error",r)},n.src=t,this.image=n,this}});Object.defineProperty(yS.prototype,"width",{get:function(){return this.image?this.image.width:this._width},set:function(t){this.image?console.warn("Texture from image can't set width"):(this._width!==t&&this.dirty(),this._width=t)}}),Object.defineProperty(yS.prototype,"height",{get:function(){return this.image?this.image.height:this._height},set:function(t){this.image?console.warn("Texture from image can't set height"):(this._height!==t&&this.dirty(),this._height=t)}});var _S=yS;function vS(t){return{byte:Fb.a.Int8Array,ubyte:Fb.a.Uint8Array,short:Fb.a.Int16Array,ushort:Fb.a.Uint16Array}[t]||Fb.a.Float32Array}function xS(t){return"attr_"+t}function bS(t,e,n,r){switch(this.name=t,this.type=e,this.size=n,this.semantic=r||"",this.value=null,n){case 1:this.get=function(t){return this.value[t]},this.set=function(t,e){this.value[t]=e},this.copy=function(t,e){this.value[t]=this.value[t]};break;case 2:this.get=function(t,e){var n=this.value;return e[0]=n[2*t],e[1]=n[2*t+1],e},this.set=function(t,e){var n=this.value;n[2*t]=e[0],n[2*t+1]=e[1]},this.copy=function(t,e){var n=this.value;n[t*=2]=n[e*=2],n[t+1]=n[e+1]};break;case 3:this.get=function(t,e){var n=3*t;t=this.value;return e[0]=t[n],e[1]=t[1+n],e[2]=t[2+n],e},this.set=function(t,e){var n=3*t;t=this.value;t[n]=e[0],t[1+n]=e[1],t[2+n]=e[2]},this.copy=function(t,e){var n=this.value;n[t*=3]=n[e*=3],n[t+1]=n[e+1],n[t+2]=n[e+2]};break;case 4:this.get=function(t,e){var n=this.value;t*=4;return e[0]=n[t],e[1]=n[1+t],e[2]=n[2+t],e[3]=n[3+t],e},this.set=function(t,e){var n=this.value;t*=4;n[t]=e[0],n[1+t]=e[1],n[2+t]=e[2],n[3+t]=e[3]},this.copy=function(t,e){var n=this.value;n[t*=4]=n[e*=4],n[t+1]=n[e+1],n[t+2]=n[e+2],n[t+3]=n[e+3]}}}function TS(t,e,n,r,i){this.name=t,this.type=e,this.buffer=n,this.size=r,this.semantic=i,this.symbol="",this.needsRemove=!1}function wS(t){this.buffer=t,this.count=0}bS.prototype.init=function(t){var e;this.value&&this.value.length===t*this.size||(e=vS(this.type),this.value=new e(t*this.size))},bS.prototype.fromArray=function(t){var e=vS(this.type);if(t[0]&&t[0].length)for(var n=0,r=this.size,i=new e(t.length*r),o=0;o<t.length;o++)for(var a=0;a<r;a++)i[n++]=t[o][a];else i=new e(t);this.value=i},bS.prototype.clone=function(t){var e=new bS(this.name,this.type,this.size,this.semantic);return t&&console.warn("todo"),e},Pu=wu.extend((function(){return{attributes:{},indices:null,dynamic:!0,_enabledAttributes:null,__used:0}}),(function(){this._cache=new cS,this._attributeList=Object.keys(this.attributes),this.__vaoCache={}}),{mainAttribute:"",pick:null,pickByRay:null,dirty:function(){for(var t=this.getEnabledAttributes(),e=0;e<t.length;e++)this.dirtyAttribute(t[e]);this.dirtyIndices(),this._enabledAttributes=null,this._cache.dirty("any")},dirtyIndices:function(){this._cache.dirtyAll("indices")},dirtyAttribute:function(t){this._cache.dirtyAll(xS(t)),this._cache.dirtyAll("attributes")},getTriangleIndices:function(t,e){if(t<this.triangleCount&&0<=t){var n=this.indices;return(e=e||[])[0]=n[3*t],e[1]=n[3*t+1],e[2]=n[3*t+2],e}},setTriangleIndices:function(t,e){var n=this.indices;n[3*t]=e[0],n[3*t+1]=e[1],n[3*t+2]=e[2]},isUseIndices:function(){return!!this.indices},initIndicesFromArray:function(t){var e=65535<this.vertexCount?Fb.a.Uint32Array:Fb.a.Uint16Array;if(t[0]&&t[0].length)for(var n=0,r=new e(3*t.length),i=0;i<t.length;i++)for(var o=0;o<3;o++)r[n++]=t[i][o];else r=new e(t);this.indices=r},createAttribute:function(t,e,n,r){return r=new bS(t,e,n,r),this.attributes[t]&&this.removeAttribute(t),this.attributes[t]=r,this._attributeList.push(t),r},removeAttribute:function(t){var e=this._attributeList,n=e.indexOf(t);return 0<=n&&(e.splice(n,1),delete this.attributes[t],!0)},getAttribute:function(t){return this.attributes[t]},getEnabledAttributes:function(){var t=this._enabledAttributes,e=this._attributeList;if(t)return t;for(var n=[],r=this.vertexCount,i=0;i<e.length;i++){var o=e[i],a=this.attributes[o];a.value&&a.value.length===r*a.size&&n.push(o)}return this._enabledAttributes=n},getBufferChunks:function(t){var e=this._cache;e.use(t.__uid__);var n=e.isDirty("attributes"),r=e.isDirty("indices");if(n||r){this._updateBuffer(t.gl,n,r);for(var i=this.getEnabledAttributes(),o=0;o<i.length;o++)e.fresh(xS(i[o]));e.fresh("attributes"),e.fresh("indices")}return e.fresh("any"),e.get("chunks")},_updateBuffer:function(t,e,n){var r=this._cache,i=r.get("chunks"),o=!1;i||((i=[])[0]={attributeBuffers:[],indicesBuffer:null},r.put("chunks",i),o=!0);var a=i[0],s=a.attributeBuffers;i=a.indicesBuffer;if(e||o){var l=this.getEnabledAttributes(),u={};if(!o)for(var h=0;h<s.length;h++)u[s[h].name]=s[h];for(var c=0;c<l.length;c++){var d,p=l[c],f=this.attributes[p],g=(d=o?d:u[p])?d.buffer:t.createBuffer();r.isDirty(xS(p))&&(t.bindBuffer(t.ARRAY_BUFFER,g),t.bufferData(t.ARRAY_BUFFER,f.value,this.dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW)),s[c]=new TS(p,f.type,g,f.size,f.semantic)}for(h=c;h<s.length;h++)t.deleteBuffer(s[h].buffer);s.length=c}this.isUseIndices()&&(n||o)&&(i||(i=new wS(t.createBuffer()),a.indicesBuffer=i),i.count=this.indices.length,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,this.dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW))},dispose:function(t){var e=this._cache;e.use(t.__uid__);var n=e.get("chunks");if(n)for(var r=0;r<n.length;r++){for(var i=n[r],o=0;o<i.attributeBuffers.length;o++){var a=i.attributeBuffers[o];t.gl.deleteBuffer(a.buffer)}i.indicesBuffer&&t.gl.deleteBuffer(i.indicesBuffer.buffer)}if(this.__vaoCache){var s,l=t.getGLExtension("OES_vertex_array_object");for(s in this.__vaoCache){var u=this.__vaoCache[s].vao;u&&l.deleteVertexArrayOES(u)}}this.__vaoCache={},e.deleteContext(t.__uid__)}}),Object.defineProperty&&(Object.defineProperty(Pu.prototype,"vertexCount",{enumerable:!1,get:function(){var t=this.attributes[this.mainAttribute];return(t=t||this.attributes[this._attributeList[0]])&&t.value?t.value.length/t.size:0}}),Object.defineProperty(Pu.prototype,"triangleCount",{enumerable:!1,get:function(){var t=this.indices;return t?t.length/3:0}})),Pu.STATIC_DRAW=Bb.STATIC_DRAW,Pu.DYNAMIC_DRAW=Bb.DYNAMIC_DRAW,Pu.STREAM_DRAW=Bb.STREAM_DRAW,Pu.AttributeBuffer=TS,Pu.IndicesBuffer=wS,Pu.Attribute=bS;S=Pu;var SS=GT.create,MS=GT.add,AS=GT.set,CS=S.Attribute,ES=S.extend((function(){return{attributes:{position:new CS("position","float",3,"POSITION"),texcoord0:new CS("texcoord0","float",2,"TEXCOORD_0"),texcoord1:new CS("texcoord1","float",2,"TEXCOORD_1"),normal:new CS("normal","float",3,"NORMAL"),tangent:new CS("tangent","float",4,"TANGENT"),color:new CS("color","float",4,"COLOR"),weight:new CS("weight","float",3,"WEIGHT"),joint:new CS("joint","float",4,"JOINT"),barycentric:new CS("barycentric","float",3,null)},boundingBox:null}}),{mainAttribute:"position",updateBoundingBox:function(){var t=(t=this.boundingBox)||(this.boundingBox=new Qw),e=this.attributes.position.value;if(e&&e.length){var n=t.min,r=(t=t.max,n.array),i=t.array;GT.set(r,e[0],e[1],e[2]),GT.set(i,e[0],e[1],e[2]);for(var o=3;o<e.length;){var a=e[o++],s=e[o++],l=e[o++];a<r[0]&&(r[0]=a),s<r[1]&&(r[1]=s),l<r[2]&&(r[2]=l),a>i[0]&&(i[0]=a),s>i[1]&&(i[1]=s),l>i[2]&&(i[2]=l)}n._dirty=!0,t._dirty=!0}},generateVertexNormals:function(){if(this.vertexCount){var t=this.indices,e=this.attributes,n=e.position.value,r=e.normal.value;if(r&&r.length===n.length)for(var i=0;i<r.length;i++)r[i]=0;else r=e.normal.value=new Fb.a.Float32Array(n.length);for(var o,a,s,l=SS(),u=SS(),h=SS(),c=SS(),d=SS(),p=SS(),f=t?t.length:this.vertexCount,g=0;g<f;)for(s=t?(o=t[g++],a=t[g++],t[g++]):(o=g++,a=g++,g++),AS(l,n[3*o],n[3*o+1],n[3*o+2]),AS(u,n[3*a],n[3*a+1],n[3*a+2]),AS(h,n[3*s],n[3*s+1],n[3*s+2]),GT.sub(c,l,u),GT.sub(d,u,h),GT.cross(p,c,d),i=0;i<3;i++)r[3*o+i]=r[3*o+i]+p[i],r[3*a+i]=r[3*a+i]+p[i],r[3*s+i]=r[3*s+i]+p[i];for(i=0;i<r.length;)AS(p,r[i],r[i+1],r[i+2]),GT.normalize(p,p),r[i++]=p[0],r[i++]=p[1],r[i++]=p[2];this.dirty()}},generateFaceNormals:function(){if(this.vertexCount){this.isUniqueVertex()||this.generateUniqueVertex();for(var t,e,n,r=this.indices,i=this.attributes,o=i.position.value,a=i.normal.value,s=SS(),l=SS(),u=SS(),h=SS(),c=SS(),d=SS(),p=(a=a||(i.normal.value=new Float32Array(o.length)),r?r.length:this.vertexCount),f=0;f<p;){n=r?(t=r[f++],e=r[f++],r[f++]):(t=f++,e=f++,f++),AS(s,o[3*t],o[3*t+1],o[3*t+2]),AS(l,o[3*e],o[3*e+1],o[3*e+2]),AS(u,o[3*n],o[3*n+1],o[3*n+2]),GT.sub(h,s,l),GT.sub(c,l,u),GT.cross(d,h,c),GT.normalize(d,d);for(var g=0;g<3;g++)a[3*t+g]=d[g],a[3*e+g]=d[g],a[3*n+g]=d[g]}this.dirty()}},generateTangents:function(){if(this.vertexCount){var t=this.vertexCount,e=this.attributes;e.tangent.value||(e.tangent.value=new Float32Array(4*t));var n=e.texcoord0.value,r=e.position.value,i=e.tangent.value,o=e.normal.value;if(n){for(var a=[],s=[],l=0;l<t;l++)a[l]=[0,0,0],s[l]=[0,0,0];var u,h,c=[0,0,0],d=[0,0,0],p=this.indices,f=p?p.length:this.vertexCount;for(l=0;l<f;){var g=p?(u=p[l++],h=p[l++],p[l++]):(u=l++,h=l++,l++),m=n[2*u],y=n[2*h],_=n[2*g],v=n[2*u+1],x=n[2*h+1],b=n[2*g+1],T=r[3*u],w=r[3*h],S=r[3*g],M=r[3*u+1],A=r[3*h+1],C=r[3*g+1],E=r[3*u+2];w=w-T,T=S-T,A=A-M,C=C-M,M=r[3*h+2]-E,E=r[3*g+2]-E,y=y-m,m=_-m,x=x-v,b=b-v,v=1/(y*b-x*m);c[0]=(b*w-x*T)*v,c[1]=(b*A-x*C)*v,c[2]=(b*M-x*E)*v,d[0]=(y*T-m*w)*v,d[1]=(y*C-m*A)*v,d[2]=(y*E-m*M)*v,MS(a[u],a[u],c),MS(a[h],a[h],c),MS(a[g],a[g],c),MS(s[u],s[u],d),MS(s[h],s[h],d),MS(s[g],s[g],d)}var I=SS(),D=SS(),R=SS();for(l=0;l<t;l++){R[0]=o[3*l],R[1]=o[3*l+1],R[2]=o[3*l+2];var L=a[l];GT.scale(I,R,GT.dot(R,L)),GT.sub(I,L,I),GT.normalize(I,I),GT.cross(D,R,L),i[4*l]=I[0],i[4*l+1]=I[1],i[4*l+2]=I[2],i[4*l+3]=GT.dot(D,s[l])<0?-1:1}this.dirty()}else console.warn("Geometry without texcoords can't generate tangents.")}},isUniqueVertex:function(){return!this.isUseIndices()||this.vertexCount===this.indices.length},generateUniqueVertex:function(){if(this.vertexCount&&this.indices){65535<this.indices.length&&(this.indices=new Fb.a.Uint32Array(this.indices));for(var t=this.attributes,e=this.indices,n=this.getEnabledAttributes(),r={},i=0;i<n.length;i++)r[l=n[i]]=t[l].value,t[l].init(this.indices.length);for(var o=0,a=0;a<e.length;a++){var s=e[a];for(i=0;i<n.length;i++)for(var l,u=t[l=n[i]].value,h=t[l].size,c=0;c<h;c++)u[o*h+c]=r[l][s*h+c];e[a]=o,o++}this.dirty()}},generateBarycentric:function(){if(this.vertexCount){this.isUniqueVertex()||this.generateUniqueVertex();var t=this.attributes,e=t.barycentric.value,n=this.indices;if(!e||e.length!==3*n.length){e=t.barycentric.value=new Float32Array(3*n.length);for(var r=0;r<(n?n.length:this.vertexCount/3);)for(var i=0;i<3;i++)e[3*(n?n[r++]:3*r+i)+i]=1;this.dirty()}}},applyTransform:function(t){var e=this.attributes,n=e.position.value,r=e.normal.value,i=e.tangent.value;t=t.array;var o=VT.create();VT.invert(o,t),VT.transpose(o,o);var a=GT.transformMat4;e=GT.forEach;e(n,3,0,null,a,t),r&&e(r,3,0,null,a,o),i&&e(i,4,0,null,a,o),this.boundingBox&&this.updateBoundingBox()},dispose:function(t){var e=this._cache;e.use(t.__uid__);var n=e.get("chunks");if(n)for(var r=0;r<n.length;r++){for(var i=n[r],o=0;o<i.attributeBuffers.length;o++){var a=i.attributeBuffers[o];t.gl.deleteBuffer(a.buffer)}i.indicesBuffer&&t.gl.deleteBuffer(i.indicesBuffer.buffer)}if(this.__vaoCache){var s,l=t.getGLExtension("OES_vertex_array_object");for(s in this.__vaoCache){var u=this.__vaoCache[s].vao;u&&l.deleteVertexArrayOES(u)}}this.__vaoCache={},e.deleteContext(t.__uid__)}});ES.STATIC_DRAW=S.STATIC_DRAW,ES.DYNAMIC_DRAW=S.DYNAMIC_DRAW,ES.STREAM_DRAW=S.STREAM_DRAW,ES.AttributeBuffer=S.AttributeBuffer,ES.IndicesBuffer=S.IndicesBuffer,ES.Attribute=CS;tr=ES;var IS="uniform vec3 ";Bo="uniform float ",Ql="@export clay.header.",ur="@end",$r=":unconfigurable;",yS=[Ql+"directional_light",IS+"directionalLightDirection[DIRECTIONAL_LIGHT_COUNT]"+$r,IS+"directionalLightColor[DIRECTIONAL_LIGHT_COUNT]"+$r,ur,Ql+"ambient_light",IS+"ambientLightColor[AMBIENT_LIGHT_COUNT]"+$r,ur,Ql+"ambient_sh_light",IS+"ambientSHLightColor[AMBIENT_SH_LIGHT_COUNT]"+$r,IS+"ambientSHLightCoefficients[AMBIENT_SH_LIGHT_COUNT * 9]"+$r,"vec3 calcAmbientSHLight(int idx, vec3 N) {\n int offset = 9 * idx;\n return ambientSHLightCoefficients[0]\n + ambientSHLightCoefficients[1] * N.x\n + ambientSHLightCoefficients[2] * N.y\n + ambientSHLightCoefficients[3] * N.z\n + ambientSHLightCoefficients[4] * N.x * N.z\n + ambientSHLightCoefficients[5] * N.z * N.y\n + ambientSHLightCoefficients[6] * N.y * N.x\n + ambientSHLightCoefficients[7] * (3.0 * N.z * N.z - 1.0)\n + ambientSHLightCoefficients[8] * (N.x * N.x - N.y * N.y);\n}",ur,Ql+"ambient_cubemap_light",IS+"ambientCubemapLightColor[AMBIENT_CUBEMAP_LIGHT_COUNT]"+$r,"uniform samplerCube ambientCubemapLightCubemap[AMBIENT_CUBEMAP_LIGHT_COUNT]"+$r,"uniform sampler2D ambientCubemapLightBRDFLookup[AMBIENT_CUBEMAP_LIGHT_COUNT]"+$r,ur,Ql+"point_light",IS+"pointLightPosition[POINT_LIGHT_COUNT]"+$r,Bo+"pointLightRange[POINT_LIGHT_COUNT]"+$r,IS+"pointLightColor[POINT_LIGHT_COUNT]"+$r,ur,Ql+"spot_light",IS+"spotLightPosition[SPOT_LIGHT_COUNT]"+$r,IS+"spotLightDirection[SPOT_LIGHT_COUNT]"+$r,Bo+"spotLightRange[SPOT_LIGHT_COUNT]"+$r,Bo+"spotLightUmbraAngleCosine[SPOT_LIGHT_COUNT]"+$r,Bo+"spotLightPenumbraAngleCosine[SPOT_LIGHT_COUNT]"+$r,Bo+"spotLightFalloffFactor[SPOT_LIGHT_COUNT]"+$r,IS+"spotLightColor[SPOT_LIGHT_COUNT]"+$r,ur].join("\n");function DS(t,e){this.normal=t||new fw(0,1,0),this.distance=e||0}FT.import(yS);var RS,LS,OS,PS,NS=eS.extend((function(){return{color:[1,1,1],intensity:1,castShadow:!0,shadowResolution:512,group:0}}),{type:"",clone:function(){var t=eS.prototype.clone.call(this);return t.color=Array.prototype.slice.call(this.color),t.intensity=this.intensity,t.castShadow=this.castShadow,t.shadowResolution=this.shadowResolution,t}});DS.prototype={constructor:DS,distanceToPoint:function(t){return GT.dot(t.array,this.normal.array)-this.distance},projectPoint:function(t,e){e=e||new fw;var n=this.distanceToPoint(t);return GT.scaleAndAdd(e.array,t.array,this.normal.array,-n),e._dirty=!0,e},normalize:function(){var t=1/GT.len(this.normal.array);GT.scale(this.normal.array,t),this.distance*=t},intersectFrustum:function(t){for(var e=t.vertices,n=this.normal.array,r=GT.dot(e[0].array,n)>this.distance,i=1;i<8;i++)if(GT.dot(e[i].array,n)>this.distance!=r)return!0},intersectLine:(PS=GT.create(),function(t,e,n){var r=this.distanceToPoint(t),i=this.distanceToPoint(e);if(0<r&&0<i||r<0&&i<0)return null;var o=this.normal.array;r=this.distance,i=t.array;return GT.sub(PS,e.array,t.array),GT.normalize(PS,PS),t=GT.dot(o,PS),0===t?null:(n=n||new fw,t=(GT.dot(o,i)-r)/t,GT.scaleAndAdd(n.array,i,PS,-t),n._dirty=!0,n)}),applyTransform:(RS=VT.create(),LS=_w.create(),(OS=_w.create())[3]=1,function(t){t=t.array,GT.scale(OS,this.normal.array,this.distance),_w.transformMat4(OS,OS,t),this.distance=GT.dot(OS,this.normal.array),VT.invert(RS,t),VT.transpose(RS,RS),LS[3]=0,GT.copy(LS,this.normal.array),_w.transformMat4(LS,LS,RS),GT.copy(this.normal.array,LS)}),copy:function(t){GT.copy(this.normal.array,t.normal.array),this.normal._dirty=!0,this.distance=t.distance},clone:function(){var t=new DS;return t.copy(this),t}};var kS,BS=DS,FS=GT.set,zS=GT.copy,HS=GT.transformMat4,VS=Math.min,US=Math.max;Pu=function(){this.planes=[];for(var t=0;t<6;t++)this.planes.push(new BS);for(this.boundingBox=new Qw,this.vertices=[],t=0;t<8;t++)this.vertices[t]=GT.fromValues(0,0,0)};Pu.prototype={setFromProjection:function(t){var e=this.planes,n=t.array,r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],l=n[5],u=n[6],h=n[7],c=n[8],d=n[9],p=n[10],f=n[11],g=n[12],m=n[13];t=n[14],n=n[15];FS(e[0].normal.array,a-r,h-s,f-c),e[0].distance=-(n-g),e[0].normalize(),FS(e[1].normal.array,a+r,h+s,f+c),e[1].distance=-(n+g),e[1].normalize(),FS(e[2].normal.array,a+i,h+l,f+d),e[2].distance=-(n+m),e[2].normalize(),FS(e[3].normal.array,a-i,h-l,f-d),e[3].distance=-(n-m),e[3].normalize(),FS(e[4].normal.array,a-o,h-u,f-p),e[4].distance=-(n-t),e[4].normalize(),FS(e[5].normal.array,a+o,h+u,f+p),e[5].distance=-(n+t),e[5].normalize();var y;o=this.boundingBox,h=this.vertices;0===n?(u=-(y=-t/(p-1))/l,o.min.set(-(e=-(f=-t/(p+1))/l)*(n=l/r),-e,f),o.max.set(e*n,e,y),FS(h[0],-e*n,-e,f),FS(h[1],-e*n,e,f),FS(h[2],e*n,-e,f),FS(h[3],e*n,e,f),FS(h[4],-u*n,-u,y),FS(h[5],-u*n,u,y),FS(h[6],u*n,-u,y),FS(h[7],u*n,u,y)):(y=(-1-g)/r,g=(1-g)/r,r=(1-m)/l,m=(-1-m)/l,l=(-1-t)/p,p=(1-t)/p,o.min.set(Math.min(y,g),Math.min(m,r),Math.min(p,l)),o.max.set(Math.max(g,y),Math.max(r,m),Math.max(l,p)),p=o.min.array,o=o.max.array,FS(h[0],p[0],p[1],p[2]),FS(h[1],p[0],o[1],p[2]),FS(h[2],o[0],p[1],p[2]),FS(h[3],o[0],o[1],p[2]),FS(h[4],p[0],p[1],o[2]),FS(h[5],p[0],o[1],o[2]),FS(h[6],o[0],p[1],o[2]),FS(h[7],o[0],o[1],o[2]))},getTransformedBoundingBox:(kS=GT.create(),function(t,e){var n=this.vertices,r=e.array,i=t.min,o=(e=t.max,i.array),a=e.array,s=n[0];HS(kS,s,r),zS(o,kS),zS(a,kS);for(var l=1;l<8;l++)s=n[l],HS(kS,s,r),o[0]=VS(kS[0],o[0]),o[1]=VS(kS[1],o[1]),o[2]=VS(kS[2],o[2]),a[0]=US(kS[0],a[0]),a[1]=US(kS[1],a[1]),a[2]=US(kS[2],a[2]);return i._dirty=!0,e._dirty=!0,t})};var GS,WS,XS,jS=Pu,YS=eS.extend((function(){return{projectionMatrix:new Ow,invProjectionMatrix:new Ow,viewMatrix:new Ow,frustum:new jS}}),(function(){this.update(!0)}),{update:function(t){eS.prototype.update.call(this,t),Ow.invert(this.viewMatrix,this.worldTransform),this.updateProjectionMatrix(),Ow.invert(this.invProjectionMatrix,this.projectionMatrix),this.frustum.setFromProjection(this.projectionMatrix)},setViewMatrix:function(t){Ow.copy(this.viewMatrix,t),Ow.invert(this.worldTransform,t),this.decomposeWorldTransform()},decomposeProjectionMatrix:function(){},setProjectionMatrix:function(t){Ow.copy(this.projectionMatrix,t),Ow.invert(this.invProjectionMatrix,t),this.decomposeProjectionMatrix()},updateProjectionMatrix:function(){},castRay:(GS=_w.create(),function(t,e){var n=void 0!==e?e:new mw;e=t.array[0],t=t.array[1];return _w.set(GS,e,t,-1,1),_w.transformMat4(GS,GS,this.invProjectionMatrix.array),_w.transformMat4(GS,GS,this.worldTransform.array),GT.scale(n.origin.array,GS,1/GS[3]),_w.set(GS,e,t,1,1),_w.transformMat4(GS,GS,this.invProjectionMatrix.array),_w.transformMat4(GS,GS,this.worldTransform.array),GT.scale(GS,GS,1/GS[3]),GT.sub(n.direction.array,GS,n.origin.array),GT.normalize(n.direction.array,n.direction.array),n.direction._dirty=!0,n.origin._dirty=!0,n})}),ZS=VT.create(),qS=VT.create(),KS={};function QS(){this.opaque=[],this.transparent=[],this._opaqueCount=0,this._transparentCount=0}function JS(t,e,n){for(var r in t){var i=t[r];if("tv"===i.type){if(e.hasUniform(r)){for(var o=[],a=0;a<i.value.length;a++){var s=i.value[a];s=e.takeCurrentTextureSlot(n,s);o.push(s)}e.setUniform(n.gl,"1iv",r,o)}}else e.setUniform(n.gl,i.type,r,i.value)}}function $S(t,e){if(e.castShadow&&!t.castShadow)return!0}QS.prototype.startCount=function(){this._opaqueCount=0,this._transparentCount=0},QS.prototype.add=function(t,e){e?this.transparent[this._transparentCount++]=t:this.opaque[this._opaqueCount++]=t},QS.prototype.endCount=function(){this.transparent.length=this._transparentCount,this.opaque.length=this._opaqueCount};var tM=eS.extend((function(){return{material:null,lights:[],viewBoundingBoxLastFrame:new Qw,shadowUniforms:{},_cameraList:[],_lightUniforms:{},_previousLightNumber:{},_lightNumber:{},_lightProgramKeys:{},_nodeRepository:{},_renderLists:new Hb(20)}}),(function(){this._scene=this}),{addToScene:function(t){t instanceof YS?(0<this._cameraList.length&&console.warn("Found multiple camera in one scene. Use the fist one."),this._cameraList.push(t)):t instanceof NS&&this.lights.push(t),t.name&&(this._nodeRepository[t.name]=t)},removeFromScene:function(t){var e;t instanceof YS?0<=(e=this._cameraList.indexOf(t))&&this._cameraList.splice(e,1):t instanceof NS&&0<=(e=this.lights.indexOf(t))&&this.lights.splice(e,1),t.name&&delete this._nodeRepository[t.name]},getNode:function(t){return this._nodeRepository[t]},setMainCamera:function(t){var e=this._cameraList.indexOf(t);0<=e&&this._cameraList.splice(e,1),this._cameraList.unshift(t)},getMainCamera:function(){return this._cameraList[0]},getLights:function(){return this.lights},updateLights:function(){var t=this.lights;this._previousLightNumber=this._lightNumber;for(var e,n={},r=0;r<t.length;r++){var i,o=t[r];o.invisible||(n[i=o.group]||(n[i]={}),n[i][o.type]=n[i][o.type]||0,n[i][o.type]++)}for(e in this._lightNumber=n)this._lightProgramKeys[e]=function(t){var e=[],n=Object.keys(t);n.sort();for(var r=0;r<n.length;r++){var i=n[r];e.push(i+" "+t[i])}var o=e.join("\n");if(KS[o])return KS[o];var a=Lb.genGUID();return KS[o]=a}(n[e]);this._updateLightUniforms()},cloneNode:function(t){var e=t.clone(),n={};return function t(e,r){n[e.__uid__]=r;for(var i=0;i<e._children.length;i++)t(e._children[i],r._children[i])}(t,e),e.traverse((function(t){t.skeleton&&(t.skeleton=t.skeleton.clone(n)),t.material&&(t.material=t.material.clone())})),e},updateRenderList:function(t,e){var n=t.__uid__,r=this._renderLists.get(n);return r||(r=new QS,this._renderLists.put(n,r)),r.startCount(),e&&(this.viewBoundingBoxLastFrame.min.set(1/0,1/0,1/0),this.viewBoundingBoxLastFrame.max.set(-1/0,-1/0,-1/0)),n=this.material&&this.material.transparent||!1,this._doUpdateRenderList(this,t,n,r,e),r.endCount(),r},getRenderList:function(t){return this._renderLists.get(t.__uid__)},_doUpdateRenderList:function(t,e,n,r,i){if(!t.invisible)for(var o=0;o<t._children.length;o++){var a,s,l=t._children[o];l.isRenderable()&&(a=l.isSkinnedMesh()?ZS:l.worldTransform.array,s=l.geometry,VT.multiplyAffine(qS,e.viewMatrix.array,a),(!i||s.boundingBox)&&this.isFrustumCulled(l,e,qS)||r.add(l,l.material.transparent||n)),0<l._children.length&&this._doUpdateRenderList(l,e,n,r,i)}},isFrustumCulled:(WS=new Qw,XS=new Ow,function(t,e,n){var r=t.boundingBox;if(!(r=r||(t.skeleton&&t.skeleton.boundingBox?t.skeleton:t.geometry).boundingBox))return!1;if(XS.array=n,WS.transformFrom(r,XS),t.castShadow&&this.viewBoundingBoxLastFrame.union(WS),t.frustumCulling){if(!WS.intersectBoundingBox(e.frustum.boundingBox))return!0;if(XS.array=e.projectionMatrix.array,0<WS.max.array[2]&&WS.min.array[2]<0&&(WS.max.array[2]=-1e-20),WS.applyProjection(XS),t=WS.min.array,e=WS.max.array,e[0]<-1||1<t[0]||e[1]<-1||1<t[1]||e[2]<-1||1<t[2])return!0}return!1}),_updateLightUniforms:function(){var t=this.lights;t.sort($S);var e=this._lightUniforms;for(o in e)for(var n in e[o])e[o][n].value.length=0;for(var r=0;r<t.length;r++){var i=t[r];if(!i.invisible){var o=i.group;for(n in i.uniformTemplates){var a=i.uniformTemplates[n],s=a.value(i);if(null!=s){e[o]||(e[o]={}),e[o][n]||(e[o][n]={type:"",value:[]});var l=e[o][n];switch(l.type=a.type+"v",a.type){case"1i":case"1f":case"t":l.value.push(s);break;case"2f":case"3f":case"4f":for(var u=0;u<s.length;u++)l.value.push(s[u]);break;default:console.error("Unkown light uniform type "+a.type)}}}}}},getLightGroups:function(){var t,e=[];for(t in this._lightNumber)e.push(t);return e},getNumberChangedLightGroups:function(){var t,e=[];for(t in this._lightNumber)this.isLightNumberChanged(t)&&e.push(t);return e},isLightNumberChanged:function(t){var e,n=this._previousLightNumber,r=this._lightNumber;for(e in r[t]){if(!n[t])return!0;if(r[t][e]!==n[t][e])return!0}for(e in n[t]){if(!r[t])return!0;if(r[t][e]!==n[t][e])return!0}return!1},getLightsNumbers:function(t){return this._lightNumber[t]},getProgramKey:function(t){return this._lightProgramKeys[t]},setLightUniforms:function(t,e,n){JS(this._lightUniforms[e],t,n),JS(this.shadowUniforms,t,n)},dispose:function(){this.material=null,this._opaqueList=[],this._transparentList=[],this.lights=[],this._lightUniforms={},this._lightNumber={},this._nodeRepository={}}}),eM=M.isPowerOfTwo,nM=["px","nx","py","ny","pz","nz"];S=pS.extend((function(){return{image:{px:null,nx:null,py:null,ny:null,pz:null,nz:null},pixels:{px:null,nx:null,py:null,ny:null,pz:null,nz:null},mipmaps:[]}}),{textureType:"textureCube",update:function(t){var e=t.gl;e.bindTexture(e.TEXTURE_CUBE_MAP,this._cache.get("webgl_texture")),this.updateCommon(t);var n=this.format,r=this.type;e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,this.getAvailableWrapS()),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,this.getAvailableWrapT()),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,this.getAvailableMagFilter()),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,this.getAvailableMinFilter());var i=t.getGLExtension("EXT_texture_filter_anisotropic");if(i&&1<this.anisotropic&&e.texParameterf(e.TEXTURE_CUBE_MAP,i.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic),36193===r&&(t.getGLExtension("OES_texture_half_float")||(r=Bb.FLOAT)),this.mipmaps.length)for(var o=this.width,a=this.height,s=0;s<this.mipmaps.length;s++){var l=this.mipmaps[s];this._updateTextureData(e,l,s,o,a,n,r),o/=2,a/=2}else this._updateTextureData(e,this,0,this.width,this.height,n,r),!this.NPOT&&this.useMipmap&&e.generateMipmap(e.TEXTURE_CUBE_MAP);e.bindTexture(e.TEXTURE_CUBE_MAP,null)},_updateTextureData:function(t,e,n,r,i,o,a){for(var s=0;s<6;s++){var l=nM[s],u=e.image&&e.image[l];u?t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+s,n,o,o,a,u):t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+s,n,o,r,i,0,o,a,e.pixels&&e.pixels[l])}},generateMipmap:function(t){t=t.gl,this.useMipmap&&!this.NPOT&&(t.bindTexture(t.TEXTURE_CUBE_MAP,this._cache.get("webgl_texture")),t.generateMipmap(t.TEXTURE_CUBE_MAP))},bind:function(t){t.gl.bindTexture(t.gl.TEXTURE_CUBE_MAP,this.getWebGLTexture(t))},unbind:function(t){t.gl.bindTexture(t.gl.TEXTURE_CUBE_MAP,null)},isPowerOfTwo:function(){return this.image.px?eM(this.image.px.width)&&eM(this.image.px.height):eM(this.width)&&eM(this.height)},isRenderable:function(){return this.image.px?rM(this.image.px)&&rM(this.image.nx)&&rM(this.image.py)&&rM(this.image.ny)&&rM(this.image.pz)&&rM(this.image.nz):!(!this.width||!this.height)},load:function(t,e){var n=0,r=this;return Lb.each(t,(function(t,i){var o=Fb.a.createImage();e&&(o.crossOrigin=e),o.onload=function(){0===--n&&(r.dirty(),r.trigger("success",r))},o.onerror=function(){n--},n++,o.src=t,r.image[i]=o})),this}});function rM(t){return 0<t.width&&0<t.height}Object.defineProperty(S.prototype,"width",{get:function(){return this.image&&this.image.px?this.image.px.width:this._width},set:function(t){this.image&&this.image.px?console.warn("Texture from image can't set width"):(this._width!==t&&this.dirty(),this._width=t)}}),Object.defineProperty(S.prototype,"height",{get:function(){return this.image&&this.image.px?this.image.px.height:this._height},set:function(t){this.image&&this.image.px?console.warn("Texture from image can't set height"):(this._height!==t&&this.dirty(),this._height=t)}});var iM=S,oM=YS.extend({fov:50,aspect:1,near:.1,far:2e3},{updateProjectionMatrix:function(){var t=this.fov/180*Math.PI;this.projectionMatrix.perspective(t,this.aspect,this.near,this.far)},decomposeProjectionMatrix:function(){var t=this.projectionMatrix.array,e=2*Math.atan(1/t[5]);this.fov=e/Math.PI*180,this.aspect=t[5]/t[0],this.near=t[14]/(t[10]-1),this.far=t[14]/(t[10]+1)},clone:function(){var t=YS.prototype.clone.call(this);return t.fov=this.fov,t.aspect=this.aspect,t.near=this.near,t.far=this.far,t}}),aM="framebuffer",sM="renderbuffer",lM=sM+"_width",uM=sM+"_height",hM=sM+"_attached",cM="depthtexture_attached",dM=Bb.FRAMEBUFFER,pM=Bb.RENDERBUFFER,fM=Bb.DEPTH_ATTACHMENT,gM=Bb.COLOR_ATTACHMENT0;ES=wu.extend({depthBuffer:!0,viewport:null,_width:0,_height:0,_textures:null,_boundRenderer:null},(function(){this._cache=new cS,this._textures={}}),{getTextureWidth:function(){return this._width},getTextureHeight:function(){return this._height},bind:function(t){if(t.__currentFrameBuffer){if(t.__currentFrameBuffer===this)return;console.warn("Renderer already bound with another framebuffer. Unbind it first")}t.__currentFrameBuffer=this;var e=t.gl;e.bindFramebuffer(dM,this._getFrameBufferGL(t)),this._boundRenderer=t;var n=this._cache;n.put("viewport",t.viewport);var r,i,o=!1;for(h in this._textures){o=!0;var a=this._textures[h];a&&(r=a.texture.width,i=a.texture.height,this._doAttach(t,a.texture,h,a.target))}this._width=r,this._height=i,!o&&this.depthBuffer&&console.error("Must attach texture before bind, or renderbuffer may have incorrect width and height."),this.viewport?t.setViewport(this.viewport):t.setViewport(0,0,r,i,1);var s,l,u=n.get("attached_textures");if(u)for(var h in u)this._textures[h]||(s=u[h],this._doDetach(e,h,s));!n.get(cM)&&this.depthBuffer&&(n.miss(sM)&&n.put(sM,e.createRenderbuffer()),l=n.get(sM),r===n.get(lM)&&i===n.get(uM)||(e.bindRenderbuffer(pM,l),e.renderbufferStorage(pM,e.DEPTH_COMPONENT16,r,i),n.put(lM,r),n.put(uM,i),e.bindRenderbuffer(pM,null)),n.get(hM)||(e.framebufferRenderbuffer(dM,fM,pM,l),n.put(hM,!0)))},unbind:function(t){t.__currentFrameBuffer=null,t.gl.bindFramebuffer(dM,null),this._boundRenderer=null,this._cache.use(t.__uid__);var e=this._cache.get("viewport");e&&t.setViewport(e),this.updateMipmap(t)},updateMipmap:function(t){var e,n=t.gl;for(e in this._textures){var r,i=this._textures[e];!i||!(r=i.texture).NPOT&&r.useMipmap&&r.minFilter===pS.LINEAR_MIPMAP_LINEAR&&(i="textureCube"===r.textureType?Bb.TEXTURE_CUBE_MAP:Bb.TEXTURE_2D,n.bindTexture(i,r.getWebGLTexture(t)),n.generateMipmap(i),n.bindTexture(i,null))}},checkStatus:function(t){return t.checkFramebufferStatus(dM)},_getFrameBufferGL:function(t){var e=this._cache;return e.use(t.__uid__),e.miss(aM)&&e.put(aM,t.gl.createFramebuffer()),e.get(aM)},attach:function(t,e,n){if(!t.width)throw new Error("The texture attached to color buffer is not a valid.");e=e||gM,n=n||Bb.TEXTURE_2D;var r=this._boundRenderer;r&&r.gl&&((o=this._cache).use(r.__uid__),i=o.get("attached_textures"));var i,o=this._textures[e];o&&o.target===n&&o.texture===t&&i&&null!=i[e]||(i=!0,r&&(i=this._doAttach(r,t,e,n),this.viewport||r.setViewport(0,0,t.width,t.height,1)),i&&(this._textures[e]=this._textures[e]||{},this._textures[e].texture=t,this._textures[e].target=n))},_doAttach:function(t,e,n,r){var i=t.gl,o=e.getWebGLTexture(t),a=this._cache.get("attached_textures");if(a&&a[n]){var s=a[n];if(s.texture===e&&s.target===r)return}return s=!0,(n=+n)!==fM&&n!==Bb.DEPTH_STENCIL_ATTACHMENT||(t.getGLExtension("WEBGL_depth_texture")||(console.error("Depth texture is not supported by the browser"),s=!1),e.format!==Bb.DEPTH_COMPONENT&&e.format!==Bb.DEPTH_STENCIL&&(console.error("The texture attached to depth buffer is not a valid."),s=!1),s&&((t=this._cache.get(sM))&&(i.framebufferRenderbuffer(dM,fM,pM,null),i.deleteRenderbuffer(t),this._cache.put(sM,!1)),this._cache.put(hM,!1),this._cache.put(cM,!0))),i.framebufferTexture2D(dM,n,r,o,0),a||this._cache.put("attached_textures",a={}),a[n]=a[n]||{},a[n].texture=e,a[n].target=r,s},_doDetach:function(t,e,n){t.framebufferTexture2D(dM,e,n,null,0),n=this._cache.get("attached_textures"),n&&n[e]&&(n[e]=null),e!==fM&&e!==Bb.DEPTH_STENCIL_ATTACHMENT||this._cache.put(cM,!1)},detach:function(t,e){this._textures[t]=null,this._boundRenderer&&(this._cache.use(this._boundRenderer.__uid__),this._doDetach(this._boundRenderer.gl,t,e))},dispose:function(t){var e=t.gl,n=this._cache;n.use(t.__uid__);var r=n.get(sM);r&&e.deleteRenderbuffer(r),r=n.get(aM),r&&e.deleteFramebuffer(r),n.deleteContext(t.__uid__),this._textures={}}});ES.DEPTH_ATTACHMENT=fM,ES.COLOR_ATTACHMENT0=gM,ES.STENCIL_ATTACHMENT=Bb.STENCIL_ATTACHMENT,ES.DEPTH_STENCIL_ATTACHMENT=Bb.DEPTH_STENCIL_ATTACHMENT;var mM=ES,yM=["px","nx","py","ny","pz","nz"],_M=wu.extend((function(){var t={position:new fw,far:1e3,near:.1,texture:null,shadowMapPass:null},e=t._cameras={px:new oM({fov:90}),nx:new oM({fov:90}),py:new oM({fov:90}),ny:new oM({fov:90}),pz:new oM({fov:90}),nz:new oM({fov:90})};return e.px.lookAt(fw.POSITIVE_X,fw.NEGATIVE_Y),e.nx.lookAt(fw.NEGATIVE_X,fw.NEGATIVE_Y),e.py.lookAt(fw.POSITIVE_Y,fw.POSITIVE_Z),e.ny.lookAt(fw.NEGATIVE_Y,fw.NEGATIVE_Z),e.pz.lookAt(fw.POSITIVE_Z,fw.NEGATIVE_Y),e.nz.lookAt(fw.NEGATIVE_Z,fw.NEGATIVE_Y),t._frameBuffer=new mM,t}),{getCamera:function(t){return this._cameras[t]},render:function(t,e,n){var r=t.gl;n||e.update();n=this.texture.width;for(var i=2*Math.atan(n/(n-.5))/Math.PI*180,o=0;o<6;o++){var a,s=this._cameras[yM[o]];fw.copy(s.position,this.position),s.far=this.far,s.near=this.near,s.fov=i,this.shadowMapPass&&(s.update(),(a=e.getBoundingBox()).applyTransform(s.viewMatrix),e.viewBoundingBoxLastFrame.copy(a),this.shadowMapPass.render(t,e,s,!0)),this._frameBuffer.attach(this.texture,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+o),this._frameBuffer.bind(t),t.render(e,s,!0),this._frameBuffer.unbind(t)}},dispose:function(t){this._frameBuffer.dispose(t)}}),vM=tr.extend({dynamic:!1,widthSegments:1,heightSegments:1},(function(){this.build()}),{build:function(){for(var t=this.heightSegments,e=this.widthSegments,n=this.attributes,r=[],i=[],o=[],a=[],s=0;s<=t;s++)for(var l=s/t,u=0;u<=e;u++){var h=u/e;r.push([2*h-1,2*l-1,0]),i&&i.push([h,l]),o&&o.push([0,0,1]),u<e&&s<t&&(a.push([h=u+s*(e+1),h+1,h+e+1]),a.push([h+e+1,h+1,h+e+2]))}n.position.fromArray(r),n.texcoord0.fromArray(i),n.normal.fromArray(o),this.initIndicesFromArray(a),this.boundingBox=new Qw,this.boundingBox.min.set(-1,-1,0),this.boundingBox.max.set(1,1,0)}}),xM=new Ow;function bM(t,e,n){switch(xM.identity(),n=new vM({widthSegments:e,heightSegments:n}),t){case"px":Ow.translate(xM,xM,fw.POSITIVE_X),Ow.rotateY(xM,xM,Math.PI/2);break;case"nx":Ow.translate(xM,xM,fw.NEGATIVE_X),Ow.rotateY(xM,xM,-Math.PI/2);break;case"py":Ow.translate(xM,xM,fw.POSITIVE_Y),Ow.rotateX(xM,xM,-Math.PI/2);break;case"ny":Ow.translate(xM,xM,fw.NEGATIVE_Y),Ow.rotateX(xM,xM,Math.PI/2);break;case"pz":Ow.translate(xM,xM,fw.POSITIVE_Z);break;case"nz":Ow.translate(xM,xM,fw.NEGATIVE_Z),Ow.rotateY(xM,xM,Math.PI)}return n.applyTransform(xM),n}var TM=tr.extend({dynamic:!1,widthSegments:1,heightSegments:1,depthSegments:1,inside:!1},(function(){this.build()}),{build:function(){var t={px:bM("px",this.depthSegments,this.heightSegments),nx:bM("nx",this.depthSegments,this.heightSegments),py:bM("py",this.widthSegments,this.depthSegments),ny:bM("ny",this.widthSegments,this.depthSegments),pz:bM("pz",this.widthSegments,this.heightSegments),nz:bM("nz",this.widthSegments,this.heightSegments)},e=["position","texcoord0","normal"],n=0,r=0;for(o in t)n+=t[o].vertexCount,r+=t[o].indices.length;for(var i=0;i<e.length;i++)this.attributes[e[i]].init(n);this.indices=new Fb.a.Uint16Array(r);var o,a=0,s=0;for(o in t){var l=t[o];for(i=0;i<e.length;i++)for(var u=e[i],h=l.attributes[u].value,c=l.attributes[u].size,d="normal"===u,p=0;p<h.length;p++){var f=h[p];this.inside&&d&&(f=-f),this.attributes[u].value[p+c*s]=f}var g=l.indices.length;for(p=0;p<l.indices.length;p++)this.indices[p+a]=s+l.indices[this.inside?g-p-1:p];a+=l.indices.length,s+=l.vertexCount}this.boundingBox=new Qw,this.boundingBox.max.set(1,1,1),this.boundingBox.min.set(-1,-1,-1)}});FT.import("@export clay.skybox.vertex\n#define SHADER_NAME skybox\nuniform mat4 world : WORLD;\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nattribute vec3 position : POSITION;\nvarying vec3 v_WorldPosition;\nvoid main()\n{\n v_WorldPosition = (world * vec4(position, 1.0)).xyz;\n gl_Position = worldViewProjection * vec4(position, 1.0);\n}\n@end\n@export clay.skybox.fragment\n#define PI 3.1415926\nuniform mat4 viewInverse : VIEWINVERSE;\n#ifdef EQUIRECTANGULAR\nuniform sampler2D environmentMap;\n#else\nuniform samplerCube environmentMap;\n#endif\nuniform float lod: 0.0;\nvarying vec3 v_WorldPosition;\n@import clay.util.rgbm\n@import clay.util.srgb\n@import clay.util.ACES\nvoid main()\n{\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(v_WorldPosition - eyePos);\n#ifdef EQUIRECTANGULAR\n float phi = acos(V.y);\n float theta = atan(-V.x, V.z) + PI * 0.5;\n vec2 uv = vec2(theta / 2.0 / PI, phi / PI);\n vec4 texel = decodeHDR(texture2D(environmentMap, fract(uv)));\n#else\n #if defined(LOD) || defined(SUPPORT_TEXTURE_LOD)\n vec4 texel = decodeHDR(textureCubeLodEXT(environmentMap, V, lod));\n #else\n vec4 texel = decodeHDR(textureCube(environmentMap, V));\n #endif\n#endif\n#ifdef SRGB_DECODE\n texel = sRGBToLinear(texel);\n#endif\n#ifdef TONEMAPPING\n texel.rgb = ACESToneMapping(texel.rgb);\n#endif\n#ifdef SRGB_ENCODE\n texel = linearTosRGB(texel);\n#endif\n gl_FragColor = encodeHDR(vec4(texel.rgb, 1.0));\n}\n@end");var wM=fS.extend((function(){var t=new FT({vertex:FT.source("clay.skybox.vertex"),fragment:FT.source("clay.skybox.fragment")});t=new oT({shader:t,depthMask:!1});return{scene:null,geometry:new TM,material:t,environmentMap:null,culling:!1,_dummyCamera:new oM}}),(function(){var t=this.scene;t&&this.attachScene(t),this.environmentMap&&this.setEnvironmentMap(this.environmentMap)}),{attachScene:function(t){this.scene&&this.detachScene(),((t.skybox=this).scene=t).on("beforerender",this._beforeRenderScene,this)},detachScene:function(){this.scene&&(this.scene.off("beforerender",this._beforeRenderScene),this.scene.skybox=null),this.scene=null},dispose:function(t){this.detachScene(),this.geometry.dispose(t)},setEnvironmentMap:function(t){"texture2D"===t.textureType?(this.material.define("EQUIRECTANGULAR"),t.minFilter=pS.LINEAR):this.material.undefine("EQUIRECTANGULAR"),this.material.set("environmentMap",t)},getEnvironmentMap:function(){return this.material.get("environmentMap")},_beforeRenderScene:function(t,e,n){this.renderSkybox(t,n)},renderSkybox:function(t,e){var n=this._dummyCamera;n.aspect=t.getViewportAspect(),n.fov=e.fov||50,n.updateProjectionMatrix(),Ow.invert(n.invProjectionMatrix,n.projectionMatrix),n.worldTransform.copy(e.worldTransform),n.viewMatrix.copy(e.viewMatrix),this.position.copy(e.getWorldPosition()),this.update(),t.gl.disable(t.gl.BLEND),0<this.material.get("lod")?this.material.define("fragment","LOD"):this.material.undefine("fragment","LOD"),t.renderPass([this],n)}}),SM=wM;function MM(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}var AM=MM("DXT1"),CM=MM("DXT3"),EM=MM("DXT5"),IM={parse:function(t,e){var n=new Int32Array(t,0,31);if(542327876!==n[0])return null;if(4&!n(20))return null;var r,i,o=n(21),a=n[4],s=n[3],l=512&n[28],u=131072&n[2];switch(o){case AM:r=8,i=pS.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case CM:r=16,i=pS.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case EM:r=16,i=pS.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return null}var h=n[1]+4,c=l?6:1,d=1;u&&(d=Math.max(1,n[7]));for(var p=[],f=0;f<c;f++){var g=a,m=s;p[f]=new _S({width:g,height:m,format:i});for(var y=[],_=0;_<d;_++){var v=Math.max(4,g)/4*Math.max(4,m)/4*r,x=new Uint8Array(t,h,v);h+=v,g*=.5,m*=.5,y[_]=x}p[f].pixels=y[0],u&&(p[f].mipmaps=y)}if(!e)return p[0];e.width=p[0].width,e.height=p[0].height,e.format=p[0].format,e.pixels=p[0].pixels,e.mipmaps=p[0].mipmaps}},DM=String.fromCharCode,RM=8,LM=32767;function OM(t,e,n,r){for(var i,o,a=0,s=0,l=r;0<l;)if(t[s][0]=e[n++],t[s][1]=e[n++],t[s][2]=e[n++],t[s][3]=e[n++],1===t[s][0]&&1===t[s][1]&&1===t[s][2]){for(var u=t[s][3]<<a>>>0;0<u;u--)i=t[s-1],(o=t[s])[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],s++,l--;a+=8}else s++,l--,a=0;return n}var PM={parseRGBE:function(t,e,n){null==n&&(n=0);var r=new Uint8Array(t),i=r.length;if("#?"===function(t,e,n){for(var r="",i=e;i<n;i++)r+=DM(t[i]);return r}(r,0,2)){for(var o=2;o<i&&("\n"!==DM(r[o])||"\n"!==DM(r[o+1]));o++);if(!(i<=o)){o+=2;for(var a="";o<i;o++){var s=DM(r[o]);if("\n"===s)break;a+=s}t=a.split(" ");var l=parseInt(t[1]),u=parseInt(t[3]);if(u&&l){for(var h=o+1,c=[],d=0;d<u;d++){c[d]=[];for(var p=0;p<4;p++)c[d][p]=0}for(var f,g,m,y,_=new Float32Array(u*l*4),v=0,x=0;x<l;x++){if(!(h=function(t,e,n,r){if(r<RM|LM<r)return OM(t,e,n,r);if(2!=(i=e[n++]))return OM(t,e,n-1,r);if(t[0][1]=e[n++],t[0][2]=e[n++],i=e[n++],(t[0][2]<<8>>>0|i)>>>0!==r)return null;for(var i=0;i<4;i++)for(var o=0;o<r;)if(128<(a=e[n++]))for(var a=(127&a)>>>0,s=e[n++];a--;)t[o++][i]=s;else for(;a--;)t[o++][i]=e[n++];return n}(c,r,h,u)))return null;for(d=0;d<u;d++)f=c[d],g=_,m=v,y=n,0<f[3]?(y=Math.pow(2,f[3]-128-8+y),g[m+0]=f[0]*y,g[m+1]=f[1]*y,g[m+2]=f[2]*y):(g[m+0]=0,g[m+1]=0,g[m+2]=0),g[m+3]=1,v+=4}return(e=e||new _S).width=u,e.height=l,e.pixels=_,e.type=pS.FLOAT,e}}}},parseRGBEFromPNG:function(t){}},NM={loadTexture:function(t,e,n,r){var i;if(e="function"==typeof e?(r=n=e,{}):e||{},"string"==typeof t){if(t.match(/.hdr$/)||"hdr"===e.fileType)return i=new _S({width:0,height:0,sRGB:!1}),NM._fetchTexture(t,(function(t){PM.parseRGBE(t,i,e.exposure),i.dirty(),n&&n(i)}),r),i;t.match(/.dds$/)||"dds"===e.fileType?(i=new _S({width:0,height:0}),NM._fetchTexture(t,(function(t){IM.parse(t,i),i.dirty(),n&&n(i)}),r)):((i=new _S).load(t),i.success(n),i.error(r))}else"object"==typeof t&&void 0!==t.px&&((i=new iM).load(t),i.success(n),i.error(r));return i},loadPanorama:function(t,e,n,r,i,o){var a=this;r="function"==typeof r?(o=i=r,{}):r||{},NM.loadTexture(e,r,(function(e){e.flipY=r.flipY||!1,a.panoramaToCubeMap(t,e,n,r),e.dispose(t),i&&i(n)}),o)},panoramaToCubeMap:function(t,e,n,r){var i=new _M,o=new SM({scene:new tM});return o.setEnvironmentMap(e),(r=r||{}).encodeRGBM&&o.material.define("fragment","RGBM_ENCODE"),n.sRGB=e.sRGB,i.texture=n,i.render(t,o.scene),i.texture=null,i.dispose(t),n},heightToNormal:function(t,e){var n=document.createElement("canvas"),r=n.width=t.width,i=n.height=t.height,o=n.getContext("2d");o.drawImage(t,0,0,r,i),e=e||!1;for(var a=o.getImageData(0,0,r,i),s=o.createImageData(r,i),l=0;l<a.data.length;l+=4){if(e){var u=a.data[l],h=a.data[l+1],c=a.data[l+2];if(20<Math.abs(u-h)+Math.abs(h-c))return console.warn("Given image is not a height map"),t}var d,p;h=l%(4*r)==0?(d=a.data[l],a.data[l+4]):l%(4*r)==4*(r-1)?(d=a.data[l-4],a.data[l]):(d=a.data[l-4],a.data[l+4]),c=l<4*r?(p=a.data[l],a.data[l+4*r]):r*(i-1)*4<l?(p=a.data[l-4*r],a.data[l]):(p=a.data[l-4*r],a.data[l+4*r]);s.data[l]=d-h+127,s.data[l+1]=p-c+127,s.data[l+2]=255,s.data[l+3]=255}return o.putImageData(s,0,0),n},isHeightImage:function(t,e,n){if(!t||!t.width||!t.height)return!1;var r=document.createElement("canvas"),i=r.getContext("2d");e=e||32;n=n||20,r.width=r.height=e,i.drawImage(t,0,0,e,e);for(var o=i.getImageData(0,0,e,e),a=0;a<o.data.length;a+=4){var s=o.data[a],l=o.data[a+1],u=o.data[a+2];if(n<Math.abs(s-l)+Math.abs(l-u))return!1}return!0},_fetchTexture:function(t,e,n){Fb.a.request.get({url:t,responseType:"arraybuffer",onload:e,onerror:n})},createChessboard:function(t,e,n,r){t=t||512,e=e||64,n=n||"black",r=r||"white";var i=Math.ceil(t/e),o=document.createElement("canvas");o.width=t,o.height=t;var a=o.getContext("2d");a.fillStyle=r,a.fillRect(0,0,t,t),a.fillStyle=n;for(var s=0;s<i;s++)for(var l=0;l<i;l++)(l%2?s%2:s%2-1)&&a.fillRect(s*e,l*e,e,e);return new _S({image:o,anisotropic:8})},createBlank:function(t){var e=document.createElement("canvas");e.width=1,e.height=1;var n=e.getContext("2d");return n.fillStyle=t,n.fillRect(0,0,1,1),new _S({image:e})}},kM=NM,BM=["mousedown","mouseup","mousemove","mouseover","mouseout","click","dblclick","contextmenu"];function FM(t){return"_on"+t}var zM,HM,VM,UM,GM,WM,XM,jM;Ql=function(t){var e=this;this._texture=new _S({anisotropic:32,flipY:!1,surface:this,dispose:function(t){e.dispose(),_S.prototype.dispose.call(this,t)}}),BM.forEach((function(t){this[FM(t)]=function(e){e.triangle&&this._meshes.forEach((function(n){this.dispatchEvent(t,n,e.triangle,e.point)}),this)}}),this),this._meshes=[],t&&this.setECharts(t),this.onupdate=null};Ql.prototype={constructor:Ql,getTexture:function(){return this._texture},setECharts:function(t){var e,n,r=(this._chart=t).getDom();r instanceof HTMLCanvasElement?(e=this,t=t.getZr(),n=t.__oldRefreshImmediately||t.refreshImmediately,t.refreshImmediately=function(){n.call(this),e._texture.dirty(),e.onupdate&&e.onupdate()},t.__oldRefreshImmediately=n):(console.error("ECharts must init on canvas if it is used as texture."),r=document.createElement("canvas")),this._texture.image=r,this._texture.dirty(),this.onupdate&&this.onupdate()},dispatchEvent:(zM=new fw,HM=new fw,VM=new fw,UM=new hT,GM=new hT,WM=new hT,XM=new hT,jM=new fw,function(t,e,n,r){var i=e.geometry,o=i.attributes.position,a=i.attributes.texcoord0;e=fw.dot,i=fw.cross;o.get(n[0],zM.array),o.get(n[1],HM.array),o.get(n[2],VM.array),a.get(n[0],UM.array),a.get(n[1],GM.array),a.get(n[2],WM.array),i(jM,HM,VM),o=e(zM,jM),a=e(r,jM)/o,i(jM,VM,zM),n=e(r,jM)/o,i(jM,zM,HM),o=e(r,jM)/o,hT.scale(XM,UM,a),hT.scaleAndAdd(XM,XM,GM,n),hT.scaleAndAdd(XM,XM,WM,o),n=XM.x*this._chart.getWidth(),o=XM.y*this._chart.getHeight(),this._chart.getZr().handler.dispatch(t,{zrX:n,zrY:o})}),attachToMesh:function(t){0<=this._meshes.indexOf(t)||(BM.forEach((function(e){t.on(e,this[FM(e)],this)}),this),this._meshes.push(t))},detachFromMesh:function(t){var e=this._meshes.indexOf(t);0<=e&&this._meshes.splice(e,1),BM.forEach((function(e){t.off(e,this[FM(e)])}),this)},dispose:function(){this._meshes.forEach((function(t){this.detachFromMesh(t)}),this)}};var YM=Ql,ZM=YS.extend({left:-1,right:1,near:-1,far:1,top:1,bottom:-1},{updateProjectionMatrix:function(){this.projectionMatrix.ortho(this.left,this.right,this.bottom,this.top,this.near,this.far)},decomposeProjectionMatrix:function(){var t=this.projectionMatrix.array;this.left=(-1-t[12])/t[0],this.right=(1-t[12])/t[0],this.top=(1-t[13])/t[5],this.bottom=(-1-t[13])/t[5],this.near=-(-1-t[14])/t[10],this.far=-(1-t[14])/t[10]},clone:function(){var t=YS.prototype.clone.call(this);return t.left=this.left,t.right=this.right,t.near=this.near,t.far=this.far,t.top=this.top,t.bottom=this.bottom,t}});FT.import("\n@export clay.compositor.vertex\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\nvarying vec2 v_Texcoord;\nvoid main()\n{\n v_Texcoord = texcoord;\n gl_Position = worldViewProjection * vec4(position, 1.0);\n}\n@end");var qM=new fS({geometry:new vM,frustumCulling:!1}),KM=new ZM,QM=wu.extend((function(){return{fragment:"",outputs:null,material:null,blendWithPrevious:!1,clearColor:!1,clearDepth:!0}}),(function(){var t=new FT(FT.source("clay.compositor.vertex"),this.fragment);t=new oT({shader:t});t.enableTexturesAll(),this.material=t}),{setUniform:function(t,e){this.material.setUniform(t,e)},getUniform:function(t){if(t=this.material.uniforms[t],t)return t.value},attachOutput:function(t,e){this.outputs||(this.outputs={}),e=e||Bb.COLOR_ATTACHMENT0,this.outputs[e]=t},detachOutput:function(t){for(var e in this.outputs)this.outputs[e]===t&&(this.outputs[e]=null)},bind:function(t,e){if(this.outputs)for(var n in this.outputs){var r=this.outputs[n];r&&e.attach(r,n)}e&&e.bind(t)},unbind:function(t,e){e.unbind(t)},render:function(t,e){var n=t.gl;if(e){this.bind(t,e);var r=t.getGLExtension("EXT_draw_buffers");if(r&&this.outputs){var i,o=[];for(i in this.outputs)(i=+i)>=n.COLOR_ATTACHMENT0&&i<=n.COLOR_ATTACHMENT0+8&&o.push(i);r.drawBuffersEXT(o)}}this.trigger("beforerender",this,t);var a=this.clearDepth?n.DEPTH_BUFFER_BIT:0;n.depthMask(!0),this.clearColor&&(a|=n.COLOR_BUFFER_BIT,n.colorMask(!0,!0,!0,!0),r=this.clearColor,Array.isArray(r)&&n.clearColor(r[0],r[1],r[2],r[3])),n.clear(a),this.blendWithPrevious?(n.enable(n.BLEND),this.material.transparent=!0):(n.disable(n.BLEND),this.material.transparent=!1),this.renderQuad(t),this.trigger("afterrender",this,t),e&&this.unbind(t,e)},renderQuad:function(t){qM.material=this.material,t.renderPass([qM],KM)},dispose:function(t){}}),JM={},$M=["px","nx","py","ny","pz","nz"];JM.prefilterEnvironmentMap=function(t,e,n,r,i){i&&r||(r=JM.generateNormalDistribution(),i=JM.integrateBRDF(t,r));var o=(n=n||{}).width||64,a=n.height||64,s=n.type||e.type,l=new iM({width:o,height:a,type:s,flipY:!1,mipmaps:[]});l.isPowerOfTwo()||console.warn("Width and height must be power of two to enable mipmap.");var u=Math.min(o,a),h=Math.log(u)/Math.log(2)+1,c=new oT({shader:new FT({vertex:FT.source("clay.skybox.vertex"),fragment:"#define SHADER_NAME prefilter\n#define SAMPLE_NUMBER 1024\n#define PI 3.14159265358979\nuniform mat4 viewInverse : VIEWINVERSE;\nuniform samplerCube environmentMap;\nuniform sampler2D normalDistribution;\nuniform float roughness : 0.5;\nvarying vec2 v_Texcoord;\nvarying vec3 v_WorldPosition;\n@import clay.util.rgbm\nvec3 importanceSampleNormal(float i, float roughness, vec3 N) {\n vec3 H = texture2D(normalDistribution, vec2(roughness, i)).rgb;\n vec3 upVector = abs(N.y) > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);\n vec3 tangentX = normalize(cross(N, upVector));\n vec3 tangentZ = cross(N, tangentX);\n return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);\n}\nvoid main() {\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(v_WorldPosition - eyePos);\n vec3 N = V;\n vec3 prefilteredColor = vec3(0.0);\n float totalWeight = 0.0;\n float fMaxSampleNumber = float(SAMPLE_NUMBER);\n for (int i = 0; i < SAMPLE_NUMBER; i++) {\n vec3 H = importanceSampleNormal(float(i) / fMaxSampleNumber, roughness, N);\n vec3 L = reflect(-V, H);\n float NoL = clamp(dot(N, L), 0.0, 1.0);\n if (NoL > 0.0) {\n prefilteredColor += decodeHDR(textureCube(environmentMap, L)).rgb * NoL;\n totalWeight += NoL;\n }\n }\n gl_FragColor = encodeHDR(vec4(prefilteredColor / totalWeight, 1.0));\n}\n"})});c.set("normalDistribution",r),n.encodeRGBM&&c.define("fragment","RGBM_ENCODE"),n.decodeRGBM&&c.define("fragment","RGBM_DECODE");var d,p=new tM;"texture2D"===e.textureType&&(u=new iM({width:o,height:a,type:s===pS.FLOAT?pS.HALF_FLOAT:s}),kM.panoramaToCubeMap(t,e,u,{encodeRGBM:n.decodeRGBM}),e=u),(d=new wM({scene:p,material:c})).material.set("environmentMap",e);var f=new _M({texture:l});n.encodeRGBM&&(s=l.type=pS.UNSIGNED_BYTE);for(var g=new _S({width:o,height:a,type:s}),m=new mM({depthBuffer:!1}),y=Fb.a[s===pS.UNSIGNED_BYTE?"Uint8Array":"Float32Array"],_=0;_<h;_++){l.mipmaps[_]={pixels:{}},d.material.set("roughness",_/(h-1));for(var v=g.width,x=2*Math.atan(v/(v-.5))/Math.PI*180,b=0;b<$M.length;b++){var T=new y(g.width*g.height*4);m.attach(g),m.bind(t);var w=f.getCamera($M[b]);w.fov=x,t.render(p,w),t.gl.readPixels(0,0,g.width,g.height,pS.RGBA,s,T),m.unbind(t),l.mipmaps[_].pixels[$M[b]]=T}g.width/=2,g.height/=2,g.dirty()}return m.dispose(t),g.dispose(t),d.dispose(t),r.dispose(t),{environmentMap:l,brdfLookup:i,normalDistribution:r,maxMipmapLevel:h}},JM.integrateBRDF=function(t,e){e=e||JM.generateNormalDistribution();var n=new mM({depthBuffer:!1}),r=new QM({fragment:"#define SAMPLE_NUMBER 1024\n#define PI 3.14159265358979\nuniform sampler2D normalDistribution;\nuniform vec2 viewportSize : [512, 256];\nconst vec3 N = vec3(0.0, 0.0, 1.0);\nconst float fSampleNumber = float(SAMPLE_NUMBER);\nvec3 importanceSampleNormal(float i, float roughness, vec3 N) {\n vec3 H = texture2D(normalDistribution, vec2(roughness, i)).rgb;\n vec3 upVector = abs(N.y) > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);\n vec3 tangentX = normalize(cross(N, upVector));\n vec3 tangentZ = cross(N, tangentX);\n return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);\n}\nfloat G_Smith(float roughness, float NoV, float NoL) {\n float k = roughness * roughness / 2.0;\n float G1V = NoV / (NoV * (1.0 - k) + k);\n float G1L = NoL / (NoL * (1.0 - k) + k);\n return G1L * G1V;\n}\nvoid main() {\n vec2 uv = gl_FragCoord.xy / viewportSize;\n float NoV = uv.x;\n float roughness = uv.y;\n vec3 V;\n V.x = sqrt(1.0 - NoV * NoV);\n V.y = 0.0;\n V.z = NoV;\n float A = 0.0;\n float B = 0.0;\n for (int i = 0; i < SAMPLE_NUMBER; i++) {\n vec3 H = importanceSampleNormal(float(i) / fSampleNumber, roughness, N);\n vec3 L = reflect(-V, H);\n float NoL = clamp(L.z, 0.0, 1.0);\n float NoH = clamp(H.z, 0.0, 1.0);\n float VoH = clamp(dot(V, H), 0.0, 1.0);\n if (NoL > 0.0) {\n float G = G_Smith(roughness, NoV, NoL);\n float G_Vis = G * VoH / (NoH * NoV);\n float Fc = pow(1.0 - VoH, 5.0);\n A += (1.0 - Fc) * G_Vis;\n B += Fc * G_Vis;\n }\n }\n gl_FragColor = vec4(vec2(A, B) / fSampleNumber, 0.0, 1.0);\n}\n"}),i=new _S({width:512,height:256,type:pS.HALF_FLOAT,wrapS:pS.CLAMP_TO_EDGE,wrapT:pS.CLAMP_TO_EDGE,minFilter:pS.NEAREST,magFilter:pS.NEAREST,useMipmap:!1});return r.setUniform("normalDistribution",e),r.setUniform("viewportSize",[512,256]),r.attachOutput(i),r.render(t,n),n.dispose(t),i},JM.generateNormalDistribution=function(t,e){for(var n=new _S({width:t=t||256,height:e=e||1024,type:pS.FLOAT,minFilter:pS.NEAREST,magFilter:pS.NEAREST,wrapS:pS.CLAMP_TO_EDGE,wrapT:pS.CLAMP_TO_EDGE,useMipmap:!1}),r=new Float32Array(e*t*4),i=[],o=0;o<t;o++){for(var a=o/t,s=a*a,l=0;l<e;l++){var u=(l<<16|l>>>16)>>>0;u=(((16711935&(u=((252645135&(u=((858993459&(u=((1431655765&u)<<1|(2863311530&u)>>>1)>>>0))<<2|(3435973836&u)>>>2)>>>0))<<4|(4042322160&u)>>>4)>>>0))<<8|(4278255360&u)>>>8)>>>0)/4294967296;var h=Math.sqrt((1-u)/(1+(s*s-1)*u));i[l]=h}for(l=0;l<e;l++){var c=4*(l*t+o),d=(h=i[l],Math.sqrt(1-h*h)),p=2*Math.PI*(l/e);r[c]=d*Math.cos(p),r[1+c]=h,r[2+c]=d*Math.sin(p),r[3+c]=1}}return n.pixels=r,n};var tA=JM,eA=NS.extend({cubemap:null,castShadow:!1,_normalDistribution:null,_brdfLookup:null},{type:"AMBIENT_CUBEMAP_LIGHT",prefilter:function(t,e){var n;t.getGLExtension("EXT_shader_texture_lod")?(this._brdfLookup||(this._normalDistribution=tA.generateNormalDistribution(),this._brdfLookup=tA.integrateBRDF(t,this._normalDistribution)),(n=this.cubemap).__prefiltered||(e=tA.prefilterEnvironmentMap(t,n,{encodeRGBM:!0,width:e,height:e},this._normalDistribution,this._brdfLookup),this.cubemap=e.environmentMap,this.cubemap.__prefiltered=!0,n.dispose(t))):console.warn("Device not support textureCubeLodEXT")},getBRDFLookup:function(){return this._brdfLookup},uniformTemplates:{ambientCubemapLightColor:{type:"3f",value:function(t){var e=t.color;t=t.intensity;return[e[0]*t,e[1]*t,e[2]*t]}},ambientCubemapLightCubemap:{type:"t",value:function(t){return t.cubemap}},ambientCubemapLightBRDFLookup:{type:"t",value:function(t){return t._brdfLookup}}}}),nA=NS.extend({castShadow:!1,coefficients:[]},(function(){this._coefficientsTmpArr=new Fb.a.Float32Array(27)}),{type:"AMBIENT_SH_LIGHT",uniformTemplates:{ambientSHLightColor:{type:"3f",value:function(t){var e=t.color;t=t.intensity;return[e[0]*t,e[1]*t,e[2]*t]}},ambientSHLightCoefficients:{type:"3f",value:function(t){for(var e=t._coefficientsTmpArr,n=0;n<t.coefficients.length;n++)e[n]=t.coefficients[n];return e}}}}),rA=(Bo={},["px","nx","py","ny","pz","nz"]),iA={px:[2,1,0,-1,-1,1],nx:[2,1,0,1,-1,-1],py:[0,2,1,1,-1,-1],ny:[0,2,1,1,1,1],pz:[0,1,2,-1,-1,-1],nz:[0,1,2,1,-1,1]};function oA(t,e,n,r){this.array=_w.fromValues(t=t||0,e=e||0,n=n||0,r=r||0),this._dirty=!0}Bo.projectEnvironmentMap=function(t,e,n){(n=n||{}).lod=n.lod||0;var r=new tM,i=64,o=(e="texture2D"===e.textureType?new SM({scene:r,environmentMap:e}):(i=(e.image&&e.image.px?e.image.px:e).width,new wM({scene:r,environmentMap:e})),Math.ceil(i/Math.pow(2,n.lod))),a=Math.ceil(i/Math.pow(2,n.lod)),s=new _S({width:o,height:a}),l=new mM;e.material.define("fragment","RGBM_ENCODE"),n.decodeRGBM&&e.material.define("fragment","RGBM_DECODE"),e.material.set("lod",n.lod);for(var u=new _M({texture:s}),h={},c=0;c<rA.length;c++){h[rA[c]]=new Uint8Array(o*a*4);var d=u.getCamera(rA[c]);d.fov=90,l.attach(s),l.bind(t),t.render(r,d),t.gl.readPixels(0,0,o,a,pS.RGBA,pS.UNSIGNED_BYTE,h[rA[c]]),l.unbind(t)}return e.dispose(t),l.dispose(t),s.dispose(t),function(t,e,n){for(var r,i,o,a=new Fb.a.Float32Array(27),s=GT.create(),l=GT.create(),u=GT.create(),h=0;h<9;h++){for(var c=GT.create(),d=0;d<rA.length;d++){for(var p=t[rA[d]],f=GT.create(),g=0,m=0,y=iA[rA[d]],_=0;_<n;_++)for(var v=0;v<e;v++){s[0]=v/(e-1)*2-1,s[1]=_/(n-1)*2-1,s[2]=-1,GT.normalize(s,s),u[0]=s[y[0]]*y[3],u[1]=s[y[1]]*y[4],u[2]=s[y[2]]*y[5],l[0]=p[m++]/255,l[1]=p[m++]/255,l[2]=p[m++]/255;var x=p[m++]/255*8.12;l[0]*=x,l[1]*=x,l[2]*=x,GT.scaleAndAdd(f,f,l,(r=h,o=i=void 0,i=(x=u)[0],o=x[1],x=x[2],(0===r?1:1===r?i:2===r?o:3===r?x:4===r?i*x:5===r?o*x:6===r?i*o:7===r?3*x*x-1:i*i-o*o)*-s[2])),g+=-s[2]}GT.scaleAndAdd(c,c,f,1/g)}a[3*h]=c[0]/6,a[3*h+1]=c[1]/6,a[3*h+2]=c[2]/6}return a}(h,o,a)};var aA=Bo,sA={firstNotNull:function(){for(var t=0,e=arguments.length;t<e;t++)if(null!=arguments[t])return arguments[t]},queryDataIndex:function(t,e){return null!=e.dataIndexInside?e.dataIndexInside:null!=e.dataIndex?l.isArray(e.dataIndex)?l.map(e.dataIndex,(function(e){return t.indexOfRawIndex(e)})):t.indexOfRawIndex(e.dataIndex):null!=e.name?l.isArray(e.name)?l.map(e.name,(function(e){return t.indexOfName(e)})):t.indexOfName(e.name):void 0}};IS=tr.extend({dynamic:!1,widthSegments:40,heightSegments:20,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI,radius:1},(function(){this.build()}),{build:function(){var t=this.heightSegments,e=this.widthSegments,n=this.attributes.position,r=this.attributes.texcoord0,i=this.attributes.normal,o=(e+1)*(t+1);n.init(o),r.init(o),i.init(o);o=65535<o?Uint32Array:Uint16Array;for(var a,s,l,u,h,c,d,p,f,g=this.indices=new o(e*t*6),m=this.radius,y=this.phiStart,_=this.phiLength,v=this.thetaStart,x=this.thetaLength,b=[],T=[],w=0,S=1/(m=this.radius),M=0;M<=t;M++)for(c=0;c<=e;c++)u=c/e,h=M/t,a=-m*Math.cos(y+u*_)*Math.sin(v+h*x),s=m*Math.cos(v+h*x),l=m*Math.sin(y+u*_)*Math.sin(v+h*x),b[0]=a,b[1]=s,b[2]=l,T[0]=u,T[1]=h,n.set(w,b),r.set(w,T),b[0]*=S,b[1]*=S,b[2]*=S,i.set(w,b),w++;var A=e+1,C=0;for(M=0;M<t;M++)for(c=0;c<e;c++)f=(M+1)*A+c+1,p=(M+1)*A+c,g[C++]=(d=M*A+c)+1,g[C++]=d,g[C++]=f,g[C++]=d,g[C++]=p,g[C++]=f;this.boundingBox=new Qw,this.boundingBox.max.set(m,m,m),this.boundingBox.min.set(-m,-m,-m)}}),$r=NS.extend({castShadow:!1},{type:"AMBIENT_LIGHT",uniformTemplates:{ambientLightColor:{type:"3f",value:function(t){var e=t.color;t=t.intensity;return[e[0]*t,e[1]*t,e[2]*t]}}}}),ur=NS.extend({shadowBias:.001,shadowSlopeScale:2,shadowCascade:1,cascadeSplitLogFactor:.2},{type:"DIRECTIONAL_LIGHT",uniformTemplates:{directionalLightDirection:{type:"3f",value:function(t){return t.__dir=t.__dir||new fw,t.__dir.copy(t.worldTransform.z).normalize().negate().array}},directionalLightColor:{type:"3f",value:function(t){var e=t.color;t=t.intensity;return[e[0]*t,e[1]*t,e[2]*t]}}},clone:function(){var t=NS.prototype.clone.call(this);return t.shadowBias=this.shadowBias,t.shadowSlopeScale=this.shadowSlopeScale,t}}),yS=NS.extend({range:100,castShadow:!1},{type:"POINT_LIGHT",uniformTemplates:{pointLightPosition:{type:"3f",value:function(t){return t.getWorldPosition().array}},pointLightRange:{type:"1f",value:function(t){return t.range}},pointLightColor:{type:"3f",value:function(t){var e=t.color;t=t.intensity;return[e[0]*t,e[1]*t,e[2]*t]}}},clone:function(){var t=NS.prototype.clone.call(this);return t.range=this.range,t}}),Pu=NS.extend({range:20,umbraAngle:30,penumbraAngle:45,falloffFactor:2,shadowBias:.001,shadowSlopeScale:2},{type:"SPOT_LIGHT",uniformTemplates:{spotLightPosition:{type:"3f",value:function(t){return t.getWorldPosition().array}},spotLightRange:{type:"1f",value:function(t){return t.range}},spotLightUmbraAngleCosine:{type:"1f",value:function(t){return Math.cos(t.umbraAngle*Math.PI/180)}},spotLightPenumbraAngleCosine:{type:"1f",value:function(t){return Math.cos(t.penumbraAngle*Math.PI/180)}},spotLightFalloffFactor:{type:"1f",value:function(t){return t.falloffFactor}},spotLightDirection:{type:"3f",value:function(t){return t.__dir=t.__dir||new fw,t.__dir.copy(t.worldTransform.z).negate().array}},spotLightColor:{type:"3f",value:function(t){var e=t.color;t=t.intensity;return[e[0]*t,e[1]*t,e[2]*t]}}},clone:function(){var t=NS.prototype.clone.call(this);return t.range=this.range,t.umbraAngle=this.umbraAngle,t.penumbraAngle=this.penumbraAngle,t.falloffFactor=this.falloffFactor,t.shadowBias=this.shadowBias,t.shadowSlopeScale=this.shadowSlopeScale,t}});function lA(){this.array=uA.create(),this._dirty=!0}oA.prototype={constructor:oA,add:function(t){return _w.add(this.array,this.array,t.array),this._dirty=!0,this},set:function(t,e,n,r){return this.array[0]=t,this.array[1]=e,this.array[2]=n,this.array[3]=r,this._dirty=!0,this},setArray:function(t){return this.array[0]=t[0],this.array[1]=t[1],this.array[2]=t[2],this.array[3]=t[3],this._dirty=!0,this},clone:function(){return new oA(this.x,this.y,this.z,this.w)},copy:function(t){return _w.copy(this.array,t.array),this._dirty=!0,this},dist:function(t){return _w.dist(this.array,t.array)},distance:function(t){return _w.distance(this.array,t.array)},div:function(t){return _w.div(this.array,this.array,t.array),this._dirty=!0,this},divide:function(t){return _w.divide(this.array,this.array,t.array),this._dirty=!0,this},dot:function(t){return _w.dot(this.array,t.array)},len:function(){return _w.len(this.array)},length:function(){return _w.length(this.array)},lerp:function(t,e,n){return _w.lerp(this.array,t.array,e.array,n),this._dirty=!0,this},min:function(t){return _w.min(this.array,this.array,t.array),this._dirty=!0,this},max:function(t){return _w.max(this.array,this.array,t.array),this._dirty=!0,this},mul:function(t){return _w.mul(this.array,this.array,t.array),this._dirty=!0,this},multiply:function(t){return _w.multiply(this.array,this.array,t.array),this._dirty=!0,this},negate:function(){return _w.negate(this.array,this.array),this._dirty=!0,this},normalize:function(){return _w.normalize(this.array,this.array),this._dirty=!0,this},random:function(t){return _w.random(this.array,t),this._dirty=!0,this},scale:function(t){return _w.scale(this.array,this.array,t),this._dirty=!0,this},scaleAndAdd:function(t,e){return _w.scaleAndAdd(this.array,this.array,t.array,e),this._dirty=!0,this},sqrDist:function(t){return _w.sqrDist(this.array,t.array)},squaredDistance:function(t){return _w.squaredDistance(this.array,t.array)},sqrLen:function(){return _w.sqrLen(this.array)},squaredLength:function(){return _w.squaredLength(this.array)},sub:function(t){return _w.sub(this.array,this.array,t.array),this._dirty=!0,this},subtract:function(t){return _w.subtract(this.array,this.array,t.array),this._dirty=!0,this},transformMat4:function(t){return _w.transformMat4(this.array,this.array,t.array),this._dirty=!0,this},transformQuat:function(t){return _w.transformQuat(this.array,this.array,t.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}},M=Object.defineProperty,M&&(M(pA=oA.prototype,"x",{get:function(){return this.array[0]},set:function(t){this.array[0]=t,this._dirty=!0}}),M(pA,"y",{get:function(){return this.array[1]},set:function(t){this.array[1]=t,this._dirty=!0}}),M(pA,"z",{get:function(){return this.array[2]},set:function(t){this.array[2]=t,this._dirty=!0}}),M(pA,"w",{get:function(){return this.array[3]},set:function(t){this.array[3]=t,this._dirty=!0}})),oA.add=function(t,e,n){return _w.add(t.array,e.array,n.array),t._dirty=!0,t},oA.set=function(t,e,n,r,i){_w.set(t.array,e,n,r,i),t._dirty=!0},oA.copy=function(t,e){return _w.copy(t.array,e.array),t._dirty=!0,t},oA.distance=oA.dist=function(t,e){return _w.distance(t.array,e.array)},oA.divide=oA.div=function(t,e,n){return _w.divide(t.array,e.array,n.array),t._dirty=!0,t},oA.dot=function(t,e){return _w.dot(t.array,e.array)},oA.len=function(t){return _w.length(t.array)},oA.lerp=function(t,e,n,r){return _w.lerp(t.array,e.array,n.array,r),t._dirty=!0,t},oA.min=function(t,e,n){return _w.min(t.array,e.array,n.array),t._dirty=!0,t},oA.max=function(t,e,n){return _w.max(t.array,e.array,n.array),t._dirty=!0,t},oA.multiply=oA.mul=function(t,e,n){return _w.multiply(t.array,e.array,n.array),t._dirty=!0,t},oA.negate=function(t,e){return _w.negate(t.array,e.array),t._dirty=!0,t},oA.normalize=function(t,e){return _w.normalize(t.array,e.array),t._dirty=!0,t},oA.random=function(t,e){return _w.random(t.array,e),t._dirty=!0,t},oA.scale=function(t,e,n){return _w.scale(t.array,e.array,n),t._dirty=!0,t},oA.scaleAndAdd=function(t,e,n,r){return _w.scaleAndAdd(t.array,e.array,n.array,r),t._dirty=!0,t},oA.squaredDistance=oA.sqrDist=function(t,e){return _w.sqrDist(t.array,e.array)},oA.squaredLength=oA.sqrLen=function(t){return _w.sqrLen(t.array)},oA.subtract=oA.sub=function(t,e,n){return _w.subtract(t.array,e.array,n.array),t._dirty=!0,t},oA.transformMat4=function(t,e,n){return _w.transformMat4(t.array,e.array,n.array),t._dirty=!0,t},oA.transformQuat=function(t,e,n){return _w.transformQuat(t.array,e.array,n.array),t._dirty=!0,t},S=oA,ES={create:function(){var t=new aT(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},clone:function(t){var e=new aT(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},transpose:function(t,e){var n;return t===e?(n=e[1],t[1]=e[2],t[2]=n):(t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3]),t},invert:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3];e=n*o-i*r;return e?(t[0]=o*(e=1/e),t[1]=-r*e,t[2]=-i*e,t[3]=n*e,t):null},adjoint:function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},determinant:function(t){return t[0]*t[3]-t[2]*t[1]},multiply:function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],l=n[1];e=n[2],n=n[3];return t[0]=r*s+o*l,t[1]=i*s+a*l,t[2]=r*e+o*n,t[3]=i*e+a*n,t}},ES.mul=ES.multiply,ES.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];e=Math.sin(n),n=Math.cos(n);return t[0]=r*n+o*e,t[1]=i*n+a*e,t[2]=r*-e+o*n,t[3]=i*-e+a*n,t},ES.scale=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];e=n[0],n=n[1];return t[0]=r*e,t[1]=i*e,t[2]=o*n,t[3]=a*n,t},ES.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},ES.LDU=function(t,e,n,r){return t[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-t[2]*n[1],[t,e,n]};var uA=ES;function hA(){this.array=cA.create(),this._dirty=!0}lA.prototype={constructor:lA,setArray:function(t){for(var e=0;e<this.array.length;e++)this.array[e]=t[e];return this._dirty=!0,this},clone:function(){return(new lA).copy(this)},copy:function(t){return uA.copy(this.array,t.array),this._dirty=!0,this},adjoint:function(){return uA.adjoint(this.array,this.array),this._dirty=!0,this},determinant:function(){return uA.determinant(this.array)},identity:function(){return uA.identity(this.array),this._dirty=!0,this},invert:function(){return uA.invert(this.array,this.array),this._dirty=!0,this},mul:function(t){return uA.mul(this.array,this.array,t.array),this._dirty=!0,this},mulLeft:function(t){return uA.mul(this.array,t.array,this.array),this._dirty=!0,this},multiply:function(t){return uA.multiply(this.array,this.array,t.array),this._dirty=!0,this},multiplyLeft:function(t){return uA.multiply(this.array,t.array,this.array),this._dirty=!0,this},rotate:function(t){return uA.rotate(this.array,this.array,t),this._dirty=!0,this},scale:function(t){return uA.scale(this.array,this.array,t.array),this._dirty=!0,this},transpose:function(){return uA.transpose(this.array,this.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}},lA.adjoint=function(t,e){return uA.adjoint(t.array,e.array),t._dirty=!0,t},lA.copy=function(t,e){return uA.copy(t.array,e.array),t._dirty=!0,t},lA.determinant=function(t){return uA.determinant(t.array)},lA.identity=function(t){return uA.identity(t.array),t._dirty=!0,t},lA.invert=function(t,e){return uA.invert(t.array,e.array),t._dirty=!0,t},lA.multiply=lA.mul=function(t,e,n){return uA.mul(t.array,e.array,n.array),t._dirty=!0,t},lA.rotate=function(t,e,n){return uA.rotate(t.array,e.array,n),t._dirty=!0,t},lA.scale=function(t,e,n){return uA.scale(t.array,e.array,n.array),t._dirty=!0,t},lA.transpose=function(t,e){return uA.transpose(t.array,e.array),t._dirty=!0,t},Ql=lA,Bo={create:function(){var t=new aT(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},clone:function(t){var e=new aT(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},invert:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5];e=n*o-r*i;return e?(t[0]=o*(e=1/e),t[1]=-r*e,t[2]=-i*e,t[3]=n*e,t[4]=(i*s-o*a)*e,t[5]=(r*a-n*s)*e,t):null},determinant:function(t){return t[0]*t[3]-t[1]*t[2]},multiply:function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=n[0],h=n[1],c=n[2],d=n[3];e=n[4],n=n[5];return t[0]=r*u+o*h,t[1]=i*u+a*h,t[2]=r*c+o*d,t[3]=i*c+a*d,t[4]=r*e+o*n+s,t[5]=i*e+a*n+l,t}},Bo.mul=Bo.multiply,Bo.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5];e=Math.sin(n),n=Math.cos(n);return t[0]=r*n+o*e,t[1]=i*n+a*e,t[2]=r*-e+o*n,t[3]=i*-e+a*n,t[4]=s,t[5]=l,t},Bo.scale=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5];e=n[0],n=n[1];return t[0]=r*e,t[1]=i*e,t[2]=o*n,t[3]=a*n,t[4]=s,t[5]=l,t},Bo.translate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5];e=n[0],n=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=r*e+o*n+s,t[5]=i*e+a*n+l,t},Bo.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)};var cA=Bo;function dA(){this.array=ww.create(),this._dirty=!0}hA.prototype={constructor:hA,setArray:function(t){for(var e=0;e<this.array.length;e++)this.array[e]=t[e];return this._dirty=!0,this},clone:function(){return(new hA).copy(this)},copy:function(t){return cA.copy(this.array,t.array),this._dirty=!0,this},determinant:function(){return cA.determinant(this.array)},identity:function(){return cA.identity(this.array),this._dirty=!0,this},invert:function(){return cA.invert(this.array,this.array),this._dirty=!0,this},mul:function(t){return cA.mul(this.array,this.array,t.array),this._dirty=!0,this},mulLeft:function(t){return cA.mul(this.array,t.array,this.array),this._dirty=!0,this},multiply:function(t){return cA.multiply(this.array,this.array,t.array),this._dirty=!0,this},multiplyLeft:function(t){return cA.multiply(this.array,t.array,this.array),this._dirty=!0,this},rotate:function(t){return cA.rotate(this.array,this.array,t),this._dirty=!0,this},scale:function(t){return cA.scale(this.array,this.array,t.array),this._dirty=!0,this},translate:function(t){return cA.translate(this.array,this.array,t.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}},hA.copy=function(t,e){return cA.copy(t.array,e.array),t._dirty=!0,t},hA.determinant=function(t){return cA.determinant(t.array)},hA.identity=function(t){return cA.identity(t.array),t._dirty=!0,t},hA.invert=function(t,e){return cA.invert(t.array,e.array),t._dirty=!0,t},hA.multiply=hA.mul=function(t,e,n){return cA.mul(t.array,e.array,n.array),t._dirty=!0,t},hA.rotate=function(t,e,n){return cA.rotate(t.array,e.array,n),t._dirty=!0,t},hA.scale=function(t,e,n){return cA.scale(t.array,e.array,n.array),t._dirty=!0,t},hA.translate=function(t,e,n){return cA.translate(t.array,e.array,n.array),t._dirty=!0,t},M=hA,dA.prototype={constructor:dA,setArray:function(t){for(var e=0;e<this.array.length;e++)this.array[e]=t[e];return this._dirty=!0,this},adjoint:function(){return ww.adjoint(this.array,this.array),this._dirty=!0,this},clone:function(){return(new dA).copy(this)},copy:function(t){return ww.copy(this.array,t.array),this._dirty=!0,this},determinant:function(){return ww.determinant(this.array)},fromMat2d:function(t){return ww.fromMat2d(this.array,t.array),this._dirty=!0,this},fromMat4:function(t){return ww.fromMat4(this.array,t.array),this._dirty=!0,this},fromQuat:function(t){return ww.fromQuat(this.array,t.array),this._dirty=!0,this},identity:function(){return ww.identity(this.array),this._dirty=!0,this},invert:function(){return ww.invert(this.array,this.array),this._dirty=!0,this},mul:function(t){return ww.mul(this.array,this.array,t.array),this._dirty=!0,this},mulLeft:function(t){return ww.mul(this.array,t.array,this.array),this._dirty=!0,this},multiply:function(t){return ww.multiply(this.array,this.array,t.array),this._dirty=!0,this},multiplyLeft:function(t){return ww.multiply(this.array,t.array,this.array),this._dirty=!0,this},rotate:function(t){return ww.rotate(this.array,this.array,t),this._dirty=!0,this},scale:function(t){return ww.scale(this.array,this.array,t.array),this._dirty=!0,this},translate:function(t){return ww.translate(this.array,this.array,t.array),this._dirty=!0,this},normalFromMat4:function(t){return ww.normalFromMat4(this.array,t.array),this._dirty=!0,this},transpose:function(){return ww.transpose(this.array,this.array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this.array,",")+"]"},toArray:function(){return Array.prototype.slice.call(this.array)}},dA.adjoint=function(t,e){return ww.adjoint(t.array,e.array),t._dirty=!0,t},dA.copy=function(t,e){return ww.copy(t.array,e.array),t._dirty=!0,t},dA.determinant=function(t){return ww.determinant(t.array)},dA.identity=function(t){return ww.identity(t.array),t._dirty=!0,t},dA.invert=function(t,e){return ww.invert(t.array,e.array),t},dA.multiply=dA.mul=function(t,e,n){return ww.mul(t.array,e.array,n.array),t._dirty=!0,t},dA.fromMat2d=function(t,e){return ww.fromMat2d(t.array,e.array),t._dirty=!0,t},dA.fromMat4=function(t,e){return ww.fromMat4(t.array,e.array),t._dirty=!0,t},dA.fromQuat=function(t,e){return ww.fromQuat(t.array,e.array),t._dirty=!0,t},dA.normalFromMat4=function(t,e){return ww.normalFromMat4(t.array,e.array),t._dirty=!0,t},dA.rotate=function(t,e,n){return ww.rotate(t.array,e.array,n),t._dirty=!0,t},dA.scale=function(t,e,n){return ww.scale(t.array,e.array,n.array),t._dirty=!0,t},dA.transpose=function(t,e){return ww.transpose(t.array,e.array),t._dirty=!0,t},dA.translate=function(t,e,n){return ww.translate(t.array,e.array,n.array),t._dirty=!0,t};var pA=dA;ES={_animators:null,getAnimators:function(){return this._animators=this._animators||[],this._animators},animate:function(t,e){var n;if(this._animators=this._animators||[],t){for(var r=t.split("."),i=this,o=0,a=r.length;o<a;o++)i=i&&i[r[o]];i&&(n=i)}else n=this;if(null==n)throw new Error("Target "+t+" not exists");var s=this._animators,l=new En(n,e),u=this;return l.during((function(){u.__zr&&u.__zr.refresh()})).done((function(){var t=s.indexOf(l);0<=t&&s.splice(t,1)})),s.push(l),this.__zr&&this.__zr.animation.addAnimator(l),l},stopAnimation:function(t){this._animators=this._animators||[];for(var e=this._animators,n=e.length,r=0;r<n;r++)e[r].stop(t);return e.length=0,this},addAnimatorsToZr:function(t){if(this._animators)for(var e=0;e<this._animators.length;e++)t.animation.addAnimator(this._animators[e])},removeAnimatorsFromZr:function(t){if(this._animators)for(var e=0;e<this._animators.length;e++)t.animation.removeAnimator(this._animators[e])}},Bo="\n@export clay.util.rand\nhighp float rand(vec2 uv) {\n const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n highp float dt = dot(uv.xy, vec2(a,b)), sn = mod(dt, 3.141592653589793);\n return fract(sin(sn) * c);\n}\n@end\n@export clay.util.calculate_attenuation\nuniform float attenuationFactor : 5.0;\nfloat lightAttenuation(float dist, float range)\n{\n float attenuation = 1.0;\n attenuation = dist*dist/(range*range+1.0);\n float att_s = attenuationFactor;\n attenuation = 1.0/(attenuation*att_s+1.0);\n att_s = 1.0/(att_s+1.0);\n attenuation = attenuation - att_s;\n attenuation /= 1.0 - att_s;\n return clamp(attenuation, 0.0, 1.0);\n}\n@end\n@export clay.util.edge_factor\n#ifdef SUPPORT_STANDARD_DERIVATIVES\nfloat edgeFactor(float width)\n{\n vec3 d = fwidth(v_Barycentric);\n vec3 a3 = smoothstep(vec3(0.0), d * width, v_Barycentric);\n return min(min(a3.x, a3.y), a3.z);\n}\n#else\nfloat edgeFactor(float width)\n{\n return 1.0;\n}\n#endif\n@end\n@export clay.util.encode_float\nvec4 encodeFloat(const in float depth)\n{\n const vec4 bitShifts = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n const vec4 bit_mask = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n vec4 res = fract(depth * bitShifts);\n res -= res.xxyz * bit_mask;\n return res;\n}\n@end\n@export clay.util.decode_float\nfloat decodeFloat(const in vec4 color)\n{\n const vec4 bitShifts = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n return dot(color, bitShifts);\n}\n@end\n@export clay.util.float\n@import clay.util.encode_float\n@import clay.util.decode_float\n@end\n@export clay.util.rgbm_decode\nvec3 RGBMDecode(vec4 rgbm, float range) {\n return range * rgbm.rgb * rgbm.a;\n}\n@end\n@export clay.util.rgbm_encode\nvec4 RGBMEncode(vec3 color, float range) {\n if (dot(color, color) == 0.0) {\n return vec4(0.0);\n }\n vec4 rgbm;\n color /= range;\n rgbm.a = clamp(max(max(color.r, color.g), max(color.b, 1e-6)), 0.0, 1.0);\n rgbm.a = ceil(rgbm.a * 255.0) / 255.0;\n rgbm.rgb = color / rgbm.a;\n return rgbm;\n}\n@end\n@export clay.util.rgbm\n@import clay.util.rgbm_decode\n@import clay.util.rgbm_encode\nvec4 decodeHDR(vec4 color)\n{\n#if defined(RGBM_DECODE) || defined(RGBM)\n return vec4(RGBMDecode(color, 8.12), 1.0);\n#else\n return color;\n#endif\n}\nvec4 encodeHDR(vec4 color)\n{\n#if defined(RGBM_ENCODE) || defined(RGBM)\n return RGBMEncode(color.xyz, 8.12);\n#else\n return color;\n#endif\n}\n@end\n@export clay.util.srgb\nvec4 sRGBToLinear(in vec4 value) {\n return vec4(mix(pow(value.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), value.rgb * 0.0773993808, vec3(lessThanEqual(value.rgb, vec3(0.04045)))), value.w);\n}\nvec4 linearTosRGB(in vec4 value) {\n return vec4(mix(pow(value.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), value.rgb * 12.92, vec3(lessThanEqual(value.rgb, vec3(0.0031308)))), value.w);\n}\n@end\n@export clay.chunk.skinning_header\n#ifdef SKINNING\nattribute vec3 weight : WEIGHT;\nattribute vec4 joint : JOINT;\n#ifdef USE_SKIN_MATRICES_TEXTURE\nuniform sampler2D skinMatricesTexture : ignore;\nuniform float skinMatricesTextureSize: ignore;\nmat4 getSkinMatrix(sampler2D tex, float idx) {\n float j = idx * 4.0;\n float x = mod(j, skinMatricesTextureSize);\n float y = floor(j / skinMatricesTextureSize) + 0.5;\n vec2 scale = vec2(skinMatricesTextureSize);\n return mat4(\n texture2D(tex, vec2(x + 0.5, y) / scale),\n texture2D(tex, vec2(x + 1.5, y) / scale),\n texture2D(tex, vec2(x + 2.5, y) / scale),\n texture2D(tex, vec2(x + 3.5, y) / scale)\n );\n}\nmat4 getSkinMatrix(float idx) {\n return getSkinMatrix(skinMatricesTexture, idx);\n}\n#else\nuniform mat4 skinMatrix[JOINT_COUNT] : SKIN_MATRIX;\nmat4 getSkinMatrix(float idx) {\n return skinMatrix[int(idx)];\n}\n#endif\n#endif\n@end\n@export clay.chunk.skin_matrix\nmat4 skinMatrixWS = getSkinMatrix(joint.x) * weight.x;\nif (weight.y > 1e-4)\n{\n skinMatrixWS += getSkinMatrix(joint.y) * weight.y;\n}\nif (weight.z > 1e-4)\n{\n skinMatrixWS += getSkinMatrix(joint.z) * weight.z;\n}\nfloat weightW = 1.0-weight.x-weight.y-weight.z;\nif (weightW > 1e-4)\n{\n skinMatrixWS += getSkinMatrix(joint.w) * weightW;\n}\n@end\n@export clay.chunk.instancing_header\n#ifdef INSTANCING\nattribute vec4 instanceMat1;\nattribute vec4 instanceMat2;\nattribute vec4 instanceMat3;\n#endif\n@end\n@export clay.chunk.instancing_matrix\nmat4 instanceMat = mat4(\n vec4(instanceMat1.xyz, 0.0),\n vec4(instanceMat2.xyz, 0.0),\n vec4(instanceMat3.xyz, 0.0),\n vec4(instanceMat1.w, instanceMat2.w, instanceMat3.w, 1.0)\n);\n@end\n@export clay.util.parallax_correct\nvec3 parallaxCorrect(in vec3 dir, in vec3 pos, in vec3 boxMin, in vec3 boxMax) {\n vec3 first = (boxMax - pos) / dir;\n vec3 second = (boxMin - pos) / dir;\n vec3 further = max(first, second);\n float dist = min(further.x, min(further.y, further.z));\n vec3 fixedPos = pos + dir * dist;\n vec3 boxCenter = (boxMax + boxMin) * 0.5;\n return normalize(fixedPos - boxCenter);\n}\n@end\n@export clay.util.clamp_sample\nvec4 clampSample(const in sampler2D texture, const in vec2 coord)\n{\n#ifdef STEREO\n float eye = step(0.5, coord.x) * 0.5;\n vec2 coordClamped = clamp(coord, vec2(eye, 0.0), vec2(0.5 + eye, 1.0));\n#else\n vec2 coordClamped = clamp(coord, vec2(0.0), vec2(1.0));\n#endif\n return texture2D(texture, coordClamped);\n}\n@end\n@export clay.util.ACES\nvec3 ACESToneMapping(vec3 color)\n{\n const float A = 2.51;\n const float B = 0.03;\n const float C = 2.43;\n const float D = 0.59;\n const float E = 0.14;\n return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\n@end";function fA(t){return t instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof Image}Object.assign(eS.prototype,ES),FT.import(Bo),FT.import(co),FT.import("\n@export ecgl.common.transformUniforms\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform mat4 worldInverseTranspose : WORLDINVERSETRANSPOSE;\nuniform mat4 world : WORLD;\n@end\n\n@export ecgl.common.attributes\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\nattribute vec3 normal : NORMAL;\n@end\n\n@export ecgl.common.uv.header\nuniform vec2 uvRepeat : [1.0, 1.0];\nuniform vec2 uvOffset : [0.0, 0.0];\nuniform vec2 detailUvRepeat : [1.0, 1.0];\nuniform vec2 detailUvOffset : [0.0, 0.0];\n\nvarying vec2 v_Texcoord;\nvarying vec2 v_DetailTexcoord;\n@end\n\n@export ecgl.common.uv.main\nv_Texcoord = texcoord * uvRepeat + uvOffset;\nv_DetailTexcoord = texcoord * detailUvRepeat + detailUvOffset;\n@end\n\n@export ecgl.common.uv.fragmentHeader\nvarying vec2 v_Texcoord;\nvarying vec2 v_DetailTexcoord;\n@end\n\n\n@export ecgl.common.albedo.main\n\n vec4 albedoTexel = vec4(1.0);\n#ifdef DIFFUSEMAP_ENABLED\n albedoTexel = texture2D(diffuseMap, v_Texcoord);\n #ifdef SRGB_DECODE\n albedoTexel = sRGBToLinear(albedoTexel);\n #endif\n#endif\n\n#ifdef DETAILMAP_ENABLED\n vec4 detailTexel = texture2D(detailMap, v_DetailTexcoord);\n #ifdef SRGB_DECODE\n detailTexel = sRGBToLinear(detailTexel);\n #endif\n albedoTexel.rgb = mix(albedoTexel.rgb, detailTexel.rgb, detailTexel.a);\n albedoTexel.a = detailTexel.a + (1.0 - detailTexel.a) * albedoTexel.a;\n#endif\n\n@end\n\n@export ecgl.common.wireframe.vertexHeader\n\n#ifdef WIREFRAME_QUAD\nattribute vec4 barycentric;\nvarying vec4 v_Barycentric;\n#elif defined(WIREFRAME_TRIANGLE)\nattribute vec3 barycentric;\nvarying vec3 v_Barycentric;\n#endif\n\n@end\n\n@export ecgl.common.wireframe.vertexMain\n\n#if defined(WIREFRAME_QUAD) || defined(WIREFRAME_TRIANGLE)\n v_Barycentric = barycentric;\n#endif\n\n@end\n\n\n@export ecgl.common.wireframe.fragmentHeader\n\nuniform float wireframeLineWidth : 1;\nuniform vec4 wireframeLineColor: [0, 0, 0, 0.5];\n\n#ifdef WIREFRAME_QUAD\nvarying vec4 v_Barycentric;\nfloat edgeFactor () {\n vec4 d = fwidth(v_Barycentric);\n vec4 a4 = smoothstep(vec4(0.0), d * wireframeLineWidth, v_Barycentric);\n return min(min(min(a4.x, a4.y), a4.z), a4.w);\n}\n#elif defined(WIREFRAME_TRIANGLE)\nvarying vec3 v_Barycentric;\nfloat edgeFactor () {\n vec3 d = fwidth(v_Barycentric);\n vec3 a3 = smoothstep(vec3(0.0), d * wireframeLineWidth, v_Barycentric);\n return min(min(a3.x, a3.y), a3.z);\n}\n#endif\n\n@end\n\n\n@export ecgl.common.wireframe.fragmentMain\n\n#if defined(WIREFRAME_QUAD) || defined(WIREFRAME_TRIANGLE)\n if (wireframeLineWidth > 0.) {\n vec4 lineColor = wireframeLineColor;\n#ifdef SRGB_DECODE\n lineColor = sRGBToLinear(lineColor);\n#endif\n\n gl_FragColor.rgb = mix(gl_FragColor.rgb, lineColor.rgb, (1.0 - edgeFactor()) * lineColor.a);\n }\n#endif\n@end\n\n\n\n\n@export ecgl.common.bumpMap.header\n\n#ifdef BUMPMAP_ENABLED\nuniform sampler2D bumpMap;\nuniform float bumpScale : 1.0;\n\n\nvec3 bumpNormal(vec3 surfPos, vec3 surfNormal, vec3 baseNormal)\n{\n vec2 dSTdx = dFdx(v_Texcoord);\n vec2 dSTdy = dFdy(v_Texcoord);\n\n float Hll = bumpScale * texture2D(bumpMap, v_Texcoord).x;\n float dHx = bumpScale * texture2D(bumpMap, v_Texcoord + dSTdx).x - Hll;\n float dHy = bumpScale * texture2D(bumpMap, v_Texcoord + dSTdy).x - Hll;\n\n vec3 vSigmaX = dFdx(surfPos);\n vec3 vSigmaY = dFdy(surfPos);\n vec3 vN = surfNormal;\n\n vec3 R1 = cross(vSigmaY, vN);\n vec3 R2 = cross(vN, vSigmaX);\n\n float fDet = dot(vSigmaX, R1);\n\n vec3 vGrad = sign(fDet) * (dHx * R1 + dHy * R2);\n return normalize(abs(fDet) * baseNormal - vGrad);\n\n}\n#endif\n\n@end\n\n@export ecgl.common.normalMap.vertexHeader\n\n#ifdef NORMALMAP_ENABLED\nattribute vec4 tangent : TANGENT;\nvarying vec3 v_Tangent;\nvarying vec3 v_Bitangent;\n#endif\n\n@end\n\n@export ecgl.common.normalMap.vertexMain\n\n#ifdef NORMALMAP_ENABLED\n if (dot(tangent, tangent) > 0.0) {\n v_Tangent = normalize((worldInverseTranspose * vec4(tangent.xyz, 0.0)).xyz);\n v_Bitangent = normalize(cross(v_Normal, v_Tangent) * tangent.w);\n }\n#endif\n\n@end\n\n\n@export ecgl.common.normalMap.fragmentHeader\n\n#ifdef NORMALMAP_ENABLED\nuniform sampler2D normalMap;\nvarying vec3 v_Tangent;\nvarying vec3 v_Bitangent;\n#endif\n\n@end\n\n@export ecgl.common.normalMap.fragmentMain\n#ifdef NORMALMAP_ENABLED\n if (dot(v_Tangent, v_Tangent) > 0.0) {\n vec3 normalTexel = texture2D(normalMap, v_DetailTexcoord).xyz;\n if (dot(normalTexel, normalTexel) > 0.0) { N = normalTexel * 2.0 - 1.0;\n mat3 tbn = mat3(v_Tangent, v_Bitangent, v_Normal);\n N = normalize(tbn * N);\n }\n }\n#endif\n@end\n\n\n\n@export ecgl.common.vertexAnimation.header\n\n#ifdef VERTEX_ANIMATION\nattribute vec3 prevPosition;\nattribute vec3 prevNormal;\nuniform float percent;\n#endif\n\n@end\n\n@export ecgl.common.vertexAnimation.main\n\n#ifdef VERTEX_ANIMATION\n vec3 pos = mix(prevPosition, position, percent);\n vec3 norm = mix(prevNormal, normal, percent);\n#else\n vec3 pos = position;\n vec3 norm = normal;\n#endif\n\n@end\n\n\n@export ecgl.common.ssaoMap.header\n#ifdef SSAOMAP_ENABLED\nuniform sampler2D ssaoMap;\nuniform vec4 viewport : VIEWPORT;\n#endif\n@end\n\n@export ecgl.common.ssaoMap.main\n float ao = 1.0;\n#ifdef SSAOMAP_ENABLED\n ao = texture2D(ssaoMap, (gl_FragCoord.xy - viewport.xy) / viewport.zw).r;\n#endif\n@end\n\n\n\n\n@export ecgl.common.diffuseLayer.header\n\n#if (LAYER_DIFFUSEMAP_COUNT > 0)\nuniform float layerDiffuseIntensity[LAYER_DIFFUSEMAP_COUNT];\nuniform sampler2D layerDiffuseMap[LAYER_DIFFUSEMAP_COUNT];\n#endif\n\n@end\n\n@export ecgl.common.emissiveLayer.header\n\n#if (LAYER_EMISSIVEMAP_COUNT > 0)\nuniform float layerEmissionIntensity[LAYER_EMISSIVEMAP_COUNT];\nuniform sampler2D layerEmissiveMap[LAYER_EMISSIVEMAP_COUNT];\n#endif\n\n@end\n\n@export ecgl.common.layers.header\n@import ecgl.common.diffuseLayer.header\n@import ecgl.common.emissiveLayer.header\n@end\n\n@export ecgl.common.diffuseLayer.main\n\n#if (LAYER_DIFFUSEMAP_COUNT > 0)\n for (int _idx_ = 0; _idx_ < LAYER_DIFFUSEMAP_COUNT; _idx_++) {{\n float intensity = layerDiffuseIntensity[_idx_];\n vec4 texel2 = texture2D(layerDiffuseMap[_idx_], v_Texcoord);\n #ifdef SRGB_DECODE\n texel2 = sRGBToLinear(texel2);\n #endif\n albedoTexel.rgb = mix(albedoTexel.rgb, texel2.rgb * intensity, texel2.a);\n albedoTexel.a = texel2.a + (1.0 - texel2.a) * albedoTexel.a;\n }}\n#endif\n\n@end\n\n@export ecgl.common.emissiveLayer.main\n\n#if (LAYER_EMISSIVEMAP_COUNT > 0)\n for (int _idx_ = 0; _idx_ < LAYER_EMISSIVEMAP_COUNT; _idx_++)\n {{\n vec4 texel2 = texture2D(layerEmissiveMap[_idx_], v_Texcoord) * layerEmissionIntensity[_idx_];\n #ifdef SRGB_DECODE\n texel2 = sRGBToLinear(texel2);\n #endif\n float intensity = layerEmissionIntensity[_idx_];\n gl_FragColor.rgb += texel2.rgb * texel2.a * intensity;\n }}\n#endif\n\n@end\n"),FT.import("@export ecgl.color.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\n@import ecgl.common.uv.header\n\nattribute vec2 texcoord : TEXCOORD_0;\nattribute vec3 position: POSITION;\n\n@import ecgl.common.wireframe.vertexHeader\n\n#ifdef VERTEX_COLOR\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n#endif\n\n#ifdef VERTEX_ANIMATION\nattribute vec3 prevPosition;\nuniform float percent : 1.0;\n#endif\n\n#ifdef ATMOSPHERE_ENABLED\nattribute vec3 normal: NORMAL;\nuniform mat4 worldInverseTranspose : WORLDINVERSETRANSPOSE;\nvarying vec3 v_Normal;\n#endif\n\nvoid main()\n{\n#ifdef VERTEX_ANIMATION\n vec3 pos = mix(prevPosition, position, percent);\n#else\n vec3 pos = position;\n#endif\n\n gl_Position = worldViewProjection * vec4(pos, 1.0);\n\n @import ecgl.common.uv.main\n\n#ifdef VERTEX_COLOR\n v_Color = a_Color;\n#endif\n\n#ifdef ATMOSPHERE_ENABLED\n v_Normal = normalize((worldInverseTranspose * vec4(normal, 0.0)).xyz);\n#endif\n\n @import ecgl.common.wireframe.vertexMain\n\n}\n\n@end\n\n@export ecgl.color.fragment\n\n#define LAYER_DIFFUSEMAP_COUNT 0\n#define LAYER_EMISSIVEMAP_COUNT 0\n\nuniform sampler2D diffuseMap;\nuniform sampler2D detailMap;\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\n#ifdef ATMOSPHERE_ENABLED\nuniform mat4 viewTranspose: VIEWTRANSPOSE;\nuniform vec3 glowColor;\nuniform float glowPower;\nvarying vec3 v_Normal;\n#endif\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\n\n@import ecgl.common.layers.header\n\n@import ecgl.common.uv.fragmentHeader\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.util.srgb\n\nvoid main()\n{\n#ifdef SRGB_DECODE\n gl_FragColor = sRGBToLinear(color);\n#else\n gl_FragColor = color;\n#endif\n\n#ifdef VERTEX_COLOR\n gl_FragColor *= v_Color;\n#endif\n\n @import ecgl.common.albedo.main\n\n @import ecgl.common.diffuseLayer.main\n\n gl_FragColor *= albedoTexel;\n\n#ifdef ATMOSPHERE_ENABLED\n float atmoIntensity = pow(1.0 - dot(v_Normal, (viewTranspose * vec4(0.0, 0.0, 1.0, 0.0)).xyz), glowPower);\n gl_FragColor.rgb += glowColor * atmoIntensity;\n#endif\n\n @import ecgl.common.emissiveLayer.main\n\n @import ecgl.common.wireframe.fragmentMain\n\n}\n@end"),FT.import("/**\n * http: */\n\n@export ecgl.lambert.vertex\n\n@import ecgl.common.transformUniforms\n\n@import ecgl.common.uv.header\n\n\n@import ecgl.common.attributes\n\n@import ecgl.common.wireframe.vertexHeader\n\n#ifdef VERTEX_COLOR\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n#endif\n\n\n@import ecgl.common.vertexAnimation.header\n\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nvoid main()\n{\n @import ecgl.common.uv.main\n\n @import ecgl.common.vertexAnimation.main\n\n\n gl_Position = worldViewProjection * vec4(pos, 1.0);\n\n v_Normal = normalize((worldInverseTranspose * vec4(norm, 0.0)).xyz);\n v_WorldPosition = (world * vec4(pos, 1.0)).xyz;\n\n#ifdef VERTEX_COLOR\n v_Color = a_Color;\n#endif\n\n @import ecgl.common.wireframe.vertexMain\n}\n\n@end\n\n\n@export ecgl.lambert.fragment\n\n#define LAYER_DIFFUSEMAP_COUNT 0\n#define LAYER_EMISSIVEMAP_COUNT 0\n\n#define NORMAL_UP_AXIS 1\n#define NORMAL_FRONT_AXIS 2\n\n@import ecgl.common.uv.fragmentHeader\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform sampler2D diffuseMap;\nuniform sampler2D detailMap;\n\n@import ecgl.common.layers.header\n\nuniform float emissionIntensity: 1.0;\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\nuniform mat4 viewInverse : VIEWINVERSE;\n\n#ifdef ATMOSPHERE_ENABLED\nuniform mat4 viewTranspose: VIEWTRANSPOSE;\nuniform vec3 glowColor;\nuniform float glowPower;\n#endif\n\n#ifdef AMBIENT_LIGHT_COUNT\n@import clay.header.ambient_light\n#endif\n#ifdef AMBIENT_SH_LIGHT_COUNT\n@import clay.header.ambient_sh_light\n#endif\n\n#ifdef DIRECTIONAL_LIGHT_COUNT\n@import clay.header.directional_light\n#endif\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\n\n\n@import ecgl.common.ssaoMap.header\n\n@import ecgl.common.bumpMap.header\n\n@import clay.util.srgb\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.plugin.compute_shadow_map\n\nvoid main()\n{\n#ifdef SRGB_DECODE\n gl_FragColor = sRGBToLinear(color);\n#else\n gl_FragColor = color;\n#endif\n\n#ifdef VERTEX_COLOR\n #ifdef SRGB_DECODE\n gl_FragColor *= sRGBToLinear(v_Color);\n #else\n gl_FragColor *= v_Color;\n #endif\n#endif\n\n @import ecgl.common.albedo.main\n\n @import ecgl.common.diffuseLayer.main\n\n gl_FragColor *= albedoTexel;\n\n vec3 N = v_Normal;\n#ifdef DOUBLE_SIDED\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(eyePos - v_WorldPosition);\n\n if (dot(N, V) < 0.0) {\n N = -N;\n }\n#endif\n\n float ambientFactor = 1.0;\n\n#ifdef BUMPMAP_ENABLED\n N = bumpNormal(v_WorldPosition, v_Normal, N);\n ambientFactor = dot(v_Normal, N);\n#endif\n\n vec3 N2 = vec3(N.x, N[NORMAL_UP_AXIS], N[NORMAL_FRONT_AXIS]);\n\n vec3 diffuseColor = vec3(0.0, 0.0, 0.0);\n\n @import ecgl.common.ssaoMap.main\n\n#ifdef AMBIENT_LIGHT_COUNT\n for(int i = 0; i < AMBIENT_LIGHT_COUNT; i++)\n {\n diffuseColor += ambientLightColor[i] * ambientFactor * ao;\n }\n#endif\n#ifdef AMBIENT_SH_LIGHT_COUNT\n for(int _idx_ = 0; _idx_ < AMBIENT_SH_LIGHT_COUNT; _idx_++)\n {{\n diffuseColor += calcAmbientSHLight(_idx_, N2) * ambientSHLightColor[_idx_] * ao;\n }}\n#endif\n#ifdef DIRECTIONAL_LIGHT_COUNT\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];\n if(shadowEnabled)\n {\n computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);\n }\n#endif\n for(int i = 0; i < DIRECTIONAL_LIGHT_COUNT; i++)\n {\n vec3 lightDirection = -directionalLightDirection[i];\n vec3 lightColor = directionalLightColor[i];\n\n float shadowContrib = 1.0;\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n if (shadowEnabled)\n {\n shadowContrib = shadowContribsDir[i];\n }\n#endif\n\n float ndl = dot(N, normalize(lightDirection)) * shadowContrib;\n\n diffuseColor += lightColor * clamp(ndl, 0.0, 1.0);\n }\n#endif\n\n gl_FragColor.rgb *= diffuseColor;\n\n#ifdef ATMOSPHERE_ENABLED\n float atmoIntensity = pow(1.0 - dot(v_Normal, (viewTranspose * vec4(0.0, 0.0, 1.0, 0.0)).xyz), glowPower);\n gl_FragColor.rgb += glowColor * atmoIntensity;\n#endif\n\n @import ecgl.common.emissiveLayer.main\n\n @import ecgl.common.wireframe.fragmentMain\n}\n\n@end"),FT.import("@export ecgl.realistic.vertex\n\n@import ecgl.common.transformUniforms\n\n@import ecgl.common.uv.header\n\n@import ecgl.common.attributes\n\n\n@import ecgl.common.wireframe.vertexHeader\n\n#ifdef VERTEX_COLOR\nattribute vec4 a_Color : COLOR;\nvarying vec4 v_Color;\n#endif\n\n#ifdef NORMALMAP_ENABLED\nattribute vec4 tangent : TANGENT;\nvarying vec3 v_Tangent;\nvarying vec3 v_Bitangent;\n#endif\n\n@import ecgl.common.vertexAnimation.header\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nvoid main()\n{\n\n @import ecgl.common.uv.main\n\n @import ecgl.common.vertexAnimation.main\n\n gl_Position = worldViewProjection * vec4(pos, 1.0);\n\n v_Normal = normalize((worldInverseTranspose * vec4(norm, 0.0)).xyz);\n v_WorldPosition = (world * vec4(pos, 1.0)).xyz;\n\n#ifdef VERTEX_COLOR\n v_Color = a_Color;\n#endif\n\n#ifdef NORMALMAP_ENABLED\n v_Tangent = normalize((worldInverseTranspose * vec4(tangent.xyz, 0.0)).xyz);\n v_Bitangent = normalize(cross(v_Normal, v_Tangent) * tangent.w);\n#endif\n\n @import ecgl.common.wireframe.vertexMain\n\n}\n\n@end\n\n\n\n@export ecgl.realistic.fragment\n\n#define LAYER_DIFFUSEMAP_COUNT 0\n#define LAYER_EMISSIVEMAP_COUNT 0\n#define PI 3.14159265358979\n#define ROUGHNESS_CHANEL 0\n#define METALNESS_CHANEL 1\n\n#define NORMAL_UP_AXIS 1\n#define NORMAL_FRONT_AXIS 2\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\n\n@import ecgl.common.uv.fragmentHeader\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform sampler2D diffuseMap;\n\nuniform sampler2D detailMap;\nuniform sampler2D metalnessMap;\nuniform sampler2D roughnessMap;\n\n@import ecgl.common.layers.header\n\nuniform float emissionIntensity: 1.0;\n\nuniform vec4 color : [1.0, 1.0, 1.0, 1.0];\n\nuniform float metalness : 0.0;\nuniform float roughness : 0.5;\n\nuniform mat4 viewInverse : VIEWINVERSE;\n\n#ifdef ATMOSPHERE_ENABLED\nuniform mat4 viewTranspose: VIEWTRANSPOSE;\nuniform vec3 glowColor;\nuniform float glowPower;\n#endif\n\n#ifdef AMBIENT_LIGHT_COUNT\n@import clay.header.ambient_light\n#endif\n\n#ifdef AMBIENT_SH_LIGHT_COUNT\n@import clay.header.ambient_sh_light\n#endif\n\n#ifdef AMBIENT_CUBEMAP_LIGHT_COUNT\n@import clay.header.ambient_cubemap_light\n#endif\n\n#ifdef DIRECTIONAL_LIGHT_COUNT\n@import clay.header.directional_light\n#endif\n\n@import ecgl.common.normalMap.fragmentHeader\n\n@import ecgl.common.ssaoMap.header\n\n@import ecgl.common.bumpMap.header\n\n@import clay.util.srgb\n\n@import clay.util.rgbm\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.plugin.compute_shadow_map\n\nvec3 F_Schlick(float ndv, vec3 spec) {\n return spec + (1.0 - spec) * pow(1.0 - ndv, 5.0);\n}\n\nfloat D_Phong(float g, float ndh) {\n float a = pow(8192.0, g);\n return (a + 2.0) / 8.0 * pow(ndh, a);\n}\n\nvoid main()\n{\n vec4 albedoColor = color;\n\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(eyePos - v_WorldPosition);\n#ifdef VERTEX_COLOR\n #ifdef SRGB_DECODE\n albedoColor *= sRGBToLinear(v_Color);\n #else\n albedoColor *= v_Color;\n #endif\n#endif\n\n @import ecgl.common.albedo.main\n\n @import ecgl.common.diffuseLayer.main\n\n albedoColor *= albedoTexel;\n\n float m = metalness;\n\n#ifdef METALNESSMAP_ENABLED\n float m2 = texture2D(metalnessMap, v_DetailTexcoord)[METALNESS_CHANEL];\n m = clamp(m2 + (m - 0.5) * 2.0, 0.0, 1.0);\n#endif\n\n vec3 baseColor = albedoColor.rgb;\n albedoColor.rgb = baseColor * (1.0 - m);\n vec3 specFactor = mix(vec3(0.04), baseColor, m);\n\n float g = 1.0 - roughness;\n\n#ifdef ROUGHNESSMAP_ENABLED\n float g2 = 1.0 - texture2D(roughnessMap, v_DetailTexcoord)[ROUGHNESS_CHANEL];\n g = clamp(g2 + (g - 0.5) * 2.0, 0.0, 1.0);\n#endif\n\n vec3 N = v_Normal;\n\n#ifdef DOUBLE_SIDED\n if (dot(N, V) < 0.0) {\n N = -N;\n }\n#endif\n\n float ambientFactor = 1.0;\n\n#ifdef BUMPMAP_ENABLED\n N = bumpNormal(v_WorldPosition, v_Normal, N);\n ambientFactor = dot(v_Normal, N);\n#endif\n\n@import ecgl.common.normalMap.fragmentMain\n\n vec3 N2 = vec3(N.x, N[NORMAL_UP_AXIS], N[NORMAL_FRONT_AXIS]);\n\n vec3 diffuseTerm = vec3(0.0);\n vec3 specularTerm = vec3(0.0);\n\n float ndv = clamp(dot(N, V), 0.0, 1.0);\n vec3 fresnelTerm = F_Schlick(ndv, specFactor);\n\n @import ecgl.common.ssaoMap.main\n\n#ifdef AMBIENT_LIGHT_COUNT\n for(int _idx_ = 0; _idx_ < AMBIENT_LIGHT_COUNT; _idx_++)\n {{\n diffuseTerm += ambientLightColor[_idx_] * ambientFactor * ao;\n }}\n#endif\n\n#ifdef AMBIENT_SH_LIGHT_COUNT\n for(int _idx_ = 0; _idx_ < AMBIENT_SH_LIGHT_COUNT; _idx_++)\n {{\n diffuseTerm += calcAmbientSHLight(_idx_, N2) * ambientSHLightColor[_idx_] * ao;\n }}\n#endif\n\n#ifdef DIRECTIONAL_LIGHT_COUNT\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];\n if(shadowEnabled)\n {\n computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);\n }\n#endif\n for(int _idx_ = 0; _idx_ < DIRECTIONAL_LIGHT_COUNT; _idx_++)\n {{\n vec3 L = -directionalLightDirection[_idx_];\n vec3 lc = directionalLightColor[_idx_];\n\n vec3 H = normalize(L + V);\n float ndl = clamp(dot(N, normalize(L)), 0.0, 1.0);\n float ndh = clamp(dot(N, H), 0.0, 1.0);\n\n float shadowContrib = 1.0;\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n if (shadowEnabled)\n {\n shadowContrib = shadowContribsDir[_idx_];\n }\n#endif\n\n vec3 li = lc * ndl * shadowContrib;\n\n diffuseTerm += li;\n specularTerm += li * fresnelTerm * D_Phong(g, ndh);\n }}\n#endif\n\n\n#ifdef AMBIENT_CUBEMAP_LIGHT_COUNT\n vec3 L = reflect(-V, N);\n L = vec3(L.x, L[NORMAL_UP_AXIS], L[NORMAL_FRONT_AXIS]);\n float rough2 = clamp(1.0 - g, 0.0, 1.0);\n float bias2 = rough2 * 5.0;\n vec2 brdfParam2 = texture2D(ambientCubemapLightBRDFLookup[0], vec2(rough2, ndv)).xy;\n vec3 envWeight2 = specFactor * brdfParam2.x + brdfParam2.y;\n vec3 envTexel2;\n for(int _idx_ = 0; _idx_ < AMBIENT_CUBEMAP_LIGHT_COUNT; _idx_++)\n {{\n envTexel2 = RGBMDecode(textureCubeLodEXT(ambientCubemapLightCubemap[_idx_], L, bias2), 8.12);\n specularTerm += ambientCubemapLightColor[_idx_] * envTexel2 * envWeight2 * ao;\n }}\n#endif\n\n gl_FragColor.rgb = albedoColor.rgb * diffuseTerm + specularTerm;\n gl_FragColor.a = albedoColor.a;\n\n#ifdef ATMOSPHERE_ENABLED\n float atmoIntensity = pow(1.0 - dot(v_Normal, (viewTranspose * vec4(0.0, 0.0, 1.0, 0.0)).xyz), glowPower);\n gl_FragColor.rgb += glowColor * atmoIntensity;\n#endif\n\n#ifdef SRGB_ENCODE\n gl_FragColor = linearTosRGB(gl_FragColor);\n#endif\n\n @import ecgl.common.emissiveLayer.main\n\n @import ecgl.common.wireframe.fragmentMain\n}\n\n@end"),FT.import("@export ecgl.hatching.vertex\n\n@import ecgl.realistic.vertex\n\n@end\n\n\n@export ecgl.hatching.fragment\n\n#define NORMAL_UP_AXIS 1\n#define NORMAL_FRONT_AXIS 2\n\n@import ecgl.common.uv.fragmentHeader\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform vec4 color : [0.0, 0.0, 0.0, 1.0];\nuniform vec4 paperColor : [1.0, 1.0, 1.0, 1.0];\n\nuniform mat4 viewInverse : VIEWINVERSE;\n\n#ifdef AMBIENT_LIGHT_COUNT\n@import clay.header.ambient_light\n#endif\n#ifdef AMBIENT_SH_LIGHT_COUNT\n@import clay.header.ambient_sh_light\n#endif\n\n#ifdef DIRECTIONAL_LIGHT_COUNT\n@import clay.header.directional_light\n#endif\n\n#ifdef VERTEX_COLOR\nvarying vec4 v_Color;\n#endif\n\n\n@import ecgl.common.ssaoMap.header\n\n@import ecgl.common.bumpMap.header\n\n@import clay.util.srgb\n\n@import ecgl.common.wireframe.fragmentHeader\n\n@import clay.plugin.compute_shadow_map\n\nuniform sampler2D hatch1;\nuniform sampler2D hatch2;\nuniform sampler2D hatch3;\nuniform sampler2D hatch4;\nuniform sampler2D hatch5;\nuniform sampler2D hatch6;\n\nfloat shade(in float tone) {\n vec4 c = vec4(1. ,1., 1., 1.);\n float step = 1. / 6.;\n vec2 uv = v_DetailTexcoord;\n if (tone <= step / 2.0) {\n c = mix(vec4(0.), texture2D(hatch6, uv), 12. * tone);\n }\n else if (tone <= step) {\n c = mix(texture2D(hatch6, uv), texture2D(hatch5, uv), 6. * tone);\n }\n if(tone > step && tone <= 2. * step){\n c = mix(texture2D(hatch5, uv), texture2D(hatch4, uv) , 6. * (tone - step));\n }\n if(tone > 2. * step && tone <= 3. * step){\n c = mix(texture2D(hatch4, uv), texture2D(hatch3, uv), 6. * (tone - 2. * step));\n }\n if(tone > 3. * step && tone <= 4. * step){\n c = mix(texture2D(hatch3, uv), texture2D(hatch2, uv), 6. * (tone - 3. * step));\n }\n if(tone > 4. * step && tone <= 5. * step){\n c = mix(texture2D(hatch2, uv), texture2D(hatch1, uv), 6. * (tone - 4. * step));\n }\n if(tone > 5. * step){\n c = mix(texture2D(hatch1, uv), vec4(1.), 6. * (tone - 5. * step));\n }\n\n return c.r;\n}\n\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\n\nvoid main()\n{\n#ifdef SRGB_DECODE\n vec4 inkColor = sRGBToLinear(color);\n#else\n vec4 inkColor = color;\n#endif\n\n#ifdef VERTEX_COLOR\n #ifdef SRGB_DECODE\n inkColor *= sRGBToLinear(v_Color);\n #else\n inkColor *= v_Color;\n #endif\n#endif\n\n vec3 N = v_Normal;\n#ifdef DOUBLE_SIDED\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(eyePos - v_WorldPosition);\n\n if (dot(N, V) < 0.0) {\n N = -N;\n }\n#endif\n\n float tone = 0.0;\n\n float ambientFactor = 1.0;\n\n#ifdef BUMPMAP_ENABLED\n N = bumpNormal(v_WorldPosition, v_Normal, N);\n ambientFactor = dot(v_Normal, N);\n#endif\n\n vec3 N2 = vec3(N.x, N[NORMAL_UP_AXIS], N[NORMAL_FRONT_AXIS]);\n\n @import ecgl.common.ssaoMap.main\n\n#ifdef AMBIENT_LIGHT_COUNT\n for(int i = 0; i < AMBIENT_LIGHT_COUNT; i++)\n {\n tone += dot(ambientLightColor[i], w) * ambientFactor * ao;\n }\n#endif\n#ifdef AMBIENT_SH_LIGHT_COUNT\n for(int _idx_ = 0; _idx_ < AMBIENT_SH_LIGHT_COUNT; _idx_++)\n {{\n tone += dot(calcAmbientSHLight(_idx_, N2) * ambientSHLightColor[_idx_], w) * ao;\n }}\n#endif\n#ifdef DIRECTIONAL_LIGHT_COUNT\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n float shadowContribsDir[DIRECTIONAL_LIGHT_COUNT];\n if(shadowEnabled)\n {\n computeShadowOfDirectionalLights(v_WorldPosition, shadowContribsDir);\n }\n#endif\n for(int i = 0; i < DIRECTIONAL_LIGHT_COUNT; i++)\n {\n vec3 lightDirection = -directionalLightDirection[i];\n float lightTone = dot(directionalLightColor[i], w);\n\n float shadowContrib = 1.0;\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n if (shadowEnabled)\n {\n shadowContrib = shadowContribsDir[i];\n }\n#endif\n\n float ndl = dot(N, normalize(lightDirection)) * shadowContrib;\n\n tone += lightTone * clamp(ndl, 0.0, 1.0);\n }\n#endif\n\n gl_FragColor = mix(inkColor, paperColor, shade(clamp(tone, 0.0, 1.0)));\n }\n@end\n"),FT.import("@export ecgl.sm.depth.vertex\n\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\n\n#ifdef VERTEX_ANIMATION\nattribute vec3 prevPosition;\nuniform float percent : 1.0;\n#endif\n\nvarying vec4 v_ViewPosition;\nvarying vec2 v_Texcoord;\n\nvoid main(){\n\n#ifdef VERTEX_ANIMATION\n vec3 pos = mix(prevPosition, position, percent);\n#else\n vec3 pos = position;\n#endif\n\n v_ViewPosition = worldViewProjection * vec4(pos, 1.0);\n gl_Position = v_ViewPosition;\n\n v_Texcoord = texcoord;\n\n}\n@end\n\n\n\n@export ecgl.sm.depth.fragment\n\n@import clay.sm.depth.fragment\n\n@end");var gA=tM.prototype.addToScene,mA=tM.prototype.removeFromScene;tM.prototype.addToScene=function(t){var e;gA.call(this,t),this.__zr&&(e=this.__zr,t.traverse((function(t){t.__zr=e,t.addAnimatorsToZr&&t.addAnimatorsToZr(e)})))},tM.prototype.removeFromScene=function(t){mA.call(this,t),t.traverse((function(t){var e=t.__zr;t.__zr=null,e&&t.removeAnimatorsFromZr&&t.removeAnimatorsFromZr(e)}))},oT.prototype.setTextureImage=function(t,e,n,r){if(this.shader){var i,o,a=n.getZr(),s=this;return s.autoUpdateTextureStatus=!1,s.disableTexture(t),(o=e)&&"none"!==o&&(i=yA.loadTexture(e,n,r,(function(e){s.enableTexture(t),a&&a.refresh()})),s.set(t,i)),i}};var yA={};yA.Renderer=nw,yA.Node=eS,yA.Mesh=fS,yA.Shader=FT,yA.Material=oT,yA.Texture=pS,yA.Texture2D=_S,yA.Geometry=tr,yA.SphereGeometry=IS,yA.PlaneGeometry=vM,yA.CubeGeometry=TM,yA.AmbientLight=$r,yA.DirectionalLight=ur,yA.PointLight=yS,yA.SpotLight=Pu,yA.PerspectiveCamera=oM,yA.OrthographicCamera=ZM,yA.Vector2=hT,yA.Vector3=fw,yA.Vector4=S,yA.Quaternion=Vw,yA.Matrix2=Ql,yA.Matrix2d=M,yA.Matrix3=pA,yA.Matrix4=Ow,yA.Plane=BS,yA.Ray=mw,yA.BoundingBox=Qw,yA.Frustum=jS;var _A=kM.createBlank("rgba(255,255,255,0)").image;function vA(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))}function xA(t){var e,n,r;t.wrapS!==pS.REPEAT&&t.wrapT!==pS.REPEAT||!t.image||(e=vA(t.width),n=vA(t.height),e===t.width&&n===t.height||((r=document.createElement("canvas")).width=e,r.height=n,r.getContext("2d").drawImage(t.image,0,0,e,n),t.image=r))}yA.loadTexture=function(t,e,n,r){"function"==typeof n&&(r=n,n={}),n=n||{};for(var i=Object.keys(n).sort(),o="",a=0;a<i.length;a++)o+=i[a]+"_"+n[i[a]]+"_";var s=e.__textureCache=e.__textureCache||new Ve(20);if((u=t).getZr&&u.setOption){var l=t.__textureid__;if(h=s.get(o+l))h.texture.surface.setECharts(t),r&&r(h.texture);else{var u=new YM(t);for(u.onupdate=function(){e.getZr().refresh()},h={texture:u.getTexture()},a=0;a<i.length;a++)h.texture[i[a]]=n[i[a]];l=t.__textureid__||"__ecgl_ec__"+h.texture.__uid__,t.__textureid__=l,s.put(o+l,h),r&&r(h.texture)}return h.texture}if(fA(t)){var h;l=t.__textureid__;if(!(h=s.get(o+l))){for(h={texture:new yA.Texture2D({image:t})},a=0;a<i.length;a++)h.texture[i[a]]=n[i[a]];l=t.__textureid__||"__ecgl_image__"+h.texture.__uid__,t.__textureid__=l,s.put(o+l,h),xA(h.texture),r&&r(h.texture)}return h.texture}if(h=s.get(o+t))h.callbacks?h.callbacks.push(r):r&&r(h.texture);else if(t.match(/.hdr$|^data:application\/octet-stream/)){h={callbacks:[r]};var c=kM.loadTexture(t,{exposure:n.exposure,fileType:"hdr"},(function(){c.dirty(),h.callbacks.forEach((function(t){t&&t(c)})),h.callbacks=null}));h.texture=c,s.put(o+t,h)}else{for(c=new yA.Texture2D({image:new Image}),a=0;a<i.length;a++)c[i[a]]=n[i[a]];h={texture:c,callbacks:[r]};var d=c.image;d.onload=function(){c.image=d,xA(c),c.dirty(),h.callbacks.forEach((function(t){t&&t(c)})),h.callbacks=null},d.crossOrigin="Anonymous",d.src=t,c.image=_A,s.put(o+t,h)}return h.texture},yA.createAmbientCubemap=function(t,e,n,r){var i=(t=t||{}).texture,o=sA.firstNotNull(t.exposure,1),a=new eA({intensity:sA.firstNotNull(t.specularIntensity,1)}),s=new nA({intensity:sA.firstNotNull(t.diffuseIntensity,1),coefficients:[.844,.712,.691,-.037,.083,.167,.343,.288,.299,-.041,-.021,-.009,-.003,-.041,-.064,-.011,-.007,-.004,-.031,.034,.081,-.06,-.049,-.06,.046,.056,.05]});return a.cubemap=yA.loadTexture(i,n,{exposure:o},(function(){a.cubemap.flipY=!1,a.prefilter(e,32),s.coefficients=aA.projectEnvironmentMap(e,a.cubemap,{lod:1}),r&&r()})),{specular:a,diffuse:s}},yA.createBlankTexture=kM.createBlank,yA.isImage=fA,yA.additiveBlend=function(t){t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE)},yA.parseColor=function(t,e){return t instanceof Array?((e=e||[])[0]=t[0],e[1]=t[1],e[2]=t[2],3<t.length?e[3]=t[3]:e[3]=1):((e=r.parse(t||"#000",e)||[0,0,0,0])[0]/=255,e[1]/=255,e[2]/=255),e},yA.directionFromAlphaBeta=function(t,e){var n=t/180*Math.PI+Math.PI/2,r=-e/180*Math.PI+Math.PI/2;t=[],e=Math.sin(n);return t[0]=e*Math.cos(r),t[1]=-Math.cos(n),t[2]=e*Math.sin(r),t},yA.getShadowResolution=function(t){var e=1024;switch(t){case"low":e=512;break;case"medium":break;case"high":e=2048;break;case"ultra":e=4096}return e},yA.COMMON_SHADERS=["lambert","color","realistic","hatching","shadow"],yA.createShader=function(t){var e=FT.source((t="ecgl.shadow"===t?"ecgl.displayShadow":t)+".vertex"),n=FT.source(t+".fragment");return e||console.error("Vertex shader of '%s' not exits",t),n||console.error("Fragment shader of '%s' not exits",t),n=new FT(e,n),n.name=t,n},yA.createMaterial=function(t,e){e instanceof Array||(e=[e]);t=yA.createShader(t);var n=new oT({shader:t});return e.forEach((function(t){"string"==typeof t&&n.define(t)})),n},yA.setMaterialFromModel=function(t,e,n,r){e.autoUpdateTextureStatus=!1;var i=n.getModel(t+"Material"),o=i.get("detailTexture"),a=sA.firstNotNull(i.get("textureTiling"),1),s=sA.firstNotNull(i.get("textureOffset"),0);"number"==typeof s&&(s=[s,s]);var l=1<(a="number"==typeof a?[a,a]:a)[0]||1<a[1]?yA.Texture.REPEAT:yA.Texture.CLAMP_TO_EDGE,u={anisotropic:8,wrapS:l,wrapT:l};if("realistic"===t){var h=i.get("roughness");n=i.get("metalness");null!=n?isNaN(n)&&(e.setTextureImage("metalnessMap",n,r,u),n=sA.firstNotNull(i.get("metalnessAdjust"),.5)):n=0,null!=h?isNaN(h)&&(e.setTextureImage("roughnessMap",h,r,u),h=sA.firstNotNull(i.get("roughnessAdjust"),.5)):h=.5,l=i.get("normalTexture"),e.setTextureImage("detailMap",o,r,u),e.setTextureImage("normalMap",l,r,u),e.set({roughness:h,metalness:n,detailUvRepeat:a,detailUvOffset:s})}else if("lambert"===t)e.setTextureImage("detailMap",o,r,u),e.set({detailUvRepeat:a,detailUvOffset:s});else if("color"===t)e.setTextureImage("detailMap",o,r,u),e.set({detailUvRepeat:a,detailUvOffset:s});else if("hatching"===t){var c=i.get("hatchingTextures")||[];c.length;for(var d=0;d<6;d++)e.setTextureImage("hatch"+(d+1),c[d],r,{anisotropic:8,wrapS:yA.Texture.REPEAT,wrapT:yA.Texture.REPEAT});e.set({detailUvRepeat:a,detailUvOffset:s})}},yA.updateVertexAnimation=function(t,e,n,r){var i=r.get("animation"),o=r.get("animationDurationUpdate"),a=(r=r.get("animationEasingUpdate"),n.shadowDepthMaterial);if(i&&e&&0<o&&e.geometry.vertexCount===n.geometry.vertexCount){n.material.define("vertex","VERTEX_ANIMATION"),n.ignorePreZ=!0,a&&a.define("vertex","VERTEX_ANIMATION");for(var s=0;s<t.length;s++)n.geometry.attributes[t[s][0]].value=e.geometry.attributes[t[s][1]].value;n.geometry.dirty(),n.__percent=0,n.material.set("percent",0),n.stopAnimation(),n.animate().when(o,{__percent:1}).during((function(){n.material.set("percent",n.__percent),a&&a.set("percent",n.__percent)})).done((function(){n.ignorePreZ=!1,n.material.undefine("vertex","VERTEX_ANIMATION"),a&&a.undefine("vertex","VERTEX_ANIMATION")})).start(r)}else n.material.undefine("vertex","VERTEX_ANIMATION"),a&&a.undefine("vertex","VERTEX_ANIMATION")};var bA=yA;M=function(t,e){this.id=t,this.zr=e;try{this.renderer=new nw({clearBit:0,devicePixelRatio:e.painter.dpr,preserveDrawingBuffer:!0,premultipliedAlpha:!0}),this.renderer.resize(e.painter.getWidth(),e.painter.getHeight())}catch(t){return this.renderer=null,this.dom=document.createElement("div"),this.dom.style.cssText="position:absolute; left: 0; top: 0; right: 0; bottom: 0;",this.dom.className="ecgl-nowebgl",this.dom.innerHTML="Sorry, your browser does not support WebGL",void console.error(t)}this.onglobalout=this.onglobalout.bind(this),e.on("globalout",this.onglobalout),this.dom=this.renderer.canvas,e=this.dom.style,e.position="absolute",e.left="0",e.top="0",this.views=[],this._picking=new uS({renderer:this.renderer}),this._viewsToDispose=[],this._accumulatingId=0,this._zrEventProxy=new s.Rect({shape:{x:-1,y:-1,width:2,height:2},__isGLToZRProxy:!0}),this._backgroundColor=null};function TA(t){var e=t.__zr;t.__zr=null,e&&t.removeAnimatorsFromZr&&t.removeAnimatorsFromZr(e)}M.prototype.setUnpainted=function(){},M.prototype.addView=function(t){var e,n;t.layer!==this&&(0<=(e=this._viewsToDispose.indexOf(t))&&this._viewsToDispose.splice(e,1),this.views.push(t),n=(t.layer=this).zr,t.scene.traverse((function(t){t.__zr=n,t.addAnimatorsToZr&&t.addAnimatorsToZr(n)})))},M.prototype.removeView=function(t){var e;t.layer!==this||0<=(e=this.views.indexOf(t))&&(this.views.splice(e,1),t.scene.traverse(TA,this),t.layer=null,this._viewsToDispose.push(t))},M.prototype.removeViewsAll=function(){this.views.forEach((function(t){t.scene.traverse(TA,this),t.layer=null,this._viewsToDispose.push(t)}),this),this.views.length=0},M.prototype.resize=function(t,e){this.renderer.resize(t,e)},M.prototype.clear=function(){var t=this.renderer.gl,e=this._backgroundColor||[0,0,0,0];t.clearColor(e[0],e[1],e[2],e[3]),t.depthMask(!0),t.colorMask(!0,!0,!0,!0),t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT)},M.prototype.clearDepth=function(){var t=this.renderer.gl;t.clear(t.DEPTH_BUFFER_BIT)},M.prototype.clearColor=function(){var t=this.renderer.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},M.prototype.needsRefresh=function(){this.zr.refresh()},M.prototype.refresh=function(t){this._backgroundColor=t?bA.parseColor(t):[0,0,0,0],this.renderer.clearColor=this._backgroundColor;for(var e=0;e<this.views.length;e++)this.views[e].prepareRender(this.renderer);for(this._doRender(!1),this._trackAndClean(),e=0;e<this._viewsToDispose.length;e++)this._viewsToDispose[e].dispose(this.renderer);this._viewsToDispose.length=0,this._startAccumulating()},M.prototype.renderToCanvas=function(t){this._startAccumulating(!0),t.drawImage(this.dom,0,0,t.canvas.width,t.canvas.height)},M.prototype._doRender=function(t){this.clear(),this.renderer.saveViewport();for(var e=0;e<this.views.length;e++)this.views[e].render(this.renderer,t);this.renderer.restoreViewport()},M.prototype._stopAccumulating=function(){this._accumulatingId=0,clearTimeout(this._accumulatingTimeout)};var wA=1;function SA(t){for(var e=0;e<t.length;e++)t[e].__used__=0}function MA(t,e){for(var n=0;n<e.length;n++)e[n].__used__||e[n].dispose(t)}function AA(t,e){t.__used__=t.__used__||0,t.__used__++,1===t.__used__&&e.push(t)}M.prototype._startAccumulating=function(t){var e=this;this._stopAccumulating();for(var n=!1,r=0;r<this.views.length;r++)n=this.views[r].needsAccumulate()||n;function i(r){if(e._accumulatingId&&r===e._accumulatingId){for(var o=!0,a=0;a<e.views.length;a++)o=e.views[a].isAccumulateFinished()&&n;o||(e._doRender(!0),t?i(r):Ir((function(){i(r)})))}}n&&(this._accumulatingId=wA++,t?i(e._accumulatingId):this._accumulatingTimeout=setTimeout((function(){i(e._accumulatingId)}),50))},M.prototype._trackAndClean=function(){var t=[],e=[];this._textureList&&(SA(this._textureList),SA(this._geometriesList));for(var n=0;n<this.views.length;n++)!function(t,e,n){var r,i;t.traverse((function(t){if(t.isRenderable()){var o=t.geometry,a=t.material;if(a!==r)for(var s=a.getTextureUniforms(),l=0;l<s.length;l++){var u=s[l],h=a.uniforms[u].value;if(h)if(h instanceof pS)AA(h,e);else if(h instanceof Array)for(var c=0;c<h.length;c++)h[c]instanceof pS&&AA(h[c],e)}o!==i&&AA(o,n),r=a,i=o}}));for(var o=0;o<t.lights.length;o++)t.lights[o].cubemap&&AA(t.lights[o].cubemap,e)}(this.views[n].scene,t,e);this._textureList&&(MA(this.renderer,this._textureList),MA(this.renderer,this._geometriesList)),this._textureList=t,this._geometriesList=e},M.prototype.dispose=function(){this._stopAccumulating(),this.renderer.disposeScene(this.scene),this.zr.off("globalout",this.onglobalout)},M.prototype.onmousedown=function(t){var e;t.target&&t.target.__isGLToZRProxy||(t=t.event,(e=this.pickObject(t.offsetX,t.offsetY))&&(this._dispatchEvent("mousedown",t,e),this._dispatchDataEvent("mousedown",t,e)),this._downX=t.offsetX,this._downY=t.offsetY)},M.prototype.onmousemove=function(t){var e,n,r;t.target&&t.target.__isGLToZRProxy||(t=t.event,n=(e=this.pickObject(t.offsetX,t.offsetY))&&e.target,r=this._hovered,this._hovered=e,r&&n!==r.target&&(r.relatedTarget=n,this._dispatchEvent("mouseout",t,r),this.zr.setCursorStyle("default")),this._dispatchEvent("mousemove",t,e),e&&(this.zr.setCursorStyle("pointer"),r&&n===r.target||this._dispatchEvent("mouseover",t,e)),this._dispatchDataEvent("mousemove",t,e))},M.prototype.onmouseup=function(t){var e;t.target&&t.target.__isGLToZRProxy||(t=t.event,(e=this.pickObject(t.offsetX,t.offsetY))&&(this._dispatchEvent("mouseup",t,e),this._dispatchDataEvent("mouseup",t,e)),this._upX=t.offsetX,this._upY=t.offsetY)},M.prototype.onclick=M.prototype.dblclick=function(t){var e,n;t.target&&t.target.__isGLToZRProxy||(e=this._upX-this._downX,n=this._upY-this._downY,20<Math.sqrt(e*e+n*n)||(t=t.event,(n=this.pickObject(t.offsetX,t.offsetY))&&(this._dispatchEvent(t.type,t,n),this._dispatchDataEvent(t.type,t,n)),(t=this._clickToSetFocusPoint(t))&&t.view.setDOFFocusOnPoint(t.distance)&&this.zr.refresh()))},M.prototype._clickToSetFocusPoint=function(t){for(var e=this.renderer,n=e.viewport,r=this.views.length-1;0<=r;r--){var i=this.views[r];if(i.hasDOF()&&i.containPoint(t.offsetX,t.offsetY)){this._picking.scene=i.scene,this._picking.camera=i.camera,e.viewport=i.viewport;var o=this._picking.pick(t.offsetX,t.offsetY,!0);if(o)return o.view=i,o}}e.viewport=n},M.prototype.onglobalout=function(t){var e=this._hovered;e&&this._dispatchEvent("mouseout",t,{target:e.target})},M.prototype.pickObject=function(t,e){for(var n=[],r=this.renderer,i=r.viewport,o=0;o<this.views.length;o++){var a=this.views[o];a.containPoint(t,e)&&(this._picking.scene=a.scene,this._picking.camera=a.camera,r.viewport=a.viewport,this._picking.pickAll(t,e,n))}return r.viewport=i,n.sort((function(t,e){return t.distance-e.distance})),n[0]},M.prototype._dispatchEvent=function(t,e,n){var r=(n=n||{}).target;for(n.cancelBubble=!1,n.event=e,n.type=t,n.offsetX=e.offsetX,n.offsetY=e.offsetY;r&&(r.trigger(t,n),r=r.getParent(),!n.cancelBubble););this._dispatchToView(t,n)},M.prototype._dispatchDataEvent=function(t,e,n){var r=n&&n.target,i=r&&r.dataIndex,a=r&&r.seriesIndex,s=r&&r.eventData,l=!1;n=this._zrEventProxy;n.x=e.offsetX,n.y=e.offsetY,n.update(),r={target:n};const u=o.getECData(n);"mousemove"===t&&(null!=i?i!==this._lastDataIndex&&(0<=parseInt(this._lastDataIndex,10)&&(u.dataIndex=this._lastDataIndex,u.seriesIndex=this._lastSeriesIndex,this.zr.handler.dispatchToElement(r,"mouseout",e)),l=!0):null!=s&&s!==this._lastEventData&&(null!=this._lastEventData&&(u.eventData=this._lastEventData,this.zr.handler.dispatchToElement(r,"mouseout",e)),l=!0),this._lastEventData=s,this._lastDataIndex=i,this._lastSeriesIndex=a),u.eventData=s,u.dataIndex=i,u.seriesIndex=a,(null!=s||0<=parseInt(i,10)&&0<=parseInt(a,10))&&(this.zr.handler.dispatchToElement(r,t,e),l&&this.zr.handler.dispatchToElement(r,"mouseover",e))},M.prototype._dispatchToView=function(t,e){for(var n=0;n<this.views.length;n++)this.views[n].containPoint(e.offsetX,e.offsetY)&&this.views[n].trigger(t,e)},Object.assign(M.prototype,f);var CA=M,EA=["bar3D","line3D","map3D","scatter3D","surface","lines3D","scatterGL","scatter3D"];function IA(t,e){var n,r;t&&t[e]&&(t[e].normal||t[e].emphasis)&&(n=t[e].normal,r=t[e].emphasis,n&&(t[e]=n),r&&(t.emphasis=t.emphasis||{},t.emphasis[e]=r))}function DA(t){t&&(t instanceof Array||(t=[t]),l.each(t,(function(t){t.axisLabel&&(t=t.axisLabel,Object.assign(t,t.textStyle),t.textStyle=null)})))}function RA(t){this._layers={},this._zr=t}function LA(t,e){t.id=t.id||t.name||e+""}RA.prototype.update=function(t,e){var n=this,r=e.getZr();if(r.getWidth()&&r.getHeight()){for(var i in this._layers)this._layers[i].removeViewsAll();t.eachComponent((function(n,r){if("series"!==n){var i=e.getViewOfComponentModel(r);n=r.coordinateSystem;if(i.__ecgl__){if(n){if(!n.viewGL)return void console.error("Can't find viewGL in coordinateSystem of component "+r.id);s=n.viewGL}else{if(!r.viewGL)return void console.error("Can't find viewGL of component "+r.id);s=n.viewGL}var s=n.viewGL;n=o(r);n.addView(s),i.afterRender&&i.afterRender(r,t,e,n),a(i.groupGL,r.get("silent"))}}})),t.eachSeries((function(n){var r,i=e.getViewOfSeriesModel(n),s=n.coordinateSystem;i.__ecgl__&&(!s||s.viewGL||i.viewGL?(r=s&&s.viewGL||i.viewGL,(s=o(n)).addView(r),i.afterRender&&i.afterRender(n,t,e,s),a(i.groupGL,n.get("silent"))):console.error("Can't find viewGL of series "+i.id))}))}else console.warn("Dom has no width or height");function o(t){r.setSleepAfterStill(0);var e=(t.coordinateSystem&&t.coordinateSystem.model,t.get("zlevel")),i=n._layers;t=i[e];return t||(t=i[e]=new CA("gl-"+e,r),r.painter.isSingleCanvas()&&(t.virtual=!0,i=new s.Image({z:1e4,style:{image:t.renderer.canvas},silent:!0}),t.__hostImage=i,r.add(i)),r.painter.insertLayer(e,t)),t.__hostImage&&t.__hostImage.setStyle({width:t.renderer.getWidth(),height:t.renderer.getHeight()}),t}function a(t,e){t&&t.traverse((function(t){t.isRenderable&&t.isRenderable()&&(t.ignorePicking=null!=t.$ignorePicking?t.$ignorePicking:e)}))}},O_((function(t){t.getZr().painter.getRenderedCanvas=function(t){if(t=t||{},this._singleCanvas)return this._layers[0].dom;var e=document.createElement("canvas"),n=t.pixelRatio||this.dpr;e.width=this.getWidth()*n,e.height=this.getHeight()*n;var r=e.getContext("2d");r.dpr=n,r.clearRect(0,0,e.width,e.height),t.backgroundColor&&(r.fillStyle=t.backgroundColor,r.fillRect(0,0,e.width,e.height));var i,o=this.storage.getDisplayList(!0),a={},s=this;function l(t,e){var n,i=s._zlevelList;null==t&&(t=-1/0);for(var o=0;o<i.length;o++){var a=i[o],l=s._layers[a];if(!l.__builtin__&&t<a&&a<e){n=l;break}}n&&n.renderToCanvas&&(r.save(),n.renderToCanvas(r),r.restore())}for(var u={ctx:r},h=0;h<o.length;h++){var c=o[h];c.zlevel!==i&&(l(i,c.zlevel),i=c.zlevel),this._doPaintEl(c,u,!0,null,a)}return l(i,1/0),e}})),P_((function(t,e){var n=e.getZr();(n.__egl=n.__egl||new RA(n)).update(t,e)})),R_((function(t){l.each(t.series,(function(e){var n;0<=l.indexOf(EA,e.type)&&(IA(n=e,"itemStyle"),IA(n,"lineStyle"),IA(n,"areaStyle"),IA(n,"label"),"mapbox"===e.coordinateSystem&&(e.coordinateSystem="mapbox3D",t.mapbox3D=t.mapbox))})),DA(t.xAxis3D),DA(t.yAxis3D),DA(t.zAxis3D),DA(t.grid3D),IA(t.geo3D)}));var OA=Ld.extend({type:"globe",layoutMode:"box",coordinateSystem:null,init:function(){OA.superApply(this,"init",arguments),l.each(this.option.layers,(function(t,e){l.merge(t,this.defaultLayerOption),LA(t,e)}),this)},mergeOption:function(t){var e=this.option.layers;function n(t){return l.reduce(t,(function(t,e,n){return LA(e,n),t[e.id]=e,t}),{})}if(this.option.layers=null,OA.superApply(this,"mergeOption",arguments),e&&e.length){var r,i=n(t.layers),o=n(e);for(r in i)o[r]?l.merge(o[r],i[r],!0):e.push(t.layers[r]);this.option.layers=e}l.each(this.option.layers,(function(t){l.merge(t,this.defaultLayerOption)}),this)},optionUpdated:function(){this.updateDisplacementHash()},defaultLayerOption:{show:!0,type:"overlay"},defaultOption:{show:!0,zlevel:-10,left:0,top:0,width:"100%",height:"100%",environment:"auto",baseColor:"#fff",baseTexture:"",heightTexture:"",displacementTexture:"",displacementScale:0,displacementQuality:"medium",globeRadius:100,globeOuterRadius:150,shading:"lambert",light:{main:{time:""}},atmosphere:{show:!1,offset:5,color:"#ffffff",glowPower:6,innerGlowPower:2},viewControl:{autoRotate:!0,panSensitivity:0,targetCoord:null},layers:[]},setDisplacementData:function(t,e,n){this.displacementData=t,this.displacementWidth=e,this.displacementHeight=n},getDisplacementTexture:function(){return this.get("displacementTexture")||this.get("heightTexture")},getDisplacemenScale:function(){var t=this.getDisplacementTexture(),e=this.get("displacementScale");return t&&"none"!==t?e:0},hasDisplacement:function(){return 0<this.getDisplacemenScale()},_displacementChanged:!0,_displacementScale:0,updateDisplacementHash:function(){var t=this.getDisplacementTexture(),e=this.getDisplacemenScale();this._displacementChanged=this._displacementTexture!==t||this._displacementScale!==e,this._displacementTexture=t,this._displacementScale=e},isDisplacementChanged:function(){return this._displacementChanged}});l.merge(OA.prototype,{defaultOption:{viewControl:{projection:"perspective",autoRotate:!1,autoRotateDirection:"cw",autoRotateSpeed:10,autoRotateAfterStill:3,damping:.8,rotateSensitivity:1,zoomSensitivity:1,panSensitivity:1,panMouseButton:"middle",rotateMouseButton:"left",distance:150,minDistance:40,maxDistance:400,orthographicSize:150,maxOrthographicSize:400,minOrthographicSize:20,center:[0,0,0],alpha:0,beta:0,minAlpha:-90,maxAlpha:90}},setView:function(t){t=t||{},this.option.viewControl=this.option.viewControl||{},null!=t.alpha&&(this.option.viewControl.alpha=t.alpha),null!=t.beta&&(this.option.viewControl.beta=t.beta),null!=t.distance&&(this.option.viewControl.distance=t.distance),null!=t.center&&(this.option.viewControl.center=t.center)}}),l.merge(OA.prototype,{defaultOption:{postEffect:{enable:!1,bloom:{enable:!0,intensity:.1},depthOfField:{enable:!1,focalRange:20,focalDistance:50,blurRadius:10,fstop:2.8,quality:"medium"},screenSpaceAmbientOcclusion:{enable:!1,radius:2,quality:"medium",intensity:1},screenSpaceReflection:{enable:!1,quality:"medium",maxRoughness:.8},colorCorrection:{enable:!0,exposure:0,brightness:0,contrast:1,saturation:1,lookupTexture:""},edge:{enable:!1},FXAA:{enable:!1}},temporalSuperSampling:{enable:"auto"}}}),l.merge(OA.prototype,{defaultOption:{light:{main:{shadow:!1,shadowQuality:"high",color:"#fff",intensity:1,alpha:0,beta:0},ambient:{color:"#fff",intensity:.2},ambientCubemap:{texture:null,exposure:1,diffuseIntensity:.5,specularIntensity:.5}}}}),l.merge(OA.prototype,{defaultOption:{shading:null,realisticMaterial:{textureTiling:1,textureOffset:0,detailTexture:null},lambertMaterial:{textureTiling:1,textureOffset:0,detailTexture:null},colorMaterial:{textureTiling:1,textureOffset:0,detailTexture:null},hatchingMaterial:{textureTiling:1,textureOffset:0,paperColor:"#fff"}}});var PA=OA,NA=sA.firstNotNull,kA={left:0,middle:1,right:2};function BA(t){return t instanceof Array?t:[t,t]}pA=wu.extend((function(){return{zr:null,viewGL:null,_center:new fw,minDistance:.5,maxDistance:1.5,maxOrthographicSize:300,minOrthographicSize:30,minAlpha:-90,maxAlpha:90,minBeta:-1/0,maxBeta:1/0,autoRotateAfterStill:0,autoRotateDirection:"cw",autoRotateSpeed:60,damping:.8,rotateSensitivity:1,zoomSensitivity:1,panSensitivity:1,panMouseButton:"middle",rotateMouseButton:"left",_mode:"rotate",_camera:null,_needsUpdate:!1,_rotating:!1,_phi:0,_theta:0,_mouseX:0,_mouseY:0,_rotateVelocity:new hT,_panVelocity:new hT,_distance:500,_zoomSpeed:0,_stillTimeout:0,_animators:[]}}),(function(){["_mouseDownHandler","_mouseWheelHandler","_mouseMoveHandler","_mouseUpHandler","_pinchHandler","_contextMenuHandler","_update"].forEach((function(t){this[t]=this[t].bind(this)}),this)}),{init:function(){var t=this.zr;t&&(t.on("mousedown",this._mouseDownHandler),t.on("globalout",this._mouseUpHandler),t.on("mousewheel",this._mouseWheelHandler),t.on("pinch",this._pinchHandler),t.animation.on("frame",this._update),t.dom.addEventListener("contextmenu",this._contextMenuHandler))},dispose:function(){var t=this.zr;t&&(t.off("mousedown",this._mouseDownHandler),t.off("mousemove",this._mouseMoveHandler),t.off("mouseup",this._mouseUpHandler),t.off("mousewheel",this._mouseWheelHandler),t.off("pinch",this._pinchHandler),t.off("globalout",this._mouseUpHandler),t.dom.removeEventListener("contextmenu",this._contextMenuHandler),t.animation.off("frame",this._update)),this.stopAllAnimation()},getDistance:function(){return this._distance},setDistance:function(t){this._distance=t,this._needsUpdate=!0},getOrthographicSize:function(){return this._orthoSize},setOrthographicSize:function(t){this._orthoSize=t,this._needsUpdate=!0},getAlpha:function(){return this._theta/Math.PI*180},getBeta:function(){return-this._phi/Math.PI*180},getCenter:function(){return this._center.toArray()},setAlpha:function(t){t=Math.max(Math.min(this.maxAlpha,t),this.minAlpha),this._theta=t/180*Math.PI,this._needsUpdate=!0},setBeta:function(t){t=Math.max(Math.min(this.maxBeta,t),this.minBeta),this._phi=-t/180*Math.PI,this._needsUpdate=!0},setCenter:function(t){this._center.setArray(t)},setViewGL:function(t){this.viewGL=t},getCamera:function(){return this.viewGL.camera},setFromViewControlModel:function(t,e){var n=(e=e||{}).baseDistance||0,r=e.baseOrthoSize||1,i=t.get("projection");this._projection=i="perspective"!==i&&"orthographic"!==i&&"isometric"!==i?"perspective":i,this.viewGL.setProjection(i);var o=t.get("distance")+n;i=t.get("orthographicSize")+r;[["damping",.8],["autoRotate",!1],["autoRotateAfterStill",3],["autoRotateDirection","cw"],["autoRotateSpeed",10],["minDistance",30],["maxDistance",400],["minOrthographicSize",30],["maxOrthographicSize",300],["minAlpha",-90],["maxAlpha",90],["minBeta",-1/0],["maxBeta",1/0],["rotateSensitivity",1],["zoomSensitivity",1],["panSensitivity",1],["panMouseButton","left"],["rotateMouseButton","middle"]].forEach((function(e){this[e[0]]=NA(t.get(e[0]),e[1])}),this),this.minDistance+=n,this.maxDistance+=n,this.minOrthographicSize+=r,this.maxOrthographicSize+=r;var a=t.ecModel,s={};["animation","animationDurationUpdate","animationEasingUpdate"].forEach((function(e){s[e]=NA(t.get(e),a&&a.get(e))})),n=NA(e.alpha,t.get("alpha"))||0,r=NA(e.beta,t.get("beta"))||0,e=NA(e.center,t.get("center"))||[0,0,0],s.animation&&0<s.animationDurationUpdate&&this._notFirst?this.animateTo({alpha:n,beta:r,center:e,distance:o,orthographicSize:i,easing:s.animationEasingUpdate,duration:s.animationDurationUpdate}):(this.setDistance(o),this.setAlpha(n),this.setBeta(r),this.setCenter(e),this.setOrthographicSize(i)),this._notFirst=!0,this._validateProperties()},_validateProperties:function(){},animateTo:function(t){var e=this.zr,n=this,r={},i={};return null!=t.distance&&(r.distance=this.getDistance(),i.distance=t.distance),null!=t.orthographicSize&&(r.orthographicSize=this.getOrthographicSize(),i.orthographicSize=t.orthographicSize),null!=t.alpha&&(r.alpha=this.getAlpha(),i.alpha=t.alpha),null!=t.beta&&(r.beta=this.getBeta(),i.beta=t.beta),null!=t.center&&(r.center=this.getCenter(),i.center=t.center),this._addAnimator(e.animation.animate(r).when(t.duration||1e3,i).during((function(){null!=r.alpha&&n.setAlpha(r.alpha),null!=r.beta&&n.setBeta(r.beta),null!=r.distance&&n.setDistance(r.distance),null!=r.center&&n.setCenter(r.center),null!=r.orthographicSize&&n.setOrthographicSize(r.orthographicSize),n._needsUpdate=!0}))).start(t.easing||"linear")},stopAllAnimation:function(){for(var t=0;t<this._animators.length;t++)this._animators[t].stop();this._animators.length=0},update:function(){this._needsUpdate=!0,this._update(20)},_isAnimating:function(){return 0<this._animators.length},_update:function(t){var e;this._rotating?(e=("cw"===this.autoRotateDirection?1:-1)*this.autoRotateSpeed/180*Math.PI,this._phi-=e*t/1e3,this._needsUpdate=!0):0<this._rotateVelocity.len()&&(this._needsUpdate=!0),(.1<Math.abs(this._zoomSpeed)||0<this._panVelocity.len())&&(this._needsUpdate=!0),this._needsUpdate&&(t=Math.min(t,50),this._updateDistanceOrSize(t),this._updatePan(t),this._updateRotate(t),this._updateTransform(),this.getCamera().update(),this.zr&&this.zr.refresh(),this.trigger("update"),this._needsUpdate=!1)},_updateRotate:function(t){var e=this._rotateVelocity;this._phi=e.y*t/20+this._phi,this._theta=e.x*t/20+this._theta,this.setAlpha(this.getAlpha()),this.setBeta(this.getBeta()),this._vectorDamping(e,Math.pow(this.damping,t/16))},_updateDistanceOrSize:function(t){"perspective"===this._projection?this._setDistance(this._distance+this._zoomSpeed*t/20):this._setOrthoSize(this._orthoSize+this._zoomSpeed*t/20),this._zoomSpeed*=Math.pow(this.damping,t/16)},_setDistance:function(t){this._distance=Math.max(Math.min(t,this.maxDistance),this.minDistance)},_setOrthoSize:function(t){this._orthoSize=Math.max(Math.min(t,this.maxOrthographicSize),this.minOrthographicSize);var e=this.getCamera(),n=this._orthoSize;t=n/this.viewGL.viewport.height*this.viewGL.viewport.width;e.left=-t/2,e.right=t/2,e.top=n/2,e.bottom=-n/2},_updatePan:function(t){var e=this._panVelocity,n=this._distance,r=this.getCamera(),i=r.worldTransform.y;r=r.worldTransform.x;this._center.scaleAndAdd(r,-e.x*n/200).scaleAndAdd(i,-e.y*n/200),this._vectorDamping(e,0)},_updateTransform:function(){var t=this.getCamera(),e=new fw,n=this._theta+Math.PI/2,r=this._phi+Math.PI/2,i=Math.sin(n);e.x=i*Math.cos(r),e.y=-Math.cos(n),e.z=i*Math.sin(r),t.position.copy(this._center).scaleAndAdd(e,this._distance),t.rotation.identity().rotateY(-this._phi).rotateX(-this._theta)},_startCountingStill:function(){clearTimeout(this._stillTimeout);var t=this.autoRotateAfterStill,e=this;!isNaN(t)&&0<t&&(this._stillTimeout=setTimeout((function(){e._rotating=!0}),1e3*t))},_vectorDamping:function(t,e){var n=t.len();(n*=e)<1e-4&&(n=0),t.normalize().scale(n)},_decomposeTransform:function(){var t,e;this.getCamera()&&(this.getCamera().updateWorldTransform(),e=this.getCamera().worldTransform.z,t=Math.asin(e.y),e=Math.atan2(e.x,e.z),this._theta=t,this._phi=-e,this.setBeta(this.getBeta()),this.setAlpha(this.getAlpha()),this.getCamera().aspect?this._setDistance(this.getCamera().position.dist(this._center)):this._setOrthoSize(this.getCamera().top-this.getCamera().bottom))},_mouseDownHandler:function(t){var e,n;t.target||this._isAnimating()||(e=t.offsetX,n=t.offsetY,this.viewGL&&!this.viewGL.containPoint(e,n)||(this.zr.on("mousemove",this._mouseMoveHandler),this.zr.on("mouseup",this._mouseUpHandler),t.event.targetTouches?1===t.event.targetTouches.length&&(this._mode="rotate"):t.event.button===kA[this.rotateMouseButton]?this._mode="rotate":t.event.button===kA[this.panMouseButton]?this._mode="pan":this._mode="",this._rotateVelocity.set(0,0),this._rotating=!1,this.autoRotate&&this._startCountingStill(),this._mouseX=t.offsetX,this._mouseY=t.offsetY))},_mouseMoveHandler:function(t){var e,n;t.target&&t.target.__isGLToZRProxy||this._isAnimating()||(e=BA(this.panSensitivity),n=BA(this.rotateSensitivity),"rotate"===this._mode?(this._rotateVelocity.y=(t.offsetX-this._mouseX)/this.zr.getHeight()*2*n[0],this._rotateVelocity.x=(t.offsetY-this._mouseY)/this.zr.getWidth()*2*n[1]):"pan"===this._mode&&(this._panVelocity.x=(t.offsetX-this._mouseX)/this.zr.getWidth()*e[0]*400,this._panVelocity.y=(-t.offsetY+this._mouseY)/this.zr.getHeight()*e[1]*400),this._mouseX=t.offsetX,this._mouseY=t.offsetY,t.event.preventDefault())},_mouseWheelHandler:function(t){var e;this._isAnimating()||(e=t.event.wheelDelta||-t.event.detail,this._zoomHandler(t,e))},_pinchHandler:function(t){this._isAnimating()||(this._zoomHandler(t,1<t.pinchScale?1:-1),this._mode="")},_zoomHandler:function(t,e){var n,r;0!==e&&(n=t.offsetX,r=t.offsetY,this.viewGL&&!this.viewGL.containPoint(n,r)||(r="perspective"===this._projection?Math.max(Math.max(Math.min(this._distance-this.minDistance,this.maxDistance-this._distance))/20,.5):Math.max(Math.max(Math.min(this._orthoSize-this.minOrthographicSize,this.maxOrthographicSize-this._orthoSize))/20,.5),this._zoomSpeed=(0<e?-1:1)*r*this.zoomSensitivity,this._rotating=!1,this.autoRotate&&"rotate"===this._mode&&this._startCountingStill(),t.event.preventDefault()))},_mouseUpHandler:function(){this.zr.off("mousemove",this._mouseMoveHandler),this.zr.off("mouseup",this._mouseUpHandler)},_isRightMouseButtonUsed:function(){return"right"===this.rotateMouseButton||"right"===this.panMouseButton},_contextMenuHandler:function(t){this._isRightMouseButtonUsed()&&t.preventDefault()},_addAnimator:function(t){var e=this._animators;return e.push(t),t.done((function(){var n=e.indexOf(t);0<=n&&e.splice(n,1)})),t}}),Object.defineProperty(pA.prototype,"autoRotate",{get:function(t){return this._autoRotate},set:function(t){this._autoRotate=t,this._rotating=t}});var FA=pA;function zA(){}zA.prototype={constructor:zA,setScene:function(t){this._scene=t,this._skybox&&this._skybox.attachScene(this._scene)},initLight:function(t){this._lightRoot=t,this.mainLight=new bA.DirectionalLight({shadowBias:.005}),this.ambientLight=new bA.AmbientLight,t.add(this.mainLight),t.add(this.ambientLight)},dispose:function(){this._lightRoot&&(this._lightRoot.remove(this.mainLight),this._lightRoot.remove(this.ambientLight))},updateLight:function(t){var e=this.mainLight,n=this.ambientLight,r=t.getModel("light");t=r.getModel("main"),r=r.getModel("ambient");e.intensity=t.get("intensity"),n.intensity=r.get("intensity"),e.color=bA.parseColor(t.get("color")).slice(0,3),n.color=bA.parseColor(r.get("color")).slice(0,3),n=t.get("alpha")||0,r=t.get("beta")||0,e.position.setArray(bA.directionFromAlphaBeta(n,r)),e.lookAt(bA.Vector3.ZERO),e.castShadow=t.get("shadow"),e.shadowResolution=bA.getShadowResolution(t.get("shadowQuality"))},updateAmbientCubemap:function(t,e,n){var r,i,o=e.getModel("light.ambientCubemap");e=o.get("texture");e?(this._cubemapLightsCache=this._cubemapLightsCache||{},(i=this._cubemapLightsCache[e])||(i=(r=this)._cubemapLightsCache[e]=bA.createAmbientCubemap(o.option,t,n,(function(){r._isSkyboxFromAmbientCubemap&&r._skybox.setEnvironmentMap(i.specular.cubemap),n.getZr().refresh()}))),this._lightRoot.add(i.diffuse),this._lightRoot.add(i.specular),this._currentCubemapLights=i):this._currentCubemapLights&&(this._lightRoot.remove(this._currentCubemapLights.diffuse),this._lightRoot.remove(this._currentCubemapLights.specular),this._currentCubemapLights=null)},updateSkybox:function(t,e,n){var i,o,a=e.get("environment"),l=this,u=(l._skybox=l._skybox||new wM,l._skybox);a&&"none"!==a?"auto"===a?(this._isSkyboxFromAmbientCubemap=!0,this._currentCubemapLights?(i=this._currentCubemapLights.specular.cubemap,u.setEnvironmentMap(i),this._scene&&u.attachScene(this._scene),u.material.set("lod",3)):this._skybox&&this._skybox.detachScene()):("object"==typeof a&&a.colorStops||"string"==typeof a&&r.parse(a)?(this._isSkyboxFromAmbientCubemap=!1,o=new bA.Texture2D({anisotropic:8,flipY:!1}),u.setEnvironmentMap(o),(i=o.image=document.createElement("canvas")).width=i.height=16,gy(i.getContext("2d"),new s.Rect({shape:{x:0,y:0,width:16,height:16},style:{fill:a}}))):(this._isSkyboxFromAmbientCubemap=!1,o=bA.loadTexture(a,n,{anisotropic:8,flipY:!1}),u.setEnvironmentMap(o)),u.attachScene(this._scene)):(this._skybox&&this._skybox.detachScene(this._scene),this._skybox=null),e=e.coordinateSystem,this._skybox&&(!e||!e.viewGL||"auto"===a||a.match&&a.match(/.hdr$/)?this._skybox.material.undefine("fragment","SRGB_DECODE"):(e=e.viewGL.isLinearSpace()?"define":"undefine",this._skybox.material[e]("fragment","SRGB_DECODE")))}};var HA=zA,VA=Math.PI,UA=Math.sin,GA=Math.cos,WA=Math.tan,XA=Math.asin,jA=Math.atan2,YA=VA/180,ZA=864e5,qA=2440588;function KA(t){return t.valueOf()/ZA-.5+qA-2451545}var QA=23.4397*YA;function JA(t){var e,n=(e=YA*(357.5291+.98560028*t))+YA*(1.9148*UA(e)+.02*UA(2*e)+3e-4*UA(3*e))+102.9372*YA+VA;return{dec:(t=n,XA(UA(e=0)*GA(QA)+GA(e)*UA(QA)*UA(t))),ra:(t=0,jA(UA(n=n)*GA(QA)-WA(t)*UA(QA),GA(n)))}}M={},M.getPosition=function(t,e,n){var r=YA*-n,i=YA*e,o=KA(t);n=JA(o),e=YA*(280.16+360.9856235*o)-r-n.ra;return{azimuth:(t=e,o=i,r=n.dec,jA(UA(t),GA(t)*UA(o)-WA(r)*GA(o))),altitude:(e=e,i=i,n=n.dec,XA(UA(i)*UA(n)+GA(i)*GA(n)*GA(e)))}};var $A=M;bA.Shader.import(Bo),bA.Shader.import("@export ecgl.atmosphere.vertex\nattribute vec3 position: POSITION;\nattribute vec3 normal : NORMAL;\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform mat4 normalMatrix : WORLDINVERSETRANSPOSE;\n\nvarying vec3 v_Normal;\n\nvoid main() {\n v_Normal = normalize((normalMatrix * vec4(normal, 0.0)).xyz);\n gl_Position = worldViewProjection * vec4(position, 1.0);\n}\n@end\n\n\n@export ecgl.atmosphere.fragment\nuniform mat4 viewTranspose: VIEWTRANSPOSE;\nuniform float glowPower;\nuniform vec3 glowColor;\n\nvarying vec3 v_Normal;\n\nvoid main() {\n float intensity = pow(1.0 - dot(v_Normal, (viewTranspose * vec4(0.0, 0.0, 1.0, 0.0)).xyz), glowPower);\n gl_FragColor = vec4(glowColor, intensity * intensity);\n}\n@end");var tC=gg.extend({type:"globe",__ecgl__:!0,_displacementScale:0,init:function(t,e){this.groupGL=new bA.Node,this._sphereGeometry=new bA.SphereGeometry({widthSegments:200,heightSegments:100,dynamic:!0}),this._overlayGeometry=new bA.SphereGeometry({widthSegments:80,heightSegments:40}),this._planeGeometry=new bA.PlaneGeometry,this._earthMesh=new bA.Mesh({renderNormal:!0}),this._atmosphereMesh=new bA.Mesh,this._atmosphereGeometry=new bA.SphereGeometry({widthSegments:80,heightSegments:40}),this._atmosphereMaterial=new bA.Material({shader:new bA.Shader(bA.Shader.source("ecgl.atmosphere.vertex"),bA.Shader.source("ecgl.atmosphere.fragment")),transparent:!0}),this._atmosphereMesh.geometry=this._atmosphereGeometry,this._atmosphereMesh.material=this._atmosphereMaterial,this._atmosphereMesh.frontFace=bA.Mesh.CW,this._lightRoot=new bA.Node,this._sceneHelper=new HA,this._sceneHelper.initLight(this._lightRoot),this.groupGL.add(this._atmosphereMesh),this.groupGL.add(this._earthMesh),this._control=new FA({zr:e.getZr()}),this._control.init(),this._layerMeshes={}},render:function(t,e,n){var r=t.coordinateSystem,i=t.get("shading");r.viewGL.add(this._lightRoot),t.get("show")?r.viewGL.add(this.groupGL):r.viewGL.remove(this.groupGL),this._sceneHelper.setScene(r.viewGL.scene),r.viewGL.setPostEffect(t.getModel("postEffect"),n),r.viewGL.setTemporalSuperSampling(t.getModel("temporalSuperSampling"));var o=this._earthMesh;o.geometry=this._sphereGeometry;var a="ecgl."+i;o.material&&o.material.shader.name===a||(o.material=bA.createMaterial(a)),bA.setMaterialFromModel(i,o.material,t,n),["roughnessMap","metalnessMap","detailMap","normalMap"].forEach((function(t){t=o.material.get(t),t&&(t.flipY=!1)})),o.material.set("color",bA.parseColor(t.get("baseColor"))),r=.99*r.radius,o.scale.set(r,r,r),t.get("atmosphere.show")?(o.material.define("both","ATMOSPHERE_ENABLED"),this._atmosphereMesh.invisible=!1,this._atmosphereMaterial.setUniforms({glowPower:t.get("atmosphere.glowPower")||6,glowColor:t.get("atmosphere.color")||"#ffffff"}),o.material.setUniforms({glowPower:t.get("atmosphere.innerGlowPower")||2,glowColor:t.get("atmosphere.color")||"#ffffff"}),s=t.get("atmosphere.offset")||5,this._atmosphereMesh.scale.set(r+s,r+s,r+s)):(o.material.undefine("both","ATMOSPHERE_ENABLED"),this._atmosphereMesh.invisible=!0);var s=o.material.setTextureImage("diffuseMap",t.get("baseTexture"),n,{flipY:!1,anisotropic:8});s&&s.surface&&s.surface.attachToMesh(o),s=o.material.setTextureImage("bumpMap",t.get("heightTexture"),n,{flipY:!1,anisotropic:8}),s&&s.surface&&s.surface.attachToMesh(o),o.material[t.get("postEffect.enable")?"define":"undefine"]("fragment","SRGB_DECODE"),this._updateLight(t,n),this._displaceVertices(t,n),this._updateViewControl(t,n),this._updateLayers(t,n)},afterRender:function(t,e,n,r){r=r.renderer,this._sceneHelper.updateAmbientCubemap(r,t,n),this._sceneHelper.updateSkybox(r,t,n)},_updateLayers:function(t,e){var n=t.coordinateSystem,r=t.get("layers"),i=n.radius,o=[],a=[],s=[],u=[];l.each(r,(function(t){var r,l,h=new xc(t),c=h.get("type");t=bA.loadTexture(h.get("texture"),e,{flipY:!1,anisotropic:8});t.surface&&t.surface.attachToMesh(this._earthMesh),"blend"===c?(c=h.get("blendTo"),l=sA.firstNotNull(h.get("intensity"),1),"emission"===c?(s.push(t),u.push(l)):(o.push(t),a.push(l))):(l=h.get("id"),r=(r=this._layerMeshes[l])||(this._layerMeshes[l]=new bA.Mesh({geometry:this._overlayGeometry,castShadow:!1,ignorePicking:!0})),"lambert"===h.get("shading")?(r.material=r.__lambertMaterial||new bA.Material({autoUpdateTextureStatus:!1,shader:bA.createShader("ecgl.lambert"),transparent:!0,depthMask:!1}),r.__lambertMaterial=r.material):(r.material=r.__colorMaterial||new bA.Material({autoUpdateTextureStatus:!1,shader:bA.createShader("ecgl.color"),transparent:!0,depthMask:!1}),r.__colorMaterial=r.material),r.material.enableTexture("diffuseMap"),l=h.get("distance"),l=i+(null==l?n.radius/100:l),r.scale.set(l,l,l),i=l,l=this._blankTexture||(this._blankTexture=bA.createBlankTexture("rgba(255, 255, 255, 0)")),r.material.set("diffuseMap",l),bA.loadTexture(h.get("texture"),e,{flipY:!1,anisotropic:8},(function(t){t.surface&&t.surface.attachToMesh(r),r.material.set("diffuseMap",t),e.getZr().refresh()})),h.get("show")?this.groupGL.add(r):this.groupGL.remove(r))}),this);var h=this._earthMesh.material;h.define("fragment","LAYER_DIFFUSEMAP_COUNT",o.length),h.define("fragment","LAYER_EMISSIVEMAP_COUNT",s.length),h.set("layerDiffuseMap",o),h.set("layerDiffuseIntensity",a),h.set("layerEmissiveMap",s),h.set("layerEmissionIntensity",u),r=t.getModel("debug.wireframe"),r.get("show")?(h.define("both","WIREFRAME_TRIANGLE"),t=bA.parseColor(r.get("lineStyle.color")||"rgba(0,0,0,0.5)"),r=sA.firstNotNull(r.get("lineStyle.width"),1),h.set("wireframeLineWidth",r),h.set("wireframeLineColor",t)):h.undefine("both","WIREFRAME_TRIANGLE")},_updateViewControl:function(t,e){var n=t.coordinateSystem,r=t.getModel("viewControl"),i=(n.viewGL.camera,this),o=this._control;o.setViewGL(n.viewGL);var a,s,l=r.get("targetCoord");null!=l&&(s=l[0]+90,a=l[1]),o.setFromViewControlModel(r,{baseDistance:n.radius,alpha:a,beta:s}),o.off("update"),o.on("update",(function(){e.dispatchAction({type:"globeChangeCamera",alpha:o.getAlpha(),beta:o.getBeta(),distance:o.getDistance()-n.radius,center:o.getCenter(),from:i.uid,globeId:t.id})}))},_displaceVertices:function(t,e){var n,r=t.get("displacementQuality"),i=t.get("debug.wireframe.show"),o=t.coordinateSystem;!t.isDisplacementChanged()&&r===this._displacementQuality&&i===this._showDebugWireframe||(this._displacementQuality=r,this._showDebugWireframe=i,n=this._sphereGeometry,r=(t={low:100,medium:200,high:400,ultra:800}[r]||200)/2,n.widthSegments===t&&!i||(n.widthSegments=t,n.heightSegments=r,n.build()),this._doDisplaceVertices(n,o),i&&n.generateBarycentric())},_doDisplaceVertices:function(t,e){var n=t.attributes.position.value,r=t.attributes.texcoord0.value,i=t.__originalPosition;i&&i.length===n.length||((i=new Float32Array(n.length)).set(n),t.__originalPosition=i);for(var o=e.displacementWidth,a=e.displacementHeight,s=e.displacementData,l=0;l<t.vertexCount;l++){var u=3*l,h=2*l,c=i[1+u],d=i[2+u],p=i[3+u],f=r[h++];h=r[+h],f=Math.round(f*(o-1)),h=Math.round(h*(a-1)),f=s?s[h*o+f]:0;n[1+u]=c+c*f,n[2+u]=d+d*f,n[3+u]=p+p*f}t.generateVertexNormals(),t.dirty(),t.updateBoundingBox()},_updateLight:function(t,e){var n=this._earthMesh;this._sceneHelper.updateLight(t);var r=this._sceneHelper.mainLight,i=t.get("light.main.time")||new Date;t=$A.getPosition(a.parseDate(i),0,0),i=Math.cos(t.altitude);r.position.y=-i*Math.cos(t.azimuth),r.position.x=Math.sin(t.altitude),r.position.z=i*Math.sin(t.azimuth),r.lookAt(n.getWorldPosition())},dispose:function(t,e){this.groupGL.removeAll(),this._control.dispose()}}),eC={vec2:uT,vec3:GT,vec4:_w,mat2:uA,mat2d:cA,mat3:ww,mat4:VT,quat:Dw}.vec3;function nC(t){this.radius=t,this.viewGL=null,this.altitudeAxis,this.displacementData=null,this.displacementWidth,this.displacementHeight}nC.prototype={constructor:nC,dimensions:["lng","lat","alt"],type:"globe",containPoint:function(){},setDisplacementData:function(t,e,n){this.displacementData=t,this.displacementWidth=e,this.displacementHeight=n},_getDisplacementScale:function(t,e){return t=(t+180)/360*(this.displacementWidth-1),e=(90-e)/180*(this.displacementHeight-1),e=Math.round(t)+Math.round(e)*this.displacementWidth,this.displacementData[e]},dataToPoint:function(t,e){var n=t[0],r=t[1],i=t[2]||0;t=this.radius;return this.displacementData&&(t*=1+this._getDisplacementScale(n,r)),this.altitudeAxis&&(t+=this.altitudeAxis.dataToCoord(i)),n=n*Math.PI/180,r=r*Math.PI/180,i=Math.cos(r)*t,(e=e||[])[0]=-i*Math.cos(n+Math.PI),e[1]=Math.sin(r)*t,e[2]=i*Math.sin(n+Math.PI),e},pointToData:function(t,e){var n=t[0],r=t[1],i=t[2];t=eC.len(t);return n/=t,r/=t,i/=t,r=Math.asin(r),n=Math.atan2(i,-n),n<0&&(n=2*Math.PI+n),r=180*r/Math.PI,n=180*n/Math.PI-180,(e=e||[])[0]=n,e[1]=r,e[2]=t-this.radius,this.altitudeAxis&&(e[2]=this.altitudeAxis.coordToData(e[2])),e}};var rC=nC;pA=function(){this._pool={},this._allocatedTextures=[]};pA.prototype={constructor:pA,get:function(t){var e=aC(t);return this._pool.hasOwnProperty(e)||(this._pool[e]=[]),e=this._pool[e],e.length?e.pop():(t=new _S(t),this._allocatedTextures.push(t),t)},put:function(t){var e=aC(t);this._pool.hasOwnProperty(e)||(this._pool[e]=[]),this._pool[e].push(t)},clear:function(t){for(var e=0;e<this._allocatedTextures.length;e++)this._allocatedTextures[e].dispose(t);this._pool={},this._allocatedTextures=[]}};var iC={width:512,height:512,type:Bb.UNSIGNED_BYTE,format:Bb.RGBA,wrapS:Bb.CLAMP_TO_EDGE,wrapT:Bb.CLAMP_TO_EDGE,minFilter:Bb.LINEAR_MIPMAP_LINEAR,magFilter:Bb.LINEAR,useMipmap:!0,anisotropic:1,flipY:!0,unpackAlignment:4,premultiplyAlpha:!1},oC=Object.keys(iC);function aC(t){Lb.defaultsWithPropList(t,iC,oC),function(t){var e=function(t,e){return 0==(t&t-1)&&0==(e&e-1)}(t.width,t.height);t.format===Bb.DEPTH_COMPONENT&&(t.useMipmap=!1),e&&t.useMipmap||(t.minFilter==Bb.NEAREST_MIPMAP_NEAREST||t.minFilter==Bb.NEAREST_MIPMAP_LINEAR?t.minFilter=Bb.NEAREST:t.minFilter!=Bb.LINEAR_MIPMAP_LINEAR&&t.minFilter!=Bb.LINEAR_MIPMAP_NEAREST||(t.minFilter=Bb.LINEAR)),e||(t.wrapS=Bb.CLAMP_TO_EDGE,t.wrapT=Bb.CLAMP_TO_EDGE)}(t);for(var e="",n=0;n<oC.length;n++)e+=t[oC[n]].toString();return e}var sC=pA,lC=["px","nx","py","ny","pz","nz"];function uC(t,e,n){return"alphaMap"===n?t.material.get("diffuseMap"):"alphaCutoff"!==n?"uvRepeat"===n?t.material.get("uvRepeat"):"uvOffset"===n?t.material.get("uvOffset"):e.get(n):t.material.isDefined("fragment","ALPHA_TEST")&&t.material.get("diffuseMap")&&t.material.get("alphaCutoff")||0}function hC(t,e){return t=t.material,e=e.material,t.get("diffuseMap")!==e.get("diffuseMap")||(t.get("alphaCutoff")||0)!==(e.get("alphaCutoff")||0)}FT.import("@export clay.sm.depth.vertex\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\nuniform vec2 uvRepeat = vec2(1.0, 1.0);\nuniform vec2 uvOffset = vec2(0.0, 0.0);\n@import clay.chunk.skinning_header\n@import clay.chunk.instancing_header\nvarying vec4 v_ViewPosition;\nvarying vec2 v_Texcoord;\nvoid main(){\n vec4 P = vec4(position, 1.0);\n#ifdef SKINNING\n @import clay.chunk.skin_matrix\n P = skinMatrixWS * P;\n#endif\n#ifdef INSTANCING\n @import clay.chunk.instancing_matrix\n P = instanceMat * P;\n#endif\n v_ViewPosition = worldViewProjection * P;\n gl_Position = v_ViewPosition;\n v_Texcoord = texcoord * uvRepeat + uvOffset;\n}\n@end\n@export clay.sm.depth.fragment\nvarying vec4 v_ViewPosition;\nvarying vec2 v_Texcoord;\nuniform float bias : 0.001;\nuniform float slopeScale : 1.0;\nuniform sampler2D alphaMap;\nuniform float alphaCutoff: 0.0;\n@import clay.util.encode_float\nvoid main(){\n float depth = v_ViewPosition.z / v_ViewPosition.w;\n if (alphaCutoff > 0.0) {\n if (texture2D(alphaMap, v_Texcoord).a <= alphaCutoff) {\n discard;\n }\n }\n#ifdef USE_VSM\n depth = depth * 0.5 + 0.5;\n float moment1 = depth;\n float moment2 = depth * depth;\n #ifdef SUPPORT_STANDARD_DERIVATIVES\n float dx = dFdx(depth);\n float dy = dFdy(depth);\n moment2 += 0.25*(dx*dx+dy*dy);\n #endif\n gl_FragColor = vec4(moment1, moment2, 0.0, 1.0);\n#else\n #ifdef SUPPORT_STANDARD_DERIVATIVES\n float dx = dFdx(depth);\n float dy = dFdy(depth);\n depth += sqrt(dx*dx + dy*dy) * slopeScale + bias;\n #else\n depth += bias;\n #endif\n gl_FragColor = encodeFloat(depth * 0.5 + 0.5);\n#endif\n}\n@end\n@export clay.sm.debug_depth\nuniform sampler2D depthMap;\nvarying vec2 v_Texcoord;\n@import clay.util.decode_float\nvoid main() {\n vec4 tex = texture2D(depthMap, v_Texcoord);\n#ifdef USE_VSM\n gl_FragColor = vec4(tex.rgb, 1.0);\n#else\n float depth = decodeFloat(tex);\n gl_FragColor = vec4(depth, depth, depth, 1.0);\n#endif\n}\n@end\n@export clay.sm.distance.vertex\nuniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\nuniform mat4 world : WORLD;\nattribute vec3 position : POSITION;\n@import clay.chunk.skinning_header\nvarying vec3 v_WorldPosition;\nvoid main (){\n vec4 P = vec4(position, 1.0);\n#ifdef SKINNING\n @import clay.chunk.skin_matrix\n P = skinMatrixWS * P;\n#endif\n#ifdef INSTANCING\n @import clay.chunk.instancing_matrix\n P = instanceMat * P;\n#endif\n gl_Position = worldViewProjection * P;\n v_WorldPosition = (world * P).xyz;\n}\n@end\n@export clay.sm.distance.fragment\nuniform vec3 lightPosition;\nuniform float range : 100;\nvarying vec3 v_WorldPosition;\n@import clay.util.encode_float\nvoid main(){\n float dist = distance(lightPosition, v_WorldPosition);\n#ifdef USE_VSM\n gl_FragColor = vec4(dist, dist * dist, 0.0, 0.0);\n#else\n dist = dist / range;\n gl_FragColor = encodeFloat(dist);\n#endif\n}\n@end\n@export clay.plugin.shadow_map_common\n@import clay.util.decode_float\nfloat tapShadowMap(sampler2D map, vec2 uv, float z){\n vec4 tex = texture2D(map, uv);\n return step(z, decodeFloat(tex) * 2.0 - 1.0);\n}\nfloat pcf(sampler2D map, vec2 uv, float z, float textureSize, vec2 scale) {\n float shadowContrib = tapShadowMap(map, uv, z);\n vec2 offset = vec2(1.0 / textureSize) * scale;\n#ifdef PCF_KERNEL_SIZE\n for (int _idx_ = 0; _idx_ < PCF_KERNEL_SIZE; _idx_++) {{\n shadowContrib += tapShadowMap(map, uv + offset * pcfKernel[_idx_], z);\n }}\n return shadowContrib / float(PCF_KERNEL_SIZE + 1);\n#else\n shadowContrib += tapShadowMap(map, uv+vec2(offset.x, 0.0), z);\n shadowContrib += tapShadowMap(map, uv+vec2(offset.x, offset.y), z);\n shadowContrib += tapShadowMap(map, uv+vec2(-offset.x, offset.y), z);\n shadowContrib += tapShadowMap(map, uv+vec2(0.0, offset.y), z);\n shadowContrib += tapShadowMap(map, uv+vec2(-offset.x, 0.0), z);\n shadowContrib += tapShadowMap(map, uv+vec2(-offset.x, -offset.y), z);\n shadowContrib += tapShadowMap(map, uv+vec2(offset.x, -offset.y), z);\n shadowContrib += tapShadowMap(map, uv+vec2(0.0, -offset.y), z);\n return shadowContrib / 9.0;\n#endif\n}\nfloat pcf(sampler2D map, vec2 uv, float z, float textureSize) {\n return pcf(map, uv, z, textureSize, vec2(1.0));\n}\nfloat chebyshevUpperBound(vec2 moments, float z){\n float p = 0.0;\n z = z * 0.5 + 0.5;\n if (z <= moments.x) {\n p = 1.0;\n }\n float variance = moments.y - moments.x * moments.x;\n variance = max(variance, 0.0000001);\n float mD = moments.x - z;\n float pMax = variance / (variance + mD * mD);\n pMax = clamp((pMax-0.4)/(1.0-0.4), 0.0, 1.0);\n return max(p, pMax);\n}\nfloat computeShadowContrib(\n sampler2D map, mat4 lightVPM, vec3 position, float textureSize, vec2 scale, vec2 offset\n) {\n vec4 posInLightSpace = lightVPM * vec4(position, 1.0);\n posInLightSpace.xyz /= posInLightSpace.w;\n float z = posInLightSpace.z;\n if(all(greaterThan(posInLightSpace.xyz, vec3(-0.99, -0.99, -1.0))) &&\n all(lessThan(posInLightSpace.xyz, vec3(0.99, 0.99, 1.0)))){\n vec2 uv = (posInLightSpace.xy+1.0) / 2.0;\n #ifdef USE_VSM\n vec2 moments = texture2D(map, uv * scale + offset).xy;\n return chebyshevUpperBound(moments, z);\n #else\n return pcf(map, uv * scale + offset, z, textureSize, scale);\n #endif\n }\n return 1.0;\n}\nfloat computeShadowContrib(sampler2D map, mat4 lightVPM, vec3 position, float textureSize) {\n return computeShadowContrib(map, lightVPM, position, textureSize, vec2(1.0), vec2(0.0));\n}\nfloat computeShadowContribOmni(samplerCube map, vec3 direction, float range)\n{\n float dist = length(direction);\n vec4 shadowTex = textureCube(map, direction);\n#ifdef USE_VSM\n vec2 moments = shadowTex.xy;\n float variance = moments.y - moments.x * moments.x;\n float mD = moments.x - dist;\n float p = variance / (variance + mD * mD);\n if(moments.x + 0.001 < dist){\n return clamp(p, 0.0, 1.0);\n }else{\n return 1.0;\n }\n#else\n return step(dist, (decodeFloat(shadowTex) + 0.0002) * range);\n#endif\n}\n@end\n@export clay.plugin.compute_shadow_map\n#if defined(SPOT_LIGHT_SHADOWMAP_COUNT) || defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT) || defined(POINT_LIGHT_SHADOWMAP_COUNT)\n#ifdef SPOT_LIGHT_SHADOWMAP_COUNT\nuniform sampler2D spotLightShadowMaps[SPOT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\nuniform mat4 spotLightMatrices[SPOT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\nuniform float spotLightShadowMapSizes[SPOT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\n#endif\n#ifdef DIRECTIONAL_LIGHT_SHADOWMAP_COUNT\n#if defined(SHADOW_CASCADE)\nuniform sampler2D directionalLightShadowMaps[1]:unconfigurable;\nuniform mat4 directionalLightMatrices[SHADOW_CASCADE]:unconfigurable;\nuniform float directionalLightShadowMapSizes[1]:unconfigurable;\nuniform float shadowCascadeClipsNear[SHADOW_CASCADE]:unconfigurable;\nuniform float shadowCascadeClipsFar[SHADOW_CASCADE]:unconfigurable;\n#else\nuniform sampler2D directionalLightShadowMaps[DIRECTIONAL_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\nuniform mat4 directionalLightMatrices[DIRECTIONAL_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\nuniform float directionalLightShadowMapSizes[DIRECTIONAL_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\n#endif\n#endif\n#ifdef POINT_LIGHT_SHADOWMAP_COUNT\nuniform samplerCube pointLightShadowMaps[POINT_LIGHT_SHADOWMAP_COUNT]:unconfigurable;\n#endif\nuniform bool shadowEnabled : true;\n#ifdef PCF_KERNEL_SIZE\nuniform vec2 pcfKernel[PCF_KERNEL_SIZE];\n#endif\n@import clay.plugin.shadow_map_common\n#if defined(SPOT_LIGHT_SHADOWMAP_COUNT)\nvoid computeShadowOfSpotLights(vec3 position, inout float shadowContribs[SPOT_LIGHT_COUNT] ) {\n float shadowContrib;\n for(int _idx_ = 0; _idx_ < SPOT_LIGHT_SHADOWMAP_COUNT; _idx_++) {{\n shadowContrib = computeShadowContrib(\n spotLightShadowMaps[_idx_], spotLightMatrices[_idx_], position,\n spotLightShadowMapSizes[_idx_]\n );\n shadowContribs[_idx_] = shadowContrib;\n }}\n for(int _idx_ = SPOT_LIGHT_SHADOWMAP_COUNT; _idx_ < SPOT_LIGHT_COUNT; _idx_++){{\n shadowContribs[_idx_] = 1.0;\n }}\n}\n#endif\n#if defined(DIRECTIONAL_LIGHT_SHADOWMAP_COUNT)\n#ifdef SHADOW_CASCADE\nvoid computeShadowOfDirectionalLights(vec3 position, inout float shadowContribs[DIRECTIONAL_LIGHT_COUNT]){\n float depth = (2.0 * gl_FragCoord.z - gl_DepthRange.near - gl_DepthRange.far)\n / (gl_DepthRange.far - gl_DepthRange.near);\n float shadowContrib;\n shadowContribs[0] = 1.0;\n for (int _idx_ = 0; _idx_ < SHADOW_CASCADE; _idx_++) {{\n if (\n depth >= shadowCascadeClipsNear[_idx_] &&\n depth <= shadowCascadeClipsFar[_idx_]\n ) {\n shadowContrib = computeShadowContrib(\n directionalLightShadowMaps[0], directionalLightMatrices[_idx_], position,\n directionalLightShadowMapSizes[0],\n vec2(1.0 / float(SHADOW_CASCADE), 1.0),\n vec2(float(_idx_) / float(SHADOW_CASCADE), 0.0)\n );\n shadowContribs[0] = shadowContrib;\n }\n }}\n for(int _idx_ = DIRECTIONAL_LIGHT_SHADOWMAP_COUNT; _idx_ < DIRECTIONAL_LIGHT_COUNT; _idx_++) {{\n shadowContribs[_idx_] = 1.0;\n }}\n}\n#else\nvoid computeShadowOfDirectionalLights(vec3 position, inout float shadowContribs[DIRECTIONAL_LIGHT_COUNT]){\n float shadowContrib;\n for(int _idx_ = 0; _idx_ < DIRECTIONAL_LIGHT_SHADOWMAP_COUNT; _idx_++) {{\n shadowContrib = computeShadowContrib(\n directionalLightShadowMaps[_idx_], directionalLightMatrices[_idx_], position,\n directionalLightShadowMapSizes[_idx_]\n );\n shadowContribs[_idx_] = shadowContrib;\n }}\n for(int _idx_ = DIRECTIONAL_LIGHT_SHADOWMAP_COUNT; _idx_ < DIRECTIONAL_LIGHT_COUNT; _idx_++) {{\n shadowContribs[_idx_] = 1.0;\n }}\n}\n#endif\n#endif\n#if defined(POINT_LIGHT_SHADOWMAP_COUNT)\nvoid computeShadowOfPointLights(vec3 position, inout float shadowContribs[POINT_LIGHT_COUNT] ){\n vec3 lightPosition;\n vec3 direction;\n for(int _idx_ = 0; _idx_ < POINT_LIGHT_SHADOWMAP_COUNT; _idx_++) {{\n lightPosition = pointLightPosition[_idx_];\n direction = position - lightPosition;\n shadowContribs[_idx_] = computeShadowContribOmni(pointLightShadowMaps[_idx_], direction, pointLightRange[_idx_]);\n }}\n for(int _idx_ = POINT_LIGHT_SHADOWMAP_COUNT; _idx_ < POINT_LIGHT_COUNT; _idx_++) {{\n shadowContribs[_idx_] = 1.0;\n }}\n}\n#endif\n#endif\n@end");var cC,dC,pC,fC,gC,mC,yC,_C,vC,xC,bC=wu.extend((function(){return{softShadow:bC.PCF,shadowBlur:1,lightFrustumBias:"auto",kernelPCF:new Float32Array([1,0,1,1,-1,1,0,1,-1,0,-1,-1,1,-1,0,-1]),precision:"highp",_lastRenderNotCastShadow:!1,_frameBuffer:new mM,_textures:{},_shadowMapNumber:{POINT_LIGHT:0,DIRECTIONAL_LIGHT:0,SPOT_LIGHT:0},_depthMaterials:{},_distanceMaterials:{},_receivers:[],_lightsCastShadow:[],_lightCameras:{},_lightMaterials:{},_texturePool:new sC}}),(function(){this._gaussianPassH=new QM({fragment:FT.source("clay.compositor.gaussian_blur")}),this._gaussianPassV=new QM({fragment:FT.source("clay.compositor.gaussian_blur")}),this._gaussianPassH.setUniform("blurSize",this.shadowBlur),this._gaussianPassH.setUniform("blurDir",0),this._gaussianPassV.setUniform("blurSize",this.shadowBlur),this._gaussianPassV.setUniform("blurDir",1),this._outputDepthPass=new QM({fragment:FT.source("clay.sm.debug_depth")})}),{render:function(t,e,n,r){n=n||e.getMainCamera(),this.trigger("beforerender",this,t,e,n),this._renderShadowPass(t,e,n,r),this.trigger("afterrender",this,t,e,n)},renderDebug:function(t,e){t.saveClear();var n,r=t.viewport,i=0,o=e||r.width/4,a=o;for(n in this.softShadow===bC.VSM?this._outputDepthPass.material.define("fragment","USE_VSM"):this._outputDepthPass.material.undefine("fragment","USE_VSM"),this._textures){var s=this._textures[n];t.setViewport(i,0,o*s.width/s.height,a),this._outputDepthPass.setUniform("depthMap",s),this._outputDepthPass.render(t),i+=o*s.width/s.height}t.setViewport(r),t.restoreClear()},_updateReceivers:function(t,e){var n;e.receiveShadow?(this._receivers.push(e),e.material.set("shadowEnabled",1),e.material.set("pcfKernel",this.kernelPCF)):e.material.set("shadowEnabled",0),this.softShadow===bC.VSM?(e.material.define("fragment","USE_VSM"),e.material.undefine("fragment","PCF_KERNEL_SIZE")):(e.material.undefine("fragment","USE_VSM"),(n=this.kernelPCF)&&n.length?e.material.define("fragment","PCF_KERNEL_SIZE",n.length/2):e.material.undefine("fragment","PCF_KERNEL_SIZE"))},_update:function(t,e){var n=this;e.traverse((function(e){e.isRenderable()&&n._updateReceivers(t,e)}));for(var r=0;r<e.lights.length;r++){var i=e.lights[r];i.castShadow&&!i.invisible&&this._lightsCastShadow.push(i)}},_renderShadowPass:function(t,e,n,r){for(var i in this._shadowMapNumber)this._shadowMapNumber[i]=0;this._lightsCastShadow.length=0,this._receivers.length=0;var o=t.gl;if(r||e.update(),n&&n.update(),e.updateLights(),this._update(t,e),this._lightsCastShadow.length||!this._lastRenderNotCastShadow){this._lastRenderNotCastShadow=0===this._lightsCastShadow,o.enable(o.DEPTH_TEST),o.depthMask(!0),o.disable(o.BLEND),o.clearColor(1,1,1,1);for(var a,s,l=[],u=[],h=[],c=[],d=[],p=[],f=0;f<this._lightsCastShadow.length;f++){var g=this._lightsCastShadow[f];if("DIRECTIONAL_LIGHT"===g.type){if(a){console.warn("Only one direectional light supported with shadow cascade");continue}if(4<g.shadowCascade){console.warn("Support at most 4 cascade");continue}1<g.shadowCascade&&(a=g),this.renderDirectionalLightShadow(t,e,n,g,d,c,h)}else"SPOT_LIGHT"===g.type?this.renderSpotLightShadow(t,e,g,u,l):"POINT_LIGHT"===g.type&&this.renderPointLightShadow(t,e,g,p);this._shadowMapNumber[g.type]++}for(s in this._shadowMapNumber){var m=this._shadowMapNumber[s],y=s+"_SHADOWMAP_COUNT";for(f=0;f<this._receivers.length;f++)(_=this._receivers[f].material).fragmentDefines[y]!==m&&(0<m?_.define("fragment",y,m):_.isDefined("fragment",y)&&_.undefine("fragment",y))}for(f=0;f<this._receivers.length;f++){var _=this._receivers[f].material;a?_.define("fragment","SHADOW_CASCADE",a.shadowCascade):_.undefine("fragment","SHADOW_CASCADE")}var v;r=e.shadowUniforms;0<h.length&&(o=h.map(x),r.directionalLightShadowMaps={value:h,type:"tv"},r.directionalLightMatrices={value:c,type:"m4v"},r.directionalLightShadowMapSizes={value:o,type:"1fv"},a&&(o=d.slice(),v=d.slice(),o.pop(),v.shift(),o.reverse(),v.reverse(),c.reverse(),r.shadowCascadeClipsNear={value:o,type:"1fv"},r.shadowCascadeClipsFar={value:v,type:"1fv"})),0<l.length&&(v=l.map(x),(r=e.shadowUniforms).spotLightShadowMaps={value:l,type:"tv"},r.spotLightMatrices={value:u,type:"m4v"},r.spotLightShadowMapSizes={value:v,type:"1fv"}),0<p.length&&(r.pointLightShadowMaps={value:p,type:"tv"})}function x(t){return t.height}},renderDirectionalLightShadow:(fC=new jS,gC=new Ow,mC=new Qw,yC=new Ow,_C=new Ow,vC=new Ow,xC=new Ow,function(t,e,n,r,i,o,a){var s=this._getDepthMaterial(r),l={getMaterial:function(t){return t.shadowDepthMaterial||s},isMaterialChanged:hC,getUniform:uC,ifRender:function(t){return t.castShadow},sortCompare:nw.opaqueSortCompare};e.viewBoundingBoxLastFrame.isFinite()||(d=e.getBoundingBox(),e.viewBoundingBoxLastFrame.copy(d).applyTransform(n.viewMatrix));var u=Math.min(-e.viewBoundingBoxLastFrame.min.z,n.far),h=Math.max(-e.viewBoundingBoxLastFrame.max.z,n.near),c=this._getDirectionalLightCamera(r,e,n),d=vC.array;xC.copy(c.projectionMatrix),VT.invert(_C.array,c.worldTransform.array),VT.multiply(_C.array,_C.array,n.worldTransform.array),VT.multiply(d,xC.array,_C.array);for(var p=[],f=n instanceof oM,g=(n.near+n.far)/(n.near-n.far),m=2*n.near*n.far/(n.near-n.far),y=0;y<=r.shadowCascade;y++){var _=h*Math.pow(u/h,y/r.shadowCascade),v=h+(u-h)*y/r.shadowCascade;v=_*r.cascadeSplitLogFactor+v*(1-r.cascadeSplitLogFactor);p.push(v),i.push(-(-v*g+m)/-v)}var x=this._getTexture(r,r.shadowCascade);for(a.push(x),d=t.viewport,a=t.gl,this._frameBuffer.attach(x),this._frameBuffer.bind(t),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),y=0;y<r.shadowCascade;y++){var b=p[y],T=p[y+1];f?VT.perspective(gC.array,n.fov/180*Math.PI,n.aspect,b,T):VT.ortho(gC.array,n.left,n.right,n.bottom,n.top,b,T),fC.setFromProjection(gC),fC.getTransformedBoundingBox(mC,_C),mC.applyProjection(xC),b=mC.min.array,T=mC.max.array,b[0]=Math.max(b[0],-1),b[1]=Math.max(b[1],-1),T[0]=Math.min(T[0],1),T[1]=Math.min(T[1],1),yC.ortho(b[0],T[0],b[1],T[1],1,-1),c.projectionMatrix.multiplyLeft(yC),T=r.shadowResolution||512,t.setViewport((r.shadowCascade-y-1)*T,0,T,T,1),T=e.updateRenderList(c),t.renderPass(T.opaque,c,l),this.softShadow===bC.VSM&&this._gaussianFilter(t,x,x.width),T=new Ow,T.copy(c.viewMatrix).multiplyLeft(c.projectionMatrix),o.push(T.array),c.projectionMatrix.copy(xC)}this._frameBuffer.unbind(t),t.setViewport(d)}),renderSpotLightShadow:function(t,e,n,r,i){var o=this._getTexture(n),a=this._getSpotLightCamera(n),s=t.gl;this._frameBuffer.attach(o),this._frameBuffer.bind(t),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT);var l=this._getDepthMaterial(n);n={getMaterial:function(t){return t.shadowDepthMaterial||l},isMaterialChanged:hC,getUniform:uC,ifRender:function(t){return t.castShadow},sortCompare:nw.opaqueSortCompare},e=e.updateRenderList(a);t.renderPass(e.opaque,a,n),this._frameBuffer.unbind(t),this.softShadow===bC.VSM&&this._gaussianFilter(t,o,o.width),t=new Ow,t.copy(a.worldTransform).invert().multiplyLeft(a.projectionMatrix),i.push(o),r.push(t.array)},renderPointLightShadow:function(t,e,n,r){var i=this._getTexture(n),o=t.gl;r.push(i);var a=this._getDepthMaterial(n),s={getMaterial:function(t){return t.shadowDepthMaterial||a},getUniform:uC,sortCompare:nw.opaqueSortCompare},l={px:[],py:[],pz:[],nx:[],ny:[],nz:[]},u=new Qw,h=n.getWorldPosition().array,c=new Qw;r=n.range;c.min.setArray(h),c.max.setArray(h),r=new fw(r,r,r),c.max.add(r),c.min.sub(r);var d={px:!1,py:!1,pz:!1,nx:!1,ny:!1,nz:!1};e.traverse((function(t){if(t.isRenderable()&&t.castShadow){var e=t.geometry;if(e.boundingBox){if(u.transformFrom(e.boundingBox,t.worldTransform),u.intersectBoundingBox(c)){for(u.updateVertices(),p=0;p<lC.length;p++)d[lC[p]]=!1;for(p=0;p<8;p++){var n=u.vertices[p],r=n[0]-h[0],i=n[1]-h[1],o=n[2]-h[2],a=Math.abs(r),s=Math.abs(i);n=Math.abs(o);s<a?n<a?d[0<r?"px":"nx"]=!0:d[0<o?"pz":"nz"]=!0:n<s?d[0<i?"py":"ny"]=!0:d[0<o?"pz":"nz"]=!0}for(p=0;p<lC.length;p++)d[lC[p]]&&l[lC[p]].push(t)}}else for(var p=0;p<lC.length;p++)l[lC[p]].push(t)}}));for(var p=0;p<6;p++){var f=lC[p],g=this._getPointLightCamera(n,f);this._frameBuffer.attach(i,o.COLOR_ATTACHMENT0,o.TEXTURE_CUBE_MAP_POSITIVE_X+p),this._frameBuffer.bind(t),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),t.renderPass(l[f],g,s)}this._frameBuffer.unbind(t)},_getDepthMaterial:function(t){var e,n=this._lightMaterials[t.__uid__],r="POINT_LIGHT"===t.type;return n||(n=new oT({precision:this.precision,shader:new FT(FT.source((e=r?"clay.sm.distance.":"clay.sm.depth.")+"vertex"),FT.source(e+"fragment"))}),this._lightMaterials[t.__uid__]=n),null!=t.shadowSlopeScale&&n.setUniform("slopeScale",t.shadowSlopeScale),null!=t.shadowBias&&n.setUniform("bias",t.shadowBias),this.softShadow===bC.VSM?n.define("fragment","USE_VSM"):n.undefine("fragment","USE_VSM"),r&&(n.set("lightPosition",t.getWorldPosition().array),n.set("range",t.range)),n},_gaussianFilter:function(t,e,n){var r={width:n,height:n,type:pS.FLOAT};r=this._texturePool.get(r);this._frameBuffer.attach(r),this._frameBuffer.bind(t),this._gaussianPassH.setUniform("texture",e),this._gaussianPassH.setUniform("textureWidth",n),this._gaussianPassH.render(t),this._frameBuffer.attach(e),this._gaussianPassV.setUniform("texture",r),this._gaussianPassV.setUniform("textureHeight",n),this._gaussianPassV.render(t),this._frameBuffer.unbind(t),this._texturePool.put(r)},_getTexture:function(t,e){var n=t.__uid__,r=this._textures[n],i=t.shadowResolution||512;return e=e||1,r||((r=new("POINT_LIGHT"===t.type?iM:_S)).width=i*e,r.height=i,this.softShadow===bC.VSM?(r.type=pS.FLOAT,r.anisotropic=4):(r.minFilter=Bb.NEAREST,r.magFilter=Bb.NEAREST,r.useMipmap=!1),this._textures[n]=r),r},_getPointLightCamera:function(t,e){this._lightCameras.point||(this._lightCameras.point={px:new oM,nx:new oM,py:new oM,ny:new oM,pz:new oM,nz:new oM});var n=this._lightCameras.point[e];switch(n.far=t.range,n.fov=90,n.position.set(0,0,0),e){case"px":n.lookAt(fw.POSITIVE_X,fw.NEGATIVE_Y);break;case"nx":n.lookAt(fw.NEGATIVE_X,fw.NEGATIVE_Y);break;case"py":n.lookAt(fw.POSITIVE_Y,fw.POSITIVE_Z);break;case"ny":n.lookAt(fw.NEGATIVE_Y,fw.NEGATIVE_Z);break;case"pz":n.lookAt(fw.POSITIVE_Z,fw.NEGATIVE_Y);break;case"nz":n.lookAt(fw.NEGATIVE_Z,fw.NEGATIVE_Y)}return t.getWorldPosition(n.position),n.update(),n},_getDirectionalLightCamera:(cC=new Ow,dC=new Qw,pC=new Qw,function(t,e,n){this._lightCameras.directional||(this._lightCameras.directional=new ZM);var r=this._lightCameras.directional;return dC.copy(e.viewBoundingBoxLastFrame),dC.intersection(n.frustum.boundingBox),r.position.copy(dC.min).add(dC.max).scale(.5).transformMat4(n.worldTransform),r.rotation.copy(t.rotation),r.scale.copy(t.scale),r.updateWorldTransform(),Ow.invert(cC,r.worldTransform),Ow.multiply(cC,cC,n.worldTransform),pC.copy(dC).applyTransform(cC),t=pC.min.array,n=pC.max.array,r.position.set((t[0]+n[0])/2,(t[1]+n[1])/2,n[2]).transformMat4(r.worldTransform),r.near=0,r.far=-t[2]+n[2],isNaN(this.lightFrustumBias)?r.far*=4:r.far+=this.lightFrustumBias,r.left=t[0],r.right=n[0],r.top=n[1],r.bottom=t[1],r.update(!0),r}),_getSpotLightCamera:function(t){this._lightCameras.spot||(this._lightCameras.spot=new oM);var e=this._lightCameras.spot;return e.fov=2*t.penumbraAngle,e.far=t.range,e.worldTransform.copy(t.worldTransform),e.updateProjectionMatrix(),VT.invert(e.viewMatrix.array,e.worldTransform.array),e},dispose:function(t){var e,n=t.gl||t;for(e in this._frameBuffer&&this._frameBuffer.dispose(n),this._textures)this._textures[e].dispose(n);this._texturePool.clear(t.gl),this._depthMaterials={},this._distanceMaterials={},this._textures={},this._lightCameras={},this._shadowMapNumber={POINT_LIGHT:0,DIRECTIONAL_LIGHT:0,SPOT_LIGHT:0},this._meshMaterials={};for(var r=0;r<this._receivers.length;r++){var i=this._receivers[r];i.material&&((i=i.material).undefine("fragment","POINT_LIGHT_SHADOW_COUNT"),i.undefine("fragment","DIRECTIONAL_LIGHT_SHADOW_COUNT"),i.undefine("fragment","AMBIENT_LIGHT_SHADOW_COUNT"),i.set("shadowEnabled",0))}this._receivers=[],this._lightsCastShadow=[]}});bC.VSM=1,bC.PCF=2;var TC,wC=bC,SC=wu.extend((function(){return{name:"",inputLinks:{},outputLinks:{},_prevOutputTextures:{},_outputTextures:{},_outputReferences:{},_rendering:!1,_rendered:!1,_compositor:null}}),{updateParameter:function(t,e){var n,r=this.outputs[t],i=r.parameters,o=(o=r._parametersCopy)||(r._parametersCopy={});if(i)for(var a in i)"width"!==a&&"height"!==a&&(o[a]=i[a]);return n=i.width instanceof Function?i.width.call(this,e):i.width,r=i.height instanceof Function?i.height.call(this,e):i.height,o.width===n&&o.height===r||this._outputTextures[t]&&this._outputTextures[t].dispose(e.gl),o.width=n,o.height=r,o},setParameter:function(t,e){},getParameter:function(t){},setParameters:function(t){for(var e in t)this.setParameter(e,t[e])},render:function(){},getOutput:function(t,e){if(null==e)return this._outputTextures[e=t];var n=this.outputs[e];return n?this._rendered?(n.outputLastFrame?this._prevOutputTextures:this._outputTextures)[e]:this._rendering?(this._prevOutputTextures[e]||(this._prevOutputTextures[e]=this._compositor.allocateTexture(n.parameters||{})),this._prevOutputTextures[e]):(this.render(t),this._outputTextures[e]):void 0},removeReference:function(t){this._outputReferences[t]--,0===this._outputReferences[t]&&(this.outputs[t].keepLastFrame?(this._prevOutputTextures[t]&&this._compositor.releaseTexture(this._prevOutputTextures[t]),this._prevOutputTextures[t]=this._outputTextures[t]):this._compositor.releaseTexture(this._outputTextures[t]))},link:function(t,e,n){this.inputLinks[t]={node:e,pin:n},e.outputLinks[n]||(e.outputLinks[n]=[]),e.outputLinks[n].push({node:this,pin:t}),this.pass.material.enableTexture(t)},clear:function(){this.inputLinks={},this.outputLinks={}},updateReference:function(t){if(!this._rendering){for(var e in this._rendering=!0,this.inputLinks)e=this.inputLinks[e],e.node.updateReference(e.pin);this._rendering=!1}t&&this._outputReferences[t]++},beforeFrame:function(){for(var t in this._rendered=!1,this.outputLinks)this._outputReferences[t]=0},afterFrame:function(){for(var t in this.outputLinks)0<this._outputReferences[t]&&(this.outputs[t].keepLastFrame?(this._prevOutputTextures[t]&&this._compositor.releaseTexture(this._prevOutputTextures[t]),this._prevOutputTextures[t]=this._outputTextures[t]):this._compositor.releaseTexture(this._outputTextures[t]))}}),MC=wu.extend((function(){return{nodes:[]}}),{dirty:function(){this._dirty=!0},addNode:function(t){0<=this.nodes.indexOf(t)||(this.nodes.push(t),this._dirty=!0)},removeNode:function(t){"string"==typeof t&&(t=this.getNodeByName(t)),t=this.nodes.indexOf(t),0<=t&&(this.nodes.splice(t,1),this._dirty=!0)},getNodeByName:function(t){for(var e=0;e<this.nodes.length;e++)if(this.nodes[e].name===t)return this.nodes[e]},update:function(){for(var t=0;t<this.nodes.length;t++)this.nodes[t].clear();for(t=0;t<this.nodes.length;t++){var e,n,r=this.nodes[t];if(r.inputs)for(var i in r.inputs)r.inputs[i]&&(!r.pass||r.pass.material.isUniformEnabled(i)?(e=r.inputs[i],(n=this.findPin(e))?r.link(i,n.node,n.pin):"string"==typeof e?console.warn("Node "+e+" not exist"):console.warn("Pin of "+e.node+"."+e.pin+" not exist")):console.warn("Pin "+r.name+"."+i+" not used."))}},findPin:function(t){var e;if("string"==typeof(t="string"==typeof t||t instanceof SC?{node:t}:t).node)for(var n=0;n<this.nodes.length;n++){var r=this.nodes[n];r.name===t.node&&(e=r)}else e=t.node;if(e){var i=t.pin;if(i||e.outputs&&(i=Object.keys(e.outputs)[0]),e.outputs[i])return{node:e,pin:i}}}}),AC=MC.extend((function(){return{_outputs:[],_texturePool:new sC,_frameBuffer:new mM({depthBuffer:!1})}}),{addNode:function(t){MC.prototype.addNode.call(this,t),t._compositor=this},render:function(t,e){if(this._dirty){this.update(),this._dirty=!1;for(var n=this._outputs.length=0;n<this.nodes.length;n++)this.nodes[n].outputs||this._outputs.push(this.nodes[n])}for(n=0;n<this.nodes.length;n++)this.nodes[n].beforeFrame();for(n=0;n<this._outputs.length;n++)this._outputs[n].updateReference();for(n=0;n<this._outputs.length;n++)this._outputs[n].render(t,e);for(n=0;n<this.nodes.length;n++)this.nodes[n].afterFrame()},allocateTexture:function(t){return this._texturePool.get(t)},releaseTexture:function(t){this._texturePool.put(t)},getFrameBuffer:function(){return this._frameBuffer},dispose:function(t){this._texturePool.clear(t)}}),CC=SC.extend({name:"scene",scene:null,camera:null,autoUpdateScene:!0,preZ:!1},(function(){this.frameBuffer=new mM}),{render:function(t){this._rendering=!0;var e=t.gl;if(this.trigger("beforerender"),this.outputs){var n,r=this.frameBuffer;for(n in this.outputs){var i=this.updateParameter(n,t),o=this.outputs[n];i=this._compositor.allocateTexture(i);this._outputTextures[n]=i,"string"==typeof(s=o.attachment||e.COLOR_ATTACHMENT0)&&(s=e[s]),r.attach(i,s)}r.bind(t);var a=t.getGLExtension("EXT_draw_buffers");if(a){var s,l=[];for(s in this.outputs)(s=parseInt(s))>=e.COLOR_ATTACHMENT0&&s<=e.COLOR_ATTACHMENT0+8&&l.push(s);a.drawBuffersEXT(l)}t.saveClear(),t.clearBit=Bb.DEPTH_BUFFER_BIT|Bb.COLOR_BUFFER_BIT,a=t.render(this.scene,this.camera,!this.autoUpdateScene,this.preZ),t.restoreClear(),r.unbind(t)}else a=t.render(this.scene,this.camera,!this.autoUpdateScene,this.preZ);this.trigger("afterrender",a),this._rendering=!1,this._rendered=!0}}),EC=SC.extend((function(){return{texture:null,outputs:{color:{}}}}),(function(){}),{getOutput:function(t,e){return this.texture},beforeFrame:function(){},afterFrame:function(){}}),IC=SC.extend((function(){return{name:"",inputs:{},outputs:null,shader:"",inputLinks:{},outputLinks:{},pass:null,_prevOutputTextures:{},_outputTextures:{},_outputReferences:{},_rendering:!1,_rendered:!1,_compositor:null}}),(function(){var t=new QM({fragment:this.shader});this.pass=t}),{render:function(t,e){this.trigger("beforerender",t),this._rendering=!0;var n,r=t.gl;for(n in this.inputLinks){var i,o=(i=this.inputLinks[n]).node.getOutput(t,i.pin);this.pass.setUniform(n,o)}if(this.outputs){this.pass.outputs={};var a,s={};for(a in this.outputs){var l=this.updateParameter(a,t);isNaN(l.width)&&this.updateParameter(a,t);var u,h=this.outputs[a];l=this._compositor.allocateTexture(l);this._outputTextures[a]=l,s[u="string"==typeof(u=h.attachment||r.COLOR_ATTACHMENT0)?r[u]:u]=l}for(u in this._compositor.getFrameBuffer().bind(t),s)this._compositor.getFrameBuffer().attach(s[u],u);this.pass.render(t),this._compositor.getFrameBuffer().updateMipmap(t)}else this.pass.outputs=null,this._compositor.getFrameBuffer().unbind(t),this.pass.render(t,e);for(n in this.inputLinks)(i=this.inputLinks[n]).node.removeReference(i.pin);this._rendering=!1,this._rendered=!0,this.trigger("afterrender",t)},updateParameter:function(t,e){var n,r=this.outputs[t],i=r.parameters,o=(o=r._parametersCopy)||(r._parametersCopy={});if(i)for(var a in i)"width"!==a&&"height"!==a&&(o[a]=i[a]);return n="function"==typeof i.width?i.width.call(this,e):i.width,r="function"==typeof i.height?i.height.call(this,e):i.height,n=Math.ceil(n),r=Math.ceil(r),o.width===n&&o.height===r||this._outputTextures[t]&&this._outputTextures[t].dispose(e),o.width=n,o.height=r,o},setParameter:function(t,e){this.pass.setUniform(t,e)},getParameter:function(t){return this.pass.getUniform(t)},setParameters:function(t){for(var e in t)this.setParameter(e,t[e])},define:function(t,e){this.pass.material.define("fragment",t,e)},undefine:function(t){this.pass.material.undefine("fragment",t)},removeReference:function(t){this._outputReferences[t]--,0===this._outputReferences[t]&&(this.outputs[t].keepLastFrame?(this._prevOutputTextures[t]&&this._compositor.releaseTexture(this._prevOutputTextures[t]),this._prevOutputTextures[t]=this._outputTextures[t]):this._compositor.releaseTexture(this._outputTextures[t]))},clear:function(){SC.prototype.clear.call(this),this.pass.material.disableTexturesAll()}}),DC="@export clay.compositor.kernel.gaussian_9\nfloat gaussianKernel[9];\ngaussianKernel[0] = 0.07;\ngaussianKernel[1] = 0.09;\ngaussianKernel[2] = 0.12;\ngaussianKernel[3] = 0.14;\ngaussianKernel[4] = 0.16;\ngaussianKernel[5] = 0.14;\ngaussianKernel[6] = 0.12;\ngaussianKernel[7] = 0.09;\ngaussianKernel[8] = 0.07;\n@end\n@export clay.compositor.kernel.gaussian_13\nfloat gaussianKernel[13];\ngaussianKernel[0] = 0.02;\ngaussianKernel[1] = 0.03;\ngaussianKernel[2] = 0.06;\ngaussianKernel[3] = 0.08;\ngaussianKernel[4] = 0.11;\ngaussianKernel[5] = 0.13;\ngaussianKernel[6] = 0.14;\ngaussianKernel[7] = 0.13;\ngaussianKernel[8] = 0.11;\ngaussianKernel[9] = 0.08;\ngaussianKernel[10] = 0.06;\ngaussianKernel[11] = 0.03;\ngaussianKernel[12] = 0.02;\n@end\n@export clay.compositor.gaussian_blur\n#define SHADER_NAME gaussian_blur\nuniform sampler2D texture;varying vec2 v_Texcoord;\nuniform float blurSize : 2.0;\nuniform vec2 textureSize : [512.0, 512.0];\nuniform float blurDir : 0.0;\n@import clay.util.rgbm\n@import clay.util.clamp_sample\nvoid main (void)\n{\n @import clay.compositor.kernel.gaussian_9\n vec2 off = blurSize / textureSize;\n off *= vec2(1.0 - blurDir, blurDir);\n vec4 sum = vec4(0.0);\n float weightAll = 0.0;\n for (int i = 0; i < 9; i++) {\n float w = gaussianKernel[i];\n vec4 texel = decodeHDR(clampSample(texture, v_Texcoord + float(i - 4) * off));\n sum += texel * w;\n weightAll += w;\n }\n gl_FragColor = encodeHDR(sum / max(weightAll, 0.01));\n}\n@end\n",RC="\n@export clay.compositor.lut\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform sampler2D lookup;\nvoid main()\n{\n vec4 tex = texture2D(texture, v_Texcoord);\n float blueColor = tex.b * 63.0;\n vec2 quad1;\n quad1.y = floor(floor(blueColor) / 8.0);\n quad1.x = floor(blueColor) - (quad1.y * 8.0);\n vec2 quad2;\n quad2.y = floor(ceil(blueColor) / 8.0);\n quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n vec2 texPos1;\n texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.r);\n texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.g);\n vec2 texPos2;\n texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.r);\n texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.g);\n vec4 newColor1 = texture2D(lookup, texPos1);\n vec4 newColor2 = texture2D(lookup, texPos2);\n vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\n gl_FragColor = vec4(newColor.rgb, tex.w);\n}\n@end",LC="@export clay.compositor.output\n#define OUTPUT_ALPHA\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\n@import clay.util.rgbm\nvoid main()\n{\n vec4 tex = decodeHDR(texture2D(texture, v_Texcoord));\n gl_FragColor.rgb = tex.rgb;\n#ifdef OUTPUT_ALPHA\n gl_FragColor.a = tex.a;\n#else\n gl_FragColor.a = 1.0;\n#endif\n gl_FragColor = encodeHDR(gl_FragColor);\n#ifdef PREMULTIPLY_ALPHA\n gl_FragColor.rgb *= gl_FragColor.a;\n#endif\n}\n@end",OC="@export clay.compositor.bright\nuniform sampler2D texture;\nuniform float threshold : 1;\nuniform float scale : 1.0;\nuniform vec2 textureSize: [512, 512];\nvarying vec2 v_Texcoord;\nconst vec3 lumWeight = vec3(0.2125, 0.7154, 0.0721);\n@import clay.util.rgbm\nvec4 median(vec4 a, vec4 b, vec4 c)\n{\n return a + b + c - min(min(a, b), c) - max(max(a, b), c);\n}\nvoid main()\n{\n vec4 texel = decodeHDR(texture2D(texture, v_Texcoord));\n#ifdef ANTI_FLICKER\n vec3 d = 1.0 / textureSize.xyx * vec3(1.0, 1.0, 0.0);\n vec4 s1 = decodeHDR(texture2D(texture, v_Texcoord - d.xz));\n vec4 s2 = decodeHDR(texture2D(texture, v_Texcoord + d.xz));\n vec4 s3 = decodeHDR(texture2D(texture, v_Texcoord - d.zy));\n vec4 s4 = decodeHDR(texture2D(texture, v_Texcoord + d.zy));\n texel = median(median(texel, s1, s2), s3, s4);\n#endif\n float lum = dot(texel.rgb , lumWeight);\n vec4 color;\n if (lum > threshold && texel.a > 0.0)\n {\n color = vec4(texel.rgb * scale, texel.a * scale);\n }\n else\n {\n color = vec4(0.0);\n }\n gl_FragColor = encodeHDR(color);\n}\n@end\n",PC="@export clay.compositor.downsample\nuniform sampler2D texture;\nuniform vec2 textureSize : [512, 512];\nvarying vec2 v_Texcoord;\n@import clay.util.rgbm\nfloat brightness(vec3 c)\n{\n return max(max(c.r, c.g), c.b);\n}\n@import clay.util.clamp_sample\nvoid main()\n{\n vec4 d = vec4(-1.0, -1.0, 1.0, 1.0) / textureSize.xyxy;\n#ifdef ANTI_FLICKER\n vec3 s1 = decodeHDR(clampSample(texture, v_Texcoord + d.xy)).rgb;\n vec3 s2 = decodeHDR(clampSample(texture, v_Texcoord + d.zy)).rgb;\n vec3 s3 = decodeHDR(clampSample(texture, v_Texcoord + d.xw)).rgb;\n vec3 s4 = decodeHDR(clampSample(texture, v_Texcoord + d.zw)).rgb;\n float s1w = 1.0 / (brightness(s1) + 1.0);\n float s2w = 1.0 / (brightness(s2) + 1.0);\n float s3w = 1.0 / (brightness(s3) + 1.0);\n float s4w = 1.0 / (brightness(s4) + 1.0);\n float oneDivideSum = 1.0 / (s1w + s2w + s3w + s4w);\n vec4 color = vec4(\n (s1 * s1w + s2 * s2w + s3 * s3w + s4 * s4w) * oneDivideSum,\n 1.0\n );\n#else\n vec4 color = decodeHDR(clampSample(texture, v_Texcoord + d.xy));\n color += decodeHDR(clampSample(texture, v_Texcoord + d.zy));\n color += decodeHDR(clampSample(texture, v_Texcoord + d.xw));\n color += decodeHDR(clampSample(texture, v_Texcoord + d.zw));\n color *= 0.25;\n#endif\n gl_FragColor = encodeHDR(color);\n}\n@end",NC="\n@export clay.compositor.upsample\n#define HIGH_QUALITY\nuniform sampler2D texture;\nuniform vec2 textureSize : [512, 512];\nuniform float sampleScale: 0.5;\nvarying vec2 v_Texcoord;\n@import clay.util.rgbm\n@import clay.util.clamp_sample\nvoid main()\n{\n#ifdef HIGH_QUALITY\n vec4 d = vec4(1.0, 1.0, -1.0, 0.0) / textureSize.xyxy * sampleScale;\n vec4 s;\n s = decodeHDR(clampSample(texture, v_Texcoord - d.xy));\n s += decodeHDR(clampSample(texture, v_Texcoord - d.wy)) * 2.0;\n s += decodeHDR(clampSample(texture, v_Texcoord - d.zy));\n s += decodeHDR(clampSample(texture, v_Texcoord + d.zw)) * 2.0;\n s += decodeHDR(clampSample(texture, v_Texcoord )) * 4.0;\n s += decodeHDR(clampSample(texture, v_Texcoord + d.xw)) * 2.0;\n s += decodeHDR(clampSample(texture, v_Texcoord + d.zy));\n s += decodeHDR(clampSample(texture, v_Texcoord + d.wy)) * 2.0;\n s += decodeHDR(clampSample(texture, v_Texcoord + d.xy));\n gl_FragColor = encodeHDR(s / 16.0);\n#else\n vec4 d = vec4(-1.0, -1.0, +1.0, +1.0) / textureSize.xyxy;\n vec4 s;\n s = decodeHDR(clampSample(texture, v_Texcoord + d.xy));\n s += decodeHDR(clampSample(texture, v_Texcoord + d.zy));\n s += decodeHDR(clampSample(texture, v_Texcoord + d.xw));\n s += decodeHDR(clampSample(texture, v_Texcoord + d.zw));\n gl_FragColor = encodeHDR(s / 4.0);\n#endif\n}\n@end",kC="@export clay.compositor.hdr.composite\n#define TONEMAPPING\nuniform sampler2D texture;\n#ifdef BLOOM_ENABLED\nuniform sampler2D bloom;\n#endif\n#ifdef LENSFLARE_ENABLED\nuniform sampler2D lensflare;\nuniform sampler2D lensdirt;\n#endif\n#ifdef LUM_ENABLED\nuniform sampler2D lum;\n#endif\n#ifdef LUT_ENABLED\nuniform sampler2D lut;\n#endif\n#ifdef COLOR_CORRECTION\nuniform float brightness : 0.0;\nuniform float contrast : 1.0;\nuniform float saturation : 1.0;\n#endif\n#ifdef VIGNETTE\nuniform float vignetteDarkness: 1.0;\nuniform float vignetteOffset: 1.0;\n#endif\nuniform float exposure : 1.0;\nuniform float bloomIntensity : 0.25;\nuniform float lensflareIntensity : 1;\nvarying vec2 v_Texcoord;\n@import clay.util.srgb\nvec3 ACESToneMapping(vec3 color)\n{\n const float A = 2.51;\n const float B = 0.03;\n const float C = 2.43;\n const float D = 0.59;\n const float E = 0.14;\n return (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nfloat eyeAdaption(float fLum)\n{\n return mix(0.2, fLum, 0.5);\n}\n#ifdef LUT_ENABLED\nvec3 lutTransform(vec3 color) {\n float blueColor = color.b * 63.0;\n vec2 quad1;\n quad1.y = floor(floor(blueColor) / 8.0);\n quad1.x = floor(blueColor) - (quad1.y * 8.0);\n vec2 quad2;\n quad2.y = floor(ceil(blueColor) / 8.0);\n quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n vec2 texPos1;\n texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.r);\n texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.g);\n vec2 texPos2;\n texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.r);\n texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * color.g);\n vec4 newColor1 = texture2D(lut, texPos1);\n vec4 newColor2 = texture2D(lut, texPos2);\n vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\n return newColor.rgb;\n}\n#endif\n@import clay.util.rgbm\nvoid main()\n{\n vec4 texel = vec4(0.0);\n vec4 originalTexel = vec4(0.0);\n#ifdef TEXTURE_ENABLED\n texel = decodeHDR(texture2D(texture, v_Texcoord));\n originalTexel = texel;\n#endif\n#ifdef BLOOM_ENABLED\n vec4 bloomTexel = decodeHDR(texture2D(bloom, v_Texcoord));\n texel.rgb += bloomTexel.rgb * bloomIntensity;\n texel.a += bloomTexel.a * bloomIntensity;\n#endif\n#ifdef LENSFLARE_ENABLED\n texel += decodeHDR(texture2D(lensflare, v_Texcoord)) * texture2D(lensdirt, v_Texcoord) * lensflareIntensity;\n#endif\n texel.a = min(texel.a, 1.0);\n#ifdef LUM_ENABLED\n float fLum = texture2D(lum, vec2(0.5, 0.5)).r;\n float adaptedLumDest = 3.0 / (max(0.1, 1.0 + 10.0*eyeAdaption(fLum)));\n float exposureBias = adaptedLumDest * exposure;\n#else\n float exposureBias = exposure;\n#endif\n#ifdef TONEMAPPING\n texel.rgb *= exposureBias;\n texel.rgb = ACESToneMapping(texel.rgb);\n#endif\n texel = linearTosRGB(texel);\n#ifdef LUT_ENABLED\n texel.rgb = lutTransform(clamp(texel.rgb,vec3(0.0),vec3(1.0)));\n#endif\n#ifdef COLOR_CORRECTION\n texel.rgb = clamp(texel.rgb + vec3(brightness), 0.0, 1.0);\n texel.rgb = clamp((texel.rgb - vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);\n float lum = dot(texel.rgb, vec3(0.2125, 0.7154, 0.0721));\n texel.rgb = mix(vec3(lum), texel.rgb, saturation);\n#endif\n#ifdef VIGNETTE\n vec2 uv = (v_Texcoord - vec2(0.5)) * vec2(vignetteOffset);\n texel.rgb = mix(texel.rgb, vec3(1.0 - vignetteDarkness), dot(uv, uv));\n#endif\n gl_FragColor = encodeHDR(texel);\n#ifdef DEBUG\n #if DEBUG == 1\n gl_FragColor = encodeHDR(decodeHDR(texture2D(texture, v_Texcoord)));\n #elif DEBUG == 2\n gl_FragColor = encodeHDR(decodeHDR(texture2D(bloom, v_Texcoord)) * bloomIntensity);\n #elif DEBUG == 3\n gl_FragColor = encodeHDR(decodeHDR(texture2D(lensflare, v_Texcoord) * lensflareIntensity));\n #endif\n#endif\n if (originalTexel.a <= 0.01 && gl_FragColor.a > 1e-5) {\n gl_FragColor.a = dot(gl_FragColor.rgb, vec3(0.2125, 0.7154, 0.0721));\n }\n#ifdef PREMULTIPLY_ALPHA\n gl_FragColor.rgb *= gl_FragColor.a;\n#endif\n}\n@end",BC="@export clay.compositor.blend\n#define SHADER_NAME blend\n#ifdef TEXTURE1_ENABLED\nuniform sampler2D texture1;\nuniform float weight1 : 1.0;\n#endif\n#ifdef TEXTURE2_ENABLED\nuniform sampler2D texture2;\nuniform float weight2 : 1.0;\n#endif\n#ifdef TEXTURE3_ENABLED\nuniform sampler2D texture3;\nuniform float weight3 : 1.0;\n#endif\n#ifdef TEXTURE4_ENABLED\nuniform sampler2D texture4;\nuniform float weight4 : 1.0;\n#endif\n#ifdef TEXTURE5_ENABLED\nuniform sampler2D texture5;\nuniform float weight5 : 1.0;\n#endif\n#ifdef TEXTURE6_ENABLED\nuniform sampler2D texture6;\nuniform float weight6 : 1.0;\n#endif\nvarying vec2 v_Texcoord;\n@import clay.util.rgbm\nvoid main()\n{\n vec4 tex = vec4(0.0);\n#ifdef TEXTURE1_ENABLED\n tex += decodeHDR(texture2D(texture1, v_Texcoord)) * weight1;\n#endif\n#ifdef TEXTURE2_ENABLED\n tex += decodeHDR(texture2D(texture2, v_Texcoord)) * weight2;\n#endif\n#ifdef TEXTURE3_ENABLED\n tex += decodeHDR(texture2D(texture3, v_Texcoord)) * weight3;\n#endif\n#ifdef TEXTURE4_ENABLED\n tex += decodeHDR(texture2D(texture4, v_Texcoord)) * weight4;\n#endif\n#ifdef TEXTURE5_ENABLED\n tex += decodeHDR(texture2D(texture5, v_Texcoord)) * weight5;\n#endif\n#ifdef TEXTURE6_ENABLED\n tex += decodeHDR(texture2D(texture6, v_Texcoord)) * weight6;\n#endif\n gl_FragColor = encodeHDR(tex);\n}\n@end",FC="@export clay.compositor.fxaa\nuniform sampler2D texture;\nuniform vec4 viewport : VIEWPORT;\nvarying vec2 v_Texcoord;\n#define FXAA_REDUCE_MIN (1.0/128.0)\n#define FXAA_REDUCE_MUL (1.0/8.0)\n#define FXAA_SPAN_MAX 8.0\n@import clay.util.rgbm\nvoid main()\n{\n vec2 resolution = 1.0 / viewport.zw;\n vec3 rgbNW = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ) ).xyz;\n vec3 rgbNE = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ) ).xyz;\n vec3 rgbSW = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ) ).xyz;\n vec3 rgbSE = decodeHDR( texture2D( texture, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ) ).xyz;\n vec4 rgbaM = decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution ) );\n vec3 rgbM = rgbaM.xyz;\n float opacity = rgbaM.w;\n vec3 luma = vec3( 0.299, 0.587, 0.114 );\n float lumaNW = dot( rgbNW, luma );\n float lumaNE = dot( rgbNE, luma );\n float lumaSW = dot( rgbSW, luma );\n float lumaSE = dot( rgbSE, luma );\n float lumaM = dot( rgbM, luma );\n float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );\n float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );\n vec2 dir;\n dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n dir.y = ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );\n float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );\n dir = min( vec2( FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n dir * rcpDirMin)) * resolution;\n vec3 rgbA = decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * ( 1.0 / 3.0 - 0.5 ) ) ).xyz;\n rgbA += decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * ( 2.0 / 3.0 - 0.5 ) ) ).xyz;\n rgbA *= 0.5;\n vec3 rgbB = decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * -0.5 ) ).xyz;\n rgbB += decodeHDR( texture2D( texture, gl_FragCoord.xy * resolution + dir * 0.5 ) ).xyz;\n rgbB *= 0.25;\n rgbB += rgbA * 0.5;\n float lumaB = dot( rgbB, luma );\n if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) )\n {\n gl_FragColor = vec4( rgbA, opacity );\n }\n else {\n gl_FragColor = vec4( rgbB, opacity );\n }\n}\n@end";(TC=FT).import("@export clay.compositor.coloradjust\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float brightness : 0.0;\nuniform float contrast : 1.0;\nuniform float exposure : 0.0;\nuniform float gamma : 1.0;\nuniform float saturation : 1.0;\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\nvoid main()\n{\n vec4 tex = texture2D( texture, v_Texcoord);\n vec3 color = clamp(tex.rgb + vec3(brightness), 0.0, 1.0);\n color = clamp( (color-vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);\n color = clamp( color * pow(2.0, exposure), 0.0, 1.0);\n color = clamp( pow(color, vec3(gamma)), 0.0, 1.0);\n float luminance = dot( color, w );\n color = mix(vec3(luminance), color, saturation);\n gl_FragColor = vec4(color, tex.a);\n}\n@end\n@export clay.compositor.brightness\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float brightness : 0.0;\nvoid main()\n{\n vec4 tex = texture2D( texture, v_Texcoord);\n vec3 color = tex.rgb + vec3(brightness);\n gl_FragColor = vec4(color, tex.a);\n}\n@end\n@export clay.compositor.contrast\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float contrast : 1.0;\nvoid main()\n{\n vec4 tex = texture2D( texture, v_Texcoord);\n vec3 color = (tex.rgb-vec3(0.5))*contrast+vec3(0.5);\n gl_FragColor = vec4(color, tex.a);\n}\n@end\n@export clay.compositor.exposure\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float exposure : 0.0;\nvoid main()\n{\n vec4 tex = texture2D(texture, v_Texcoord);\n vec3 color = tex.rgb * pow(2.0, exposure);\n gl_FragColor = vec4(color, tex.a);\n}\n@end\n@export clay.compositor.gamma\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float gamma : 1.0;\nvoid main()\n{\n vec4 tex = texture2D(texture, v_Texcoord);\n vec3 color = pow(tex.rgb, vec3(gamma));\n gl_FragColor = vec4(color, tex.a);\n}\n@end\n@export clay.compositor.saturation\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float saturation : 1.0;\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\nvoid main()\n{\n vec4 tex = texture2D(texture, v_Texcoord);\n vec3 color = tex.rgb;\n float luminance = dot(color, w);\n color = mix(vec3(luminance), color, saturation);\n gl_FragColor = vec4(color, tex.a);\n}\n@end"),TC.import(DC),TC.import("@export clay.compositor.hdr.log_lum\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\n@import clay.util.rgbm\nvoid main()\n{\n vec4 tex = decodeHDR(texture2D(texture, v_Texcoord));\n float luminance = dot(tex.rgb, w);\n luminance = log(luminance + 0.001);\n gl_FragColor = encodeHDR(vec4(vec3(luminance), 1.0));\n}\n@end\n@export clay.compositor.hdr.lum_adaption\nvarying vec2 v_Texcoord;\nuniform sampler2D adaptedLum;\nuniform sampler2D currentLum;\nuniform float frameTime : 0.02;\n@import clay.util.rgbm\nvoid main()\n{\n float fAdaptedLum = decodeHDR(texture2D(adaptedLum, vec2(0.5, 0.5))).r;\n float fCurrentLum = exp(encodeHDR(texture2D(currentLum, vec2(0.5, 0.5))).r);\n fAdaptedLum += (fCurrentLum - fAdaptedLum) * (1.0 - pow(0.98, 30.0 * frameTime));\n gl_FragColor = encodeHDR(vec4(vec3(fAdaptedLum), 1.0));\n}\n@end\n@export clay.compositor.lum\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\nvoid main()\n{\n vec4 tex = texture2D( texture, v_Texcoord );\n float luminance = dot(tex.rgb, w);\n gl_FragColor = vec4(vec3(luminance), 1.0);\n}\n@end"),TC.import(RC),TC.import("@export clay.compositor.vignette\n#define OUTPUT_ALPHA\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\nuniform float darkness: 1;\nuniform float offset: 1;\n@import clay.util.rgbm\nvoid main()\n{\n vec4 texel = decodeHDR(texture2D(texture, v_Texcoord));\n gl_FragColor.rgb = texel.rgb;\n vec2 uv = (v_Texcoord - vec2(0.5)) * vec2(offset);\n gl_FragColor = encodeHDR(vec4(mix(texel.rgb, vec3(1.0 - darkness), dot(uv, uv)), texel.a));\n}\n@end"),TC.import(LC),TC.import(OC),TC.import(PC),TC.import(NC),TC.import(kC),TC.import("@export clay.compositor.lensflare\n#define SAMPLE_NUMBER 8\nuniform sampler2D texture;\nuniform sampler2D lenscolor;\nuniform vec2 textureSize : [512, 512];\nuniform float dispersal : 0.3;\nuniform float haloWidth : 0.4;\nuniform float distortion : 1.0;\nvarying vec2 v_Texcoord;\n@import clay.util.rgbm\nvec4 textureDistorted(\n in vec2 texcoord,\n in vec2 direction,\n in vec3 distortion\n) {\n return vec4(\n decodeHDR(texture2D(texture, texcoord + direction * distortion.r)).r,\n decodeHDR(texture2D(texture, texcoord + direction * distortion.g)).g,\n decodeHDR(texture2D(texture, texcoord + direction * distortion.b)).b,\n 1.0\n );\n}\nvoid main()\n{\n vec2 texcoord = -v_Texcoord + vec2(1.0); vec2 textureOffset = 1.0 / textureSize;\n vec2 ghostVec = (vec2(0.5) - texcoord) * dispersal;\n vec2 haloVec = normalize(ghostVec) * haloWidth;\n vec3 distortion = vec3(-textureOffset.x * distortion, 0.0, textureOffset.x * distortion);\n vec4 result = vec4(0.0);\n for (int i = 0; i < SAMPLE_NUMBER; i++)\n {\n vec2 offset = fract(texcoord + ghostVec * float(i));\n float weight = length(vec2(0.5) - offset) / length(vec2(0.5));\n weight = pow(1.0 - weight, 10.0);\n result += textureDistorted(offset, normalize(ghostVec), distortion) * weight;\n }\n result *= texture2D(lenscolor, vec2(length(vec2(0.5) - texcoord)) / length(vec2(0.5)));\n float weight = length(vec2(0.5) - fract(texcoord + haloVec)) / length(vec2(0.5));\n weight = pow(1.0 - weight, 10.0);\n vec2 offset = fract(texcoord + haloVec);\n result += textureDistorted(offset, normalize(ghostVec), distortion) * weight;\n gl_FragColor = result;\n}\n@end"),TC.import(BC),TC.import(FC);var zC=/^#source\((.*?)\)/;function HC(t,e){return t}function VC(t,e){return e}function UC(t){var e={};if(!t)return e;["type","minFilter","magFilter","wrapS","wrapT","flipY","useMipmap"].forEach((function(n){var r=t[n];null!=r&&("string"==typeof r&&(r=pS[r]),e[n]=r)}));var n=t.scale||1;return["width","height"].forEach((function(r){var i,o,a;null!=t[r]&&("string"==typeof(i=t[r])?(i=i.trim(),e[r]=(o=GC(i),a=(a=n)||1,function(t){var e=t.getDevicePixelRatio(),n=t.getWidth()*a;t=t.getHeight()*a;return o(n,t,e)})):e[r]=i)})),e.width||(e.width=HC),e.height||(e.height=VC),null!=t.useMipmap&&(e.useMipmap=t.useMipmap),e}function GC(t){if(t=/^expr\((.*)\)$/.exec(t),t)try{var e=new Function("width","height","dpr","return "+t[1]);return e(1,1),e}catch(t){throw new Error("Invalid expression.")}}var WC=function(t,e){var n=new AC;function r(r,i){for(var o=0;o<t.nodes.length;o++){var a=function(t,e,n){var r,i,o,a,s=t.type||"filter";if("filter"===s){var l=t.shader.trim(),u=zC.exec(l);if(u?r=FT.source(u[1].trim()):"#"===l.charAt(0)&&(r=e.shaders[l.substr(1)]),!(r=r||l))return}if(t.inputs)for(var h in i={},t.inputs)"string"==typeof t.inputs[h]?i[h]=t.inputs[h]:i[h]={node:t.inputs[h].node,pin:t.inputs[h].pin};if(t.outputs)for(var h in o={},t.outputs){var c=t.outputs[h];o[h]={},null!=c.attachment&&(o[h].attachment=c.attachment),null!=c.keepLastFrame&&(o[h].keepLastFrame=c.keepLastFrame),null!=c.outputLastFrame&&(o[h].outputLastFrame=c.outputLastFrame),c.parameters&&(o[h].parameters=UC(c.parameters))}if(a="scene"===s?new CC({name:t.name,scene:n.scene,camera:n.camera,outputs:o}):"texture"===s?new EC({name:t.name,outputs:o}):new IC({name:t.name,shader:r,inputs:i,outputs:o}),a){if(t.parameters)for(var h in t.parameters)"string"==typeof(d=t.parameters[h])?"#"===(d=d.trim()).charAt(0)?d=e.textures[d.substr(1)]:a.on("beforerender",function(t,e){return function(n){var r=n.getDevicePixelRatio(),i=n.getWidth();n=n.getHeight(),r=e(i,n,r);this.setParameter(t,r)}}(h,GC(d))):"function"==typeof d&&a.on("beforerender",d),a.setParameter(h,d);if(t.defines&&a.pass)for(var h in t.defines){var d=t.defines[h];a.pass.material.define("fragment",h,d)}}return a}(t.nodes[o],d,e);a&&n.addNode(a)}}e=e||{};var i,o,a,s,l,u,h,c,d={textures:{},parameters:{}};for(i in t.parameters){var p=t.parameters[i];d.parameters[i]=UC(p)}return a=e,s=function(t){d.textures=t,r()},(o=t).textures?(u=0,h=!(l={}),c=a.textureRootPath,Lb.each(o.textures,(function(t,e){var n,r=t.path;t=UC(t.parameters);if(Array.isArray(r)&&6===r.length)c&&(r=r.map((function(t){return Lb.relative2absolute(t,c)}))),n=new iM(t);else{if("string"!=typeof r)return;c&&(r=Lb.relative2absolute(r,c)),n=new _S(t)}n.load(r),u++,n.once("success",(function(){l[e]=n,0===--u&&(s(l),h=!0)}))})),0!==u||h||s(l)):s({}),n},XC=function(t,e){for(var n=0,r=1/e,i=t;0<i;)n+=r*(i%e),i=Math.floor(i/e),r/=e;return n};function jC(t){for(var e=new Uint8Array(t*t*4),n=0,r=new fw,i=0;i<t;i++)for(var o=0;o<t;o++)r.set(2*Math.random()-1,2*Math.random()-1,0).normalize(),e[n++]=255*(.5*r.x+.5),e[n++]=255*(.5*r.y+.5),e[n++]=0,e[n++]=255;return e}function YC(t){return new _S({pixels:jC(t),wrapS:pS.REPEAT,wrapT:pS.REPEAT,width:t,height:t})}function ZC(t){t=t||{},this._ssaoPass=new QM({fragment:FT.source("ecgl.ssao.estimate")}),this._blurPass=new QM({fragment:FT.source("ecgl.ssao.blur")}),this._framebuffer=new mM({depthBuffer:!1}),this._ssaoTexture=new _S,this._blurTexture=new _S,this._blurTexture2=new _S,this._depthTex=t.depthTexture,this._normalTex=t.normalTexture,this.setNoiseSize(4),this.setKernelSize(t.kernelSize||12),null!=t.radius&&this.setParameter("radius",t.radius),null!=t.power&&this.setParameter("power",t.power),this._normalTex||(this._ssaoPass.material.disableTexture("normalTex"),this._blurPass.material.disableTexture("normalTex")),this._depthTex||this._blurPass.material.disableTexture("depthTex"),this._blurPass.material.setUniform("normalTex",this._normalTex),this._blurPass.material.setUniform("depthTex",this._depthTex)}FT.import("@export ecgl.ssao.estimate\n\nuniform sampler2D depthTex;\n\nuniform sampler2D normalTex;\n\nuniform sampler2D noiseTex;\n\nuniform vec2 depthTexSize;\n\nuniform vec2 noiseTexSize;\n\nuniform mat4 projection;\n\nuniform mat4 projectionInv;\n\nuniform mat4 viewInverseTranspose;\n\nuniform vec3 kernel[KERNEL_SIZE];\n\nuniform float radius : 1;\n\nuniform float power : 1;\n\nuniform float bias: 1e-2;\n\nuniform float intensity: 1.0;\n\nvarying vec2 v_Texcoord;\n\nfloat ssaoEstimator(in vec3 originPos, in mat3 kernelBasis) {\n float occlusion = 0.0;\n\n for (int i = 0; i < KERNEL_SIZE; i++) {\n vec3 samplePos = kernel[i];\n#ifdef NORMALTEX_ENABLED\n samplePos = kernelBasis * samplePos;\n#endif\n samplePos = samplePos * radius + originPos;\n\n vec4 texCoord = projection * vec4(samplePos, 1.0);\n texCoord.xy /= texCoord.w;\n\n vec4 depthTexel = texture2D(depthTex, texCoord.xy * 0.5 + 0.5);\n\n float sampleDepth = depthTexel.r * 2.0 - 1.0;\n if (projection[3][3] == 0.0) {\n sampleDepth = projection[3][2] / (sampleDepth * projection[2][3] - projection[2][2]);\n }\n else {\n sampleDepth = (sampleDepth - projection[3][2]) / projection[2][2];\n }\n \n float rangeCheck = smoothstep(0.0, 1.0, radius / abs(originPos.z - sampleDepth));\n occlusion += rangeCheck * step(samplePos.z, sampleDepth - bias);\n }\n#ifdef NORMALTEX_ENABLED\n occlusion = 1.0 - occlusion / float(KERNEL_SIZE);\n#else\n occlusion = 1.0 - clamp((occlusion / float(KERNEL_SIZE) - 0.6) * 2.5, 0.0, 1.0);\n#endif\n return pow(occlusion, power);\n}\n\nvoid main()\n{\n\n vec4 depthTexel = texture2D(depthTex, v_Texcoord);\n\n#ifdef NORMALTEX_ENABLED\n vec4 tex = texture2D(normalTex, v_Texcoord);\n if (dot(tex.rgb, tex.rgb) == 0.0) {\n gl_FragColor = vec4(1.0);\n return;\n }\n vec3 N = tex.rgb * 2.0 - 1.0;\n N = (viewInverseTranspose * vec4(N, 0.0)).xyz;\n\n vec2 noiseTexCoord = depthTexSize / vec2(noiseTexSize) * v_Texcoord;\n vec3 rvec = texture2D(noiseTex, noiseTexCoord).rgb * 2.0 - 1.0;\n vec3 T = normalize(rvec - N * dot(rvec, N));\n vec3 BT = normalize(cross(N, T));\n mat3 kernelBasis = mat3(T, BT, N);\n#else\n if (depthTexel.r > 0.99999) {\n gl_FragColor = vec4(1.0);\n return;\n }\n mat3 kernelBasis;\n#endif\n\n float z = depthTexel.r * 2.0 - 1.0;\n\n vec4 projectedPos = vec4(v_Texcoord * 2.0 - 1.0, z, 1.0);\n vec4 p4 = projectionInv * projectedPos;\n\n vec3 position = p4.xyz / p4.w;\n\n float ao = ssaoEstimator(position, kernelBasis);\n ao = clamp(1.0 - (1.0 - ao) * intensity, 0.0, 1.0);\n gl_FragColor = vec4(vec3(ao), 1.0);\n}\n\n@end\n\n\n@export ecgl.ssao.blur\n#define SHADER_NAME SSAO_BLUR\n\nuniform sampler2D ssaoTexture;\n\n#ifdef NORMALTEX_ENABLED\nuniform sampler2D normalTex;\n#endif\n\nvarying vec2 v_Texcoord;\n\nuniform vec2 textureSize;\nuniform float blurSize : 1.0;\n\nuniform int direction: 0.0;\n\n#ifdef DEPTHTEX_ENABLED\nuniform sampler2D depthTex;\nuniform mat4 projection;\nuniform float depthRange : 0.5;\n\nfloat getLinearDepth(vec2 coord)\n{\n float depth = texture2D(depthTex, coord).r * 2.0 - 1.0;\n return projection[3][2] / (depth * projection[2][3] - projection[2][2]);\n}\n#endif\n\nvoid main()\n{\n float kernel[5];\n kernel[0] = 0.122581;\n kernel[1] = 0.233062;\n kernel[2] = 0.288713;\n kernel[3] = 0.233062;\n kernel[4] = 0.122581;\n\n vec2 off = vec2(0.0);\n if (direction == 0) {\n off[0] = blurSize / textureSize.x;\n }\n else {\n off[1] = blurSize / textureSize.y;\n }\n\n vec2 coord = v_Texcoord;\n\n float sum = 0.0;\n float weightAll = 0.0;\n\n#ifdef NORMALTEX_ENABLED\n vec3 centerNormal = texture2D(normalTex, v_Texcoord).rgb * 2.0 - 1.0;\n#endif\n#if defined(DEPTHTEX_ENABLED)\n float centerDepth = getLinearDepth(v_Texcoord);\n#endif\n\n for (int i = 0; i < 5; i++) {\n vec2 coord = clamp(v_Texcoord + vec2(float(i) - 2.0) * off, vec2(0.0), vec2(1.0));\n\n float w = kernel[i];\n#ifdef NORMALTEX_ENABLED\n vec3 normal = texture2D(normalTex, coord).rgb * 2.0 - 1.0;\n w *= clamp(dot(normal, centerNormal), 0.0, 1.0);\n#endif\n#ifdef DEPTHTEX_ENABLED\n float d = getLinearDepth(coord);\n w *= (1.0 - smoothstep(abs(centerDepth - d) / depthRange, 0.0, 1.0));\n#endif\n\n weightAll += w;\n sum += texture2D(ssaoTexture, coord).r * w;\n }\n\n gl_FragColor = vec4(vec3(sum / weightAll), 1.0);\n}\n\n@end\n"),ZC.prototype.setDepthTexture=function(t){this._depthTex=t},ZC.prototype.setNormalTexture=function(t){this._normalTex=t,this._ssaoPass.material[t?"enableTexture":"disableTexture"]("normalTex"),this.setKernelSize(this._kernelSize)},ZC.prototype.update=function(t,e,n){var r=t.getWidth(),i=t.getHeight(),o=this._ssaoPass,a=this._blurPass;o.setUniform("kernel",this._kernels[n%this._kernels.length]),o.setUniform("depthTex",this._depthTex),null!=this._normalTex&&o.setUniform("normalTex",this._normalTex),o.setUniform("depthTexSize",[this._depthTex.width,this._depthTex.height]);var s=new Ow;Ow.transpose(s,e.worldTransform),o.setUniform("projection",e.projectionMatrix.array),o.setUniform("projectionInv",e.invProjectionMatrix.array),o.setUniform("viewInverseTranspose",s.array);var l=this._ssaoTexture;n=this._blurTexture,s=this._blurTexture2;l.width=r/2,l.height=i/2,n.width=r,n.height=i,s.width=r,s.height=i,this._framebuffer.attach(l),this._framebuffer.bind(t),t.gl.clearColor(1,1,1,1),t.gl.clear(t.gl.COLOR_BUFFER_BIT),o.render(t),a.setUniform("textureSize",[r/2,i/2]),a.setUniform("projection",e.projectionMatrix.array),this._framebuffer.attach(n),a.setUniform("direction",0),a.setUniform("ssaoTexture",l),a.render(t),this._framebuffer.attach(s),a.setUniform("textureSize",[r,i]),a.setUniform("direction",1),a.setUniform("ssaoTexture",n),a.render(t),this._framebuffer.unbind(t),a=t.clearColor,t.gl.clearColor(a[0],a[1],a[2],a[3])},ZC.prototype.getTargetTexture=function(){return this._blurTexture2},ZC.prototype.setParameter=function(t,e){"noiseTexSize"===t?this.setNoiseSize(e):"kernelSize"===t?this.setKernelSize(e):"intensity"===t?this._ssaoPass.material.set("intensity",e):this._ssaoPass.setUniform(t,e)},ZC.prototype.setKernelSize=function(t){this._kernelSize=t,this._ssaoPass.material.define("fragment","KERNEL_SIZE",t),this._kernels=this._kernels||[];for(var e=0;e<30;e++)this._kernels[e]=function(t,e,n){var r=new Float32Array(3*t);e=e||0;for(var i=0;i<t;i++){var o=XC(i+e,2)*(n?1:2)*Math.PI,a=XC(i+e,3)*Math.PI,s=Math.random(),l=Math.cos(o)*Math.sin(a)*s,u=Math.cos(a)*s;s=Math.sin(o)*Math.sin(a)*s;r[3*i]=l,r[3*i+1]=u,r[3*i+2]=s}return r}(t,e*t,!!this._normalTex)},ZC.prototype.setNoiseSize=function(t){var e=this._ssaoPass.getUniform("noiseTex");e?(e.data=jC(t),e.width=e.height=t,e.dirty()):(e=YC(t),this._ssaoPass.setUniform("noiseTex",YC(t))),this._ssaoPass.setUniform("noiseTexSize",[t,t])},ZC.prototype.dispose=function(t){this._blurTexture.dispose(t),this._ssaoTexture.dispose(t),this._blurTexture2.dispose(t)};var qC=ZC;function KC(t){t=t||{},this._ssrPass=new QM({fragment:FT.source("ecgl.ssr.main"),clearColor:[0,0,0,0]}),this._blurPass1=new QM({fragment:FT.source("ecgl.ssr.blur"),clearColor:[0,0,0,0]}),this._blurPass2=new QM({fragment:FT.source("ecgl.ssr.blur"),clearColor:[0,0,0,0]}),this._blendPass=new QM({fragment:FT.source("clay.compositor.blend")}),this._blendPass.material.disableTexturesAll(),this._blendPass.material.enableTexture(["texture1","texture2"]),this._ssrPass.setUniform("gBufferTexture1",t.normalTexture),this._ssrPass.setUniform("gBufferTexture2",t.depthTexture),this._blurPass1.setUniform("gBufferTexture1",t.normalTexture),this._blurPass1.setUniform("gBufferTexture2",t.depthTexture),this._blurPass2.setUniform("gBufferTexture1",t.normalTexture),this._blurPass2.setUniform("gBufferTexture2",t.depthTexture),this._blurPass2.material.define("fragment","VERTICAL"),this._blurPass2.material.define("fragment","BLEND"),this._ssrTexture=new _S({type:pS.HALF_FLOAT}),this._texture2=new _S({type:pS.HALF_FLOAT}),this._texture3=new _S({type:pS.HALF_FLOAT}),this._prevTexture=new _S({type:pS.HALF_FLOAT}),this._currentTexture=new _S({type:pS.HALF_FLOAT}),this._frameBuffer=new mM({depthBuffer:!1}),this._normalDistribution=null,this._totalSamples=256,this._samplePerFrame=4,this._ssrPass.material.define("fragment","SAMPLE_PER_FRAME",this._samplePerFrame),this._ssrPass.material.define("fragment","TOTAL_SAMPLES",this._totalSamples),this._downScale=1}FT.import("@export ecgl.ssr.main\n\n#define SHADER_NAME SSR\n#define MAX_ITERATION 20;\n#define SAMPLE_PER_FRAME 5;\n#define TOTAL_SAMPLES 128;\n\nuniform sampler2D sourceTexture;\nuniform sampler2D gBufferTexture1;\nuniform sampler2D gBufferTexture2;\nuniform sampler2D gBufferTexture3;\nuniform samplerCube specularCubemap;\nuniform float specularIntensity: 1;\n\nuniform mat4 projection;\nuniform mat4 projectionInv;\nuniform mat4 toViewSpace;\nuniform mat4 toWorldSpace;\n\nuniform float maxRayDistance: 200;\n\nuniform float pixelStride: 16;\nuniform float pixelStrideZCutoff: 50; \nuniform float screenEdgeFadeStart: 0.9; \nuniform float eyeFadeStart : 0.2; uniform float eyeFadeEnd: 0.8; \nuniform float minGlossiness: 0.2; uniform float zThicknessThreshold: 1;\n\nuniform float nearZ;\nuniform vec2 viewportSize : VIEWPORT_SIZE;\n\nuniform float jitterOffset: 0;\n\nvarying vec2 v_Texcoord;\n\n#ifdef DEPTH_DECODE\n@import clay.util.decode_float\n#endif\n\n#ifdef PHYSICALLY_CORRECT\nuniform sampler2D normalDistribution;\nuniform float sampleOffset: 0;\nuniform vec2 normalDistributionSize;\n\nvec3 transformNormal(vec3 H, vec3 N) {\n vec3 upVector = N.y > 0.999 ? vec3(1.0, 0.0, 0.0) : vec3(0.0, 1.0, 0.0);\n vec3 tangentX = normalize(cross(N, upVector));\n vec3 tangentZ = cross(N, tangentX);\n return normalize(tangentX * H.x + N * H.y + tangentZ * H.z);\n}\nvec3 importanceSampleNormalGGX(float i, float roughness, vec3 N) {\n float p = fract((i + sampleOffset) / float(TOTAL_SAMPLES));\n vec3 H = texture2D(normalDistribution,vec2(roughness, p)).rgb;\n return transformNormal(H, N);\n}\nfloat G_Smith(float g, float ndv, float ndl) {\n float roughness = 1.0 - g;\n float k = roughness * roughness / 2.0;\n float G1V = ndv / (ndv * (1.0 - k) + k);\n float G1L = ndl / (ndl * (1.0 - k) + k);\n return G1L * G1V;\n}\nvec3 F_Schlick(float ndv, vec3 spec) {\n return spec + (1.0 - spec) * pow(1.0 - ndv, 5.0);\n}\n#endif\n\nfloat fetchDepth(sampler2D depthTexture, vec2 uv)\n{\n vec4 depthTexel = texture2D(depthTexture, uv);\n return depthTexel.r * 2.0 - 1.0;\n}\n\nfloat linearDepth(float depth)\n{\n if (projection[3][3] == 0.0) {\n return projection[3][2] / (depth * projection[2][3] - projection[2][2]);\n }\n else {\n return (depth - projection[3][2]) / projection[2][2];\n }\n}\n\nbool rayIntersectDepth(float rayZNear, float rayZFar, vec2 hitPixel)\n{\n if (rayZFar > rayZNear)\n {\n float t = rayZFar; rayZFar = rayZNear; rayZNear = t;\n }\n float cameraZ = linearDepth(fetchDepth(gBufferTexture2, hitPixel));\n return rayZFar <= cameraZ && rayZNear >= cameraZ - zThicknessThreshold;\n}\n\n\nbool traceScreenSpaceRay(\n vec3 rayOrigin, vec3 rayDir, float jitter,\n out vec2 hitPixel, out vec3 hitPoint, out float iterationCount\n)\n{\n float rayLength = ((rayOrigin.z + rayDir.z * maxRayDistance) > -nearZ)\n ? (-nearZ - rayOrigin.z) / rayDir.z : maxRayDistance;\n\n vec3 rayEnd = rayOrigin + rayDir * rayLength;\n\n vec4 H0 = projection * vec4(rayOrigin, 1.0);\n vec4 H1 = projection * vec4(rayEnd, 1.0);\n\n float k0 = 1.0 / H0.w, k1 = 1.0 / H1.w;\n\n vec3 Q0 = rayOrigin * k0, Q1 = rayEnd * k1;\n\n vec2 P0 = (H0.xy * k0 * 0.5 + 0.5) * viewportSize;\n vec2 P1 = (H1.xy * k1 * 0.5 + 0.5) * viewportSize;\n\n P1 += dot(P1 - P0, P1 - P0) < 0.0001 ? 0.01 : 0.0;\n vec2 delta = P1 - P0;\n\n bool permute = false;\n if (abs(delta.x) < abs(delta.y)) {\n permute = true;\n delta = delta.yx;\n P0 = P0.yx;\n P1 = P1.yx;\n }\n float stepDir = sign(delta.x);\n float invdx = stepDir / delta.x;\n\n vec3 dQ = (Q1 - Q0) * invdx;\n float dk = (k1 - k0) * invdx;\n\n vec2 dP = vec2(stepDir, delta.y * invdx);\n\n float strideScaler = 1.0 - min(1.0, -rayOrigin.z / pixelStrideZCutoff);\n float pixStride = 1.0 + strideScaler * pixelStride;\n\n dP *= pixStride; dQ *= pixStride; dk *= pixStride;\n\n vec4 pqk = vec4(P0, Q0.z, k0);\n vec4 dPQK = vec4(dP, dQ.z, dk);\n\n pqk += dPQK * jitter;\n float rayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);\n float rayZNear;\n\n bool intersect = false;\n\n vec2 texelSize = 1.0 / viewportSize;\n\n iterationCount = 0.0;\n\n for (int i = 0; i < MAX_ITERATION; i++)\n {\n pqk += dPQK;\n\n rayZNear = rayZFar;\n rayZFar = (dPQK.z * 0.5 + pqk.z) / (dPQK.w * 0.5 + pqk.w);\n\n hitPixel = permute ? pqk.yx : pqk.xy;\n hitPixel *= texelSize;\n\n intersect = rayIntersectDepth(rayZNear, rayZFar, hitPixel);\n\n iterationCount += 1.0;\n\n dPQK *= 1.2;\n\n if (intersect) {\n break;\n }\n }\n\n Q0.xy += dQ.xy * iterationCount;\n Q0.z = pqk.z;\n hitPoint = Q0 / pqk.w;\n\n return intersect;\n}\n\nfloat calculateAlpha(\n float iterationCount, float reflectivity,\n vec2 hitPixel, vec3 hitPoint, float dist, vec3 rayDir\n)\n{\n float alpha = clamp(reflectivity, 0.0, 1.0);\n alpha *= 1.0 - (iterationCount / float(MAX_ITERATION));\n vec2 hitPixelNDC = hitPixel * 2.0 - 1.0;\n float maxDimension = min(1.0, max(abs(hitPixelNDC.x), abs(hitPixelNDC.y)));\n alpha *= 1.0 - max(0.0, maxDimension - screenEdgeFadeStart) / (1.0 - screenEdgeFadeStart);\n\n float _eyeFadeStart = eyeFadeStart;\n float _eyeFadeEnd = eyeFadeEnd;\n if (_eyeFadeStart > _eyeFadeEnd) {\n float tmp = _eyeFadeEnd;\n _eyeFadeEnd = _eyeFadeStart;\n _eyeFadeStart = tmp;\n }\n\n float eyeDir = clamp(rayDir.z, _eyeFadeStart, _eyeFadeEnd);\n alpha *= 1.0 - (eyeDir - _eyeFadeStart) / (_eyeFadeEnd - _eyeFadeStart);\n\n alpha *= 1.0 - clamp(dist / maxRayDistance, 0.0, 1.0);\n\n return alpha;\n}\n\n@import clay.util.rand\n\n@import clay.util.rgbm\n\nvoid main()\n{\n vec4 normalAndGloss = texture2D(gBufferTexture1, v_Texcoord);\n\n if (dot(normalAndGloss.rgb, vec3(1.0)) == 0.0) {\n discard;\n }\n\n float g = normalAndGloss.a;\n#if !defined(PHYSICALLY_CORRECT)\n if (g <= minGlossiness) {\n discard;\n }\n#endif\n\n float reflectivity = (g - minGlossiness) / (1.0 - minGlossiness);\n\n vec3 N = normalize(normalAndGloss.rgb * 2.0 - 1.0);\n N = normalize((toViewSpace * vec4(N, 0.0)).xyz);\n\n vec4 projectedPos = vec4(v_Texcoord * 2.0 - 1.0, fetchDepth(gBufferTexture2, v_Texcoord), 1.0);\n vec4 pos = projectionInv * projectedPos;\n vec3 rayOrigin = pos.xyz / pos.w;\n vec3 V = -normalize(rayOrigin);\n\n float ndv = clamp(dot(N, V), 0.0, 1.0);\n float iterationCount;\n float jitter = rand(fract(v_Texcoord + jitterOffset));\n\n#ifdef PHYSICALLY_CORRECT\n vec4 color = vec4(vec3(0.0), 1.0);\n vec4 albedoMetalness = texture2D(gBufferTexture3, v_Texcoord);\n vec3 albedo = albedoMetalness.rgb;\n float m = albedoMetalness.a;\n vec3 diffuseColor = albedo * (1.0 - m);\n vec3 spec = mix(vec3(0.04), albedo, m);\n\n float jitter2 = rand(fract(v_Texcoord)) * float(TOTAL_SAMPLES);\n\n for (int i = 0; i < SAMPLE_PER_FRAME; i++) {\n vec3 H = importanceSampleNormalGGX(float(i) + jitter2, 1.0 - g, N);\n vec3 rayDir = normalize(reflect(-V, H));\n#else\n vec3 rayDir = normalize(reflect(-V, N));\n#endif\n vec2 hitPixel;\n vec3 hitPoint;\n\n bool intersect = traceScreenSpaceRay(rayOrigin, rayDir, jitter, hitPixel, hitPoint, iterationCount);\n\n float dist = distance(rayOrigin, hitPoint);\n\n vec3 hitNormal = texture2D(gBufferTexture1, hitPixel).rgb * 2.0 - 1.0;\n hitNormal = normalize((toViewSpace * vec4(hitNormal, 0.0)).xyz);\n#ifdef PHYSICALLY_CORRECT\n float ndl = clamp(dot(N, rayDir), 0.0, 1.0);\n float vdh = clamp(dot(V, H), 0.0, 1.0);\n float ndh = clamp(dot(N, H), 0.0, 1.0);\n vec3 litTexel = vec3(0.0);\n if (dot(hitNormal, rayDir) < 0.0 && intersect) {\n litTexel = texture2D(sourceTexture, hitPixel).rgb;\n litTexel *= pow(clamp(1.0 - dist / 200.0, 0.0, 1.0), 3.0);\n\n }\n else {\n #ifdef SPECULARCUBEMAP_ENABLED\n vec3 rayDirW = normalize(toWorldSpace * vec4(rayDir, 0.0)).rgb;\n litTexel = RGBMDecode(textureCubeLodEXT(specularCubemap, rayDirW, 0.0), 8.12).rgb * specularIntensity;\n#endif\n }\n color.rgb += ndl * litTexel * (\n F_Schlick(ndl, spec) * G_Smith(g, ndv, ndl) * vdh / (ndh * ndv + 0.001)\n );\n }\n color.rgb /= float(SAMPLE_PER_FRAME);\n#else\n #if !defined(SPECULARCUBEMAP_ENABLED)\n if (dot(hitNormal, rayDir) >= 0.0) {\n discard;\n }\n if (!intersect) {\n discard;\n }\n#endif\n float alpha = clamp(calculateAlpha(iterationCount, reflectivity, hitPixel, hitPoint, dist, rayDir), 0.0, 1.0);\n vec4 color = texture2D(sourceTexture, hitPixel);\n color.rgb *= alpha;\n\n#ifdef SPECULARCUBEMAP_ENABLED\n vec3 rayDirW = normalize(toWorldSpace * vec4(rayDir, 0.0)).rgb;\n alpha = alpha * (intersect ? 1.0 : 0.0);\n float bias = (1.0 -g) * 5.0;\n color.rgb += (1.0 - alpha)\n * RGBMDecode(textureCubeLodEXT(specularCubemap, rayDirW, bias), 8.12).rgb\n * specularIntensity;\n#endif\n\n#endif\n\n gl_FragColor = encodeHDR(color);\n}\n@end\n\n@export ecgl.ssr.blur\n\nuniform sampler2D texture;\nuniform sampler2D gBufferTexture1;\nuniform sampler2D gBufferTexture2;\nuniform mat4 projection;\nuniform float depthRange : 0.05;\n\nvarying vec2 v_Texcoord;\n\nuniform vec2 textureSize;\nuniform float blurSize : 1.0;\n\n#ifdef BLEND\n #ifdef SSAOTEX_ENABLED\nuniform sampler2D ssaoTex;\n #endif\nuniform sampler2D sourceTexture;\n#endif\n\nfloat getLinearDepth(vec2 coord)\n{\n float depth = texture2D(gBufferTexture2, coord).r * 2.0 - 1.0;\n return projection[3][2] / (depth * projection[2][3] - projection[2][2]);\n}\n\n@import clay.util.rgbm\n\n\nvoid main()\n{\n @import clay.compositor.kernel.gaussian_9\n\n vec4 centerNTexel = texture2D(gBufferTexture1, v_Texcoord);\n float g = centerNTexel.a;\n float maxBlurSize = clamp(1.0 - g, 0.0, 1.0) * blurSize;\n#ifdef VERTICAL\n vec2 off = vec2(0.0, maxBlurSize / textureSize.y);\n#else\n vec2 off = vec2(maxBlurSize / textureSize.x, 0.0);\n#endif\n\n vec2 coord = v_Texcoord;\n\n vec4 sum = vec4(0.0);\n float weightAll = 0.0;\n\n vec3 cN = centerNTexel.rgb * 2.0 - 1.0;\n float cD = getLinearDepth(v_Texcoord);\n for (int i = 0; i < 9; i++) {\n vec2 coord = clamp((float(i) - 4.0) * off + v_Texcoord, vec2(0.0), vec2(1.0));\n float w = gaussianKernel[i]\n * clamp(dot(cN, texture2D(gBufferTexture1, coord).rgb * 2.0 - 1.0), 0.0, 1.0);\n float d = getLinearDepth(coord);\n w *= (1.0 - smoothstep(abs(cD - d) / depthRange, 0.0, 1.0));\n\n weightAll += w;\n sum += decodeHDR(texture2D(texture, coord)) * w;\n }\n\n#ifdef BLEND\n float aoFactor = 1.0;\n #ifdef SSAOTEX_ENABLED\n aoFactor = texture2D(ssaoTex, v_Texcoord).r;\n #endif\n gl_FragColor = encodeHDR(\n sum / weightAll * aoFactor + decodeHDR(texture2D(sourceTexture, v_Texcoord))\n );\n#else\n gl_FragColor = encodeHDR(sum / weightAll);\n#endif\n}\n\n@end"),KC.prototype.setAmbientCubemap=function(t,e){this._ssrPass.material.set("specularCubemap",t),this._ssrPass.material.set("specularIntensity",e),this._ssrPass.material[t&&e?"enableTexture":"disableTexture"]("specularCubemap")},KC.prototype.update=function(t,e,n,r){var i=t.getWidth(),o=t.getHeight(),a=this._ssrTexture,s=this._texture2,l=this._texture3;a.width=this._prevTexture.width=this._currentTexture.width=i/this._downScale,a.height=this._prevTexture.height=this._currentTexture.height=o/this._downScale,s.width=l.width=i,s.height=l.height=o;var u=this._frameBuffer,h=this._ssrPass,c=this._blurPass1,d=this._blurPass2,p=this._blendPass,f=new Ow,g=new Ow;Ow.transpose(f,e.worldTransform),Ow.transpose(g,e.viewMatrix),h.setUniform("sourceTexture",n),h.setUniform("projection",e.projectionMatrix.array),h.setUniform("projectionInv",e.invProjectionMatrix.array),h.setUniform("toViewSpace",f.array),h.setUniform("toWorldSpace",g.array),h.setUniform("nearZ",e.near),g=r/this._totalSamples*this._samplePerFrame,h.setUniform("jitterOffset",g),h.setUniform("sampleOffset",r*this._samplePerFrame),c.setUniform("textureSize",[a.width,a.height]),d.setUniform("textureSize",[i,o]),d.setUniform("sourceTexture",n),c.setUniform("projection",e.projectionMatrix.array),d.setUniform("projection",e.projectionMatrix.array),u.attach(a),u.bind(t),h.render(t),this._physicallyCorrect&&(u.attach(this._currentTexture),p.setUniform("texture1",this._prevTexture),p.setUniform("texture2",a),p.material.set({weight1:1<=r?.95:0,weight2:1<=r?.05:1}),p.render(t)),u.attach(s),c.setUniform("texture",this._physicallyCorrect?this._currentTexture:a),c.render(t),u.attach(l),d.setUniform("texture",s),d.render(t),u.unbind(t),this._physicallyCorrect&&(t=this._prevTexture,this._prevTexture=this._currentTexture,this._currentTexture=t)},KC.prototype.getTargetTexture=function(){return this._texture3},KC.prototype.setParameter=function(t,e){"maxIteration"===t?this._ssrPass.material.define("fragment","MAX_ITERATION",e):this._ssrPass.setUniform(t,e)},KC.prototype.setPhysicallyCorrect=function(t){t?(this._normalDistribution||(this._normalDistribution=tA.generateNormalDistribution(64,this._totalSamples)),this._ssrPass.material.define("fragment","PHYSICALLY_CORRECT"),this._ssrPass.material.set("normalDistribution",this._normalDistribution),this._ssrPass.material.set("normalDistributionSize",[64,this._totalSamples])):this._ssrPass.material.undefine("fragment","PHYSICALLY_CORRECT"),this._physicallyCorrect=t},KC.prototype.setSSAOTexture=function(t){var e=this._blurPass2;t?(e.material.enableTexture("ssaoTex"),e.material.set("ssaoTex",t)):e.material.disableTexture("ssaoTex")},KC.prototype.isFinished=function(t){return!this._physicallyCorrect||t>this._totalSamples/this._samplePerFrame},KC.prototype.dispose=function(t){this._ssrTexture.dispose(t),this._texture2.dispose(t),this._texture3.dispose(t),this._prevTexture.dispose(t),this._currentTexture.dispose(t),this._frameBuffer.dispose(t)};var QC=KC,JC=[0,0,-.321585265978,-.154972575841,.458126042375,.188473391593,.842080129861,.527766490688,.147304551086,-.659453822776,-.331943915203,-.940619700594,.0479226680259,.54812163202,.701581552186,-.709825561388,-.295436780218,.940589268233,-.901489676764,.237713156085,.973570876096,-.109899459384,-.866792314779,-.451805525005,.330975007087,.800048655954,-.344275183665,.381779221166,-.386139432542,-.437418421534,-.576478634965,-.0148463392551,.385798197415,-.262426961053,-.666302061145,.682427250835,-.628010632582,-.732836215494,.10163141741,-.987658134403,.711995289051,-.320024291314,.0296005138058,.950296523438,.0130612307608,-.351024443122,-.879596633704,-.10478487883,.435712737232,.504254490347,.779203817497,.206477676721,.388264289969,-.896736162545,-.153106280781,-.629203242522,-.245517550697,.657969239148,.126830499058,.26862328493,-.634888119007,-.302301223431,.617074219636,.779817204925];function $C(t,e,n,r,i){var o=t.gl;e.setUniform(o,"1i",n,i),o.activeTexture(o.TEXTURE0+i),r.isRenderable()?r.bind(t):r.unbind(t)}function tE(t){this._depthTex=new _S({format:pS.DEPTH_COMPONENT,type:pS.UNSIGNED_INT}),this._normalTex=new _S({type:pS.HALF_FLOAT}),this._framebuffer=new mM,this._framebuffer.attach(this._normalTex),this._framebuffer.attach(this._depthTex,mM.DEPTH_ATTACHMENT),this._normalMaterial=new oT({shader:new FT(FT.source("ecgl.normal.vertex"),FT.source("ecgl.normal.fragment"))}),this._normalMaterial.enableTexture(["normalMap","bumpMap","roughnessMap"]),this._defaultNormalMap=kM.createBlank("#000"),this._defaultBumpMap=kM.createBlank("#000"),this._defaultRoughessMap=kM.createBlank("#000"),this._debugPass=new QM({fragment:FT.source("clay.compositor.output")}),this._debugPass.setUniform("texture",this._normalTex),this._debugPass.material.undefine("fragment","OUTPUT_ALPHA")}FT.import("@export ecgl.normal.vertex\n\n@import ecgl.common.transformUniforms\n\n@import ecgl.common.uv.header\n\n@import ecgl.common.attributes\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\n@import ecgl.common.normalMap.vertexHeader\n\n@import ecgl.common.vertexAnimation.header\n\nvoid main()\n{\n\n @import ecgl.common.vertexAnimation.main\n\n @import ecgl.common.uv.main\n\n v_Normal = normalize((worldInverseTranspose * vec4(normal, 0.0)).xyz);\n v_WorldPosition = (world * vec4(pos, 1.0)).xyz;\n\n @import ecgl.common.normalMap.vertexMain\n\n gl_Position = worldViewProjection * vec4(pos, 1.0);\n\n}\n\n\n@end\n\n\n@export ecgl.normal.fragment\n\n#define ROUGHNESS_CHANEL 0\n\nuniform bool useBumpMap;\nuniform bool useRoughnessMap;\nuniform bool doubleSide;\nuniform float roughness;\n\n@import ecgl.common.uv.fragmentHeader\n\nvarying vec3 v_Normal;\nvarying vec3 v_WorldPosition;\n\nuniform mat4 viewInverse : VIEWINVERSE;\n\n@import ecgl.common.normalMap.fragmentHeader\n@import ecgl.common.bumpMap.header\n\nuniform sampler2D roughnessMap;\n\nvoid main()\n{\n vec3 N = v_Normal;\n \n bool flipNormal = false;\n if (doubleSide) {\n vec3 eyePos = viewInverse[3].xyz;\n vec3 V = normalize(eyePos - v_WorldPosition);\n\n if (dot(N, V) < 0.0) {\n flipNormal = true;\n }\n }\n\n @import ecgl.common.normalMap.fragmentMain\n\n if (useBumpMap) {\n N = bumpNormal(v_WorldPosition, v_Normal, N);\n }\n\n float g = 1.0 - roughness;\n\n if (useRoughnessMap) {\n float g2 = 1.0 - texture2D(roughnessMap, v_DetailTexcoord)[ROUGHNESS_CHANEL];\n g = clamp(g2 + (g - 0.5) * 2.0, 0.0, 1.0);\n }\n\n if (flipNormal) {\n N = -N;\n }\n\n gl_FragColor.rgb = (N.xyz + 1.0) * 0.5;\n gl_FragColor.a = g;\n}\n@end"),tE.prototype.getDepthTexture=function(){return this._depthTex},tE.prototype.getNormalTexture=function(){return this._normalTex},tE.prototype.update=function(t,e,n){var r=t.getWidth(),i=t.getHeight(),o=this._depthTex,a=this._normalTex,s=this._normalMaterial;o.width=r,o.height=i,a.width=r,a.height=i;var l,u,h,c,d,p,f,g,m;e=e.getRenderList(n).opaque;this._framebuffer.bind(t),t.gl.clearColor(0,0,0,0),t.gl.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT),t.gl.disable(t.gl.BLEND),t.renderPass(e,n,{getMaterial:function(){return s},ifRender:function(t){return t.renderNormal},beforeRender:(l=t,u=this._defaultNormalMap,h=this._defaultBumpMap,c=this._defaultRoughessMap,this._normalMaterial,m=l.gl,function(t,e,n){var r,i,o,a,s,y,_,v,x,b,T,w;g&&g.material===t.material||(b=t.material,r=t.__program,null==(i=b.get("roughness"))&&(i=1),o=b.get("normalMap")||u,w=b.get("roughnessMap"),T=b.get("bumpMap"),a=b.get("uvRepeat"),s=b.get("uvOffset"),y=b.get("detailUvRepeat"),_=b.get("detailUvOffset"),v=!!T&&b.isTextureEnabled("bumpMap"),x=!!w&&b.isTextureEnabled("roughnessMap"),b=b.isDefined("fragment","DOUBLE_SIDED"),T=T||h,w=w||c,n!==e?(e.set("normalMap",o),e.set("bumpMap",T),e.set("roughnessMap",w),e.set("useBumpMap",v),e.set("useRoughnessMap",x),e.set("doubleSide",b),null!=a&&e.set("uvRepeat",a),null!=s&&e.set("uvOffset",s),null!=y&&e.set("detailUvRepeat",y),null!=_&&e.set("detailUvOffset",_),e.set("roughness",i)):(r.setUniform(m,"1f","roughness",i),d!==o&&$C(l,r,"normalMap",o,0),p!==T&&T&&$C(l,r,"bumpMap",T,1),f!==w&&w&&$C(l,r,"roughnessMap",w,2),null!=a&&r.setUniform(m,"2f","uvRepeat",a),null!=s&&r.setUniform(m,"2f","uvOffset",s),null!=y&&r.setUniform(m,"2f","detailUvRepeat",y),null!=_&&r.setUniform(m,"2f","detailUvOffset",_),r.setUniform(m,"1i","useBumpMap",+v),r.setUniform(m,"1i","useRoughnessMap",+x),r.setUniform(m,"1i","doubleSide",+b)),d=o,p=T,f=w,g=t)}),sort:t.opaqueSortCompare}),this._framebuffer.unbind(t)},tE.prototype.renderDebug=function(t){this._debugPass.render(t)},tE.prototype.dispose=function(t){this._depthTex.dispose(t),this._normalTex.dispose(t)};var eE=tE;function nE(t){t=t||{},this._edgePass=new QM({fragment:FT.source("ecgl.edge")}),this._edgePass.setUniform("normalTexture",t.normalTexture),this._edgePass.setUniform("depthTexture",t.depthTexture),this._targetTexture=new _S({type:pS.HALF_FLOAT}),this._frameBuffer=new mM,this._frameBuffer.attach(this._targetTexture)}nE.prototype.update=function(t,e,n,r){var i=t.getWidth(),o=t.getHeight(),a=this._targetTexture;a.width=i,a.height=o,a=this._frameBuffer,a.bind(t),this._edgePass.setUniform("projectionInv",e.invProjectionMatrix.array),this._edgePass.setUniform("textureSize",[i,o]),this._edgePass.setUniform("texture",n),this._edgePass.render(t),a.unbind(t)},nE.prototype.getTargetTexture=function(){return this._targetTexture},nE.prototype.setParameter=function(t,e){this._edgePass.setUniform(t,e)},nE.prototype.dispose=function(t){this._targetTexture.dispose(t),this._frameBuffer.dispose(t)};var rE=nE,iE={type:"compositor",nodes:[{name:"source",type:"texture",outputs:{color:{}}},{name:"source_half",shader:"#source(clay.compositor.downsample)",inputs:{texture:"source"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"}},{name:"bright",shader:"#source(clay.compositor.bright)",inputs:{texture:"source_half"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{threshold:2,scale:4,textureSize:"expr([width * 1.0 / 2, height / 2])"}},{name:"bright_downsample_4",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 2, height / 2] )"}},{name:"bright_downsample_8",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright_downsample_4"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 4, height / 4] )"}},{name:"bright_downsample_16",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright_downsample_8"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 16)",height:"expr(height * 1.0 / 16)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 8, height / 8] )"}},{name:"bright_downsample_32",shader:"#source(clay.compositor.downsample)",inputs:{texture:"bright_downsample_16"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 32)",height:"expr(height * 1.0 / 32)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0 / 16, height / 16] )"}},{name:"bright_upsample_16_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_32"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 16)",height:"expr(height * 1.0 / 16)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 32, height / 32] )"}},{name:"bright_upsample_16_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_16_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 16)",height:"expr(height * 1.0 / 16)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 16, height * 1.0 / 16] )"}},{name:"bright_upsample_8_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_16"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 16, height * 1.0 / 16] )"}},{name:"bright_upsample_8_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_8_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 8, height * 1.0 / 8] )"}},{name:"bright_upsample_8_blend",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_8_blur_v",texture2:"bright_upsample_16_blur_v"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 8)",height:"expr(height * 1.0 / 8)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"bright_upsample_4_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_8"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 8, height * 1.0 / 8] )"}},{name:"bright_upsample_4_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_4_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 4, height * 1.0 / 4] )"}},{name:"bright_upsample_4_blend",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_4_blur_v",texture2:"bright_upsample_8_blend"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 4)",height:"expr(height * 1.0 / 4)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"bright_upsample_2_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_downsample_4"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 4, height * 1.0 / 4] )"}},{name:"bright_upsample_2_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_2_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0 / 2, height * 1.0 / 2] )"}},{name:"bright_upsample_2_blend",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_2_blur_v",texture2:"bright_upsample_4_blend"},outputs:{color:{parameters:{width:"expr(width * 1.0 / 2)",height:"expr(height * 1.0 / 2)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"bright_upsample_full_blur_h",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:0,textureSize:"expr( [width * 1.0 / 2, height * 1.0 / 2] )"}},{name:"bright_upsample_full_blur_v",shader:"#source(clay.compositor.gaussian_blur)",inputs:{texture:"bright_upsample_full_blur_h"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{blurSize:1,blurDir:1,textureSize:"expr( [width * 1.0, height * 1.0] )"}},{name:"bloom_composite",shader:"#source(clay.compositor.blend)",inputs:{texture1:"bright_upsample_full_blur_v",texture2:"bright_upsample_2_blend"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{weight1:.3,weight2:.7}},{name:"coc",shader:"#source(ecgl.dof.coc)",outputs:{color:{parameters:{minFilter:"NEAREST",magFilter:"NEAREST",width:"expr(width * 1.0)",height:"expr(height * 1.0)"}}},parameters:{focalDist:50,focalRange:30}},{name:"dof_far_blur",shader:"#source(ecgl.dof.diskBlur)",inputs:{texture:"source",coc:"coc"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"}},{name:"dof_near_blur",shader:"#source(ecgl.dof.diskBlur)",inputs:{texture:"source",coc:"coc"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"},defines:{BLUR_NEARFIELD:null}},{name:"dof_coc_blur",shader:"#source(ecgl.dof.diskBlur)",inputs:{texture:"coc"},outputs:{color:{parameters:{minFilter:"NEAREST",magFilter:"NEAREST",width:"expr(width * 1.0)",height:"expr(height * 1.0)"}}},parameters:{textureSize:"expr( [width * 1.0, height * 1.0] )"},defines:{BLUR_COC:null}},{name:"dof_composite",shader:"#source(ecgl.dof.composite)",inputs:{original:"source",blurred:"dof_far_blur",nearfield:"dof_near_blur",coc:"coc",nearcoc:"dof_coc_blur"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)",type:"HALF_FLOAT"}}}},{name:"composite",shader:"#source(clay.compositor.hdr.composite)",inputs:{texture:"source",bloom:"bloom_composite"},outputs:{color:{parameters:{width:"expr(width * 1.0)",height:"expr(height * 1.0)"}}},defines:{}},{name:"FXAA",shader:"#source(clay.compositor.fxaa)",inputs:{texture:"composite"}}]};function oE(t,e){return{color:{parameters:{width:t,height:e}}}}FT.import(DC),FT.import(RC),FT.import(LC),FT.import(OC),FT.import(PC),FT.import(NC),FT.import(kC),FT.import(BC),FT.import(FC),FT.import("@export ecgl.dof.coc\n\nuniform sampler2D depth;\n\nuniform float zNear: 0.1;\nuniform float zFar: 2000;\n\nuniform float focalDistance: 3;\nuniform float focalRange: 1;\nuniform float focalLength: 30;\nuniform float fstop: 2.8;\n\nvarying vec2 v_Texcoord;\n\n@import clay.util.encode_float\n\nvoid main()\n{\n float z = texture2D(depth, v_Texcoord).r * 2.0 - 1.0;\n\n float dist = 2.0 * zNear * zFar / (zFar + zNear - z * (zFar - zNear));\n\n float aperture = focalLength / fstop;\n\n float coc;\n\n float uppper = focalDistance + focalRange;\n float lower = focalDistance - focalRange;\n if (dist <= uppper && dist >= lower) {\n coc = 0.5;\n }\n else {\n float focalAdjusted = dist > uppper ? uppper : lower;\n\n coc = abs(aperture * (focalLength * (dist - focalAdjusted)) / (dist * (focalAdjusted - focalLength)));\n coc = clamp(coc, 0.0, 2.0) / 2.00001;\n\n if (dist < lower) {\n coc = -coc;\n }\n coc = coc * 0.5 + 0.5;\n }\n\n gl_FragColor = encodeFloat(coc);\n}\n@end\n\n\n@export ecgl.dof.composite\n\n#define DEBUG 0\n\nuniform sampler2D original;\nuniform sampler2D blurred;\nuniform sampler2D nearfield;\nuniform sampler2D coc;\nuniform sampler2D nearcoc;\nvarying vec2 v_Texcoord;\n\n@import clay.util.rgbm\n@import clay.util.float\n\nvoid main()\n{\n vec4 blurredColor = texture2D(blurred, v_Texcoord);\n vec4 originalColor = texture2D(original, v_Texcoord);\n\n float fCoc = decodeFloat(texture2D(coc, v_Texcoord));\n\n fCoc = abs(fCoc * 2.0 - 1.0);\n\n float weight = smoothstep(0.0, 1.0, fCoc);\n \n#ifdef NEARFIELD_ENABLED\n vec4 nearfieldColor = texture2D(nearfield, v_Texcoord);\n float fNearCoc = decodeFloat(texture2D(nearcoc, v_Texcoord));\n fNearCoc = abs(fNearCoc * 2.0 - 1.0);\n\n gl_FragColor = encodeHDR(\n mix(\n nearfieldColor, mix(originalColor, blurredColor, weight),\n pow(1.0 - fNearCoc, 4.0)\n )\n );\n#else\n gl_FragColor = encodeHDR(mix(originalColor, blurredColor, weight));\n#endif\n\n}\n\n@end\n\n\n\n@export ecgl.dof.diskBlur\n\n#define POISSON_KERNEL_SIZE 16;\n\nuniform sampler2D texture;\nuniform sampler2D coc;\nvarying vec2 v_Texcoord;\n\nuniform float blurRadius : 10.0;\nuniform vec2 textureSize : [512.0, 512.0];\n\nuniform vec2 poissonKernel[POISSON_KERNEL_SIZE];\n\nuniform float percent;\n\nfloat nrand(const in vec2 n) {\n return fract(sin(dot(n.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n@import clay.util.rgbm\n@import clay.util.float\n\n\nvoid main()\n{\n vec2 offset = blurRadius / textureSize;\n\n float rnd = 6.28318 * nrand(v_Texcoord + 0.07 * percent );\n float cosa = cos(rnd);\n float sina = sin(rnd);\n vec4 basis = vec4(cosa, -sina, sina, cosa);\n\n#if !defined(BLUR_NEARFIELD) && !defined(BLUR_COC)\n offset *= abs(decodeFloat(texture2D(coc, v_Texcoord)) * 2.0 - 1.0);\n#endif\n\n#ifdef BLUR_COC\n float cocSum = 0.0;\n#else\n vec4 color = vec4(0.0);\n#endif\n\n\n float weightSum = 0.0;\n\n for (int i = 0; i < POISSON_KERNEL_SIZE; i++) {\n vec2 ofs = poissonKernel[i];\n\n ofs = vec2(dot(ofs, basis.xy), dot(ofs, basis.zw));\n\n vec2 uv = v_Texcoord + ofs * offset;\n vec4 texel = texture2D(texture, uv);\n\n float w = 1.0;\n#ifdef BLUR_COC\n float fCoc = decodeFloat(texel) * 2.0 - 1.0;\n cocSum += clamp(fCoc, -1.0, 0.0) * w;\n#else\n texel = texel;\n #if !defined(BLUR_NEARFIELD)\n float fCoc = decodeFloat(texture2D(coc, uv)) * 2.0 - 1.0;\n w *= abs(fCoc);\n #endif\n texel.rgb *= texel.a;\n color += texel * w;\n#endif\n\n weightSum += w;\n }\n\n#ifdef BLUR_COC\n gl_FragColor = encodeFloat(clamp(cocSum / weightSum, -1.0, 0.0) * 0.5 + 0.5);\n#else\n color /= weightSum;\n color.rgb /= (color.a + 0.0001);\n gl_FragColor = color;\n#endif\n}\n\n@end"),FT.import("@export ecgl.edge\n\nuniform sampler2D texture;\n\nuniform sampler2D normalTexture;\nuniform sampler2D depthTexture;\n\nuniform mat4 projectionInv;\n\nuniform vec2 textureSize;\n\nuniform vec4 edgeColor: [0,0,0,0.8];\n\nvarying vec2 v_Texcoord;\n\nvec3 packColor(vec2 coord) {\n float z = texture2D(depthTexture, coord).r * 2.0 - 1.0;\n vec4 p = vec4(v_Texcoord * 2.0 - 1.0, z, 1.0);\n vec4 p4 = projectionInv * p;\n\n return vec3(\n texture2D(normalTexture, coord).rg,\n -p4.z / p4.w / 5.0\n );\n}\n\nvoid main() {\n vec2 cc = v_Texcoord;\n vec3 center = packColor(cc);\n\n float size = clamp(1.0 - (center.z - 10.0) / 100.0, 0.0, 1.0) * 0.5;\n float dx = size / textureSize.x;\n float dy = size / textureSize.y;\n\n vec2 coord;\n vec3 topLeft = packColor(cc+vec2(-dx, -dy));\n vec3 top = packColor(cc+vec2(0.0, -dy));\n vec3 topRight = packColor(cc+vec2(dx, -dy));\n vec3 left = packColor(cc+vec2(-dx, 0.0));\n vec3 right = packColor(cc+vec2(dx, 0.0));\n vec3 bottomLeft = packColor(cc+vec2(-dx, dy));\n vec3 bottom = packColor(cc+vec2(0.0, dy));\n vec3 bottomRight = packColor(cc+vec2(dx, dy));\n\n vec3 v = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;\n vec3 h = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;\n\n float edge = sqrt(dot(h, h) + dot(v, v));\n\n edge = smoothstep(0.8, 1.0, edge);\n\n gl_FragColor = mix(texture2D(texture, v_Texcoord), vec4(edgeColor.rgb, 1.0), edgeColor.a * edge);\n}\n@end");var aE=["composite","FXAA"];function sE(){this._width,this._height,this._dpr,this._sourceTexture=new _S({type:pS.HALF_FLOAT}),this._depthTexture=new _S({format:pS.DEPTH_COMPONENT,type:pS.UNSIGNED_INT}),this._framebuffer=new mM,this._framebuffer.attach(this._sourceTexture),this._framebuffer.attach(this._depthTexture,mM.DEPTH_ATTACHMENT),this._normalPass=new eE,this._compositor=WC(iE);var t=this._compositor.getNodeByName("source");t.texture=this._sourceTexture;var e=this._compositor.getNodeByName("coc");this._sourceNode=t,this._cocNode=e,this._compositeNode=this._compositor.getNodeByName("composite"),this._fxaaNode=this._compositor.getNodeByName("FXAA"),this._dofBlurNodes=["dof_far_blur","dof_near_blur","dof_coc_blur"].map((function(t){return this._compositor.getNodeByName(t)}),this),this._dofBlurKernel=0,this._dofBlurKernelSize=new Float32Array(0),this._finalNodesChain=aE.map((function(t){return this._compositor.getNodeByName(t)}),this),e={normalTexture:this._normalPass.getNormalTexture(),depthTexture:this._normalPass.getDepthTexture()},this._ssaoPass=new qC(e),this._ssrPass=new QC(e),this._edgePass=new rE(e)}sE.prototype.resize=function(t,e,n){t*=n=n||1,e*=n;var r=this._sourceTexture,i=this._depthTexture;r.width=t,r.height=e,i.width=t,i.height=e;var o={getWidth:function(){return t},getHeight:function(){return e},getDevicePixelRatio:function(){return n}};function a(t,e){var n;"function"==typeof t[e]&&(n=t[e].__original||t[e],t[e]=function(t){return n.call(this,o)},t[e].__original=n)}this._compositor.nodes.forEach((function(t){for(var e in t.outputs)e=t.outputs[e].parameters,e&&(a(e,"width"),a(e,"height"));for(var n in t.parameters)a(t.parameters,n)})),this._width=t,this._height=e,this._dpr=n},sE.prototype.getWidth=function(){return this._width},sE.prototype.getHeight=function(){return this._height},sE.prototype._ifRenderNormalPass=function(){return this._enableSSAO||this._enableEdge||this._enableSSR},sE.prototype._getPrevNode=function(t){for(var e=aE.indexOf(t.name)-1,n=this._finalNodesChain[e];n&&!this._compositor.getNodeByName(n.name);)n=this._finalNodesChain[--e];return n},sE.prototype._getNextNode=function(t){for(var e=aE.indexOf(t.name)+1,n=this._finalNodesChain[e];n&&!this._compositor.getNodeByName(n.name);)n=this._finalNodesChain[e+=1];return n},sE.prototype._addChainNode=function(t){var e=this._getPrevNode(t),n=this._getNextNode(t);e&&(t.inputs.texture=e.name,n?(t.outputs=oE(this.getWidth.bind(this),this.getHeight.bind(this)),n.inputs.texture=t.name):t.outputs=null,this._compositor.addNode(t))},sE.prototype._removeChainNode=function(t){var e=this._getPrevNode(t),n=this._getNextNode(t);e&&(n?(e.outputs=oE(this.getWidth.bind(this),this.getHeight.bind(this)),n.inputs.texture=e.name):e.outputs=null,this._compositor.removeNode(t))},sE.prototype.updateNormal=function(t,e,n,r){this._ifRenderNormalPass()&&this._normalPass.update(t,e,n)},sE.prototype.updateSSAO=function(t,e,n,r){this._ssaoPass.update(t,n,r)},sE.prototype.enableSSAO=function(){this._enableSSAO=!0},sE.prototype.disableSSAO=function(){this._enableSSAO=!1},sE.prototype.enableSSR=function(){this._enableSSR=!0},sE.prototype.disableSSR=function(){this._enableSSR=!1},sE.prototype.getSSAOTexture=function(){return this._ssaoPass.getTargetTexture()},sE.prototype.getSourceFrameBuffer=function(){return this._framebuffer},sE.prototype.getSourceTexture=function(){return this._sourceTexture},sE.prototype.disableFXAA=function(){this._removeChainNode(this._fxaaNode)},sE.prototype.enableFXAA=function(){this._addChainNode(this._fxaaNode)},sE.prototype.enableBloom=function(){this._compositeNode.inputs.bloom="bloom_composite",this._compositor.dirty()},sE.prototype.disableBloom=function(){this._compositeNode.inputs.bloom=null,this._compositor.dirty()},sE.prototype.enableDOF=function(){this._compositeNode.inputs.texture="dof_composite",this._compositor.dirty()},sE.prototype.disableDOF=function(){this._compositeNode.inputs.texture="source",this._compositor.dirty()},sE.prototype.enableColorCorrection=function(){this._compositeNode.define("COLOR_CORRECTION"),this._enableColorCorrection=!0},sE.prototype.disableColorCorrection=function(){this._compositeNode.undefine("COLOR_CORRECTION"),this._enableColorCorrection=!1},sE.prototype.enableEdge=function(){this._enableEdge=!0},sE.prototype.disableEdge=function(){this._enableEdge=!1},sE.prototype.setBloomIntensity=function(t){this._compositeNode.setParameter("bloomIntensity",t)},sE.prototype.setSSAOParameter=function(t,e){switch(t){case"quality":this._ssaoPass.setParameter("kernelSize",{low:6,medium:12,high:32,ultra:62}[e]||12);break;case"radius":this._ssaoPass.setParameter(t,e),this._ssaoPass.setParameter("bias",e/200);break;case"intensity":this._ssaoPass.setParameter(t,e);break;default:}},sE.prototype.setDOFParameter=function(t,e){switch(t){case"focalDistance":case"focalRange":case"fstop":this._cocNode.setParameter(t,e);break;case"blurRadius":for(var n=0;n<this._dofBlurNodes.length;n++)this._dofBlurNodes[n].setParameter("blurRadius",e);break;case"quality":var r={low:4,medium:8,high:16,ultra:32}[e]||8;for(this._dofBlurKernelSize=r,n=0;n<this._dofBlurNodes.length;n++)this._dofBlurNodes[n].pass.material.define("POISSON_KERNEL_SIZE",r);this._dofBlurKernel=new Float32Array(2*r);break;default:}},sE.prototype.setSSRParameter=function(t,e){if(null!=e)switch(t){case"quality":var n={low:32,medium:16,high:8,ultra:4}[e]||16;this._ssrPass.setParameter("maxIteration",{low:10,medium:15,high:30,ultra:80}[e]||20),this._ssrPass.setParameter("pixelStride",n);break;case"maxRoughness":this._ssrPass.setParameter("minGlossiness",Math.max(Math.min(1-e,1),0));break;case"physical":this.setPhysicallyCorrectSSR(e);break;default:console.warn("Unkown SSR parameter "+t)}},sE.prototype.setPhysicallyCorrectSSR=function(t){this._ssrPass.setPhysicallyCorrect(t)},sE.prototype.setEdgeColor=function(t){t=bA.parseColor(t),this._edgePass.setParameter("edgeColor",t)},sE.prototype.setExposure=function(t){this._compositeNode.setParameter("exposure",Math.pow(2,t))},sE.prototype.setColorLookupTexture=function(t,e){this._compositeNode.pass.material.setTextureImage("lut",this._enableColorCorrection?t:"none",e,{minFilter:bA.Texture.NEAREST,magFilter:bA.Texture.NEAREST,flipY:!1})},sE.prototype.setColorCorrection=function(t,e){this._compositeNode.setParameter(t,e)},sE.prototype.isSSREnabled=function(){return this._enableSSR},sE.prototype.composite=function(t,e,n,r,i){var o=this._sourceTexture,a=o;this._enableEdge&&(this._edgePass.update(t,n,o,i),o=a=this._edgePass.getTargetTexture()),this._enableSSR&&(this._ssrPass.update(t,n,o,i),a=this._ssrPass.getTargetTexture(),this._ssrPass.setSSAOTexture(this._enableSSAO?this._ssaoPass.getTargetTexture():null)),this._sourceNode.texture=a,this._cocNode.setParameter("depth",this._depthTexture);for(var s=this._dofBlurKernel,l=this._dofBlurKernelSize,u=i%Math.floor(JC.length/2/l),h=0;h<2*l;h++)s[h]=JC[h+u*l*2];for(h=0;h<this._dofBlurNodes.length;h++)this._dofBlurNodes[h].setParameter("percent",i/30),this._dofBlurNodes[h].setParameter("poissonKernel",s);this._cocNode.setParameter("zNear",n.near),this._cocNode.setParameter("zFar",n.far),this._compositor.render(t,r)},sE.prototype.dispose=function(t){this._sourceTexture.dispose(t),this._depthTexture.dispose(t),this._framebuffer.dispose(t),this._compositor.dispose(t),this._normalPass.dispose(t),this._ssaoPass.dispose(t)};var lE=sE;function uE(t){for(var e=[],n=0;n<30;n++)e.push([XC(n,2),XC(n,3)]);this._haltonSequence=e,this._frame=0,this._sourceTex=new _S,this._sourceFb=new mM,this._sourceFb.attach(this._sourceTex),this._prevFrameTex=new _S,this._outputTex=new _S;var r=this._blendPass=new QM({fragment:FT.source("clay.compositor.blend")});r.material.disableTexturesAll(),r.material.enableTexture(["texture1","texture2"]),this._blendFb=new mM({depthBuffer:!1}),this._outputPass=new QM({fragment:FT.source("clay.compositor.output"),blendWithPrevious:!0}),this._outputPass.material.define("fragment","OUTPUT_ALPHA"),this._outputPass.material.blend=function(t){t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)}}uE.prototype={constructor:uE,jitterProjection:function(t,e){var n=t.viewport,r=n.devicePixelRatio||t.getDevicePixelRatio(),i=n.width*r;t=n.height*r,n=this._haltonSequence[this._frame%this._haltonSequence.length],r=new Ow;r.array[12]=(2*n[0]-1)/i,r.array[13]=(2*n[1]-1)/t,Ow.mul(e.projectionMatrix,r,e.projectionMatrix),Ow.invert(e.invProjectionMatrix,e.projectionMatrix)},resetFrame:function(){this._frame=0},getFrame:function(){return this._frame},getSourceFrameBuffer:function(){return this._sourceFb},getOutputTexture:function(){return this._outputTex},resize:function(t,e){this._prevFrameTex.width=t,this._prevFrameTex.height=e,this._outputTex.width=t,this._outputTex.height=e,this._sourceTex.width=t,this._sourceTex.height=e,this._prevFrameTex.dirty(),this._outputTex.dirty(),this._sourceTex.dirty()},isFinished:function(){return this._frame>=this._haltonSequence.length},render:function(t,e,n){var r=this._blendPass;0===this._frame?(r.setUniform("weight1",0),r.setUniform("weight2",1)):(r.setUniform("weight1",.9),r.setUniform("weight2",.1)),r.setUniform("texture1",this._prevFrameTex),r.setUniform("texture2",e||this._sourceTex),this._blendFb.attach(this._outputTex),this._blendFb.bind(t),r.render(t),this._blendFb.unbind(t),n||(this._outputPass.setUniform("texture",this._outputTex),this._outputPass.render(t)),t=this._prevFrameTex,this._prevFrameTex=this._outputTex,this._outputTex=t,this._frame++},dispose:function(t){this._sourceFb.dispose(t),this._blendFb.dispose(t),this._prevFrameTex.dispose(t),this._outputTex.dispose(t),this._sourceTex.dispose(t),this._outputPass.dispose(t),this._blendPass.dispose(t)}};var hE=uE;function cE(t){t=t||"perspective",this.layer=null,this.scene=new tM,this.rootNode=this.scene,this.viewport={x:0,y:0,width:0,height:0},this.setProjection(t),this._compositor=new lE,this._temporalSS=new hE,this._shadowMapPass=new wC;for(var e=[],n=0,r=0;r<30;r++){for(var i=[],o=0;o<6;o++)i.push(4*XC(n,2)-2),i.push(4*XC(n,3)-2),n++;e.push(i)}this._pcfKernels=e,this.scene.on("beforerender",(function(t,e,n){this.needsTemporalSS()&&this._temporalSS.jitterProjection(t,n)}),this)}cE.prototype.setProjection=function(t){var e=this.camera;e&&e.update(),"perspective"===t?this.camera instanceof oM||(this.camera=new oM,e&&this.camera.setLocalTransform(e.localTransform)):this.camera instanceof ZM||(this.camera=new ZM,e&&this.camera.setLocalTransform(e.localTransform)),this.camera.near=.1,this.camera.far=2e3},cE.prototype.setViewport=function(t,e,n,r,i){this.camera instanceof oM&&(this.camera.aspect=n/r),i=i||1,this.viewport.x=t,this.viewport.y=e,this.viewport.width=n,this.viewport.height=r,this.viewport.devicePixelRatio=i,this._compositor.resize(n*i,r*i),this._temporalSS.resize(n*i,r*i)},cE.prototype.containPoint=function(t,e){var n=this.viewport;return e=this.layer.renderer.getHeight()-e,t>=n.x&&e>=n.y&&t<=n.x+n.width&&e<=n.y+n.height};var dE=new hT;cE.prototype.castRay=function(t,e,n){var r=this.layer.renderer,i=r.viewport;return r.viewport=this.viewport,r.screenToNDC(t,e,dE),this.camera.castRay(dE,n),r.viewport=i,n},cE.prototype.prepareRender=function(){this.scene.update(),this.camera.update(),this.scene.updateLights();var t=this.scene.updateRenderList(this.camera);this._needsSortProgressively=!1;for(var e=0;e<t.transparent.length;e++){var n=t.transparent[e].geometry;n.needsSortVerticesProgressively&&n.needsSortVerticesProgressively()&&(this._needsSortProgressively=!0),n.needsSortTrianglesProgressively&&n.needsSortTrianglesProgressively()&&(this._needsSortProgressively=!0)}this._frame=0,this._temporalSS.resetFrame()},cE.prototype.render=function(t,e){this._doRender(t,e,this._frame),this._frame++},cE.prototype.needsAccumulate=function(){return this.needsTemporalSS()||this._needsSortProgressively},cE.prototype.needsTemporalSS=function(){var t=this._enableTemporalSS;return"auto"===t?this._enablePostEffect:t},cE.prototype.hasDOF=function(){return this._enableDOF},cE.prototype.isAccumulateFinished=function(){return this.needsTemporalSS()?this._temporalSS.isFinished():30<this._frame},cE.prototype._doRender=function(t,e,n){var r=this.scene,i=this.camera;this._updateTransparent(t,r,i,n=n||0),e||(this._shadowMapPass.kernelPCF=this._pcfKernels[0],this._shadowMapPass.render(t,r,i,!0)),this._updateShadowPCFKernel(n);var o;n=t.clearColor;t.gl.clearColor(n[0],n[1],n[2],n[3]),this._enablePostEffect&&(this.needsTemporalSS()&&this._temporalSS.jitterProjection(t,i),this._compositor.updateNormal(t,r,i,this._temporalSS.getFrame())),this._updateSSAO(t,r,i,this._temporalSS.getFrame()),this._enablePostEffect?((o=this._compositor.getSourceFrameBuffer()).bind(t),t.gl.clear(t.gl.DEPTH_BUFFER_BIT|t.gl.COLOR_BUFFER_BIT),t.render(r,i,!0,!0),o.unbind(t),this.needsTemporalSS()&&e?(this._compositor.composite(t,r,i,this._temporalSS.getSourceFrameBuffer(),this._temporalSS.getFrame()),t.setViewport(this.viewport),this._temporalSS.render(t)):(t.setViewport(this.viewport),this._compositor.composite(t,r,i,null,0))):this.needsTemporalSS()&&e?((o=this._temporalSS.getSourceFrameBuffer()).bind(t),t.saveClear(),t.clearBit=t.gl.DEPTH_BUFFER_BIT|t.gl.COLOR_BUFFER_BIT,t.render(r,i,!0,!0),t.restoreClear(),o.unbind(t),t.setViewport(this.viewport),this._temporalSS.render(t)):(t.setViewport(this.viewport),t.render(r,i,!0,!0))},cE.prototype._updateTransparent=function(t,e,n,r){for(var i=new fw,o=new Ow,a=n.getWorldPosition(),s=e.getRenderList(n).transparent,l=0;l<s.length;l++){var u=s[l],h=u.geometry;Ow.invert(o,u.worldTransform),fw.transformMat4(i,a,o),h.needsSortTriangles&&h.needsSortTriangles()&&h.doSortTriangles(i,r),h.needsSortVertices&&h.needsSortVertices()&&h.doSortVertices(i,r)}},cE.prototype._updateSSAO=function(t,e,n){var r=this._enableSSAO&&this._enablePostEffect;r&&this._compositor.updateSSAO(t,e,n,this._temporalSS.getFrame());for(var i=e.getRenderList(n),o=0;o<i.opaque.length;o++){var a=i.opaque[o];a.renderNormal&&a.material[r?"enableTexture":"disableTexture"]("ssaoMap"),r&&a.material.set("ssaoMap",this._compositor.getSSAOTexture())}},cE.prototype._updateShadowPCFKernel=function(t){for(var e=this._pcfKernels[t%this._pcfKernels.length],n=this.scene.getRenderList(this.camera).opaque,r=0;r<n.length;r++)n[r].receiveShadow&&(n[r].material.set("pcfKernel",e),n[r].material.define("fragment","PCF_KERNEL_SIZE",e.length/2))},cE.prototype.dispose=function(t){this._compositor.dispose(t.gl),this._temporalSS.dispose(t.gl),this._shadowMapPass.dispose(t)},cE.prototype.setPostEffect=function(t,e){var n=this._compositor;this._enablePostEffect=t.get("enable");var r=t.getModel("bloom"),i=t.getModel("edge"),o=t.getModel("DOF",t.getModel("depthOfField")),a=t.getModel("SSAO",t.getModel("screenSpaceAmbientOcclusion")),s=t.getModel("SSR",t.getModel("screenSpaceReflection")),l=t.getModel("FXAA"),u=t.getModel("colorCorrection");r.get("enable")?n.enableBloom():n.disableBloom(),o.get("enable")?n.enableDOF():n.disableDOF(),s.get("enable")?n.enableSSR():n.disableSSR(),u.get("enable")?n.enableColorCorrection():n.disableColorCorrection(),i.get("enable")?n.enableEdge():n.disableEdge(),l.get("enable")?n.enableFXAA():n.disableFXAA(),this._enableDOF=o.get("enable"),this._enableSSAO=a.get("enable"),this._enableSSAO?n.enableSSAO():n.disableSSAO(),n.setBloomIntensity(r.get("intensity")),n.setEdgeColor(i.get("color")),n.setColorLookupTexture(u.get("lookupTexture"),e),n.setExposure(u.get("exposure")),["radius","quality","intensity"].forEach((function(t){n.setSSAOParameter(t,a.get(t))})),["quality","maxRoughness","physical"].forEach((function(t){n.setSSRParameter(t,s.get(t))})),["quality","focalDistance","focalRange","blurRadius","fstop"].forEach((function(t){n.setDOFParameter(t,o.get(t))})),["brightness","contrast","saturation"].forEach((function(t){n.setColorCorrection(t,u.get(t))}))},cE.prototype.setDOFFocusOnPoint=function(t){if(this._enablePostEffect&&!(t>this.camera.far||t<this.camera.near))return this._compositor.setDOFParameter("focalDistance",t),!0},cE.prototype.setTemporalSuperSampling=function(t){this._enableTemporalSS=t.get("enable")},cE.prototype.isLinearSpace=function(){return this._enablePostEffect},cE.prototype.setRootNode=function(t){if(this.rootNode!==t){for(var e=this.rootNode.children(),n=0;n<e.length;n++)t.add(e[n]);t!==this.scene&&this.scene.add(t),this.rootNode=t}},cE.prototype.add=function(t){this.rootNode.add(t)},cE.prototype.remove=function(t){this.rootNode.remove(t)},cE.prototype.removeAll=function(t){this.rootNode.removeAll(t)},Object.assign(cE.prototype,f);var pE=cE;function fE(t,e){var n=vd(t.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()});n.y=e.getHeight()-n.y-n.height,this.viewGL.setViewport(n.x,n.y,n.width,n.height,e.getDevicePixelRatio()),this.radius=t.get("globeRadius"),t=t.get("globeOuterRadius"),this.altitudeAxis&&this.altitudeAxis.setExtent(0,t-this.radius)}function gE(t,e){var n=[1/0,-1/0];t.eachSeries((function(t){var e;t.coordinateSystem===this&&(e=t.getData(),(t=(t=t.coordDimToDataDim("alt"))&&t[0])&&(t=e.getDataExtent(t,!0),n[0]=Math.min(n[0],t[0]),n[1]=Math.max(n[1],t[1])))}),this),n&&isFinite(n[1]-n[0])&&(t=o.createScale(n,{type:"value",min:"dataMin",max:"dataMax"}),this.altitudeAxis=new hb("altitude",t),this.resize(this.model,e))}var mE,yE={dimensions:rC.prototype.dimensions,create:function(t,e){var n=[];return t.eachComponent("globe",(function(t){t.__viewGL=t.__viewGL||new pE;var r=new rC;r.viewGL=t.__viewGL,(t.coordinateSystem=r).model=t,n.push(r),r.resize=fE,r.resize(t,e),r.update=gE})),t.eachSeries((function(e){if("globe"===e.get("coordinateSystem")){var n=e.getReferringComponents("globe").models[0];if(!(n=n||t.getComponent("globe")))throw new Error('globe "'+sA.firstNotNull(e.get("globe3DIndex"),e.get("globe3DId"),0)+'" not found');n=n.coordinateSystem,e.coordinateSystem=n}})),t.eachComponent("globe",(function(t,n){var r,i=t.coordinateSystem,o=t.getDisplacementTexture(),a=t.getDisplacemenScale();t.isDisplacementChanged()&&(t.hasDisplacement()?(r=!0,bA.loadTexture(o,e,(function(n){n=function(t,e){var n=document.createElement("canvas"),r=n.getContext("2d"),i=t.width,o=t.height;n.width=i,n.height=o,r.drawImage(t,0,0,i,o);for(var a=r.getImageData(0,0,i,o).data,s=new Float32Array(a.length/4),l=0;l<a.length/4;l++){var u=a[4*l];s[l]=u/255*e}return{data:s,width:i,height:o}}(n.image,a),t.setDisplacementData(n.data,n.width,n.height),r||e.dispatchAction({type:"globeUpdateDisplacment"})})),r=!1):i.setDisplacementData(null,0,0),i.setDisplacementData(t.displacementData,t.displacementWidth,t.displacementHeight))})),n}},_E="\0_ec_interaction_mutex";function vE(t,e){return xE(t)[e]}function xE(t){return t[_E]||(t[_E]={})}function bE(t){var e=mE.call(this)||this;e._zr=t;var n=G(e._mousedownHandler,e),r=G(e._mousemoveHandler,e),i=G(e._mouseupHandler,e),o=G(e._mousewheelHandler,e),a=G(e._pinchHandler,e);return e.enable=function(e,s){this.disable(),this._opt=L(I(s)||{},{zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!1,preventDefaultMouseMove:!0}),!0!==(e=null==e||e)&&"move"!==e&&"pan"!==e||(t.on("mousedown",n),t.on("mousemove",r),t.on("mouseup",i)),!0!==e&&"scale"!==e&&"zoom"!==e||(t.on("mousewheel",o),t.on("pinch",a))},e.disable=function(){t.off("mousedown",n),t.off("mousemove",r),t.off("mouseup",i),t.off("mousewheel",o),t.off("pinch",a)},e}function TE(t,e,n,r,i){t.pointerChecker&&t.pointerChecker(r,i.originX,i.originY)&&($t(r.event),wE(t,e,n,r,i))}function wE(t,e,n,r,i){i.isAvailableBehavior=G(SE,null,n,r),t.trigger(e,i)}function SE(t,e,n){return n=n[t],!t||n&&(!Y(n)||e.event[n+"Key"])}N_({type:"takeGlobalCursor",event:"globalCursorTaken",update:"update"},(function(){}));var ME=(h(bE,mE=Bt),bE.prototype.isDragging=function(){return this._dragging},bE.prototype.isPinching=function(){return this._pinching},bE.prototype.setPointerChecker=function(t){this.pointerChecker=t},bE.prototype.dispose=function(){this.disable()},bE.prototype._mousedownHandler=function(t){var e,n;te(t)||t.target&&t.target.draggable||(e=t.offsetX,n=t.offsetY,this.pointerChecker&&this.pointerChecker(t,e,n)&&(this._x=e,this._y=n,this._dragging=!0))},bE.prototype._mousemoveHandler=function(t){var e,n,r,i,o,a;this._dragging&&SE("moveOnMouseMove",t,this._opt)&&"pinch"!==t.gestureEvent&&!vE(this._zr,"globalPan")&&(e=t.offsetX,n=t.offsetY,o=e-(r=this._x),a=n-(i=this._y),this._x=e,this._y=n,this._opt.preventDefaultMouseMove&&$t(t.event),wE(this,"pan","moveOnMouseMove",t,{dx:o,dy:a,oldX:r,oldY:i,newX:e,newY:n,isAvailableBehavior:null}))},bE.prototype._mouseupHandler=function(t){te(t)||(this._dragging=!1)},bE.prototype._mousewheelHandler=function(t){var e=SE("zoomOnMouseWheel",t,this._opt),n=SE("moveOnMouseWheel",t,this._opt),r=t.wheelDelta,i=Math.abs(r),o=t.offsetX,a=t.offsetY;0!==r&&(e||n)&&(e&&(i=3<i?1.4:1<i?1.2:1.1,TE(this,"zoom","zoomOnMouseWheel",t,{scale:0<r?i:1/i,originX:o,originY:a,isAvailableBehavior:null})),n&&TE(this,"scrollMove","moveOnMouseWheel",t,{scrollDelta:(0<r?1:-1)*(3<(r=Math.abs(r))?.4:1<r?.15:.05),originX:o,originY:a,isAvailableBehavior:null}))},bE.prototype._pinchHandler=function(t){vE(this._zr,"globalPan")||TE(this,"zoom",null,t,{scale:1<t.pinchScale?1.1:1/1.1,originX:t.pinchX,originY:t.pinchY,isAvailableBehavior:null})},bE),AE={axisPointer:1,tooltip:1,brush:1};function CE(t,e,n){return e=e.getComponentByElement(t.topTarget),t=e&&e.coordinateSystem,e&&e!==n&&!AE.hasOwnProperty(e.mainType)&&t&&t.model!==n}var EE=1e-8;function IE(t,e){return Math.abs(t-e)<EE}function DE(t,e,n){var r=0,i=t[0];if(i){for(var o=1;o<t.length;o++){var a=t[o];r+=Ua(i[0],i[1],a[0],a[1],e,n),i=a}var s=t[0];return IE(i[0],s[0])&&IE(i[1],s[1])||(r+=Ua(i[0],i[1],s[0],s[1],e,n)),0!==r}}function RE(t,e,n){this.name=t,this.geometries=e,n=n?[n[0],n[1]]:[(e=this.getBoundingRect()).x+e.width/2,e.y+e.height/2],this.center=n}var LE=(RE.prototype.getBoundingRect=function(){var t=this._rect;if(t)return t;t=Number.MAX_VALUE;for(var e=[t,t],n=[-t,-t],r=[],i=[],o=this.geometries,a=0;a<o.length;a++)"polygon"===o[a].type&&(function(t,e,n){if(0!==t.length){for(var r=t[0],i=r[0],o=r[0],a=r[1],s=r[1],l=1;l<t.length;l++)r=t[l],i=aa(i,r[0]),o=sa(o,r[0]),a=aa(a,r[1]),s=sa(s,r[1]);e[0]=i,e[1]=a,n[0]=o,n[1]=s}}(o[a].exterior,r,i),Rt(e,e,r),Lt(n,n,i));return 0===a&&(e[0]=e[1]=n[0]=n[1]=0),this._rect=new Un(e[0],e[1],n[0]-e[0],n[1]-e[1])},RE.prototype.contain=function(t){var e=this.getBoundingRect(),n=this.geometries;if(!e.contain(t[0],t[1]))return!1;t:for(var r=0,i=n.length;r<i;r++)if("polygon"===n[r].type){var o=n[r].exterior,a=n[r].interiors;if(DE(o,t[0],t[1])){for(var s=0;s<(a?a.length:0);s++)if(DE(a[s],t[0],t[1]))continue t;return!0}}return!1},RE.prototype.transformTo=function(t,e,n,r){var i=this.getBoundingRect(),o=i.width/i.height;n?r=r||n/o:n=o*r;r=new Un(t,e,n,r);for(var a=i.calculateTransform(r),s=this.geometries,l=0;l<s.length;l++)if("polygon"===s[l].type){for(var u=s[l].exterior,h=s[l].interiors,c=0;c<u.length;c++)Dt(u[c],u[c],a);for(var d=0;d<(h?h.length:0);d++)for(c=0;c<h[d].length;c++)Dt(h[d][c],h[d][c],a)}(i=this._rect).copy(r),this.center=[i.x+i.width/2,i.y+i.height/2]},RE.prototype.cloneShallow=function(t){return t=new RE(t=null==t?this.name:t,this.geometries,this.center),t._rect=this._rect,t.transformTo=null,t},RE);function OE(t,e,n){for(var r=[],i=e[0],o=e[1],a=0;a<t.length;a+=2){var s=(s=t.charCodeAt(a)-64)>>1^-(1&s),l=(l=t.charCodeAt(a+1)-64)>>1^-(1&l);s+=i,l+=o,r.push([(i=s)/n,(o=l)/n])}return r}function PE(t,e){return z(V((t=function(t){if(!t.UTF8Encoding)return t;var e=(t=t).UTF8Scale;null==e&&(e=1024);for(var n=t.features,r=0;r<n.length;r++){var i=n[r].geometry;if("Polygon"===i.type)for(var o=i.coordinates,a=0;a<o.length;a++)o[a]=OE(o[a],i.encodeOffsets[a],e);else if("MultiPolygon"===i.type)for(o=i.coordinates,a=0;a<o.length;a++)for(var s=o[a],l=0;l<s.length;l++)s[l]=OE(s[l],i.encodeOffsets[a][l],e)}return t.UTF8Encoding=!1,t}(t)).features,(function(t){return t.geometry&&t.properties&&0<t.geometry.coordinates.length})),(function(t){var n=t.properties,r=(t=t.geometry,[]);"Polygon"===t.type&&(i=t.coordinates,r.push({type:"polygon",exterior:i[0],interiors:i.slice(1)})),"MultiPolygon"===t.type&&F(i=t.coordinates,(function(t){t[0]&&r.push({type:"polygon",exterior:t[0],interiors:t.slice(1)})}));var i=new LE(n[e||"name"],r,n.cp);return i.properties=n,i}))}for(var NE=[126,25],kE=[[[0,3.5],[7,11.2],[15,11.9],[30,7],[42,.7],[52,.7],[56,7.7],[59,.7],[64,.7],[64,0],[5,0],[0,3.5]],[[13,16.1],[19,14.7],[16,21.7],[11,23.1],[13,16.1]],[[12,32.2],[14,38.5],[15,38.5],[13,32.2],[12,32.2]],[[16,47.6],[12,53.2],[13,53.2],[18,47.6],[16,47.6]],[[6,64.4],[8,70],[9,70],[8,64.4],[6,64.4]],[[23,82.6],[29,79.8],[30,79.8],[25,82.6],[23,82.6]],[[37,70.7],[43,62.3],[44,62.3],[39,70.7],[37,70.7]],[[48,51.1],[51,45.5],[53,45.5],[50,51.1],[48,51.1]],[[51,35],[51,28.7],[53,28.7],[53,35],[51,35]],[[52,22.4],[55,17.5],[56,17.5],[53,22.4],[52,22.4]],[[58,12.6],[62,7],[63,7],[60,12.6],[58,12.6]],[[0,3.5],[0,93.1],[64,93.1],[64,0],[63,0],[63,92.4],[1,92.4],[1,3.5],[0,3.5]]],BE=0;BE<kE.length;BE++)for(var FE=0;FE<kE[BE].length;FE++)kE[BE][FE][0]/=10.5,kE[BE][FE][1]/=-14,kE[BE][FE][0]+=NE[0],kE[BE][FE][1]+=NE[1];var zE,HE={"":[32,80],"":[0,-10],"":[10,5],"":[-10,10],"":[5,5]},VE={Russia:[100,60],"United States":[-99,38],"United States of America":[-99,38]},UE=[[[123.45165252685547,25.73527164402261],[123.49731445312499,25.73527164402261],[123.49731445312499,25.750734064600884],[123.45165252685547,25.750734064600884],[123.45165252685547,25.73527164402261]]],GE=Xi(),WE=(M={load:function(t,e,n){var r=GE(e).parsed;if(r)return r;var i,o=e.specialAreas||{};r=e.geoJSON;try{i=r?PE(r,n):[]}catch(e){throw new Error("Invalid geoJson format\n"+e.message)}return n=i,"china"===t&&n.push(new LE("",z(kE,(function(t){return{type:"polygon",exterior:t}})),NE)),F(i,(function(e){var n,r,i=e.name;n=e,"china"!==(r=t)||(r=HE[n.name])&&((n=n.center)[0]+=r[0]/10.5,n[1]+=-r[1]/14),n=e,"world"!==(r=t)||(r=VE[n.name])&&((n=n.center)[0]=r[0],n[1]=r[1]),r=e,"china"===t&&""===r.name&&r.geometries.push({type:"polygon",exterior:UE[0]}),i=o[i],i&&e.transformTo(i.left,i.top,i.width,i.height)})),GE(e).parsed={regions:i,boundingRect:function(t){for(var e,n=0;n<t.length;n++){var r=t[n].getBoundingRect();(e=e||r.clone()).union(r)}return e}(i)}}},/[\s,]+/),XE=(jE.prototype.parse=function(t,e){e=e||{};var n=tm(t);if(!n)throw new Error("Illegal svg");var r=new ei;this._root=r;var i=n.getAttribute("viewBox")||"",o=parseFloat(n.getAttribute("width")||e.width);t=parseFloat(n.getAttribute("height")||e.height);isNaN(o)&&(o=null),isNaN(t)&&(t=null),QE(n,r,null,!0);for(var a,s,l,u=n.firstChild;u;)this._parseNode(u,r),u=u.nextSibling;return!i||4<=(s=st(i).split(WE)).length&&(a={x:parseFloat(s[0]||0),y:parseFloat(s[1]||0),width:parseFloat(s[2]),height:parseFloat(s[3])}),a&&null!=o&&null!=t&&(l=nI(a,o,t),e.ignoreViewBox||(s=r,(r=new ei).add(s),s.scaleX=s.scaleY=l.scale,s.x=l.x,s.y=l.y)),e.ignoreRootClip||null==o||null==t||r.setClipPath(new bs({shape:{x:0,y:0,width:o,height:t}})),{root:r,width:o,height:t,viewBoxRect:a,viewBoxTransform:l}},jE.prototype._parseNode=function(t,e){var n,r,i,o,a=t.nodeName.toLowerCase();if("defs"===a?this._isDefine=!0:"text"===a&&(this._isText=!0),this._isDefine?(o=YE[a])&&(r=o.call(this,t),(i=t.getAttribute("id"))&&(this._defs[i]=r)):(o=zE[a])&&(n=o.call(this,t,e),e.add(n)),n)for(var s=t.firstChild;s;)1===s.nodeType&&this._parseNode(s,n),3===s.nodeType&&this._isText&&this._parseText(s,n),s=s.nextSibling;"defs"===a?this._isDefine=!1:"text"===a&&(this._isText=!1)},jE.prototype._parseText=function(t,e){1===t.nodeType&&(n=t.getAttribute("dx")||0,r=t.getAttribute("dy")||0,this._textX+=parseFloat(n),this._textY+=parseFloat(r));var n=new ss({style:{text:t.textContent},x:this._textX||0,y:this._textY||0});ZE(e,n),QE(t,n,this._defs);var r=n.style;t=r.fontSize;return t&&t<9&&(r.fontSize=9,n.scaleX*=t/9,n.scaleY*=t/9),t=(r.fontSize||r.fontFamily)&&[r.fontStyle,r.fontWeight,(r.fontSize||12)+"px",r.fontFamily||"sans-serif"].join(" "),r.font=t,t=n.getBoundingRect(),this._textX+=t.width,e.add(n),n},jE.internalField=void(zE={g:function(t,e){var n=new ei;return ZE(e,n),QE(t,n,this._defs),n},rect:function(t,e){var n=new bs;return ZE(e,n),QE(t,n,this._defs),n.setShape({x:parseFloat(t.getAttribute("x")||"0"),y:parseFloat(t.getAttribute("y")||"0"),width:parseFloat(t.getAttribute("width")||"0"),height:parseFloat(t.getAttribute("height")||"0")}),n},circle:function(t,e){var n=new tu;return ZE(e,n),QE(t,n,this._defs),n.setShape({cx:parseFloat(t.getAttribute("cx")||"0"),cy:parseFloat(t.getAttribute("cy")||"0"),r:parseFloat(t.getAttribute("r")||"0")}),n},line:function(t,e){var n=new Vu;return ZE(e,n),QE(t,n,this._defs),n.setShape({x1:parseFloat(t.getAttribute("x1")||"0"),y1:parseFloat(t.getAttribute("y1")||"0"),x2:parseFloat(t.getAttribute("x2")||"0"),y2:parseFloat(t.getAttribute("y2")||"0")}),n},ellipse:function(t,e){var n=new ru;return ZE(e,n),QE(t,n,this._defs),n.setShape({cx:parseFloat(t.getAttribute("cx")||"0"),cy:parseFloat(t.getAttribute("cy")||"0"),rx:parseFloat(t.getAttribute("rx")||"0"),ry:parseFloat(t.getAttribute("ry")||"0")}),n},polygon:function(t,e){var n=t.getAttribute("points");n&&(r=qE(n));var r=new Lu({shape:{points:r||[]}});return ZE(e,r),QE(t,r,this._defs),r},polyline:function(t,e){var n=new rs;ZE(e,n),QE(t,n,this._defs);var r;t=t.getAttribute("points");return t&&(r=qE(t)),new Bu({shape:{points:r||[]}})},image:function(t,e){var n=new cs;return ZE(e,n),QE(t,n,this._defs),n.setStyle({image:t.getAttribute("xlink:href"),x:+t.getAttribute("x"),y:+t.getAttribute("y"),width:+t.getAttribute("width"),height:+t.getAttribute("height")}),n},text:function(t,e){var n=t.getAttribute("x")||"0",r=t.getAttribute("y")||"0",i=t.getAttribute("dx")||"0",o=t.getAttribute("dy")||"0";return this._textX=parseFloat(n)+parseFloat(i),this._textY=parseFloat(r)+parseFloat(o),o=new ei,ZE(e,o),QE(t,o,this._defs),o},tspan:function(t,e){var n=t.getAttribute("x"),r=t.getAttribute("y");null!=n&&(this._textX=parseFloat(n)),null!=r&&(this._textY=parseFloat(r));var i=t.getAttribute("dx")||0;n=t.getAttribute("dy")||0,r=new ei;return ZE(e,r),QE(t,r,this._defs),this._textX+=i,this._textY+=n,r},path:function(t,e){var n=Zl(t.getAttribute("d")||"");return ZE(e,n),QE(t,n,this._defs),n}}),jE);function jE(){this._defs={},this._root=null,this._isDefine=!1,this._isText=!1}var YE={lineargradient:function(t){var e=parseInt(t.getAttribute("x1")||"0",10),n=parseInt(t.getAttribute("y1")||"0",10),r=parseInt(t.getAttribute("x2")||"10",10),i=parseInt(t.getAttribute("y2")||"0",10);i=new oh(e,n,r,i);return function(t,e){for(var n=t.firstChild;n;){var r,i;1===n.nodeType&&(i=n.getAttribute("offset"),r=void 0,r=0<i.indexOf("%")?parseInt(i,10)/100:i?parseFloat(i):0,i=n.getAttribute("stop-color")||"#000000",e.colorStops.push({offset:r,color:i})),n=n.nextSibling}}(t,i),i}};function ZE(t,e){t&&t.__inheritedStyle&&(e.__inheritedStyle||(e.__inheritedStyle={}),L(e.__inheritedStyle,t.__inheritedStyle))}function qE(t){for(var e=st(t).split(WE),n=[],r=0;r<e.length;r+=2){var i=parseFloat(e[r]),o=parseFloat(e[r+1]);n.push([i,o])}return n}var KE={fill:"fill",stroke:"stroke","stroke-width":"lineWidth",opacity:"opacity","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-miterlimit":"miterLimit","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","text-align":"textAlign","alignment-baseline":"textBaseline"};function QE(t,e,n,r){var i,o=e,a=o.__inheritedStyle||{};if(1===t.nodeType&&(function(t,e){if(t=t.getAttribute("transform"),t){t=t.replace(/,/g," ");var n=[],r=null;t.replace(tI,(function(t,e,r){return n.push(e,r),""}));for(var i=n.length-1;0<i;i-=2){var o=n[i],a=n[i-1],s=void 0;switch(r=r||ye(),a){case"translate":s=st(o).split(WE),be(r,r,[parseFloat(s[0]),parseFloat(s[1]||"0")]);break;case"scale":s=st(o).split(WE),we(r,r,[parseFloat(s[0]),parseFloat(s[1]||s[0])]);break;case"rotate":s=st(o).split(WE),Te(r,r,parseFloat(s[0]));break;case"skew":s=st(o).split(WE),console.warn("Skew transform is not supported yet");break;case"matrix":s=st(o).split(WE),r[0]=parseFloat(s[0]),r[1]=parseFloat(s[1]),r[2]=parseFloat(s[2]),r[3]=parseFloat(s[3]),r[4]=parseFloat(s[4]),r[5]=parseFloat(s[5])}}e.setLocalTransform(r)}}(t,e),R(a,function(t){var e=t.getAttribute("style"),n={};if(!e)return n;var r,i,o={};for(eI.lastIndex=0;null!=(r=eI.exec(e));)o[r[1]]=r[2];for(i in KE)KE.hasOwnProperty(i)&&null!=o[i]&&(n[KE[i]]=o[i]);return n}(t)),!r))for(var s in KE)!KE.hasOwnProperty(s)||null!=(i=t.getAttribute(s))&&(a[KE[s]]=i);o.style=o.style||{},null!=a.fill&&(o.style.fill=$E(a.fill,n)),null!=a.stroke&&(o.style.stroke=$E(a.stroke,n)),F(["lineWidth","opacity","fillOpacity","strokeOpacity","miterLimit","fontSize"],(function(t){null!=a[t]&&(o.style[t]=parseFloat(a[t]))})),a.textBaseline&&"auto"!==a.textBaseline||(a.textBaseline="alphabetic"),"alphabetic"===a.textBaseline&&(a.textBaseline="bottom"),"start"===a.textAlign&&(a.textAlign="left"),"end"===a.textAlign&&(a.textAlign="right"),F(["lineDashOffset","lineCap","lineJoin","fontWeight","fontFamily","fontStyle","textAlign","textBaseline"],(function(t){null!=a[t]&&(o.style[t]=a[t])})),a.lineDash&&(o.style.lineDash=z(st(a.lineDash).split(WE),(function(t){return parseFloat(t)}))),o.__inheritedStyle=a}var JE=/url\(\s*#(.*?)\)/;function $E(t,e){var n=e&&t&&t.match(JE);return n?e[st(n[1])]:t}var tI=/(translate|scale|rotate|skewX|skewY|matrix)\(([\-\s0-9\.e,]*)\)/g,eI=/([^\s:;]+)\s*:\s*([^:;]+)/g;function nI(t,e,n){var r=e/t.width,i=n/t.height;i=Math.min(r,i);return{scale:i,x:-(t.x+t.width/2)*i+e/2,y:-(t.y+t.height/2)*i+n/2}}var rI=Xi();function iI(t,e){t=t.svgXML;try{at(null!=(n=(o=t&&(r=t,i={ignoreViewBox:!0,ignoreRootClip:!0},(new XE).parse(r,i))||{}).root))}catch(t){throw new Error("Invalid svg format\n"+t.message)}var n,r=o.width,i=o.height,o=o.viewBoxRect;return e||(e=null==r||null==i?n.getBoundingRect():new Un(0,0,0,0),null!=r&&(e.width=r),null!=i&&(e.height=i)),o&&(i=nI(o,e.width,e.height),o=n,(n=new ei).add(o),o.scaleX=o.scaleY=i.scale,o.x=i.x,o.y=i.y),n.setClipPath(new bs({shape:e.plain()})),{root:n,boundingRect:e}}var oI={geoJSON:M,svg:{load:function(t,e){var n=rI(e).originRoot;return n?{root:n,boundingRect:rI(e).boundingRect}:(n=iI(e),rI(e).originRoot=n.root,rI(e).boundingRect=n.boundingRect,n)},makeGraphic:function(t,e,n){var r=rI(e),i=r.rootMap||(r.rootMap=pt());if(s=i.get(n))return s;var o=r.originRoot,a=r.boundingRect,s=r.originRootHostKey?iI(e,a).root:(r.originRootHostKey=n,o);return i.set(n,s)},removeGraphic:function(t,e,n){var r=rI(e);e=r.rootMap;e&&e.removeKey(n),n===r.originRootHostKey&&(r.originRootHostKey=null)}}},aI=function(t,e,n){var r,i=[],o=pt(),a=pt();return F(uI(t),(function(s){s=oI[s.type].load(t,s,n),F(s.regions,(function(t){var n=t.name;e&&e.hasOwnProperty(n)&&(t=t.cloneShallow(n=e[n])),i.push(t),o.set(n,t),a.set(n,t.center)})),s=s.boundingRect,s&&(r?r.union(s):r=s.clone())})),{regions:i,regionsMap:o,nameCoordMap:a,boundingRect:r||new Un(0,0,0,0)}},sI=function(t,e){var n=uI(t),r=[];return F(n,(function(n){var i=oI[n.type].makeGraphic;i&&r.push(i(t,n,e))})),r},lI=function(t,e){F(uI(t),(function(n){var r=oI[n.type].makeGraphic;r&&r(t,n,e)}))};function uI(t){return nm.retrieveMap(t)||[]}function hI(t){var e=t.getItemStyle();t=t.get("areaColor");return null!=t&&(e.fill=t),e}function cI(t){var e=new ei;this.uid=Tc("ec_map_draw"),this._controller=new ME(t.getZr()),this._controllerHost={target:e},(this.group=e).add(this._regionsGroup=new ei),e.add(this._backgroundGroup=new ei)}var dI,pI=(cI.prototype.draw=function(t,e,n,r,i){var o="geo"===t.mainType,a=t.getData&&t.getData();o&&e.eachComponent({mainType:"series",subType:"map"},(function(e){a||e.getHostGeoModel()!==t||(a=e.getData())}));var s=t.coordinateSystem;this._updateBackground(s);var l,u,h,c=this._regionsGroup,d=this.group,p=s.getTransformInfo(),f=!c.childAt(0)||i;f?(d.transform=p.roamTransform,d.decomposeTransform(),d.dirty()):((l=new Le).transform=p.roamTransform,l.decomposeTransform(),i={scaleX:l.scaleX,scaleY:l.scaleY,x:l.x,y:l.y},u=l.scaleX,h=l.scaleY,Nh(d,i,t)),c.removeAll();var g=pt(),m=a&&a.getVisual("visualMeta")&&0<a.getVisual("visualMeta").length;F(s.regions,(function(e){var r=g.get(e.name)||g.set(e.name,new ei),i=new th({segmentIgnoreThreshold:1,shape:{paths:[]}});r.add(i);var s=t.getRegionModel(e.name)||t,l=s.getModel("itemStyle"),y=s.getModel("emphasis"),_=y.getModel("itemStyle"),v=s.getModel(["blur","itemStyle"]),x=s.getModel(["select","itemStyle"]),b=hI(l),T=hI(_);l=hI(v),_=hI(x);function w(t){return[t[0]*S+A,t[1]*M+C]}a&&(R=a.indexOfName(e.name),v=a.getItemVisual(R,"style"),x=a.getItemVisual(R,"decal"),m&&v.fill&&(b.fill=v.fill),x&&(b.decal=xy(x,n)));var S=p.rawScaleX,M=p.rawScaleY,A=p.rawX,C=p.rawY;F(e.geometries,(function(t){if("polygon"===t.type){for(var e=[],n=0;n<t.exterior.length;++n)e.push(w(t.exterior[n]));for(i.shape.paths.push(new Lu({segmentIgnoreThreshold:1,shape:{points:e}})),n=0;n<(t.interiors?t.interiors.length:0);++n){for(var r=t.interiors[n],o=[],a=0;a<r.length;++a)o.push(w(r[a]));i.shape.paths.push(new Lu({segmentIgnoreThreshold:1,shape:{points:o}}))}}})),i.setStyle(b),i.style.strokeNoScale=!0,i.culling=!0,i.ensureState("emphasis").style=T,i.ensureState("blur").style=l,i.ensureState("select").style=_;for(var E=!1,I=0;I<Us.length;I++){var D=Us[I];if(s.get("normal"===D?["label","show"]:[D,"label","show"])){E=!0;break}}var R;T=a&&isNaN(a.get(a.mapDimension("value"),R)),l=a&&a.getItemLayout(R);(o||T&&E||l&&l.showLabel)&&(_=o?e.name:R,T=!a||0<=R?t:void 0,l=w(e.center),tc(l=new Os({x:l[0],y:l[1],scaleX:1/d.scaleX,scaleY:1/d.scaleY,z2:10,silent:!0}),ec(s),{labelFetcher:T,labelDataIndex:_,defaultText:e.name},{normal:{align:"center",verticalAlign:"middle"}}),i.setTextContent(l),i.setTextConfig({local:!0}),i.disableLabelAnimation=!0,f||Nh(l,{scaleX:1/u,scaleY:1/h},t)),a?a.setItemGraphicEl(R,r):(R=t.getRegionModel(e.name),Ps(i).eventData={componentType:"geo",componentIndex:t.componentIndex,geoIndex:t.componentIndex,name:e.name,region:R&&R.option||{}}),(r.__regions||(r.__regions=[])).push(e),r.highDownSilentOnTouch=!!t.get("selectedMode"),bl(r,y.get("focus"),y.get("blurScope")),c.add(r)})),this._updateController(t,e,n),this._updateMapSelectHandler(t,c,n,r)},cI.prototype.remove=function(){this._regionsGroup.removeAll(),this._backgroundGroup.removeAll(),this._controller.dispose(),this._mapName&&lI(this._mapName,this.uid),this._mapName=null,this._controllerHost=null},cI.prototype._updateBackground=function(t){t=t.map,this._mapName!==t&&F(sI(t,this.uid),(function(t){this._backgroundGroup.add(t)}),this),this._mapName=t},cI.prototype._updateController=function(t,e,n){var r=t.coordinateSystem,i=this._controller,o=this._controllerHost;o.zoomLimit=t.get("scaleLimit"),o.zoom=r.getZoom(),i.enable(t.get("roam")||!1);var a=t.mainType;function s(){var e={type:"geoRoam",componentType:a};return e[a+"Id"]=t.id,e}i.off("pan").on("pan",(function(t){var e,r,i;this._mouseDownFlag=!1,e=o,r=t.dx,i=t.dy,(e=e.target).x+=r,e.y+=i,e.dirty(),n.dispatchAction(R(s(),{dx:t.dx,dy:t.dy}))}),this),i.off("zoom").on("zoom",(function(t){this._mouseDownFlag=!1,function(t,e,n,r){var i=t.target,o=t.zoomLimit,a=t.zoom=t.zoom||1;a*=e,o&&(s=o.min||0,o=o.max||1/0,a=Math.max(Math.min(o,a),s));var s=a/t.zoom;t.zoom=a,i.x-=(n-i.x)*(s-1),i.y-=(r-i.y)*(s-1),i.scaleX*=s,i.scaleY*=s,i.dirty()}(o,t.scale,t.originX,t.originY),n.dispatchAction(R(s(),{zoom:t.scale,originX:t.originX,originY:t.originY}));var e=this.group;this._regionsGroup.traverse((function(t){t=t.getTextContent(),t&&(t.scaleX=1/e.scaleX,t.scaleY=1/e.scaleY,t.markRedraw())}))}),this),i.setPointerChecker((function(e,i,o){return r.getViewRectAfterRoam().contain(i,o)&&!CE(e,n,t)}))},cI.prototype._updateMapSelectHandler=function(t,e,n,r){var i=this;e.off("mousedown"),t.get("selectedMode")&&(e.on("mousedown",(function(){i._mouseDownFlag=!0})),e.on("click",(function(t){i._mouseDownFlag&&(i._mouseDownFlag=!1)})))},cI);function fI(){var t=null!==dI&&dI.apply(this,arguments)||this;return t.type=fI.type,t}var gI,mI=(h(fI,dI=Mg),fI.prototype.render=function(t,e,n,r){var i,o;r&&"mapToggleSelect"===r.type&&r.from===this.uid||((i=this.group).removeAll(),t.getHostGeoModel()||(r&&"geoRoam"===r.type&&"series"===r.componentType&&r.seriesId===t.id?(o=this._mapDraw)&&i.add(o.group):t.needsDrawMap?(o=this._mapDraw||new pI(n),i.add(o.group),o.draw(t,e,n,this,r),this._mapDraw=o):(this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null),t.get("showLegendSymbol")&&e.getComponent("legend")&&this._renderSymbols(t,e,n)))},fI.prototype.remove=function(){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null,this.group.removeAll()},fI.prototype.dispose=function(){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null},fI.prototype._renderSymbols=function(t,e,n){var r=t.originalData,i=this.group;r.each(r.mapDimension("value"),(function(e,n){var o,a,s;isNaN(e)||(s=r.getItemLayout(n))&&s.point&&(e=s.point,s=s.offset,o=new tu({style:{fill:t.getData().getVisual("style").fill},shape:{cx:e[0]+9*s,cy:e[1],r:3},silent:!0,z2:8+(s?0:Gs+1)}),s||(e=t.mainSeries.getData(),s=r.getName(n),a=e.indexOfName(s),n=(s=r.getItemModel(n)).getModel("label"),e=e.getItemGraphicEl(a),tc(o,ec(s),{labelFetcher:{getFormattedLabel:function(e,n){return t.getFormattedLabel(a,n)}}}),o.disableLabelAnimation=!0,n.get("position")||o.setTextConfig({position:"bottom"}),e.onHoverStateChange=function(t){o.useState(t)}),i.add(o))}))},fI.type="map",fI);function yI(t,e,n){e=X(e)?{coordDimensions:e}:R({},e);var r=t.getSource();e=Mv(r,e),t=new Tv(e,t);return t.initData(r,n),t}function _I(){var t=null!==gI&&gI.apply(this,arguments)||this;return t.type=_I.type,t.needsDrawMap=!1,t.seriesGroup=[],t.getTooltipPosition=function(t){if(null!=t){var e=this.getData().getName(t);t=this.coordinateSystem,e=t.getRegion(e);return e&&t.dataToPoint(e.center)}},t}var vI=(h(_I,gI=pg),_I.prototype.getInitialData=function(t){for(var e=yI(this,{coordDimensions:["value"],encodeDefaulter:W(jd,this)}),n=pt(),r=[],i=0,o=e.count();i<o;i++){var a=e.getName(i);n.set(a,!0)}return F(aI(this.getMapType(),this.option.nameMap,this.option.nameProperty).regions,(function(t){t=t.name,n.get(t)||r.push(t)})),e.appendValues([],r),e},_I.prototype.getHostGeoModel=function(){var t=this.option.geoIndex;return null!=t?this.ecModel.getComponent("geo",t):null},_I.prototype.getMapType=function(){return(this.getHostGeoModel()||this).option.map},_I.prototype.getRawValue=function(t){var e=this.getData();return e.get(e.mapDimension("value"),t)},_I.prototype.getRegionModel=function(t){var e=this.getData();return e.getItemModel(e.indexOfName(t))},_I.prototype.formatTooltip=function(t,e,n){for(var r=this.getData(),i=this.getRawValue(t),o=r.getName(t),a=this.seriesGroup,s=[],l=0;l<a.length;l++){var u=a[l].originalData.indexOfName(o),h=r.mapDimension("value");isNaN(a[l].originalData.get(h,u))||s.push(a[l].name)}return Xf("section",{header:s.join(", "),noHeader:!s.length,blocks:[Xf("nameValue",{name:o,value:i})]})},_I.prototype.setZoom=function(t){this.option.zoom=t},_I.prototype.setCenter=function(t){this.option.center=t},_I.type="series.map",_I.dependencies=["geo"],_I.layoutMode="box",_I.defaultOption={zlevel:0,z:2,coordinateSystem:"geo",map:"",left:"center",top:"center",aspectScale:.75,showLegendSymbol:!0,boundingCoords:null,center:null,zoom:1,scaleLimit:null,selectedMode:!0,label:{show:!1,color:"#000"},itemStyle:{borderWidth:.5,borderColor:"#444",areaColor:"#eee"},emphasis:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{areaColor:"rgba(255,215,0,0.8)"}},select:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},nameProperty:"name"},_I);function xI(t){var e={};t.eachSeriesByType("map",(function(t){var n=t.getHostGeoModel();n=n?"o"+n.id:"i"+t.getMapType();(e[n]=e[n]||[]).push(t)})),F(e,(function(t,e){for(var n,r,i,o=(n=z(t,(function(t){return t.getData()})),r=t[0].get("mapValueCalculation"),i={},F(n,(function(t){t.each(t.mapDimension("value"),(function(e,n){n="ec-"+t.getName(n),i[n]=i[n]||[],isNaN(e)||i[n].push(e)}))})),n[0].map(n[0].mapDimension("value"),(function(t,e){for(var o="ec-"+n[0].getName(e),a=0,s=1/0,l=-1/0,u=i[o].length,h=0;h<u;h++)s=Math.min(s,i[o][h]),l=Math.max(l,i[o][h]),a+=i[o][h];return e="min"===r?s:"max"===r?l:"average"===r?a/u:a,0===u?NaN:e}))),a=0;a<t.length;a++)t[a].originalData=t[a].getData();for(a=0;a<t.length;a++)(t[a].seriesGroup=t)[a].needsDrawMap=0===a&&!t[a].getHostGeoModel(),t[a].setData(o.cloneShallow()),t[a].mainSeries=t[0]}))}function bI(t){var e={};t.eachSeriesByType("map",(function(n){var r,i,o=n.getMapType();n.getHostGeoModel()||e[o]||(r={},F(n.seriesGroup,(function(e){var n=e.coordinateSystem,i=e.originalData;e.get("showLegendSymbol")&&t.getComponent("legend")&&i.each(i.mapDimension("value"),(function(t,e){var o=i.getName(e),a=n.getRegion(o);a&&!isNaN(t)&&(t=r[o]||0,a=n.dataToPoint(a.center),r[o]=t+1,i.setItemLayout(e,{point:a,offset:t}))}))})),(i=n.getData()).each((function(t){var e=i.getName(t),n=i.getItemLayout(t)||{};n.showLabel=!r[e],i.setItemLayout(t,n)})),e[o]=!0)}))}var TI,wI=Dt;function SI(t){var e=TI.call(this)||this;return e.type="view",e.dimensions=["x","y"],e._roamTransformable=new Le,e._rawTransformable=new Le,e.name=t,e}function MI(t){return t=t.seriesModel,t?t.coordinateSystem:null}var AI,CI=(h(SI,TI=Le),SI.prototype.setBoundingRect=function(t,e,n,r){return this._rect=new Un(t,e,n,r),this._rect},SI.prototype.getBoundingRect=function(){return this._rect},SI.prototype.setViewRect=function(t,e,n,r){this.transformTo(t,e,n,r),this._viewRect=new Un(t,e,n,r)},SI.prototype.transformTo=function(t,e,n,r){var i=this.getBoundingRect(),o=this._rawTransformable;o.transform=i.calculateTransform(new Un(t,e,n,r)),o.decomposeTransform(),this._updateTransform()},SI.prototype.setCenter=function(t){t&&(this._center=t,this._updateCenterAndZoom())},SI.prototype.setZoom=function(t){t=t||1;var e=this.zoomLimit;e&&(null!=e.max&&(t=Math.min(e.max,t)),null!=e.min&&(t=Math.max(e.min,t))),this._zoom=t,this._updateCenterAndZoom()},SI.prototype.getDefaultCenter=function(){var t=this.getBoundingRect();return[t.x+t.width/2,t.y+t.height/2]},SI.prototype.getCenter=function(){return this._center||this.getDefaultCenter()},SI.prototype.getZoom=function(){return this._zoom||1},SI.prototype.getRoamTransform=function(){return this._roamTransformable.getLocalTransform()},SI.prototype._updateCenterAndZoom=function(){var t=this._rawTransformable.getLocalTransform(),e=this._roamTransformable,n=this.getDefaultCenter(),r=this.getCenter(),i=this.getZoom();r=Dt([],r,t),n=Dt([],n,t);e.originX=r[0],e.originY=r[1],e.x=n[0]-r[0],e.y=n[1]-r[1],e.scaleX=e.scaleY=i,this._updateTransform()},SI.prototype._updateTransform=function(){var t=this._roamTransformable,e=this._rawTransformable;(e.parent=t).updateTransform(),e.updateTransform(),ve(this.transform||(this.transform=[]),e.transform||ye()),this._rawTransform=e.getLocalTransform(),this.invTransform=this.invTransform||[],Se(this.invTransform,this.transform),this.decomposeTransform()},SI.prototype.getTransformInfo=function(){var t=this._roamTransformable.transform,e=this._rawTransformable;return{roamTransform:t?it(t):ye(),rawScaleX:e.scaleX,rawScaleY:e.scaleY,rawX:e.x,rawY:e.y}},SI.prototype.getViewRect=function(){return this._viewRect},SI.prototype.getViewRectAfterRoam=function(){var t=this.getBoundingRect().clone();return t.applyTransform(this.transform),t},SI.prototype.dataToPoint=function(t,e,n){return e=e?this._rawTransform:this.transform,n=n||[],e?wI(n,t,e):(t=t,(n=n)[0]=t[0],n[1]=t[1],n)},SI.prototype.pointToData=function(t){var e=this.invTransform;return e?wI([],t,e):[t[0],t[1]]},SI.prototype.convertToPixel=function(t,e,n){return e=MI(e),e===this?e.dataToPoint(n):null},SI.prototype.convertFromPixel=function(t,e,n){return e=MI(e),e===this?e.pointToData(n):null},SI.prototype.containPoint=function(t){return this.getViewRectAfterRoam().contain(t[0],t[1])},SI.dimensions=["x","y"],SI);h(EI,AI=CI),EI.prototype.containCoord=function(t){for(var e=this.regions,n=0;n<e.length;n++)if(e[n].contain(t))return!0;return!1},EI.prototype.transformTo=function(t,e,n,r){var i=this.getBoundingRect(),o=this._invertLongitute;i=i.clone();o&&(i.y=-i.y-i.height);var a=this._rawTransformable;a.transform=i.calculateTransform(new Un(t,e,n,r)),a.decomposeTransform(),o&&(a.scaleY=-a.scaleY),a.updateTransform(),this._updateTransform()},EI.prototype.getRegion=function(t){return this._regionsMap.get(t)},EI.prototype.getRegionByCoord=function(t){for(var e=this.regions,n=0;n<e.length;n++)if(e[n].contain(t))return e[n]},EI.prototype.addGeoCoord=function(t,e){this._nameCoordMap.set(t,e)},EI.prototype.getGeoCoord=function(t){return this._nameCoordMap.get(t)},EI.prototype.getBoundingRect=function(){return this._rect},EI.prototype.dataToPoint=function(t,e,n){if(t="string"==typeof t?this.getGeoCoord(t):t)return CI.prototype.dataToPoint.call(this,t,e,n)},EI.prototype.convertToPixel=function(t,e,n){return e=II(e),e===this?e.dataToPoint(n):null},EI.prototype.convertFromPixel=function(t,e,n){return e=II(e),e===this?e.pointToData(n):null},Bo=EI;function EI(t,e,n,r){return t=AI.call(this,t)||this,t.dimensions=["lng","lat"],t.type="geo",t.map=e,n=aI(e,n),t._nameCoordMap=n.nameCoordMap,t._regionsMap=n.regionsMap,t._invertLongitute=null==r||r,t.regions=n.regions,t._rect=n.boundingRect,t}function II(t){var e=t.geoModel;t=t.seriesModel;return e?e.coordinateSystem:t?t.coordinateSystem||(t.getReferringComponents("geo",Zi).models[0]||{}).coordinateSystem:null}k(Bo,CI);var DI=Bo;function RI(t,e){var n=t.get("boundingCoords");null!=n&&(u=n[0],l=n[1],isNaN(u[0])||isNaN(u[1])||isNaN(l[0])||isNaN(l[1])||this.setBoundingRect(u[0],u[1],l[0]-u[0],l[1]-u[1]));var r,i,o,a=this.getBoundingRect(),s=t.get("layoutCenter"),l=(n=t.get("layoutSize"),e.getWidth()),u=e.getHeight();e=a.width/a.height*this.aspectScale,a=!1;s&&n&&(o=[hi(s[0],l),hi(s[1],u)],r=hi(n,Math.min(l,u)),isNaN(o[0])||isNaN(o[1])||isNaN(r)||(a=!0)),a?(i={},1<e?(i.width=r,i.height=r/e):(i.height=r,i.width=r*e),i.y=o[1]-i.height/2,i.x=o[0]-i.width/2):((o=t.getBoxLayoutParams()).aspect=e,i=vd(o,{width:l,height:u})),this.setViewRect(i.x,i.y,i.width,i.height),this.setCenter(t.get("center")),this.setZoom(t.get("zoom"))}function LI(){this.dimensions=DI.prototype.dimensions}var OI,PI=new(LI.prototype.create=function(t,e){var n=[];t.eachComponent("geo",(function(t,r){var i=t.get("map"),o=t.get("aspectScale"),a=!0,s=nm.retrieveMap(i);s&&s[0]&&"svg"===s[0].type?(null==o&&(o=1),a=!1):null==o&&(o=.75),a=new DI(i+r,i,t.get("nameMap"),a),a.aspectScale=o,a.zoomLimit=t.get("scaleLimit"),n.push(a),(t.coordinateSystem=a).model=t,a.resize=RI,a.resize(t,e)})),t.eachSeries((function(t){var e;"geo"===t.get("coordinateSystem")&&(e=t.get("geoIndex")||0,t.coordinateSystem=n[e])}));var r={};return t.eachSeriesByType("map",(function(t){var e;t.getHostGeoModel()||(e=t.getMapType(),r[e]=r[e]||[],r[e].push(t))})),F(r,(function(t,r){var i=z(t,(function(t){return t.get("nameMap")})),o=new DI(r,r,function(t,e){for(var n=t[0],r=1,i=t.length;r<i;r++)n=D(n,t[r],e);return n}(i));o.zoomLimit=et.apply(null,z(t,(function(t){return t.get("scaleLimit")}))),n.push(o),o.resize=RI,o.aspectScale=t[0].get("aspectScale"),o.resize(t[0],e),F(t,(function(t){var e;t.coordinateSystem=o,e=o,F(t.get("geoCoord"),(function(t,n){e.addGeoCoord(n,t)}))}))})),n},LI.prototype.getFilledRegions=function(t,e,n){for(var r=(t||[]).slice(),i=pt(),o=0;o<r.length;o++)i.set(r[o].name,r[o]);return F(aI(e,n).regions,(function(t){t=t.name,i.get(t)||r.push({name:t})})),r},LI);function NI(){var t=null!==OI&&OI.apply(this,arguments)||this;return t.type=NI.type,t}var kI,BI=(h(NI,OI=Ld),NI.prototype.init=function(t,e,n){OI.prototype.init.call(this,t,e,n),Pi(t,"label",["show"])},NI.prototype.optionUpdated=function(){var t=this.option,e=this;t.regions=PI.getFilledRegions(t.regions,t.map,t.nameMap);var n={};this._optionModelMap=H(t.regions||[],(function(t,r){var i=r.name;return i&&(t.set(i,new xc(r,e)),r.selected&&(n[i]=!0)),t}),pt()),t.selectedMap||(t.selectedMap=n)},NI.prototype.getRegionModel=function(t){return this._optionModelMap.get(t)||new xc(null,this,this.ecModel)},NI.prototype.getFormattedLabel=function(t,e){var n=this.getRegionModel(t),r="normal"===e?n.get(["label","formatter"]):n.get(["emphasis","label","formatter"]);n={name:t};return"function"==typeof r?(n.status=e,r(n)):"string"==typeof r?r.replace("{a}",null!=t?t:""):void 0},NI.prototype.setZoom=function(t){this.option.zoom=t},NI.prototype.setCenter=function(t){this.option.center=t},NI.prototype.select=function(t){var e=this.option,n=e.selectedMode;n&&("multiple"!==n&&(e.selectedMap=null),(e.selectedMap||(e.selectedMap={}))[t]=!0)},NI.prototype.unSelect=function(t){var e=this.option.selectedMap;e&&(e[t]=!1)},NI.prototype.toggleSelected=function(t){this[this.isSelected(t)?"unSelect":"select"](t)},NI.prototype.isSelected=function(t){var e=this.option.selectedMap;return!(!e||!e[t])},NI.prototype._initSelectedMapFromData=function(){},NI.type="geo",NI.layoutMode="box",NI.defaultOption={zlevel:0,z:0,show:!0,left:"center",top:"center",aspectScale:null,silent:!1,map:"",boundingCoords:null,center:null,zoom:1,scaleLimit:null,label:{show:!1,color:"#000"},itemStyle:{borderWidth:.5,borderColor:"#444",color:"#eee"},emphasis:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},select:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},regions:[]},NI);function FI(){var t=null!==kI&&kI.apply(this,arguments)||this;return t.type=FI.type,t}var zI=(h(FI,kI=gg),FI.prototype.init=function(t,e){var n=new pI(e);this._mapDraw=n,this.group.add(n.group),this._api=e},FI.prototype.render=function(t,e,n,r){var i=this._mapDraw;t.get("show")?i.draw(t,e,n,this,r):this._mapDraw.group.removeAll(),i.group.on("click",this._handleRegionClick,this),i.group.silent=t.get("silent"),this._model=t,this.updateSelectStatus(t,e,n)},FI.prototype._handleRegionClick=function(t){for(var e,n=t.target;n&&null==(e=Ps(n).eventData);)n=n.__hostTarget||n.parent;e&&this._api.dispatchAction({type:"geoToggleSelect",geoId:this._model.id,name:e.name})},FI.prototype.updateSelectStatus=function(t,e,n){var r=this;this._mapDraw.group.traverse((function(t){var e=Ps(t).eventData;if(e)return r._model.isSelected(e.name)?n.enterSelect(t):n.leaveSelect(t),!0}))},FI.prototype.dispose=function(){this._mapDraw&&this._mapDraw.remove()},FI.type="geo",FI);function HI(t){function e(e,n){n.update="geo:updateSelectStatus",t.registerAction(n,(function(t,n){var r={};return n.eachComponent({mainType:"geo",query:t},(function(n){n[e](t.name),F(n.coordinateSystem.regions,(function(t){r[t.name]=n.isSelected(t.name)||!1}))})),{selected:r,name:t.name}}))}t.registerCoordinateSystem("geo",PI),t.registerComponentModel(BI),t.registerComponentView(zI),e("toggleSelected",{type:"geoToggleSelect",event:"geoselectchanged"}),e("select",{type:"geoSelect",event:"geoselected"}),e("unSelect",{type:"geoUnSelect",event:"geounselected"}),t.registerAction({type:"geoRoam",event:"geoRoam",update:"updateTransform"},(function(t,e){var n=t.componentType||"series";e.eachComponent({mainType:n,query:t},(function(e){var r,i,o,a,s,l,u,h=e.coordinateSystem;"geo"===h.type&&(i=h,o=t,a=e.get("scaleLimit"),l=i.getZoom(),u=i.getCenter(),h=o.zoom,u=i.dataToPoint(u),null!=o.dx&&null!=o.dy&&(u[0]-=o.dx,u[1]-=o.dy,i.setCenter(i.pointToData(u))),null!=h&&(a&&(s=a.min||0,a=a.max||1/0,h=Math.max(Math.min(l*h,a),s)/l),i.scaleX*=h,i.scaleY*=h,s=(o.originX-i.x)*(h-1),o=(o.originY-i.y)*(h-1),i.x-=s,i.y-=o,i.updateTransform(),i.setCenter(i.pointToData(u)),i.setZoom(h*l)),r={center:i.getCenter(),zoom:i.getZoom()},e.setCenter&&e.setCenter(r.center),e.setZoom&&e.setZoom(r.zoom),"series"===n&&F(e.seriesGroup,(function(t){t.setCenter(r.center),t.setZoom(r.zoom)})))}))}))}var VI={average:function(t){for(var e=0,n=0,r=0;r<t.length;r++)isNaN(t[r])||(e+=t[r],n++);return 0===n?NaN:e/n},sum:function(t){for(var e=0,n=0;n<t.length;n++)e+=t[n]||0;return e},max:function(t){for(var e=-1/0,n=0;n<t.length;n++)t[n]>e&&(e=t[n]);return isFinite(e)?e:NaN},min:function(t){for(var e=1/0,n=0;n<t.length;n++)t[n]<e&&(e=t[n]);return isFinite(e)?e:NaN},nearest:function(t){return t[0]}},UI=function(t){return Math.round(t.length/2)};function GI(t){return{seriesType:t,reset:function(t,e,n){var r,i=t.getData(),o=t.get("sampling"),a=t.coordinateSystem,s=i.count();10<s&&"cartesian2d"===a.type&&o&&(r=a.getBaseAxis(),a=a.getOtherAxis(r),r=r.getExtent(),n=n.getDevicePixelRatio(),n=Math.abs(r[1]-r[0])*(n||1),1<(s=Math.round(s/n))&&("lttb"===o&&t.setData(i.lttbDownSample(i.mapDimension(a.dim),1/s)),n=void 0,"string"==typeof o?n=VI[o]:"function"==typeof o&&(n=o),n&&t.setData(i.downSample(i.mapDimension(a.dim),1/s,n,UI))))}}}var WI;h(XI,WI=pg),XI.prototype.getInitialData=function(t,e){return Lv(this.getSource(),this,{useEncodeDefaulter:!0})},XI.prototype.getMarkerPosition=function(t){var e=this.coordinateSystem;if(e){var n=e.dataToPoint(e.clampData(t)),r=this.getData();t=r.getLayout("offset"),r=r.getLayout("size");return n[e.getBaseAxis().isHorizontal()?0:1]+=t+r/2,n}return[NaN,NaN]},XI.type="series.__base_bar__",XI.defaultOption={zlevel:0,z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,barMinHeight:0,barMinAngle:0,large:!1,largeThreshold:400,progressive:3e3,progressiveChunkMode:"mod"},pA=XI;function XI(){var t=null!==WI&&WI.apply(this,arguments)||this;return t.type=XI.type,t}pg.registerClass(pA);var jI;wu=pA;function YI(){var t=null!==jI&&jI.apply(this,arguments)||this;return t.type=YI.type,t}var ZI=(h(YI,jI=wu),YI.prototype.getInitialData=function(){return Lv(this.getSource(),this,{useEncodeDefaulter:!0,createInvertedIndices:!!this.get("realtimeSort",!0)||null})},YI.prototype.getProgressive=function(){return!!this.get("large")&&this.get("progressive")},YI.prototype.getProgressiveThreshold=function(){var t=this.get("progressiveThreshold"),e=this.get("largeThreshold");return t<e?e:t},YI.prototype.brushSelector=function(t,e,n){return n.rect(e.getItemLayout(t))},YI.type="series.bar",YI.dependencies=["grid","polar"],YI.defaultOption=wc(wu.defaultOption,{clip:!0,roundCap:!1,showBackground:!1,backgroundStyle:{color:"rgba(180, 180, 180, 0.2)",borderColor:null,borderWidth:0,borderType:"solid",borderRadius:0,shadowBlur:0,shadowColor:null,shadowOffsetX:0,shadowOffsetY:0,opacity:1},select:{itemStyle:{borderColor:"#212121"}},realtimeSort:!1}),YI);function qI(t,e,n,r,i){var o=t.getArea(),a=o.x,s=o.y,l=o.width,u=o.height;o=n.get(["lineStyle","width"])||2;a-=o/2,s-=o/2,l+=o,u+=o;a=Math.floor(a),l=Math.round(l);var h=new bs({shape:{x:a,y:s,width:l,height:u}});return e&&(t=(e=t.getBaseAxis()).isHorizontal(),e=e.inverse,t?(e&&(h.shape.x+=l),h.shape.width=0):(e||(h.shape.y+=u),h.shape.height=0),kh(h,{shape:{width:l,height:u,x:a,y:s}},n,null,r,"function"==typeof i?function(t){i(t,h)}:null)),h}function KI(t,e,n){var r=t.getArea(),i=ci(r.r0,1),o=ci(r.r,1),a=new bu({shape:{cx:ci(t.cx,1),cy:ci(t.cy,1),r0:i,r:o,startAngle:r.startAngle,endAngle:r.endAngle,clockwise:r.clockwise}});return e&&("angle"===t.getBaseAxis().dim?a.shape.endAngle=r.startAngle:a.shape.r=i,kh(a,{shape:{endAngle:r.endAngle,r:o}},n)),a}function QI(t,e,n,r,i){return t?"polar"===t.type?KI(t,e,n):"cartesian2d"===t.type?qI(t,e,n,r,i):null:null}var JI,$I=function(){this.cx=0,this.cy=0,this.r0=0,this.r=0,this.startAngle=0,this.endAngle=2*Math.PI,this.clockwise=!0};function tD(t){return t=JI.call(this,t)||this,t.type="sausage",t}var eD=(h(tD,JI=rs),tD.prototype.getDefaultShape=function(){return new $I},tD.prototype.buildPath=function(t,e){var n=e.cx,r=e.cy,i=Math.max(e.r0||0,0),o=Math.max(e.r,0),a=.5*(o-i),s=i+a,l=e.startAngle,u=e.endAngle,h=e.clockwise,c=Math.cos(l),d=Math.sin(l),p=Math.cos(u);e=Math.sin(u);(h?u-l<2*Math.PI:l-u<2*Math.PI)&&(t.moveTo(c*i+n,d*i+r),t.arc(c*s+n,d*s+r,a,-Math.PI+l,l,!h)),t.arc(n,r,o,l,u,!h),t.moveTo(p*o+n,e*o+r),t.arc(p*s+n,e*s+r,a,u-2*Math.PI,u-Math.PI,!h),0!==i&&(t.arc(n,r,i,u,l,h),t.moveTo(c*i+n,e*i+r)),t.closePath()},tD);function nD(t,e){return t.type===e}function rD(t,e){var n=t.mapDimensionsAll("defaultedLabel"),r=n.length;if(1===r){var i=rf(t,e,n[0]);return null!=i?i+"":null}if(r){for(var o=[],a=0;a<n.length;a++)o.push(rf(t,e,n[a]));return o.join(" ")}}function iD(t,e){var n=t.mapDimensionsAll("defaultedLabel");if(!X(e))return e+"";for(var r=[],i=0;i<n.length;i++){var o=t.getDimensionInfo(n[i]);o&&r.push(e[o.index])}return r.join(" ")}var oD,aD=["itemStyle","borderWidth"],sD=["itemStyle","borderRadius"],lD=[0,0],uD=Math.max,hD=Math.min;h(cD,oD=Mg),cD.prototype.render=function(t,e,n,r){this._model=t,this._removeOnRenderedListener(n),this._updateDrawMode(t);var i=t.get("coordinateSystem");"cartesian2d"!==i&&"polar"!==i||(this._isLargeDraw?this._renderLarge(t,e,n):this._renderNormal(t,e,n,r))},cD.prototype.incrementalPrepareRender=function(t){this._clear(),this._updateDrawMode(t),this._updateLargeClip(t)},cD.prototype.incrementalRender=function(t,e){this._incrementalRenderLarge(t,e)},cD.prototype._updateDrawMode=function(t){t=t.pipelineContext.large,null!=this._isLargeDraw&&t===this._isLargeDraw||(this._isLargeDraw=t,this._clear())},cD.prototype._renderNormal=function(t,e,n,r){var i,o=this.group,a=t.getData(),s=this._data,l=t.coordinateSystem,u=l.getBaseAxis();"cartesian2d"===l.type?i=u.isHorizontal():"polar"===l.type&&(i="angle"===u.dim);var h=t.isAnimationEnabled()?t:null,c=function(t,e){var n=t.get("realtimeSort",!0);t=e.getBaseAxis();if(n&&"category"===t.type&&"cartesian2d"===e.type)return{baseAxis:t,otherAxis:e.getOtherAxis(t)}}(t,l);c&&this._enableRealtimeSort(c,a,n);var d,p,f=t.get("clip",!0)||c,g=(p=a,n=(d=l).getArea&&d.getArea(),nD(d,"cartesian2d")&&("category"===(d=d.getBaseAxis()).type&&d.onBand||(p=p.getLayout("bandWidth"),d.isHorizontal()?(n.x-=p,n.width+=2*p):(n.y-=p,n.height+=2*p))),n);o.removeClipPath();var m=t.get("roundCap",!0),y=t.get("showBackground",!0),_=t.getModel("backgroundStyle"),v=_.get("borderRadius")||0,x=[],b=this._backgroundEls,T=r&&r.isInitSort,w=r&&"changeAxisOrder"===r.type;function S(t){var e,n=gD[l.type](a,t);e=i,n=new("polar"===l.type?bu:bs)({shape:wD(e,n,l),silent:!0,z2:0});return n.useStyle(_.getItemStyle()),"cartesian2d"===l.type&&n.setShape("r",v),x[t]=n}a.diff(s).add((function(e){var n,r,s=a.getItemModel(e),d=gD[l.type](a,e,s);y&&S(e),a.hasValue(e)&&(n=!1,f&&(n=dD[l.type](g,d)),mD(r=pD[l.type](t,a,e,d,i,h,u.model,!1,m),a,e,s,d,t,i,"polar"===l.type),T?r.attr({shape:d}):c?fD(c,h,r,d,e,i,!1,!1):kh(r,{shape:d},t,e),a.setItemGraphicEl(e,r),o.add(r),r.ignore=n)})).update((function(e,n){var r,d=a.getItemModel(e),p=gD[l.type](a,e,d);y&&(r=void 0,0===b.length?r=S(n):((r=b[n]).useStyle(_.getItemStyle()),"cartesian2d"===l.type&&r.setShape("r",v),x[e]=r),M=gD[l.type](a,e),Nh(r,{shape:wD(i,M,l)},h,e));var M=s.getItemGraphicEl(n);if(!a.hasValue(e))return o.remove(M),void(M=null);n=!1,f&&(n=dD[l.type](g,p))&&o.remove(M),M=M||pD[l.type](t,a,e,p,i,h,u.model,!!M,m),w||mD(M,a,e,d,p,t,i,"polar"===l.type),T?M.attr({shape:p}):c?fD(c,h,M,p,e,i,!0,w):Nh(M,{shape:p},t,e,null),a.setItemGraphicEl(e,M),M.ignore=n,o.add(M)})).remove((function(e){var n=s.getItemGraphicEl(e);n&&zh(n,t,e)})).execute();var M=this._backgroundGroup||(this._backgroundGroup=new ei);M.removeAll();for(var A=0;A<x.length;++A)M.add(x[A]);o.add(M),this._backgroundEls=x,this._data=a},cD.prototype._renderLarge=function(t,e,n){this._clear(),bD(t,this.group),this._updateLargeClip(t)},cD.prototype._incrementalRenderLarge=function(t,e){this._removeBackground(),bD(e,this.group,!0)},cD.prototype._updateLargeClip=function(t){t=t.get("clip",!0)?QI(t.coordinateSystem,!1,t):null,t?this.group.setClipPath(t):this.group.removeClipPath()},cD.prototype._enableRealtimeSort=function(t,e,n){var r,i,o=this;e.count()&&(r=t.baseAxis,this._isFirstFrame?(this._dispatchInitSort(e,t,n),this._isFirstFrame=!1):(i=function(t){return t=e.getItemGraphicEl(t),t?(t=t.shape,(r.isHorizontal()?Math.abs(t.height):Math.abs(t.width))||0):0},this._onRendered=function(){o._updateSortWithinSameData(e,i,r,n)},n.getZr().on("rendered",this._onRendered)))},cD.prototype._dataSort=function(t,e,n){var r=[];return t.each(t.mapDimension(e.dim),(function(t,e){var i=null==(i=n(e))?NaN:i;r.push({dataIndex:e,mappedValue:i,ordinalNumber:t})})),r.sort((function(t,e){return e.mappedValue-t.mappedValue})),{ordinalNumbers:z(r,(function(t){return t.ordinalNumber}))}},cD.prototype._isOrderChangedWithinSameData=function(t,e,n){for(var r=n.scale,i=t.mapDimension(n.dim),o=Number.MAX_VALUE,a=0,s=r.getOrdinalMeta().categories.length;a<s;++a){var l=t.rawIndexOf(i,r.getRawOrdinalNumber(a));l=l<0?Number.MIN_VALUE:e(t.indexOfRawIndex(l));if(o<l)return!0;o=l}return!1},cD.prototype._isOrderDifferentInView=function(t,e){for(var n=e.scale,r=(e=n.getExtent(),Math.max(0,e[0])),i=Math.min(e[1],n.getOrdinalMeta().categories.length-1);r<=i;++r)if(t.ordinalNumbers[r]!==n.getRawOrdinalNumber(r))return!0},cD.prototype._updateSortWithinSameData=function(t,e,n,r){this._isOrderChangedWithinSameData(t,e,n)&&(e=this._dataSort(t,n,e),this._isOrderDifferentInView(e,n)&&(this._removeOnRenderedListener(r),r.dispatchAction({type:"changeAxisOrder",componentType:n.dim+"Axis",axisId:n.index,sortInfo:e})))},cD.prototype._dispatchInitSort=function(t,e,n){var r=e.baseAxis,i=this._dataSort(t,r,(function(n){return t.get(t.mapDimension(e.otherAxis.dim),n)}));n.dispatchAction({type:"changeAxisOrder",componentType:r.dim+"Axis",isInitSort:!0,axisId:r.index,sortInfo:i,animation:{duration:0}})},cD.prototype.remove=function(t,e){this._clear(this._model),this._removeOnRenderedListener(e)},cD.prototype.dispose=function(t,e){this._removeOnRenderedListener(e)},cD.prototype._removeOnRenderedListener=function(t){this._onRendered&&(t.getZr().off("rendered",this._onRendered),this._onRendered=null)},cD.prototype._clear=function(t){var e=this.group,n=this._data;t&&t.isAnimationEnabled()&&n&&!this._isLargeDraw?(this._removeBackground(),this._backgroundEls=[],n.eachItemGraphicEl((function(e){zh(e,t,Ps(e).dataIndex)}))):e.removeAll(),this._data=null,this._isFirstFrame=!0},cD.prototype._removeBackground=function(){this.group.remove(this._backgroundGroup),this._backgroundGroup=null},cD.type="bar",f=cD;function cD(){var t=oD.call(this)||this;return t.type=cD.type,t._isFirstFrame=!0,t}var dD={cartesian2d:function(t,e){var n=e.width<0?-1:1,r=e.height<0?-1:1;n<0&&(e.x+=e.width,e.width=-e.width),r<0&&(e.y+=e.height,e.height=-e.height);var i=t.x+t.width,o=t.y+t.height,a=uD(e.x,t.x),s=hD(e.x+e.width,i),l=uD(e.y,t.y),u=hD(e.y+e.height,o),h=s<a;t=u<l;return e.x=h&&i<a?s:a,e.y=t&&o<l?u:l,e.width=h?0:s-a,e.height=t?0:u-l,n<0&&(e.x+=e.width,e.width=-e.width),r<0&&(e.y+=e.height,e.height=-e.height),h||t},polar:function(t,e){var n=e.r0<=e.r?1:-1;n<0&&(r=e.r,e.r=e.r0,e.r0=r);var r,i=hD(e.r,t.r);t=uD(e.r0,t.r0),t=(e.r=i)-(e.r0=t)<0;return n<0&&(r=e.r,e.r=e.r0,e.r0=r),t}},pD={cartesian2d:function(t,e,n,r,i,o,a,s,l){return r=new bs({shape:R({},r),z2:1}),r.__dataIndex=n,r.name="item",o&&(r.shape[i?"height":"width"]=0),r},polar:function(t,e,n,r,i,o,a,s,l){var u=r.startAngle<r.endAngle,h=new(!i&&l?eD:bu)({shape:L({clockwise:u},r),z2:1});return h.name="item",o&&(l={},h.shape[u=i?"r":"endAngle"]=i?0:r.startAngle,l[u]=r[u],(s?Nh:kh)(h,{shape:l},o)),h}};function fD(t,e,n,r,i,o,a,s){var l;r=o?(l={x:r.x,width:r.width},{y:r.y,height:r.height}):(l={y:r.y,height:r.height},{x:r.x,width:r.width});s||(a?Nh:kh)(n,{shape:r},e,i,null),(a?Nh:kh)(n,{shape:l},e?t.baseAxis.model:null,i)}var gD={cartesian2d:function(t,e,n){e=t.getItemLayout(e);var r=n?(o=e,r=(i=n).get(aD)||0,i=isNaN(o.width)?Number.MAX_VALUE:Math.abs(o.width),o=isNaN(o.height)?Number.MAX_VALUE:Math.abs(o.height),Math.min(r,i,o)):0,i=0<e.width?1:-1,o=0<e.height?1:-1;return{x:e.x+i*r/2,y:e.y+o*r/2,width:e.width-i*r,height:e.height-o*r}},polar:function(t,e,n){return e=t.getItemLayout(e),{cx:e.cx,cy:e.cy,r0:e.r0,r:e.r,startAngle:e.startAngle,endAngle:e.endAngle}}};function mD(t,e,n,r,i,o,a,s){var l=e.getItemVisual(n,"style");s||t.setShape("r",r.get(sD)||0),t.useStyle(l);var u=r.getShallow("cursor");u&&t.attr("cursor",u),s||(a=a?0<i.height?"bottom":"top":0<i.width?"left":"right",tc(t,h=ec(r),{labelFetcher:o,labelDataIndex:n,defaultText:rD(o.getData(),n),inheritColor:l.fill,defaultOpacity:l.opacity,defaultOutsidePosition:a}),a=t.getTextContent(),a=a,h=h,o=o.getRawValue(n),n=function(t){return iD(e,t)},a&&((a=lc(a)).prevValue=a.value,a.value=o,o=h.normal,a.valueAnimation=o.get("valueAnimation"),a.valueAnimation&&(a.precision=o.get("precision"),a.defaultInterpolatedText=n,a.statesModels=h)));var h=r.getModel(["emphasis"]);bl(t,h.get("focus"),h.get("blurScope")),Sl(t,r),null!=(i=i).startAngle&&null!=i.endAngle&&i.startAngle===i.endAngle&&(t.style.fill="none",t.style.stroke="none",F(t.states,(function(t){t.style&&(t.style.fill=t.style.stroke="none")})))}var yD,_D=function(){},vD=(h(xD,yD=rs),xD.prototype.getDefaultShape=function(){return new _D},xD.prototype.buildPath=function(t,e){for(var n=e.points,r=this.__startPoint,i=this.__baseDimIdx,o=0;o<n.length;o+=2)r[i]=n[o+i],t.moveTo(r[0],r[1]),t.lineTo(n[o],n[o+1])},xD);function xD(t){return t=yD.call(this,t)||this,t.type="largeBar",t}function bD(t,e,n){var r=t.getData(),i=[],o=r.getLayout("valueAxisHorizontal")?1:0;i[1-o]=r.getLayout("valueAxisStart");var a,s,l,u,h=r.getLayout("largeDataIndices"),c=r.getLayout("barWidth"),d=t.getModel("backgroundStyle");t.get("showBackground",!0)&&(u=r.getLayout("largeBackgroundPoints"),(l=[])[1-o]=r.getLayout("backgroundStart"),(a=new vD({shape:{points:u},incremental:!!n,silent:!0,z2:0})).__startPoint=l,a.__baseDimIdx=o,a.__largeDataIndices=h,a.__barWidth=c,s=a,u=r,d=(l=d).get("borderColor")||l.get("color"),l=l.getItemStyle(),s.useStyle(l),s.style.fill=null,s.style.stroke=d,s.style.lineWidth=u.getLayout("barWidth"),e.add(a)),n=new vD({shape:{points:r.getLayout("largePoints")},incremental:!!n}),n.__startPoint=i,n.__baseDimIdx=o,n.__largeDataIndices=h,n.__barWidth=c,e.add(n),c=n,r=(e=r).getVisual("style"),c.useStyle(R({},r)),c.style.fill=null,c.style.stroke=r.fill,c.style.lineWidth=e.getLayout("barWidth"),Ps(n).seriesIndex=t.seriesIndex,t.get("silent")||(n.on("mousedown",TD),n.on("mousemove",TD))}var TD=Ig((function(t){t=function(t,e,n){var r=t.__baseDimIdx,i=1-r,o=t.shape.points,a=t.__largeDataIndices,s=Math.abs(t.__barWidth/2),l=t.__startPoint[i];lD[0]=e,lD[1]=n;n=lD[r];for(var u=lD[1-r],h=n-s,c=n+s,d=0,p=o.length/2;d<p;d++){var f=2*d,g=o[f+r];f=o[f+i];if(h<=g&&g<=c&&(l<=f?l<=u&&u<=f:f<=u&&u<=l))return a[d]}return-1}(this,t.offsetX,t.offsetY),Ps(this).dataIndex=0<=t?t:null}),30,!1);function wD(t,e,n){if(nD(n,"cartesian2d")){var r=e,i=n.getArea();return{x:(t?r:i).x,y:(t?i:r).y,width:(t?r:i).width,height:(t?i:r).height}}return{cx:(i=n.getArea()).cx,cy:i.cy,r0:(t?i:e).r0,r:(t?i:e).r,startAngle:t?e.startAngle:0,endAngle:t?e.endAngle:2*Math.PI}}var SD,MD=f;function AD(){var t=null!==SD&&SD.apply(this,arguments)||this;return t.type=AD.type,t.hasSymbolVisual=!0,t.legendSymbol="line",t}var CD,ED=(h(AD,SD=pg),AD.prototype.getInitialData=function(t){return Lv(this.getSource(),this,{useEncodeDefaulter:!0})},AD.type="series.line",AD.dependencies=["grid","polar"],AD.defaultOption={zlevel:0,z:3,coordinateSystem:"cartesian2d",legendHoverLink:!0,clip:!0,label:{position:"top"},endLabel:{show:!1,valueAnimation:!0,distance:8},lineStyle:{width:2,type:"solid"},emphasis:{scale:!0,lineStyle:{width:"bolder"}},step:!1,smooth:!1,smoothMonotone:null,symbol:"emptyCircle",symbolSize:4,symbolRotate:null,showSymbol:!0,showAllSymbol:"auto",connectNulls:!1,sampling:"none",animationEasing:"linear",progressive:0,hoverLayerThreshold:1/0},AD);function ID(t,e,n,r){var i=CD.call(this)||this;return i.updateData(t,e,n,r),i}function DD(t,e){this.parent.drift(t,e)}var RD=(h(ID,CD=ei),ID.prototype._createSymbol=function(t,e,n,r,i){this.removeAll(),i=qm(t,-1,-1,2,2,null,i),i.attr({z2:100,culling:!0,scaleX:r[0]/2,scaleY:r[1]/2}),i.drift=DD,this._symbolType=t,this.add(i)},ID.prototype.stopSymbolAnimation=function(t){this.childAt(0).stopAnimation(null,t)},ID.prototype.getSymbolPath=function(){return this.childAt(0)},ID.prototype.highlight=function(){dl(this.childAt(0))},ID.prototype.downplay=function(){pl(this.childAt(0))},ID.prototype.setZ=function(t,e){var n=this.childAt(0);n.zlevel=t,n.z=e},ID.prototype.setDraggable=function(t){var e=this.childAt(0);e.draggable=t,e.cursor=t?"move":e.cursor},ID.prototype.updateData=function(t,e,n,r){this.silent=!1;var i,o,a,s=t.getItemVisual(e,"symbol")||"circle",l=t.hostModel,u=ID.getSymbolSize(t,e),h=s!==this._symbolType,c=r&&r.disableAnimation;h?(i=t.getItemVisual(e,"symbolKeepAspect"),this._createSymbol(s,t,e,u,i)):((o=this.childAt(0)).silent=!1,a={scaleX:u[0]/2,scaleY:u[1]/2},c?o.attr(a):Nh(o,a,l,e)),this._updateCommon(t,e,u,n,r),h&&(o=this.childAt(0),c||(a={scaleX:this._sizeX,scaleY:this._sizeY,style:{opacity:o.style.opacity}},o.scaleX=o.scaleY=0,o.style.opacity=0,kh(o,a,l,e))),c&&this.childAt(0).stopAnimation("remove"),this._seriesModel=l},ID.prototype._updateCommon=function(t,e,n,r,i){var o,a,s,l,u,h,c=this.childAt(0),d=t.hostModel;r&&(o=r.emphasisItemStyle,s=r.blurItemStyle,a=r.selectItemStyle,l=r.focus,u=r.blurScope,f=r.symbolOffset,h=r.labelStatesModels,_=r.hoverScale,g=r.cursorStyle),r&&!t.hasItemOption||(o=(r=(p=r&&r.itemModel?r.itemModel:t.getItemModel(e)).getModel("emphasis")).getModel("itemStyle").getItemStyle(),a=p.getModel(["select","itemStyle"]).getItemStyle(),s=p.getModel(["blur","itemStyle"]).getItemStyle(),l=r.get("focus"),u=r.get("blurScope"),f=p.getShallow("symbolOffset"),h=ec(p),_=r.getShallow("scale"),g=p.getShallow("cursor"));var p=t.getItemVisual(e,"symbolRotate");c.attr("rotation",(p||0)*Math.PI/180||0),f&&(c.x=hi(f[0],n[0]),c.y=hi(f[1],n[1])),g&&c.attr("cursor",g);p=t.getItemVisual(e,"style");var f=p.fill;c instanceof cs?(m=c.style,c.useStyle(R({image:m.image,x:m.x,y:m.y,width:m.width,height:m.height},p))):(c.__isEmptyBrush?c.useStyle(R({},p)):c.useStyle(p),c.style.decal=null,c.setColor(f,i&&i.symbolInnerColor),c.style.strokeNoScale=!0);var g=t.getItemVisual(e,"liftZ"),m=this._z2;null!=g?null==m&&(this._z2=c.z2,c.z2+=g):null!=m&&(c.z2=m,this._z2=null);var y=i&&i.useNameLabel;tc(c,h,{labelFetcher:d,labelDataIndex:e,defaultText:function(e){return y?t.getName(e):rD(t,e)},inheritColor:f,defaultOpacity:p.opacity}),this._sizeX=n[0]/2,this._sizeY=n[1]/2;var _;n=c.ensureState("emphasis");n.style=o,c.ensureState("select").style=a,c.ensureState("blur").style=s,_&&(_=Math.max(1.1,3/this._sizeY),n.scaleX=this._sizeX*_,n.scaleY=this._sizeY*_),this.setSymbolScale(1),bl(this,l,u)},ID.prototype.setSymbolScale=function(t){this.scaleX=this.scaleY=t},ID.prototype.fadeOut=function(t,e){var n=this.childAt(0),r=this._seriesModel,i=Ps(this).dataIndex,o=e&&e.animation;this.silent=n.silent=!0,e&&e.fadeLabel?(e=n.getTextContent())&&Bh(e,{style:{opacity:0}},r,{dataIndex:i,removeOpt:o,cb:function(){n.removeTextContent()}}):n.removeTextContent(),Bh(n,{style:{opacity:0},scaleX:0,scaleY:0},r,{dataIndex:i,cb:t,removeOpt:o})},ID.getSymbolSize=function(t,e){return e=t.getItemVisual(e,"symbolSize"),e instanceof Array?e.slice():[+e,+e]},ID);function LD(t,e,n,r){return e&&!isNaN(e[0])&&!isNaN(e[1])&&(!r.isIgnore||!r.isIgnore(n))&&(!r.clipShape||r.clipShape.contain(e[0],e[1]))&&"none"!==t.getItemVisual(n,"symbol")}function OD(t){return(t=null==t||K(t)?t:{isIgnore:t})||{}}function PD(t){var e=t.hostModel;t=e.getModel("emphasis");return{emphasisItemStyle:t.getModel("itemStyle").getItemStyle(),blurItemStyle:e.getModel(["blur","itemStyle"]).getItemStyle(),selectItemStyle:e.getModel(["select","itemStyle"]).getItemStyle(),focus:t.get("focus"),blurScope:t.get("blurScope"),symbolRotate:e.get("symbolRotate"),symbolOffset:e.get("symbolOffset"),hoverScale:t.get("scale"),labelStatesModels:ec(e),cursorStyle:e.get("cursor")}}function ND(t){this.group=new ei,this._SymbolCtor=t||RD}var kD=(ND.prototype.updateData=function(t,e){e=OD(e);var n=this.group,r=t.hostModel,i=this._data,o=this._SymbolCtor,a=e.disableAnimation,s=PD(t),l={disableAnimation:a},u=e.getSymbolPoint||function(e){return t.getItemLayout(e)};i||n.removeAll(),t.diff(i).add((function(r){var i,a=u(r);LD(t,a,r,e)&&((i=new o(t,r,s,l)).setPosition(a),t.setItemGraphicEl(r,i),n.add(i))})).update((function(h,c){var d=i.getItemGraphicEl(c),p=u(h);LD(t,p,h,e)?(d?(d.updateData(t,h,s,l),c={x:p[0],y:p[1]},a?d.attr(c):Nh(d,c,r)):(d=new o(t,h)).setPosition(p),n.add(d),t.setItemGraphicEl(h,d)):n.remove(d)})).remove((function(t){var e=i.getItemGraphicEl(t);e&&e.fadeOut((function(){n.remove(e)}))})).execute(),this._getSymbolPoint=u,this._data=t},ND.prototype.isPersistent=function(){return!0},ND.prototype.updateLayout=function(){var t=this,e=this._data;e&&e.eachItemGraphicEl((function(e,n){n=t._getSymbolPoint(n),e.setPosition(n),e.markRedraw()}))},ND.prototype.incrementalPrepareUpdate=function(t){this._seriesScope=PD(t),this._data=null,this.group.removeAll()},ND.prototype.incrementalUpdate=function(t,e,n){function r(t){t.isGroup||(t.incremental=!0,t.ensureState("emphasis").hoverLayer=!0)}n=OD(n);for(var i=t.start;i<t.end;i++){var o,a=e.getItemLayout(i);LD(e,a,i,n)&&((o=new this._SymbolCtor(e,i,this._seriesScope)).traverse(r),o.setPosition(a),this.group.add(o),e.setItemGraphicEl(i,o))}},ND.prototype.remove=function(t){var e=this.group,n=this._data;n&&t?n.eachItemGraphicEl((function(t){t.fadeOut((function(){e.remove(t)}))})):e.removeAll()},ND);function BD(t,e,n){var r=t.getBaseAxis(),i=t.getOtherAxis(r),o=function(t,e){var n=0;t=t.scale.getExtent();return"start"===e?n=t[0]:"end"===e?n=t[1]:0<t[0]?n=t[0]:t[1]<0&&(n=t[1]),n}(i,n),a=r.dim,s=i.dim,l=e.mapDimension(s),u=e.mapDimension(a);n="x"===s||"radius"===s?1:0,r=z(t.dimensions,(function(t){return e.mapDimension(t)})),i=!1,t=e.getCalculationInfo("stackResultDimension");return Dv(e,r[0])&&(i=!0,r[0]=t),Dv(e,r[1])&&(i=!0,r[1]=t),{dataDimsForPoint:r,valueStart:o,valueAxisDim:s,baseAxisDim:a,stacked:!!i,valueDim:l,baseDim:u,baseDataOffset:n,stackedOverDimension:e.getCalculationInfo("stackedOverDimension")}}function FD(t,e,n,r){var i=NaN;t.stacked&&(i=n.get(n.getCalculationInfo("stackedOverDimension"),r)),isNaN(i)&&(i=t.valueStart);var o=t.baseDataOffset,a=[];return a[o]=n.get(t.baseDim,r),a[1-o]=i,e.dataToPoint(a)}var zD="undefined"!=typeof Float32Array,HD=zD?Float32Array:Array;function VD(t){return X(t)?zD?new Float32Array(t):t:new HD(t)}var UD=Math.min,GD=Math.max;function WD(t,e){return isNaN(t)||isNaN(e)}function XD(t,e,n,r,i,o,a,s,l){for(var u,h,c,d,p,f,g=n,m=0;m<r;m++){var y=e[2*g],_=e[2*g+1];if(i<=g||g<0)break;if(WD(y,_)){if(l){g+=o;continue}break}if(g===n)t[0<o?"moveTo":"lineTo"](y,_),c=y,d=_;else{var v=y-u,x=_-h;if(v*v+x*x<.5){g+=o;continue}if(0<a){var b=g+o,T=e[2*b],w=e[2*b+1],S=m+1;if(l)for(;WD(T,w)&&S<r;)S++,T=e[2*(b+=o)],w=e[2*b+1];var M,A,C,E,I,D=0,R=0,L=void 0,O=void 0;r<=S||WD(T,w)?(p=y,f=_):(D=T-u,R=w-h,A=y-u,C=T-y,E=_-h,I=w-_,x=v=void 0,O="x"===s?(v=Math.abs(A),x=Math.abs(C),p=y-v*a,L=y+v*a,f=_):"y"===s?(v=Math.abs(E),x=Math.abs(I),f=_-v*a,L=p=y,_+v*a):(v=Math.sqrt(A*A+E*E),p=y-D*a*(1-(M=(x=Math.sqrt(C*C+I*I))/(x+v))),f=_-R*a*(1-M),O=_+R*a*M,L=UD(L=y+D*a*M,GD(T,y)),O=UD(O,GD(w,_)),L=GD(L,UD(T,y)),f=_-(R=(O=GD(O,UD(w,_)))-_)*v/x,p=UD(p=y-(D=L-y)*v/x,GD(u,y)),f=UD(f,GD(h,_)),L=y+(D=y-(p=GD(p,UD(u,y))))*x/v,_+(R=_-(f=GD(f,UD(h,_))))*x/v)),t.bezierCurveTo(c,d,p,f,y,_),c=L,d=O}else t.lineTo(y,_)}u=y,h=_,g+=o}return m}var jD,YD=function(){this.smooth=0,this.smoothConstraint=!0},ZD=(h(qD,jD=rs),qD.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},qD.prototype.getDefaultShape=function(){return new YD},qD.prototype.buildPath=function(t,e){var n=e.points,r=0,i=n.length/2;if(e.connectNulls){for(;0<i&&WD(n[2*i-2],n[2*i-1]);i--);for(;r<i&&WD(n[2*r],n[2*r+1]);r++);}for(;r<i;)r+=XD(t,n,r,i,i,1,e.smooth,e.smoothMonotone,e.connectNulls)+1},qD.prototype.getPointOn=function(t,e){this.path||(this.createPathProxy(),this.buildPath(this.path,this.shape));for(var n,r,i=this.path.data,o=Ba.CMD,a="x"===e,s=[],l=0;l<i.length;){var u,h=void 0,c=void 0;switch(i[l++]){case o.M:n=i[l++],r=i[l++];break;case o.L:if(h=i[l++],c=i[l++],(u=a?(t-n)/(h-n):(t-r)/(c-r))<=1&&0<=u){var d=a?(c-r)*u+r:(h-n)*u+n;return a?[t,d]:[d,t]}n=h,r=c;break;case o.C:h=i[l++],c=i[l++];var p=i[l++],f=i[l++],g=i[l++],m=i[l++],y=a?Qo(n,h,p,g,t,s):Qo(r,c,f,m,t,s);if(0<y)for(var _=0;_<y;_++){var v=s[_];if(v<=1&&0<=v)return d=a?qo(r,c,f,m,v):qo(n,h,p,g,v),a?[t,d]:[d,t]}n=g,r=m}}},qD);function qD(t){return t=jD.call(this,t)||this,t.type="ec-polyline",t}var KD,QD=(h(JD,KD=YD),JD);function JD(){return null!==KD&&KD.apply(this,arguments)||this}var $D,tR,eR=(h(nR,$D=rs),nR.prototype.getDefaultShape=function(){return new QD},nR.prototype.buildPath=function(t,e){var n=e.points,r=e.stackedOnPoints,i=0,o=n.length/2,a=e.smoothMonotone;if(e.connectNulls){for(;0<o&&WD(n[2*o-2],n[2*o-1]);o--);for(;i<o&&WD(n[2*i],n[2*i+1]);i++);}for(;i<o;){var s=XD(t,n,i,o,o,1,e.smooth,a,e.connectNulls);XD(t,r,i+s-1,s,o,-1,e.stackedOnSmooth,a,e.connectNulls),i+=s+1,t.closePath()}},nR);function nR(t){return t=$D.call(this,t)||this,t.type="ec-polygon",t}function rR(t,e){if(t.length===e.length){for(var n=0;n<t.length;n++)if(t[n]!==e[n])return;return 1}}function iR(t){for(var e=1/0,n=1/0,r=-1/0,i=-1/0,o=0;o<t.length;){var a=t[o++],s=t[o++];isNaN(a)||(e=Math.min(a,e),r=Math.max(a,r)),isNaN(s)||(n=Math.min(s,n),i=Math.max(s,i))}return[[e,n],[r,i]]}function oR(t,e){var n=iR(t),r=n[0];t=n[1],n=iR(e),e=n[0],n=n[1];return Math.max(Math.abs(r[0]-e[0]),Math.abs(r[1]-e[1]),Math.abs(t[0]-n[0]),Math.abs(t[1]-n[1]))}function aR(t){return"number"==typeof t?t:t?.5:0}function sR(t,e,n){e=e.getBaseAxis();for(var r="x"===e.dim||"radius"===e.dim?0:1,i=[],o=0,a=[],s=[],l=[];o<t.length-2;o+=2)switch(l[0]=t[o+2],l[1]=t[o+3],s[0]=t[o],s[1]=t[o+1],i.push(s[0],s[1]),n){case"end":a[r]=l[r],a[1-r]=s[1-r],i.push(a[0],a[1]);break;case"middle":var u=(s[r]+l[r])/2,h=[];a[r]=h[r]=u,a[1-r]=s[1-r],h[1-r]=l[1-r],i.push(a[0],a[1]),i.push(h[0],h[1]);break;default:a[r]=s[r],a[1-r]=l[1-r],i.push(a[0],a[1])}return i.push(t[o++],t[o++]),i}function lR(t,e,n){var r=t.get("showAllSymbol");t="auto"===r;if(!r||t){var i=n.getAxesByScale("ordinal")[0];if(i&&(!t||!function(t,e){var n=t.getExtent(),r=Math.abs(n[1]-n[0])/t.scale.count();isNaN(r)&&(r=0);for(var i=e.count(),o=Math.max(1,Math.round(i/5)),a=0;a<i;a+=o)if(1.5*RD.getSymbolSize(e,a)[t.isHorizontal()?1:0]>r)return!1;return!0}(i,e))){var o=e.mapDimension(i.dim),a={};return F(i.getViewLabels(),(function(t){t=i.scale.getRawOrdinalNumber(t.tickValue),a[t]=1})),function(t){return!a.hasOwnProperty(e.get(o,t))}}}}function uR(t){for(var e,n,r=t.length/2;0<r&&(e=t[2*r-2],n=t[2*r-1],isNaN(e)||isNaN(n));r--);return r-1}function hR(t,e){return[t[2*e],t[2*e+1]]}function cR(t,e,n,r){if(nD(e,"cartesian2d")){var i,o=r.getModel("endLabel"),a=o.get("show"),s=o.get("valueAnimation"),l=r.getData(),u={lastFrameIndex:0},h=a?function(n,r){t._endLabelOnDuring(n,r,l,u,s,o,e)}:null,c=e.getBaseAxis().isHorizontal(),d=qI(e,n,r,(function(){var e=t._endLabel;e&&n&&null!=u.originalX&&e.attr({x:u.originalX,y:u.originalY})}),h);return r.get("clip",!0)||(i=d.shape,a=Math.max(i.width,i.height),c?(i.y-=a,i.height+=2*a):(i.x-=a,i.width+=2*a)),h&&h(1,d),d}return KI(e,n,r)}function dR(){return null!==tR&&tR.apply(this,arguments)||this}var pR=(h(dR,tR=Mg),dR.prototype.init=function(){var t=new ei,e=new kD;this.group.add(e.group),this._symbolDraw=e,this._lineGroup=t},dR.prototype.render=function(t,e,n){var r=this,i=t.coordinateSystem,o=this.group,a=t.getData(),s=t.getModel("lineStyle"),l=t.getModel("areaStyle"),u=a.getLayout("points")||[],h="polar"===i.type,c=this._coordSys,d=this._symbolDraw,p=this._polyline,f=this._polygon,g=this._lineGroup,m=t.get("animation"),y=!l.isEmpty(),_=l.get("origin"),v=BD(i,a,_),x=y&&function(t,e,n){if(!n.valueDim)return[];for(var r=e.count(),i=VD(2*r),o=0;o<r;o++){var a=FD(n,t,e,o);i[2*o]=a[0],i[2*o+1]=a[1]}return i}(i,a,v),b=t.get("showSymbol"),T=b&&!h&&lR(t,a,i),w=this._data;w&&w.eachItemGraphicEl((function(t,e){t.__temp&&(o.remove(t),w.setItemGraphicEl(e,null))})),b||d.remove(),o.add(g);var S=!h&&t.get("step");i&&i.getArea&&t.get("clip",!0)&&(null!=(M=i.getArea()).width?(M.x-=.1,M.y-=.1,M.width+=.2,M.height+=.2):M.r0&&(M.r0-=.5,M.r+=.5)),this._clipShapeForSymbol=M,v=function(t,e){var n=t.getVisual("visualMeta");if(n&&n.length&&t.count()&&"cartesian2d"===e.type){for(var r,i=n.length-1;0<=i;i--){var o,a=n[i].dimension;a=t.dimensions[a],a=t.getDimensionInfo(a);if("x"===(o=a&&a.coordDim)||"y"===o){r=n[i];break}}if(r){var s=e.getAxis(o),l=z(r.stops,(function(t){return{offset:0,coord:s.toGlobalCoord(s.dataToCoord(t.value)),color:t.color}})),u=l.length,h=r.outerColors.slice();u&&l[0].coord>l[u-1].coord&&(l.reverse(),h.reverse());var c=l[0].coord-10,d=(e=l[u-1].coord+10,e-c);return d<.001?"transparent":(F(l,(function(t){t.offset=(t.coord-c)/d})),l.push({offset:u?l[u-1].offset:.5,color:h[1]||"transparent"}),l.unshift({offset:u?l[0].offset:.5,color:h[0]||"transparent"}),l=new oh(0,0,0,0,l,!0),l[o]=c,l[o+"2"]=e,l)}}}(a,i)||a.getVisual("style")[a.getVisual("drawType")],p&&c.type===i.type&&S===this._step?(y&&!f?f=this._newPolygon(u,x):f&&!y&&(g.remove(f),f=this._polygon=null),h||this._initOrUpdateEndLabel(t,i,dd(v)),g.setClipPath(cR(this,i,!1,t)),b&&d.updateData(a,{isIgnore:T,clipShape:M,disableAnimation:!0,getSymbolPoint:function(t){return[u[2*t],u[2*t+1]]}}),rR(this._stackedOnPoints,x)&&rR(this._points,u)||(m?this._doUpdateAnimation(a,x,i,n,S,_):(S&&(u=sR(u,i,S),x=x&&sR(x,i,S)),p.setShape({points:u}),f&&f.setShape({points:u,stackedOnPoints:x})))):(b&&d.updateData(a,{isIgnore:T,clipShape:M,disableAnimation:!0,getSymbolPoint:function(t){return[u[2*t],u[2*t+1]]}}),m&&this._initSymbolLabelAnimation(a,i,M),S&&(u=sR(u,i,S),x=x&&sR(x,i,S)),p=this._newPolyline(u),y&&(f=this._newPolygon(u,x)),h||this._initOrUpdateEndLabel(t,i,dd(v)),g.setClipPath(cR(this,i,!0,t)));m=t.get(["emphasis","focus"]);var M=t.get(["emphasis","blurScope"]);function A(t){r._changePolyState(t)}p.useStyle(L(s.getLineStyle(),{fill:"none",stroke:v,lineJoin:"bevel"})),Sl(p,t,"lineStyle"),0<p.style.lineWidth&&"bolder"===t.get(["emphasis","lineStyle","width"])&&(p.getState("emphasis").style.lineWidth=p.style.lineWidth+1),Ps(p).seriesIndex=t.seriesIndex,bl(p,m,M),y=aR(t.get("smooth")),h=t.get("smoothMonotone"),g=t.get("connectNulls"),p.setShape({smooth:y,smoothMonotone:h,connectNulls:g}),f&&(s=a.getCalculationInfo("stackedOnSeries"),p=0,f.useStyle(L(l.getAreaStyle(),{fill:v,opacity:.7,lineJoin:"bevel",decal:a.getVisual("style").decal})),s&&(p=aR(s.get("smooth"))),f.setShape({smooth:y,stackedOnSmooth:p,smoothMonotone:h,connectNulls:g}),Sl(f,t,"areaStyle"),Ps(f).seriesIndex=t.seriesIndex,bl(f,m,M)),a.eachItemGraphicEl((function(t){t&&(t.onHoverStateChange=A)})),this._polyline.onHoverStateChange=A,this._data=a,this._coordSys=i,this._stackedOnPoints=x,this._points=u,this._step=S,this._valueOrigin=_},dR.prototype.dispose=function(){},dR.prototype.highlight=function(t,e,n,r){var i=t.getData(),o=Wi(i,r);if(this._changePolyState("emphasis"),!(o instanceof Array)&&null!=o&&0<=o){var a=i.getLayout("points"),s=i.getItemGraphicEl(o);if(!s){var l=a[2*o];a=a[2*o+1];if(isNaN(l)||isNaN(a))return;if(this._clipShapeForSymbol&&!this._clipShapeForSymbol.contain(l,a))return;(s=new RD(i,o)).x=l,s.y=a,s.setZ(t.get("zlevel"),t.get("z")),s.__temp=!0,i.setItemGraphicEl(o,s),s.stopSymbolAnimation(!0),this.group.add(s)}s.highlight()}else Mg.prototype.highlight.call(this,t,e,n,r)},dR.prototype.downplay=function(t,e,n,r){var i,o=t.getData(),a=Wi(o,r);this._changePolyState("normal"),null!=a&&0<=a?(i=o.getItemGraphicEl(a))&&(i.__temp?(o.setItemGraphicEl(a,null),this.group.remove(i)):i.downplay()):Mg.prototype.downplay.call(this,t,e,n,r)},dR.prototype._changePolyState=function(t){var e=this._polygon;ll(this._polyline,t),e&&ll(e,t)},dR.prototype._newPolyline=function(t){var e=this._polyline;return e&&this._lineGroup.remove(e),e=new ZD({shape:{points:t},segmentIgnoreThreshold:2,z2:10}),this._lineGroup.add(e),this._polyline=e},dR.prototype._newPolygon=function(t,e){var n=this._polygon;return n&&this._lineGroup.remove(n),n=new eR({shape:{points:t,stackedOnPoints:e},segmentIgnoreThreshold:2}),this._lineGroup.add(n),this._polygon=n},dR.prototype._initSymbolLabelAnimation=function(t,e,n){var r,i,o=e.getBaseAxis(),a=o.inverse;"cartesian2d"===e.type?(r=o.isHorizontal(),i=!1):"polar"===e.type&&(r="angle"===o.dim,i=!0);o=t.hostModel;var s=o.get("animationDuration");"function"==typeof s&&(s=s(null));var l=o.get("animationDelay")||0,u="function"==typeof l?l(null):l;t.eachItemGraphicEl((function(t,o){var h,c,d,p,f,g=t;g&&(c=[t.x,t.y],d=f=p=void 0,d=i?(h=n,c=e.pointToCoord(c),r?(p=h.startAngle,f=h.endAngle,-c[1]/180*Math.PI):(p=h.r0,f=h.r,c[0])):r?(p=n.x,f=n.x+n.width,t.x):(p=n.y+n.height,f=n.y,t.y),f=f===p?0:(d-p)/(f-p),a&&(f=1-f),p="function"==typeof l?l(o):s*f+u,f=(o=g.getSymbolPath()).getTextContent(),g.attr({scaleX:0,scaleY:0}),g.animateTo({scaleX:1,scaleY:1},{duration:200,delay:p}),f&&f.animateFrom({style:{opacity:0}},{duration:300,delay:p}),o.disableLabelAnimation=!0)}))},dR.prototype._initOrUpdateEndLabel=function(t,e,n){var r,i,o,a=t.getModel("endLabel");a.get("show")?(r=t.getData(),i=this._polyline,this._endLabel||((this._endLabel=new Os({z2:200})).ignoreClip=!0,i.setTextContent(this._endLabel),i.disableLabelAnimation=!0),0<=(o=uR(r.getLayout("points")))&&(tc(i,ec(t,"endLabel"),{inheritColor:n,labelFetcher:t,labelDataIndex:o,defaultText:function(t,e,n){return null!=n?iD(r,n):rD(r,t)},enableTextSetter:!0},(t=a,e=(a=(o=e).getBaseAxis()).isHorizontal(),o=a.inverse,a=e?o?"right":"left":"center",o=e?"middle":o?"top":"bottom",{normal:{align:t.get("align")||a,verticalAlign:t.get("verticalAlign")||o}})),i.textConfig.position=null)):this._endLabel&&(this._polyline.removeTextContent(),this._endLabel=null)},dR.prototype._endLabelOnDuring=function(t,e,n,r,i,o,a){var s,l,u,h,c,d,p,f,g,m,y=this._endLabel,_=this._polyline;y&&(t<1&&null==r.originalX&&(r.originalX=y.x,r.originalY=y.y),s=n.getLayout("points"),u=(l=n.hostModel).get("connectNulls"),h=o.get("precision"),f=o.get("distance")||0,d=(p=a.getBaseAxis()).isHorizontal(),c=p.inverse,g=e.shape,o=(d?f:0)*(c?-1:1),a=(d?0:-f)*(c?-1:1),p=void 0,1<=(d=(g=(c=function(t,e,n){for(var r,i,o=t.length/2,a="x"===n?0:1,s=0,l=-1,u=0;u<o;u++)if(i=t[2*u+a],!isNaN(i)&&!isNaN(t[2*u+1-a]))if(0!==u){if(r<=e&&e<=i||e<=r&&i<=e){l=u;break}s=u,r=i}else r=i;return{range:[s,l],t:(e-r)/(i-r)}}(s,e=c?d?g.x:g.y+g.height:d?g.x+g.width:g.y,f=d?"x":"y")).range)[1]-g[0])?(1<d&&!u?(m=hR(s,g[0]),y.attr({x:m[0]+o,y:m[1]+a}),i&&(p=l.getRawValue(g[0]))):((m=_.getPointOn(e,f))&&y.attr({x:m[0]+o,y:m[1]+a}),e=l.getRawValue(g[0]),f=l.getRawValue(g[1]),i&&(p=Ji(n,h,e,f,c.t))),r.lastFrameIndex=g[0]):(m=hR(s,g=1===t||0<r.lastFrameIndex?g[0]:0),i&&(p=l.getRawValue(g)),y.attr({x:m[0]+o,y:m[1]+a})),i&&lc(y).setLabelText(p))},dR.prototype._doUpdateAnimation=function(t,e,n,r,i,o){var a=this._polyline,s=this._polygon,l=t.hostModel,u=function(t,e,n,r,i,o,a,s){for(var l,u=(l=[],e.diff(t).add((function(t){l.push({cmd:"+",idx:t})})).update((function(t,e){l.push({cmd:"=",idx:e,idx1:t})})).remove((function(t){l.push({cmd:"-",idx:t})})).execute(),l),h=[],c=[],d=[],p=[],f=[],g=[],m=[],y=BD(i,e,a),_=BD(o,t,s),v=t.getLayout("points")||[],x=e.getLayout("points")||[],b=0;b<u.length;b++){var T=u[b],w=!0,S=void 0,M=void 0;switch(T.cmd){case"=":S=2*T.idx,M=2*T.idx1;var A=v[S],C=v[S+1],E=x[M],I=x[M+1];(isNaN(A)||isNaN(C))&&(A=E,C=I),h.push(A,C),c.push(E,I),d.push(n[S],n[S+1]),p.push(r[M],r[M+1]),m.push(e.getRawIndex(T.idx1));break;case"+":var D=T.idx,R=y.dataDimsForPoint,L=i.dataToPoint([e.get(R[0],D),e.get(R[1],D)]);M=2*D,h.push(L[0],L[1]),c.push(x[M],x[M+1]),R=FD(y,i,e,D),d.push(R[0],R[1]),p.push(r[M],r[M+1]),m.push(e.getRawIndex(D));break;case"-":L=T.idx,R=t.getRawIndex(L),D=_.dataDimsForPoint,S=2*L,R!==L?(D=o.dataToPoint([t.get(D[0],L),t.get(D[1],L)]),L=FD(_,o,t,L),h.push(v[S],v[S+1]),c.push(D[0],D[1]),d.push(n[S],n[S+1]),p.push(L[0],L[1]),m.push(R)):w=!1}w&&(f.push(T),g.push(g.length))}g.sort((function(t,e){return m[t]-m[e]}));var O=VD(s=h.length),P=VD(s),N=VD(s),k=VD(s),B=[];for(b=0;b<g.length;b++){var F=g[b],z=2*b,H=2*F;O[z]=h[H],O[1+z]=h[1+H],P[z]=c[H],P[1+z]=c[1+H],N[z]=d[H],N[1+z]=d[1+H],k[z]=p[H],k[1+z]=p[1+H],B[b]=f[F]}return{current:O,next:P,stackedOnCurrent:N,stackedOnNext:k,status:B}}(this._data,t,this._stackedOnPoints,e,this._coordSys,n,this._valueOrigin,o),h=u.current,c=u.stackedOnCurrent;e=u.next,o=u.stackedOnNext;if(i&&(h=sR(u.current,n,i),c=sR(u.stackedOnCurrent,n,i),e=sR(u.next,n,i),o=sR(u.stackedOnNext,n,i)),3e3<oR(h,e)||s&&3e3<oR(c,o))return a.setShape({points:e}),void(s&&s.setShape({points:e,stackedOnPoints:o}));a.shape.__points=u.current,a.shape.points=h,e={shape:{points:e}},u.current!==h&&(e.shape.__points=u.next),a.stopAnimation(),Nh(a,e,l),s&&(s.setShape({points:h,stackedOnPoints:c}),s.stopAnimation(),Nh(s,{shape:{stackedOnPoints:o}},l),a.shape.points!==s.shape.points&&(s.shape.points=a.shape.points));for(var d,p=[],f=u.status,g=0;g<f.length;g++)"="!==f[g].cmd||(d=t.getItemGraphicEl(f[g].idx1))&&p.push({el:d,ptIdx:g});a.animators&&a.animators.length&&a.animators[0].during((function(){s&&s.dirtyShape();for(var t=a.shape.__points,e=0;e<p.length;e++){var n=p[e].el,r=2*p[e].ptIdx;n.x=t[r],n.y=t[1+r],n.markRedraw()}}))},dR.prototype.remove=function(t){var e=this.group,n=this._data;this._lineGroup.removeAll(),this._symbolDraw.remove(!0),n&&n.eachItemGraphicEl((function(t,r){t.__temp&&(e.remove(t),n.setItemGraphicEl(r,null))})),this._polyline=this._polygon=this._coordSys=this._points=this._stackedOnPoints=this._endLabel=this._data=null},dR.type="line",dR),fR=2*Math.PI,gR=Math.PI/180;function mR(t,e,n){e.eachSeriesByType(t,(function(t){var e=t.getData(),r=e.mapDimension("value"),i=(u=n,vd(t.getBoxLayoutParams(),{width:u.getWidth(),height:u.getHeight()})),o=t.get("center"),a=t.get("radius");X(a)||(a=[0,a]),X(o)||(o=[o,o]);var s=hi(i.width,n.getWidth()),l=hi(i.height,n.getHeight()),u=Math.min(s,l),h=hi(o[0],s)+i.x,c=hi(o[1],l)+i.y,d=hi(a[0],u/2),p=hi(a[1],u/2),f=-t.get("startAngle")*gR,g=t.get("minAngle")*gR,m=0;e.each(r,(function(t){isNaN(t)||m++}));var y=e.getSum(r),_=Math.PI/(y||m)*2,v=t.get("clockwise"),x=t.get("roseType"),b=t.get("stillShowZeroSum"),T=e.getDataExtent(r);T[0]=0;var w,S=fR,M=0,A=f,C=v?1:-1;e.setLayout({viewRect:i,r:p}),e.each(r,(function(t,n){var r,i;isNaN(t)?e.setItemLayout(n,{angle:NaN,startAngle:NaN,endAngle:NaN,clockwise:v,cx:h,cy:c,r0:d,r:x?NaN:p}):((r="area"!==x?0===y&&b?_:t*_:fR/m)<g?S-=r=g:M+=t,i=A+C*r,e.setItemLayout(n,{angle:r,startAngle:A,endAngle:i,clockwise:v,cx:h,cy:c,r0:d,r:x?ui(t,T,[d,p]):p}),A=i)})),S<fR&&m&&(S<=.001?(w=fR/m,e.each(r,(function(t,n){isNaN(t)||((t=e.getItemLayout(n)).angle=w,t.startAngle=f+C*n*w,t.endAngle=f+C*(n+1)*w)}))):(_=S/M,A=f,e.each(r,(function(t,n){isNaN(t)||(t=(n=e.getItemLayout(n)).angle===g?g:t*_,n.startAngle=A,n.endAngle=A+C*t,A+=C*t)}))))}))}var yR=Math.PI/180;function _R(t,e,n,r,i,o,a,s,l,u){if(!(t.length<2)){for(var h,c=t.length,d=0;d<c;d++)"outer"===t[d].position&&"labelLine"===t[d].labelAlignTo&&(h=t[d].label.x-u,t[d].linePoints[1][0]+=h,t[d].label.x=u);Dm(t,l,l+a)&&function(t){for(var o,a,s,l,u,h={list:[],maxY:0},c={list:[],maxY:0},d=0;d<t.length;d++)"none"===t[d].labelAlignTo&&(a=(o=t[d]).label.y>n?c:h,(s=Math.abs(o.label.y-n))>a.maxY&&(l=o.label.x-e-o.len2*i,u=r+o.len,u=Math.abs(l)<u?Math.sqrt(s*s/(1-l*l/u/u)):u,a.rB=u,a.maxY=s),a.list.push(o));p(h),p(c)}(t)}function p(t){for(var o=t.rB,a=o*o,s=0;s<t.list.length;s++){var l=t.list[s],u=Math.abs(l.label.y-n),h=r+l.len;h=h*h,h=Math.sqrt((1-Math.abs(u*u/a))*h);l.label.x=e+(h+l.len2)*i}}}function vR(t){return"center"===t.position}function xR(t){var e,n,r=t.getData(),i=[],o=!1,a=(t.get("minShowLabelAngle")||0)*yR,s=r.getLayout("viewRect"),l=r.getLayout("r"),u=s.width,h=s.x,c=s.y;s=s.height;function d(t){t.ignore=!0}r.each((function(t){var s,c,p,f,g,m,y,_,v,x,b=r.getItemGraphicEl(t),T=b.shape,w=b.getTextContent(),S=b.getTextGuideLine(),M=r.getItemModel(t),A=M.getModel("label"),C=A.get("position")||M.get(["emphasis","label","position"]),E=A.get("distanceToLabelLine"),I=A.get("alignTo"),D=hi(A.get("edgeDistance"),u),R=A.get("bleedMargin"),L=M.getModel("labelLine"),O=hi(O=L.get("length"),u),P=hi(P=L.get("length2"),u);if(Math.abs(T.endAngle-T.startAngle)<a)return F(w.states,d),void(w.ignore=!0);!function(t){if(!t.ignore)return 1;for(var e in t.states)if(!1===t.states[e].ignore)return 1}(w)||(x=(T.startAngle+T.endAngle)/2,s=Math.cos(x),c=Math.sin(x),e=T.cx,n=T.cy,p="inside"===C||"inner"===C,_="center"===C?(g=T.cx,m=T.cy,"center"):(g=(f=(p?(T.r+T.r0)/2*s:T.r*s)+e)+3*s,m=(t=(p?(T.r+T.r0)/2*c:T.r*c)+n)+3*c,p||(M=f+s*(O+l-T.r),_=t+c*(O+l-T.r),y=M+(s<0?-1:1)*P,g="edge"===I?s<0?h+D:h+u-D:y+(s<0?-E:E),y=[[f,t],[M,m=_],[y,_]]),p?"center":"edge"===I?0<s?"right":"left":0<s?"left":"right"),x="number"==typeof(A=A.get("rotate"))?A*(Math.PI/180):A?s<0?-x+Math.PI:-x:0,o=!!x,w.x=g,w.y=m,w.rotation=x,w.setStyle({verticalAlign:"middle"}),p?(w.setStyle({align:_}),(v=w.states.select)&&(v.x+=w.x,v.y+=w.y)):((x=w.getBoundingRect().clone()).applyTransform(w.getComputedTransform()),v=(w.style.margin||0)+2.1,x.y-=v/2,x.height+=v,i.push({label:w,labelLine:S,position:C,len:O,len2:P,minTurnAngle:L.get("minTurnAngle"),maxSurfaceAngle:L.get("maxSurfaceAngle"),surfaceNormal:new Dn(s,c),linePoints:y,textAlign:_,labelDistance:E,labelAlignTo:I,edgeDistance:D,bleedMargin:R,rect:x})),b.setTextConfig({inside:p}))})),!o&&t.get("avoidLabelOverlap")&&function(t,e,n,r,i,o,a,s){for(var l=[],u=[],h=Number.MAX_VALUE,c=-Number.MAX_VALUE,d=0;d<t.length;d++){var p=t[d].label;vR(t[d])||(p.x<e?(h=Math.min(h,p.x),l.push(t[d])):(c=Math.max(c,p.x),u.push(t[d])))}for(_R(u,e,n,r,1,0,o,0,s,c),_R(l,e,n,r,-1,0,o,0,s,h),d=0;d<t.length;d++){var f,g,m,y,_=t[d];p=_.label;vR(_)||(f=_.linePoints)&&(g="edge"===_.labelAlignTo,m=_.rect.width,y=void 0,(y=g?p.x<e?f[2][0]-_.labelDistance-a-_.edgeDistance:a+i-_.edgeDistance-f[2][0]-_.labelDistance:p.x<e?p.x-a-_.bleedMargin:a+i-p.x-_.bleedMargin)<_.rect.width&&(_.label.style.width=y,"edge"===_.labelAlignTo&&(m=y)),y=f[1][0]-f[2][0],g?p.x<e?f[2][0]=a+_.edgeDistance+m+_.labelDistance:f[2][0]=a+i-_.edgeDistance-m-_.labelDistance:(p.x<e?f[2][0]=p.x+_.labelDistance:f[2][0]=p.x-_.labelDistance,f[1][0]=f[2][0]+y),f[1][1]=f[2][1]=p.y)}}(i,e,n,l,u,s,h,c);for(var p=0;p<i.length;p++){var f,g=i[p],m=g.label,y=g.labelLine,_=isNaN(m.x)||isNaN(m.y);m&&(m.setStyle({align:g.textAlign}),_&&(F(m.states,d),m.ignore=!0),(f=m.states.select)&&(f.x+=m.x,f.y+=m.y)),y&&(f=g.linePoints,_||!f?(F(y.states,d),y.ignore=!0):(Sm(f,g.minTurnAngle),function(t,e,n){if(n<=180&&0<n){n=n/180*Math.PI,mm.fromArray(t[0]),ym.fromArray(t[1]),_m.fromArray(t[2]),Dn.sub(vm,ym,mm),Dn.sub(xm,_m,ym);var r=vm.len(),i=xm.len();if(!(r<.001||i<.001)&&(vm.scale(1/r),xm.scale(1/i),vm.dot(e)<Math.cos(n))){if(r=dm(ym.x,ym.y,_m.x,_m.y,mm.x,mm.y,Tm,!1),wm.fromArray(Tm),i=Math.PI/2,n=i+Math.acos(xm.dot(e))-n,i<=n)Dn.copy(wm,_m);else{if(wm.scaleAndAdd(xm,r/Math.tan(Math.PI/2-n)),n=_m.x!==ym.x?(wm.x-ym.x)/(_m.x-ym.x):(wm.y-ym.y)/(_m.y-ym.y),isNaN(n))return;n<0?Dn.copy(wm,ym):1<n&&Dn.copy(wm,_m)}wm.toArray(t[1])}}}(f,g.surfaceNormal,g.maxSurfaceAngle),y.setShape({points:f}),m.__hostTarget.textGuideLineConfig={anchor:new Dn(f[0][0],f[0][1])}))}}function bR(t,e){return t=t.get("borderRadius"),null==t?null:{innerCornerRadius:Jn((t=X(t)?t:[t,t])[0],e.r0),cornerRadius:Jn(t[1],e.r)}}var TR,wR,SR=(h(MR,TR=bu),MR.prototype.updateData=function(t,e,n,r){var i=this,o=t.hostModel,a=t.getItemModel(e),s=a.getModel("emphasis"),l=t.getItemLayout(e),u=R(bR(a.getModel("itemStyle"),l)||{},l);r?(i.setShape(u),"scale"===o.getShallow("animationType")?(i.shape.r=l.r0,kh(i,{shape:{r:l.r}},o,e)):null!=n?(i.setShape({startAngle:n,endAngle:n}),kh(i,{shape:{startAngle:l.startAngle,endAngle:l.endAngle}},o,e)):(i.shape.endAngle=l.startAngle,Nh(i,{shape:{endAngle:l.endAngle}},o,e))):Nh(i,{shape:u},o,e),i.useStyle(t.getItemVisual(e,"style")),Sl(i,a),r=(l.startAngle+l.endAngle)/2,n=o.get("selectedOffset"),u=Math.cos(r)*n,r=Math.sin(r)*n,n=a.getShallow("cursor"),n&&i.attr("cursor",n),this._updateLabel(o,t,e),i.ensureState("emphasis").shape=c({r:l.r+(s.get("scale")&&s.get("scaleSize")||0)},bR(s.getModel("itemStyle"),l)),R(i.ensureState("select"),{x:u,y:r,shape:bR(a.getModel(["select","itemStyle"]),l)}),R(i.ensureState("blur"),{shape:bR(a.getModel(["blur","itemStyle"]),l)}),l=i.getTextGuideLine(),i=i.getTextContent(),l&&R(l.ensureState("select"),{x:u,y:r}),R(i.ensureState("select"),{x:u,y:r}),bl(this,s.get("focus"),s.get("blurScope"))},MR.prototype._updateLabel=function(t,e,n){var r=e.getItemModel(n),i=r.getModel("labelLine"),o=e.getItemVisual(n,"style"),a=o&&o.fill;o=o&&o.opacity;tc(this,ec(r),{labelFetcher:e.hostModel,labelDataIndex:n,inheritColor:a,defaultOpacity:o,defaultText:t.getFormattedLabel(n,"normal")||e.getName(n)}),n=this.getTextContent(),this.setTextConfig({position:null,rotation:null}),n.attr({z2:10}),t=t.get(["label","position"]),"outside"===t||"outer"===t?Cm(this,Em(r),{stroke:a,opacity:rt(i.get(["lineStyle","opacity"]),o,1)}):null!==(o=this.getTextGuideLine())&&void 0!==o&&o.hide()},MR);function MR(t,e,n){var r=TR.call(this)||this;r.z2=2;var i=new Bu,o=new Os;return r.setTextGuideLine(i),r.setTextContent(o),r.updateData(t,e,n,!0),r}function AR(){var t=null!==wR&&wR.apply(this,arguments)||this;return t.ignoreLabelLineUpdate=!0,t}var CR=(h(AR,wR=Mg),AR.prototype.init=function(){var t=new ei;this._sectorGroup=t},AR.prototype.render=function(t,e,n,r){var i,o=t.getData(),a=this._data,s=this.group;if(!a&&0<o.count()){for(var l=o.getItemLayout(0),u=1;isNaN(l&&l.startAngle)&&u<o.count();++u)l=o.getItemLayout(u);l&&(i=l.startAngle)}o.diff(a).add((function(t){var e=new SR(o,t,i);o.setItemGraphicEl(t,e),s.add(e)})).update((function(t,e){e=a.getItemGraphicEl(e),e.updateData(o,t,i),e.off("click"),s.add(e),o.setItemGraphicEl(t,e)})).remove((function(e){zh(a.getItemGraphicEl(e),t,e)})).execute(),xR(t),"expansion"!==t.get("animationTypeUpdate")&&(this._data=o)},AR.prototype.dispose=function(){},AR.prototype.containPoint=function(t,e){var n=e.getData().getItemLayout(0);if(n)return e=t[0]-n.cx,t=t[1]-n.cy,t=Math.sqrt(e*e+t*t),t<=n.r&&t>=n.r0},AR.type="pie",AR);function ER(t,e){this._getDataWithEncodedVisual=t,this._getRawData=e}var IR,DR=(ER.prototype.getAllNames=function(){var t=this._getRawData();return t.mapArray(t.getName)},ER.prototype.containName=function(t){return 0<=this._getRawData().indexOfName(t)},ER.prototype.indexOfName=function(t){return this._getDataWithEncodedVisual().indexOfName(t)},ER.prototype.getItemVisual=function(t,e){return this._getDataWithEncodedVisual().getItemVisual(t,e)},ER);function RR(){var t=null!==IR&&IR.apply(this,arguments)||this;return t.useColorPaletteOnData=!0,t}var LR,OR=(h(RR,IR=pg),RR.prototype.init=function(t){IR.prototype.init.apply(this,arguments),this.legendVisualProvider=new DR(G(this.getData,this),G(this.getRawData,this)),this._defaultLabelLine(t)},RR.prototype.mergeOption=function(){IR.prototype.mergeOption.apply(this,arguments)},RR.prototype.getInitialData=function(){return yI(this,{coordDimensions:["value"],encodeDefaulter:W(jd,this)})},RR.prototype.getDataParams=function(t){var e=this.getData(),n=IR.prototype.getDataParams.call(this,t),r=[];return e.each(e.mapDimension("value"),(function(t){r.push(t)})),n.percent=mi(r,t,e.hostModel.get("percentPrecision")),n.$vars.push("percent"),n},RR.prototype._defaultLabelLine=function(t){Pi(t,"labelLine",["show"]);var e=t.labelLine,n=t.emphasis.labelLine;e.show=e.show&&t.label.show,n.show=n.show&&t.emphasis.label.show},RR.type="series.pie",RR.defaultOption={zlevel:0,z:2,legendHoverLink:!0,center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,minAngle:0,minShowLabelAngle:0,selectedOffset:10,percentPrecision:2,stillShowZeroSum:!0,left:0,top:0,right:0,bottom:0,width:null,height:null,label:{rotate:0,show:!0,overflow:"truncate",position:"outer",alignTo:"none",edgeDistance:"25%",bleedMargin:10,distanceToLabelLine:5},labelLine:{show:!0,length:15,length2:15,smooth:!1,minTurnAngle:90,maxSurfaceAngle:90,lineStyle:{width:1,type:"solid"}},itemStyle:{borderWidth:1},labelLayout:{hideOverlap:!0},emphasis:{scale:!0,scaleSize:5},avoidLabelOverlap:!0,animationType:"expansion",animationDuration:1e3,animationTypeUpdate:"transition",animationEasingUpdate:"cubicInOut",animationDurationUpdate:500,animationEasing:"cubicInOut"},RR),PR=["color","borderColor"];h(NR,LR=Mg),NR.prototype.render=function(t,e,n){this.group.removeClipPath(),this._updateDrawMode(t),this._isLargeDraw?this._renderLarge(t):this._renderNormal(t)},NR.prototype.incrementalPrepareRender=function(t,e,n){this._clear(),this._updateDrawMode(t)},NR.prototype.incrementalRender=function(t,e,n,r){this._isLargeDraw?this._incrementalRenderLarge(t,e):this._incrementalRenderNormal(t,e)},NR.prototype._updateDrawMode=function(t){t=t.pipelineContext.large,null!=this._isLargeDraw&&t===this._isLargeDraw||(this._isLargeDraw=t,this._clear())},NR.prototype._renderNormal=function(t){var e=t.getData(),n=this._data,r=this.group,i=e.getLayout("isSimpleBox"),o=t.get("clip",!0),a=t.coordinateSystem,s=a.getArea&&a.getArea();this._data||r.removeAll(),e.diff(n).add((function(n){var a,l;e.hasValue(n)&&(a=e.getItemLayout(n),o&&VR(s,a)||(kh(l=HR(a,0,!0),{shape:{points:a.ends}},t,n),UR(l,e,n,i),r.add(l),e.setItemGraphicEl(n,l)))})).update((function(a,l){var u=n.getItemGraphicEl(l);e.hasValue(a)?(l=e.getItemLayout(a),o&&VR(s,l)?r.remove(u):(u?Nh(u,{shape:{points:l.ends}},t,a):u=HR(l),UR(u,e,a,i),r.add(u),e.setItemGraphicEl(a,u))):r.remove(u)})).remove((function(t){t=n.getItemGraphicEl(t),t&&r.remove(t)})).execute(),this._data=e},NR.prototype._renderLarge=function(t){this._clear(),YR(t,this.group),t=t.get("clip",!0)?QI(t.coordinateSystem,!1,t):null,t?this.group.setClipPath(t):this.group.removeClipPath()},NR.prototype._incrementalRenderNormal=function(t,e){for(var n,r=e.getData(),i=r.getLayout("isSimpleBox");null!=(n=t.next());){var o=HR(r.getItemLayout(n));UR(o,r,n,i),o.incremental=!0,this.group.add(o)}},NR.prototype._incrementalRenderLarge=function(t,e){YR(e,this.group,!0)},NR.prototype.remove=function(t){this._clear()},NR.prototype._clear=function(){this.group.removeAll(),this._data=null},NR.type="candlestick",M=NR;function NR(){var t=null!==LR&&LR.apply(this,arguments)||this;return t.type=NR.type,t}var kR,BR=function(){},FR=(h(zR,kR=rs),zR.prototype.getDefaultShape=function(){return new BR},zR.prototype.buildPath=function(t,e){e=e.points,this.__simpleBox?(t.moveTo(e[4][0],e[4][1]),t.lineTo(e[6][0],e[6][1])):(t.moveTo(e[0][0],e[0][1]),t.lineTo(e[1][0],e[1][1]),t.lineTo(e[2][0],e[2][1]),t.lineTo(e[3][0],e[3][1]),t.closePath(),t.moveTo(e[4][0],e[4][1]),t.lineTo(e[5][0],e[5][1]),t.moveTo(e[6][0],e[6][1]),t.lineTo(e[7][0],e[7][1]))},zR);function zR(t){return t=kR.call(this,t)||this,t.type="normalCandlestickBox",t}function HR(t,e,n){var r,i=t.ends;return new FR({shape:{points:n?(r=t,z(i,(function(t){return(t=t.slice())[1]=r.initBaseline,t}))):i},z2:100})}function VR(t,e){for(var n=!0,r=0;r<e.ends.length;r++)if(t.contain(e.ends[r][0],e.ends[r][1])){n=!1;break}return n}function UR(t,e,n,r){var i=e.getItemModel(n);t.useStyle(e.getItemVisual(n,"style")),t.style.strokeNoScale=!0,t.__simpleBox=r,Sl(t,i)}var GR,WR=function(){},XR=(h(jR,GR=rs),jR.prototype.getDefaultShape=function(){return new WR},jR.prototype.buildPath=function(t,e){for(var n,r=e.points,i=0;i<r.length;)this.__sign===r[i++]?(n=r[i++],t.moveTo(n,r[i++]),t.lineTo(n,r[i++])):i+=3},jR);function jR(t){return t=GR.call(this,t)||this,t.type="largeCandlestickBox",t}function YR(t,e,n){var r=t.getData(),i=r.getLayout("largePoints"),o=new XR({shape:{points:i},__sign:1});e.add(o),i=new XR({shape:{points:i},__sign:-1}),e.add(i),ZR(1,o,t),ZR(-1,i,t),n&&(o.incremental=!0,i.incremental=!0)}function ZR(t,e,n){t=n.get(["itemStyle",0<t?"borderColor":"borderColor0"])||n.get(["itemStyle",0<t?"color":"color0"]),n=n.getModel("itemStyle").getItemStyle(PR),e.useStyle(n),e.style.fill=null,e.style.stroke=t}var qR=M;KR.prototype.getInitialData=function(t,e){var n,r,i=e.getComponent("xAxis",this.get("xAxisIndex")),o=e.getComponent("yAxis",this.get("yAxisIndex")),a=i.get("type"),s=o.get("type");"category"===a?(t.layout="horizontal",n=i.getOrdinalMeta(),r=!0):"category"===s?(t.layout="vertical",n=o.getOrdinalMeta(),r=!0):t.layout=t.layout||"horizontal";var l;e=["x","y"],a="horizontal"===t.layout?0:1,s=this._baseAxisDim=e[a],e=e[1-a],i=[i,o],o=i[a].get("type"),i=i[1-a].get("type"),a=t.data;return a&&r&&(l=[],F(a,(function(t,e){var n;X(t)?(n=t.slice(),t.unshift(e)):X(t.value)?(n=t.value.slice(),t.value.unshift(e)):n=t,l.push(n)})),t.data=l),t=this.defaultValueDimensions,i=[{name:s,type:q_(o),ordinalMeta:n,otherDims:{tooltip:!1,itemName:0},dimsDef:["base"]},{name:e,type:q_(i),dimsDef:t.slice()}],yI(this,{coordDimensions:i,dimensionsCount:t.length+1,encodeDefaulter:W(Xd,i,this)})},KR.prototype.getBaseAxis=function(){var t=this._baseAxisDim;return this.ecModel.getComponent(t+"Axis",this.get(t+"AxisIndex")).axis},Bo=KR;function KR(){}var QR;h(JR,QR=pg),JR.prototype.getShadowDim=function(){return"open"},JR.prototype.brushSelector=function(t,e,n){return t=e.getItemLayout(t),t&&n.rect(t.brushRect)},JR.type="series.candlestick",JR.dependencies=["xAxis","yAxis","grid"],JR.defaultOption={zlevel:0,z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,layout:null,clip:!0,itemStyle:{color:"#eb5454",color0:"#47b262",borderColor:"#eb5454",borderColor0:"#47b262",borderWidth:1},emphasis:{scale:!0,itemStyle:{borderWidth:2}},barMaxWidth:null,barMinWidth:null,barWidth:null,large:!0,largeThreshold:600,progressive:3e3,progressiveThreshold:1e4,progressiveChunkMode:"mod",animationEasing:"linear",animationDuration:300},pA=JR;function JR(){var t=null!==QR&&QR.apply(this,arguments)||this;return t.type=JR.type,t.defaultValueDimensions=[{name:"open",defaultTooltip:!0},{name:"close",defaultTooltip:!0},{name:"lowest",defaultTooltip:!0},{name:"highest",defaultTooltip:!0}],t}k(pA,Bo,!0);var $R=pA;function tL(t){t&&X(t.series)&&F(t.series,(function(t){K(t)&&"k"===t.type&&(t.type="candlestick")}))}var eL=["itemStyle","borderColor"],nL=["itemStyle","borderColor0"],rL=["itemStyle","color"],iL=["itemStyle","color0"],oL={seriesType:"candlestick",plan:mg(),performRawSeries:!0,reset:function(t,e){var n=t.getData();if(n.setVisual("legendSymbol","roundRect"),!e.isSeriesFiltered(t))return!t.pipelineContext.large&&{progress:function(t,e){for(var n;null!=(n=t.next());){var r=e.getItemModel(n),i=e.getItemLayout(n).sign,o=r.getItemStyle();o.fill=r.get(0<i?rL:iL),o.stroke=r.get(0<i?eL:nL)||o.fill,R(e.ensureUniqueItemVisual(n,"style"),o)}}}}},aL="undefined"!=typeof Float32Array?Float32Array:Array;function sL(t,e,n,r,i){return r=r<n||!(n<r||!(0<e)||t.get(i,e-1)<=r)?-1:1,r}var lL,uL={seriesType:"candlestick",plan:mg(),reset:function(t){var e,n,r,i=t.coordinateSystem,o=t.getData(),a=(s=o,n="category"===(n=(e=t).getBaseAxis()).type?n.getBandWidth():(r=n.getExtent(),Math.abs(r[1]-r[0])/s.count()),r=hi(nt(e.get("barMaxWidth"),n),n),s=hi(nt(e.get("barMinWidth"),1),n),null!=(e=e.get("barWidth"))?hi(e,n):Math.max(Math.min(n/2,r),s)),s=["x","y"],l=o.mapDimension(s[0]),u=(s=o.mapDimensionsAll(s[1]),s[0]),h=s[1],c=s[2],d=s[3];if(o.setLayout({candleWidth:a,isSimpleBox:a<=1.3}),!(null==l||s.length<4))return{progress:t.pipelineContext.large?function(t,e){for(var n,r=new aL(4*t.count),o=0,a=[],s=[];null!=(n=t.next());){var p=e.get(l,n),f=e.get(u,n),g=e.get(h,n),m=e.get(c,n),y=e.get(d,n);isNaN(p)||isNaN(m)||isNaN(y)?(r[o++]=NaN,o+=3):(r[o++]=sL(e,n,f,g,h),a[0]=p,a[1]=m,m=i.dataToPoint(a,null,s),r[o++]=m?m[0]:NaN,r[o++]=m?m[1]:NaN,a[1]=y,m=i.dataToPoint(a,null,s),r[o++]=m?m[1]:NaN)}e.setLayout("largePoints",r)}:function(t,e){for(var n;null!=(n=t.next());){var r=e.get(l,n),o=e.get(u,n),s=e.get(h,n),p=e.get(c,n),f=e.get(d,n),g=Math.min(o,s),m=Math.max(o,s),y=x(g,r),_=x(m,r),v=x(p,r);g=x(f,r),m=[];b(m,_,0),b(m,y,1),m.push(T(g),T(_),T(v),T(y)),e.setItemLayout(n,{sign:sL(e,n,o,s,h),initBaseline:(s<o?_:y)[1],ends:m,brushRect:function(t,e,n){return t=x(t,n),n=x(e,n),t[0]-=a/2,n[0]-=a/2,{x:t[0],y:t[1],width:a,height:n[1]-t[1]}}(p,f,r)})}function x(t,e){var n=[];return n[0]=e,n[1]=t,isNaN(e)||isNaN(t)?[NaN,NaN]:i.dataToPoint(n)}function b(t,e,n){var r=e.slice();e=e.slice();r[0]=Oh(r[0]+a/2,1,!1),e[0]=Oh(e[0]-a/2,1,!0),n?t.push(r,e):t.push(e,r)}function T(t){return t[0]=Oh(t[0],1),t}}}}},hL=(h(cL,lL=Ld),cL.type="title",cL.defaultOption={zlevel:0,z:6,show:!0,text:"",target:"blank",subtext:"",subtarget:"blank",left:0,top:0,backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderWidth:0,padding:5,itemGap:10,textStyle:{fontSize:18,fontWeight:"bold",color:"#464646"},subtextStyle:{fontSize:12,color:"#6E7079"}},cL);function cL(){var t=null!==lL&&lL.apply(this,arguments)||this;return t.type=cL.type,t.layoutMode={type:"box",ignoreSize:!0},t}var dL,pL=(h(fL,dL=gg),fL.prototype.render=function(t,e,n){var r,i,o,a,s,l,u,h,c;this.group.removeAll(),t.get("show")&&(r=this.group,u=t.getModel("textStyle"),a=t.getModel("subtextStyle"),i=t.get("textAlign"),c=nt(t.get("textBaseline"),t.get("textVerticalAlign")),h=(o=new Os({style:nc(u,{text:t.get("text"),fill:u.getTextColor()},{disableBox:!0}),z2:10})).getBoundingRect(),u=t.get("subtext"),a=new Os({style:nc(a,{text:u,fill:a.getTextColor(),y:h.height+t.get("itemGap"),verticalAlign:"top"},{disableBox:!0}),z2:10}),s=t.get("link"),l=t.get("sublink"),h=t.get("triggerEvent",!0),o.silent=!s&&!h,a.silent=!l&&!h,s&&o.on("click",(function(){pd(s,"_"+t.get("target"))})),l&&a.on("click",(function(){pd(l,"_"+t.get("subtarget"))})),Ps(o).eventData=Ps(a).eventData=h?{componentType:"title",componentIndex:t.componentIndex}:null,r.add(o),u&&r.add(a),h=r.getBoundingRect(),(u=t.getBoxLayoutParams()).width=h.width,u.height=h.height,n=vd(u,{width:n.getWidth(),height:n.getHeight()},t.get("padding")),i||("right"===(i="middle"===(i=t.get("left")||t.get("right"))?"center":i)?n.x+=n.width:"center"===i&&(n.x+=n.width/2)),c||("bottom"===(c="center"===(c=t.get("top")||t.get("bottom"))?"middle":c)?n.y+=n.height:"middle"===c&&(n.y+=n.height/2),c=c||"top"),r.x=n.x,r.y=n.y,r.markRedraw(),o.setStyle(c={align:i,verticalAlign:c}),a.setStyle(c),h=r.getBoundingRect(),c=n.margin,(n=t.getItemStyle(["color","opacity"])).fill=t.get("backgroundColor"),n=new bs({shape:{x:h.x-c[3],y:h.y-c[0],width:h.width+c[1]+c[3],height:h.height+c[0]+c[2],r:t.get("borderRadius")},style:n,subPixelOptimize:!0,silent:!0}),r.add(n))},fL.type="title",fL);function fL(){var t=null!==dL&&dL.apply(this,arguments)||this;return t.type=fL.type,t}var gL=["x","y","radius","angle","single"],mL=["cartesian2d","polar","singleAxis"];function yL(t){return t+"Axis"}function _L(t,e){var n,r=pt(),i=[],o=pt();for(t.eachComponent({mainType:"dataZoom",query:e},(function(t){o.get(t.uid)||s(t)}));n=!1,t.eachComponent("dataZoom",a),n;);function a(t){var e;!o.get(t.uid)&&(e=!1,t.eachTargetAxis((function(t,n){t=r.get(t),t&&t[n]&&(e=!0)})),e)&&(s(t),n=!0)}function s(t){o.set(t.uid,!0),i.push(t),t.eachTargetAxis((function(t,e){(r.get(t)||r.set(t,[]))[e]=!0}))}return i}function vL(t){var e=t.ecModel,n={infoList:[],infoMap:pt()};return t.eachTargetAxis((function(t,r){var i,o=e.getComponent(yL(t),r);!o||(i=o.getCoordSysModel())&&(t=i.uid,(r=n.infoMap.get(t))||(n.infoList.push(r={model:i,axisModels:[]}),n.infoMap.set(t,r)),r.axisModels.push(o))})),n}var xL,bL=(TL.prototype.add=function(t){this.indexMap[t]||(this.indexList.push(t),this.indexMap[t]=!0)},TL);function TL(){this.indexList=[],this.indexMap=[]}function wL(){var t=null!==xL&&xL.apply(this,arguments)||this;return t.type=wL.type,t._autoThrottle=!0,t._noTarget=!0,t._rangePropMode=["percent","percent"],t}function SL(t){var e={};return F(["start","end","startValue","endValue","throttle"],(function(n){t.hasOwnProperty(n)&&(e[n]=t[n])})),e}var ML;h(wL,xL=Ld),wL.prototype.init=function(t,e,n){var r=SL(t);this.settledOption=r,this.mergeDefaultAndTheme(t,n),this._doInit(r)},wL.prototype.mergeOption=function(t){var e=SL(t);D(this.option,t,!0),D(this.settledOption,e,!0),this._doInit(e)},wL.prototype._doInit=function(t){var e=this.option;this._setDefaultThrottle(t),this._updateRangeUse(t);var n=this.settledOption;F([["start","startValue"],["end","endValue"]],(function(t,r){"value"===this._rangePropMode[r]&&(e[t[0]]=n[t[0]]=null)}),this),this._resetTarget()},wL.prototype._resetTarget=function(){var t=this.get("orient",!0),e=this._targetAxisInfoMap=pt();this._fillSpecifiedTargetAxis(e)?this._orient=t||this._makeAutoOrientByTargetAxis():(this._orient=t||"horizontal",this._fillAutoTargetAxisByOrient(e,this._orient)),this._noTarget=!0,e.each((function(t){t.indexList.length&&(this._noTarget=!1)}),this)},wL.prototype._fillSpecifiedTargetAxis=function(t){var e=!1;return F(gL,(function(n){var r,i=this.getReferringComponents(yL(n),qi);i.specified&&(e=!0,r=new bL,F(i.models,(function(t){r.add(t.componentIndex)})),t.set(n,r))}),this),e},wL.prototype._fillAutoTargetAxisByOrient=function(t,e){var n,r=this.ecModel,i=!0;function o(e,n){var r,o,a=e[0];a&&((r=new bL).add(a.componentIndex),t.set(n,r),i=!1,"x"!==n&&"y"!==n||(o=a.getReferringComponents("grid",Zi).models[0])&&F(e,(function(t){a.componentIndex!==t.componentIndex&&o===t.getReferringComponents("grid",Zi).models[0]&&r.add(t.componentIndex)})))}i&&o(r.findComponents({mainType:(n="vertical"===e?"y":"x")+"Axis"}),n),i&&o(r.findComponents({mainType:"singleAxis",filter:function(t){return t.get("orient",!0)===e}}),"single"),i&&F(gL,(function(e){var n,o;!i||(n=r.findComponents({mainType:yL(e),filter:function(t){return"category"===t.get("type",!0)}}))[0]&&((o=new bL).add(n[0].componentIndex),t.set(e,o),i=!1)}),this)},wL.prototype._makeAutoOrientByTargetAxis=function(){var t;return this.eachTargetAxis((function(e){t=t||e}),this),"y"===t?"vertical":"horizontal"},wL.prototype._setDefaultThrottle=function(t){t.hasOwnProperty("throttle")&&(this._autoThrottle=!1),this._autoThrottle&&(t=this.ecModel.option,this.option.throttle=t.animation&&0<t.animationDurationUpdate?100:20)},wL.prototype._updateRangeUse=function(t){var e=this._rangePropMode,n=this.get("rangeMode");F([["start","startValue"],["end","endValue"]],(function(r,i){var o=null!=t[r[0]];r=null!=t[r[1]];o&&!r?e[i]="percent":!o&&r?e[i]="value":n?e[i]=n[i]:o&&(e[i]="percent")}))},wL.prototype.noTarget=function(){return this._noTarget},wL.prototype.getFirstTargetAxisModel=function(){var t;return this.eachTargetAxis((function(e,n){null==t&&(t=this.ecModel.getComponent(yL(e),n))}),this),t},wL.prototype.eachTargetAxis=function(t,e){this._targetAxisInfoMap.each((function(n,r){F(n.indexList,(function(n){t.call(e,r,n)}))}))},wL.prototype.getAxisProxy=function(t,e){if(e=this.getAxisModel(t,e),e)return e.__dzAxisProxy},wL.prototype.getAxisModel=function(t,e){var n=this._targetAxisInfoMap.get(t);if(n&&n.indexMap[e])return this.ecModel.getComponent(yL(t),e)},wL.prototype.setRawRange=function(t){var e=this.option,n=this.settledOption;F([["start","startValue"],["end","endValue"]],(function(r){null==t[r[0]]&&null==t[r[1]]||(e[r[0]]=n[r[0]]=t[r[0]],e[r[1]]=n[r[1]]=t[r[1]])}),this),this._updateRangeUse(t)},wL.prototype.setCalculatedRange=function(t){var e=this.option;F(["start","startValue","end","endValue"],(function(n){e[n]=t[n]}))},wL.prototype.getPercentRange=function(){var t=this.findRepresentativeAxisProxy();if(t)return t.getDataPercentWindow()},wL.prototype.getValueRange=function(t,e){return null!=t||null!=e?this.getAxisProxy(t,e).getDataValueWindow():(e=this.findRepresentativeAxisProxy(),e?e.getDataValueWindow():void 0)},wL.prototype.findRepresentativeAxisProxy=function(t){if(t)return t.__dzAxisProxy;for(var e,n=this._targetAxisInfoMap.keys(),r=0;r<n.length;r++)for(var i=n[r],o=this._targetAxisInfoMap.get(i),a=0;a<o.indexList.length;a++){var s=this.getAxisProxy(i,o.indexList[a]);if(s.hostedBy(this))return s;e=e||s}return e},wL.prototype.getRangePropMode=function(){return this._rangePropMode.slice()},wL.prototype.getOrient=function(){return this._orient},wL.type="dataZoom",wL.dependencies=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","series","toolbox"],wL.defaultOption={zlevel:0,z:4,filterMode:"filter",start:0,end:100},wu=wL;function AL(){var t=null!==ML&&ML.apply(this,arguments)||this;return t.type=AL.type,t}var CL,EL=(h(AL,ML=wu),AL.type="dataZoom.select",AL);function IL(){var t=null!==CL&&CL.apply(this,arguments)||this;return t.type=IL.type,t}var DL;h(IL,CL=gg),IL.prototype.render=function(t,e,n,r){this.dataZoomModel=t,this.ecModel=e,this.api=n},IL.type="dataZoom",f=IL;function RL(){var t=null!==DL&&DL.apply(this,arguments)||this;return t.type=RL.type,t}var LL=(h(RL,DL=f),RL.type="dataZoom.select",RL);function OL(t,e,n,r,i,o){t=t||0;var a=n[1]-n[0];null!=i&&(i=NL(i,[0,a])),null!=o&&(o=Math.max(o,null!=i?i:0)),"all"===r&&(s=NL(s=Math.abs(e[1]-e[0]),[0,a]),i=o=NL(s,[i,o]),r=0),e[0]=NL(e[0],n),e[1]=NL(e[1],n);var s=PL(e,r);return e[r]+=t,t=i||0,n=n.slice(),s.sign<0?n[0]+=t:n[1]-=t,e[r]=NL(e[r],n),n=PL(e,r),null!=i&&(n.sign!==s.sign||n.span<i)&&(e[1-r]=e[r]+s.sign*i),n=PL(e,r),null!=o&&n.span>o&&(e[1-r]=e[r]+n.sign*o),e}function PL(t,e){return t=t[e]-t[1-e],{span:Math.abs(t),sign:0<t||!(t<0)&&e?-1:1}}function NL(t,e){return Math.min(null!=e[1]?e[1]:1/0,Math.max(null!=e[0]?e[0]:-1/0,t))}var kL=F,BL=di;function FL(t,e,n,r){this._dimName=t,this._axisIndex=e,this.ecModel=r,this._dataZoomModel=n}var zL=(FL.prototype.hostedBy=function(t){return this._dataZoomModel===t},FL.prototype.getDataValueWindow=function(){return this._valueWindow.slice()},FL.prototype.getDataPercentWindow=function(){return this._percentWindow.slice()},FL.prototype.getTargetSeriesModels=function(){var t=[];return this.ecModel.eachSeries((function(e){var n;n=(n=e).get("coordinateSystem"),0<=P(mL,n)&&(n=yL(this._dimName),(n=e.getReferringComponents(n,Zi).models[0])&&this._axisIndex===n.componentIndex&&t.push(e))}),this),t},FL.prototype.getAxisModel=function(){return this.ecModel.getComponent(this._dimName+"Axis",this._axisIndex)},FL.prototype.getMinMaxSpan=function(){return I(this._minMaxSpan)},FL.prototype.calculateDataWindow=function(t){var e,n=this._dataExtent,r=this.getAxisModel().axis.scale,i=this._dataZoomModel.getRangePropMode(),o=[0,100],a=[],s=[];kL(["start","end"],(function(l,u){var h=t[l];l=t[l+"Value"];"percent"===i[u]?l=r.parse(ui(h=null==h?o[u]:h,o,n)):(e=!0,h=ui(l=null==l?n[u]:r.parse(l),n,o)),s[u]=l,a[u]=h})),BL(s),BL(a);var l=this._minMaxSpan;function u(t,e,n,i,o){var a=o?"Span":"ValueSpan";OL(0,t,n,"all",l["min"+a],l["max"+a]);for(var s=0;s<2;s++)e[s]=ui(t[s],n,i,!0),o&&(e[s]=r.parse(e[s]))}return e?u(s,a,n,o,!1):u(a,s,o,n,!0),{valueWindow:s,percentWindow:a}},FL.prototype.reset=function(t){var e;t===this._dataZoomModel&&(e=this.getTargetSeriesModels(),this._dataExtent=function(t,e,n){var r=[1/0,-1/0];return kL(n,(function(t){var n,i;n=r,i=t.getData(),t=e,i&&F(Gx(i,t),(function(t){t=i.getApproximateExtent(t),t[0]<n[0]&&(n[0]=t[0]),t[1]>n[1]&&(n[1]=t[1])}))})),t=t.getAxisModel(),t=Ox(t.axis.scale,t,r).calculate(),[t.min,t.max]}(this,this._dimName,e),this._updateMinMaxSpan(),t=this.calculateDataWindow(t.settledOption),this._valueWindow=t.valueWindow,this._percentWindow=t.percentWindow,this._setAxisModel())},FL.prototype.filterData=function(t,e){var n,r,i,o;t===this._dataZoomModel&&(n=this._dimName,r=this.getTargetSeriesModels(),i=t.get("filterMode"),o=this._valueWindow,"none"!==i&&kL(r,(function(t){var e=t.getData(),r=e.mapDimensionsAll(n);r.length&&("weakFilter"===i?e.filterSelf((function(t){for(var n,i,a,s=0;s<r.length;s++){var l=e.get(r[s],t),u=!isNaN(l),h=l<o[0];l=l>o[1];if(u&&!h&&!l)return!0;u&&(a=!0),h&&(n=!0),l&&(i=!0)}return a&&n&&i})):kL(r,(function(n){var r;"empty"===i?t.setData(e=e.map(n,(function(t){return(e=t)>=o[0]&&e<=o[1]?t:NaN;var e}))):((r={})[n]=o,e.selectRange(r))})),kL(r,(function(t){e.setApproximateExtent(o,t)})))})))},FL.prototype._updateMinMaxSpan=function(){var t=this._minMaxSpan={},e=this._dataZoomModel,n=this._dataExtent;kL(["min","max"],(function(r){var i=e.get(r+"Span"),o=e.get(r+"ValueSpan");null!=(o=null!=o?this.getAxisModel().axis.scale.parse(o):o)?i=ui(n[0]+o,n,[0,100],!0):null!=i&&(o=ui(i,[0,100],n,!0)-n[0]),t[r+"Span"]=i,t[r+"ValueSpan"]=o}),this)},FL.prototype._setAxisModel=function(){var t,e=this.getAxisModel(),n=this._percentWindow,r=this._valueWindow;n&&(t=gi(r,[0,500]),t=Math.min(t,20),e=e.axis.scale.rawExtentInfo,0!==n[0]&&e.setDeterminedMinMax("min",+r[0].toFixed(t)),100!==n[1]&&e.setDeterminedMinMax("max",+r[1].toFixed(t)),e.freeze())},FL),HL={getTargetSeries:function(t){function e(e){t.eachComponent("dataZoom",(function(n){n.eachTargetAxis((function(r,i){var o=t.getComponent(yL(r),i);e(r,i,o,n)}))}))}e((function(t,e,n,r){n.__dzAxisProxy=null}));var n=[];e((function(e,r,i,o){i.__dzAxisProxy||(i.__dzAxisProxy=new zL(e,r,o,t),n.push(i.__dzAxisProxy))}));var r=pt();return F(n,(function(t){F(t.getTargetSeriesModels(),(function(t){r.set(t.uid,t)}))})),r},overallReset:function(t,e){t.eachComponent("dataZoom",(function(t){t.eachTargetAxis((function(e,n){t.getAxisProxy(e,n).reset(t)})),t.eachTargetAxis((function(n,r){t.getAxisProxy(n,r).filterData(t,e)}))})),t.eachComponent("dataZoom",(function(t){var e,n=t.findRepresentativeAxisProxy();n&&(e=n.getDataPercentWindow(),n=n.getDataValueWindow(),t.setCalculatedRange({start:e[0],end:e[1],startValue:n[0],endValue:n[1]}))}))}},VL=!1;function UL(t){VL||(VL=!0,t.registerProcessor(t.PRIORITY.PROCESSOR.FILTER,HL),t.registerAction("dataZoom",(function(t,e){F(_L(e,t),(function(e){e.setRawRange({start:t.start,end:t.end,startValue:t.startValue,endValue:t.endValue})}))})),t.registerSubTypeDefaulter("dataZoom",(function(){return"slider"})))}function GL(t){t.registerComponentModel(EL),t.registerComponentView(LL),UL(t)}function WL(){}var XL,jL={};function YL(t,e){jL[t]=e}function ZL(t){return jL[t]}function qL(){var t=null!==XL&&XL.apply(this,arguments)||this;return t.type=qL.type,t}var KL,QL=(h(qL,XL=Ld),qL.prototype.optionUpdated=function(){XL.prototype.optionUpdated.apply(this,arguments);var t=this.ecModel;F(this.option.feature,(function(e,n){n=ZL(n),n&&(n.getDefaultOption&&(n.defaultOption=n.getDefaultOption(t)),D(e,n.defaultOption))}))},qL.type="toolbox",qL.layoutMode={type:"box",ignoreSize:!0},qL.defaultOption={show:!0,z:6,zlevel:0,orient:"horizontal",left:"right",top:"top",backgroundColor:"transparent",borderColor:"#ccc",borderRadius:0,borderWidth:0,padding:5,itemSize:15,itemGap:8,showTitle:!0,iconStyle:{borderColor:"#666",color:"none"},emphasis:{iconStyle:{borderColor:"#3E98C5"}},tooltip:{show:!1}},qL);function JL(t,e){var n=id(e.get("padding")),r=e.getItemStyle(["color","opacity"]);return r.fill=e.get("backgroundColor"),new bs({shape:{x:t.x-n[3],y:t.y-n[0],width:t.width+n[1]+n[3],height:t.height+n[0]+n[2],r:e.get("borderRadius")},style:r,silent:!0,z2:-1})}function $L(){return null!==KL&&KL.apply(this,arguments)||this}var tO,eO=(h($L,KL=gg),$L.prototype.render=function(t,e,n,r){var i,o,a,s,l,u,h,c,d,p,f=this.group;function g(l,u){var h,c=s[l],d=s[u];l=o[c],u=new xc(l,t,t.ecModel);if(r&&null!=r.newTitle&&r.featureName===c&&(l.title=r.newTitle),c&&!d){if(0===c.indexOf("my"))h={onclick:u.option.onclick,featureName:c};else{if(l=ZL(c),!l)return;h=new l}a[c]=h}else if(!(h=a[d]))return;if(h.uid=Tc("toolbox-feature"),h.model=u,h.ecModel=e,h.api=n,h instanceof WL){if(!c&&d)return void(h.dispose&&h.dispose(e,n));if(!u.get("show")||h.unusable)return void(h.remove&&h.remove(e,n))}!function(r,o,a){var s,l,u=r.getModel("iconStyle"),h=r.getModel(["emphasis","iconStyle"]),c=o instanceof WL&&o.getIcons?o.getIcons():r.get("icon"),d=r.get("title")||{};"string"==typeof c?(s={})[a]=c:s=c,"string"==typeof d?(l={})[a]=d:l=d;var p=r.iconPaths={};F(s,(function(a,s){var c=Zh(a,{},{x:-i/2,y:-i/2,width:i,height:i});c.setStyle(u.getItemStyle()),c.ensureState("emphasis").style=h.getItemStyle();var d=new Os({style:{text:l[s],align:h.get("textAlign"),borderRadius:h.get("textBorderRadius"),padding:h.get("textPadding"),fill:null},ignore:!0});c.setTextContent(d),a=t.getModel("tooltip"),a&&a.get("show")&&(c.tooltip=R({content:l[s],formatter:a.get("formatter",!0)||function(){return l[s]},formatterParams:{componentType:"toolbox",name:s,title:l[s],$vars:["name","title"]},position:a.get("position",!0)||"bottom"},a.option)),c.__title=l[s],c.on("mouseover",(function(){var e=h.getItemStyle(),n="vertical"===t.get("orient")?null==t.get("right")?"right":"left":null==t.get("bottom")?"bottom":"top";d.setStyle({fill:h.get("textFill")||e.fill||e.stroke||"#000",backgroundColor:h.get("textBackgroundColor")}),c.setTextConfig({position:h.get("textPosition")||n}),d.ignore=!t.get("showTitle"),dl(this)})).on("mouseout",(function(){"emphasis"!==r.get(["iconStatus",s])&&pl(this),d.hide()})),("emphasis"===r.get(["iconStatus",s])?dl:pl)(c),f.add(c),c.on("click",G(o.onclick,o,e,n,s)),p[s]=c}))}(u,h,c),u.setIconStatus=function(t,e){var n=this.option,r=this.iconPaths;n.iconStatus=n.iconStatus||{},n.iconStatus[t]=e,r[t]&&("emphasis"===e?dl:pl)(r[t])},h instanceof WL&&h.render&&h.render(u,e,n,r)}f.removeAll(),t.get("show")&&(i=+t.get("itemSize"),o=t.get("feature")||{},a=this._features||(this._features={}),s=[],F(o,(function(t,e){s.push(e)})),new j_(this._featureNames||[],s).add(g).update(g).remove(W(g,null)).execute(),this._featureNames=s,l=f,h=n,c=(u=t).getBoxLayoutParams(),d=u.get("padding"),p={width:h.getWidth(),height:h.getHeight()},h=vd(c,p,d),_d(u.get("orient"),l,u.get("itemGap"),h.width,h.height),xd(l,c,p,d),f.add(JL(f.getBoundingRect(),t)),f.eachChild((function(t){var e=t.__title,r=t.ensureState("emphasis"),o=r.textConfig||(r.textConfig={}),a=t.getTextContent(),s=a&&a.states.emphasis;s&&!j(s)&&e&&(r=s.style||(s.style={}),a=Zn(e,Os.makeFont(r)),s=t.x+f.x,e=!1,t.y+f.y+i+a.height>n.getHeight()&&(o.position="top",e=!0),e=e?-5-a.height:i+8,s+a.width/2>n.getWidth()?(o.position=["100%",e],r.align="right"):s-a.width/2<0&&(o.position=[0,e],r.align="left"))})))},$L.prototype.updateView=function(t,e,n,r){F(this._features,(function(t){t instanceof WL&&t.updateView&&t.updateView(t.model,e,n,r)}))},$L.prototype.remove=function(t,e){F(this._features,(function(n){n instanceof WL&&n.remove&&n.remove(t,e)})),this.group.removeAll()},$L.prototype.dispose=function(t,e){F(this._features,(function(n){n instanceof WL&&n.dispose&&n.dispose(t,e)}))},$L.type="toolbox",$L);h(nO,tO=WL),nO.prototype.onclick=function(t,e){var n=this.model,r=n.get("name")||t.get("title.0.text")||"echarts",i="svg"===e.getZr().painter.getType(),o=i?"svg":n.get("type",!0)||"png",a=e.getConnectedDataURL({type:o,backgroundColor:n.get("backgroundColor",!0)||t.get("backgroundColor")||"#fff",connectedBackgroundColor:n.get("connectedBackgroundColor"),excludeComponents:n.get("excludeComponents"),pixelRatio:n.get("pixelRatio")});if("function"!=typeof MouseEvent||!g.browser.newEdge&&(g.browser.ie||g.browser.edge))if(window.navigator.msSaveOrOpenBlob||i){e=a.split(","),t=-1<e[0].indexOf("base64");var s=i?decodeURIComponent(e[1]):e[1];if(t&&(s=atob(s)),i=r+"."+o,window.navigator.msSaveOrOpenBlob){for(var l=s.length,u=new Uint8Array(l);l--;)u[l]=s.charCodeAt(l);var h=new Blob([u]);window.navigator.msSaveOrOpenBlob(h,i)}else e=document.createElement("iframe"),document.body.appendChild(e),t=e.contentWindow,h=t.document,h.open("image/svg+xml","replace"),h.write(s),h.close(),t.focus(),h.execCommand("SaveAs",!0,i),document.body.removeChild(e)}else{var c=n.get("lang");n='<body style="margin:0;"><img src="'+a+'" style="max-width:100%;" title="'+(c&&c[0]||"")+'" /></body>',c=window.open();c.document.write(n),c.document.title=r}else c=document.createElement("a"),c.download=r+"."+o,c.target="_blank",c.href=a,a=new MouseEvent("click",{view:document.defaultView,bubbles:!0,cancelable:!1}),c.dispatchEvent(a)},nO.getDefaultOption=function(t){return{show:!0,icon:"M4.7,22.9L29.3,45.5L54.7,23.4M4.6,43.6L4.6,58L53.8,58L53.8,43.6M29.2,45.1L29.2,0",title:t.getLocale(["toolbox","saveAsImage","title"]),type:"png",connectedBackgroundColor:"#fff",name:"",excludeComponents:["toolbox"],lang:t.getLocale(["toolbox","saveAsImage","lang"])}},M=nO;function nO(){return null!==tO&&tO.apply(this,arguments)||this}M.prototype.unusable=!g.canvasSupported;var rO,iO=M,oO="__ec_magicType_stack__",aO=[["line","bar"],["stack"]];h(sO,rO=WL),sO.prototype.getIcons=function(){var t=this.model,e=t.get("icon"),n={};return F(t.get("type"),(function(t){e[t]&&(n[t]=e[t])})),n},sO.getDefaultOption=function(t){return{show:!0,type:[],icon:{line:"M4.1,28.9h7.1l9.3-22l7.4,38l9.7-19.7l3,12.8h14.9M4.1,58h51.4",bar:"M6.7,22.9h10V48h-10V22.9zM24.9,13h10v35h-10V13zM43.2,2h10v46h-10V2zM3.1,58h53.7",stack:"M8.2,38.4l-8.4,4.1l30.6,15.3L60,42.5l-8.1-4.1l-21.5,11L8.2,38.4z M51.9,30l-8.1,4.2l-13.4,6.9l-13.9-6.9L8.2,30l-8.4,4.2l8.4,4.2l22.2,11l21.5-11l8.1-4.2L51.9,30z M51.9,21.7l-8.1,4.2L35.7,30l-5.3,2.8L24.9,30l-8.4-4.1l-8.3-4.2l-8.4,4.2L8.2,30l8.3,4.2l13.9,6.9l13.4-6.9l8.1-4.2l8.1-4.1L51.9,21.7zM30.4,2.2L-0.2,17.5l8.4,4.1l8.3,4.2l8.4,4.2l5.5,2.7l5.3-2.7l8.1-4.2l8.1-4.2l8.1-4.1L30.4,2.2z"},title:t.getLocale(["toolbox","magicType","title"]),option:{},seriesIndex:{}}},sO.prototype.onclick=function(t,e,n){var r,i,o=this.model,a=o.get(["seriesIndex",n]);lO[n]&&(r={series:[]},F(aO,(function(t){0<=P(t,n)&&F(t,(function(t){o.setIconStatus(t,"normal")}))})),o.setIconStatus(n,"emphasis"),t.eachComponent({mainType:"series",query:null==a?null:{seriesIndex:a}},(function(t){var e=t.subType,i=t.id;i=lO[n](e,i,t,o);if(i&&(L(i,t.option),r.series.push(i)),i=t.coordinateSystem,i&&"cartesian2d"===i.type&&("line"===n||"bar"===n)&&(i=i.getAxesByScale("ordinal")[0],i)){var a=i.dim+"Axis",s=t.getReferringComponents(a,Zi).models[0].componentIndex;r[a]=r[a]||[];for(var l=0;l<=s;l++)r[a][s]=r[a][s]||{};r[a][s].boundaryGap="bar"===n}})),"stack"===n&&(i=D({stack:o.option.title.tiled,tiled:o.option.title.stack},o.option.title)),e.dispatchAction({type:"changeMagicType",currentType:n,newOption:r,newTitle:i,featureName:"magicType"}))},Bo=sO;function sO(){return null!==rO&&rO.apply(this,arguments)||this}var lO={line:function(t,e,n,r){if("bar"===t)return D({id:e,type:"line",data:n.get("data"),stack:n.get("stack"),markPoint:n.get("markPoint"),markLine:n.get("markLine")},r.get(["option","line"])||{},!0)},bar:function(t,e,n,r){if("line"===t)return D({id:e,type:"bar",data:n.get("data"),stack:n.get("stack"),markPoint:n.get("markPoint"),markLine:n.get("markLine")},r.get(["option","bar"])||{},!0)},stack:function(t,e,n,r){if(n=n.get("stack")===oO,"line"===t||"bar"===t)return r.setIconStatus("stack",n?"normal":"emphasis"),D({id:e,stack:n?"":oO},r.get(["option","stack"])||{},!0)}};N_({type:"changeMagicType",event:"magicTypeChanged",update:"prepareAndUpdate"},(function(t,e){e.mergeOption(t.newOption)}));var uO=Bo,hO=new Array(60).join("-"),cO="\t";function dO(t){var e,n,r,i;e={},n=[],r=[],t.eachRawSeries((function(t){var i,o,a=t.coordinateSystem;!a||"cartesian2d"!==a.type&&"polar"!==a.type||"category"!==(i=a.getBaseAxis()).type?n.push(t):(o=i.dim+"_"+i.index,e[o]||(e[o]={categoryAxis:i,valueAxis:a.getOtherAxis(i),series:[]},r.push({axisDim:i.dim,axisIndex:i.index})),e[o].series.push(t))})),t={seriesGroupByCategoryAxis:e,other:n,meta:r};return{value:V([(i=[],F(t.seriesGroupByCategoryAxis,(function(t,e){var n=t.categoryAxis,r=t.valueAxis.dim,o=[" "].concat(z(t.series,(function(t){return t.name}))),a=[n.model.getCategories()];F(t.series,(function(t){var e=t.getRawData();a.push(t.getRawData().mapArray(e.mapDimension(r),(function(t){return t})))}));for(var s=[o.join(cO)],l=0;l<a[0].length;l++){for(var u=[],h=0;h<a.length;h++)u.push(a[h][l]);s.push(u.join(cO))}i.push(s.join("\n"))})),i.join("\n\n"+hO+"\n\n")),z(t.other,(function(t){var e=t.getRawData(),n=[t.name],r=[];return e.each(e.dimensions,(function(){for(var t=arguments.length,i=e.getName(arguments[t-1]),o=0;o<t-1;o++)r[o]=arguments[o];n.push((i?i+cO:"")+r.join(cO))})),n.join("\n")})).join("\n\n"+hO+"\n\n")],(function(t){return!!t.replace(/[\n\t\s]/g,"")})).join("\n\n"+hO+"\n\n"),meta:t.meta}}function pO(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}var fO=new RegExp("["+cO+"]+","g");function gO(t,e){t=t.split(new RegExp("\n*"+hO+"\n*","g"));var n={series:[]};return F(t,(function(t,r){var i,o;0<=t.slice(0,t.indexOf("\n")).indexOf(cO)?(o=function(t){for(var e=t.split(/\n+/g),n=[],r=z(pO(e.shift()).split(fO),(function(t){return{name:t,data:[]}})),i=0;i<e.length;i++){var o=pO(e[i]).split(fO);n.push(o.shift());for(var a=0;a<o.length;a++)r[a]&&(r[a].data[i]=o[a])}return{series:r,categories:n}}(t),r=(i=e[r]).axisDim+"Axis",i&&(n[r]=n[r]||[],n[r][i.axisIndex]={data:o.categories},n.series=n.series.concat(o.series))):(o=function(t){for(var e=t.split(/\n+/g),n=(t=pO(e.shift()),[]),r=0;r<e.length;r++){var i=pO(e[r]);if(i){for(var o,a=i.split(fO),s=void 0,l=(i=!1,s=isNaN(a[0])?(i=!0,o=a[0],a=a.slice(1),n[r]={name:o,value:[]},n[r].value):n[r]=[],0);l<a.length;l++)s.push(+a[l]);1===s.length&&(i?n[r].value=s[0]:n[r]=s[0])}}return{name:t,data:n}}(t),n.series.push(o))})),n}var mO;h(yO,mO=WL),yO.prototype.onclick=function(t,e){var n=e.getDom(),r=this.model;this._dom&&n.removeChild(this._dom);var i=document.createElement("div");i.style.cssText="position:absolute;left:5px;top:5px;bottom:5px;right:5px;",i.style.backgroundColor=r.get("backgroundColor")||"#fff";var o=document.createElement("h4"),a=r.get("lang")||[];o.innerHTML=a[0]||r.get("title"),o.style.cssText="margin: 10px 20px;",o.style.color=r.get("textColor");var s=document.createElement("div"),l=document.createElement("textarea");s.style.cssText="display:block;width:100%;overflow:auto;";var u=r.get("optionToContent"),h=r.get("contentToOption"),c=dO(t);"function"==typeof u?"string"==typeof(f=u(e.getOption()))?s.innerHTML=f:$(f)&&s.appendChild(f):(s.appendChild(l),l.readOnly=r.get("readOnly"),l.style.cssText="width:100%;height:100%;font-family:monospace;font-size:14px;line-height:1.6rem;",l.style.color=r.get("textColor"),l.style.borderColor=r.get("textareaBorderColor"),l.style.backgroundColor=r.get("textareaColor"),l.value=c.value);var d=c.meta,p=document.createElement("div");p.style.cssText="position:absolute;bottom:0;left:0;right:0;";t="float:right;margin-right:20px;border:none;cursor:pointer;padding:2px 5px;font-size:12px;border-radius:3px";var f=document.createElement("div");c=document.createElement("div");t+=";background-color:"+r.get("buttonColor"),t+=";color:"+r.get("buttonTextColor");var g=this;function m(){n.removeChild(i),g._dom=null}Jt(f,"click",m),Jt(c,"click",(function(){if(null==h&&null!=u||null!=h&&null==u)m();else{var t;try{t="function"==typeof h?h(s,e.getOption()):gO(l.value,d)}catch(t){throw m(),new Error("Data view format error "+t)}t&&e.dispatchAction({type:"changeDataView",newOption:t}),m()}})),f.innerHTML=a[1],c.innerHTML=a[2],c.style.cssText=t,f.style.cssText=t,r.get("readOnly")||p.appendChild(c),p.appendChild(f),i.appendChild(o),i.appendChild(s),i.appendChild(p),s.style.height=n.clientHeight-80+"px",n.appendChild(i),this._dom=i},yO.prototype.remove=function(t,e){this._dom&&e.getDom().removeChild(this._dom)},yO.prototype.dispose=function(t,e){this.remove(t,e)},yO.getDefaultOption=function(t){return{show:!0,readOnly:!1,optionToContent:null,contentToOption:null,icon:"M17.5,17.3H33 M17.5,17.3H33 M45.4,29.5h-28 M11.5,2v56H51V14.8L38.4,2H11.5z M38.4,2.2v12.7H51 M45.4,41.7h-28",title:t.getLocale(["toolbox","dataView","title"]),lang:t.getLocale(["toolbox","dataView","lang"]),backgroundColor:"#fff",textColor:"#000",textareaColor:"#fff",textareaBorderColor:"#333",buttonColor:"#c23531",buttonTextColor:"#fff"}},pA=yO;function yO(){return null!==mO&&mO.apply(this,arguments)||this}N_({type:"changeDataView",event:"dataViewChanged",update:"prepareAndUpdate"},(function(t,e){var n=[];F(t.newOption.series,(function(t){var r,i,o=e.getSeriesByName(t.name)[0];o?(r=o.get("data"),n.push({name:t.name,data:(o=t.data,i=r,z(o,(function(t,e){var n=i&&i[e];return!K(n)||X(n)||(K(t)&&!X(t)||(t={value:t}),e=null!=n.name&&null==t.name,t=L(t,n),e&&delete t.name),t})))})):n.push(R({type:"scatter"},t))})),e.mergeOption(L({series:n},t.newOption))}));var _O=pA,vO=F,xO=Xi();function bO(t){return t=xO(t),t.snapshots||(t.snapshots=[{}]),t.snapshots}var TO;h(wO,TO=WL),wO.prototype.onclick=function(t,e){xO(t).snapshots=null,e.dispatchAction({type:"restore",from:this.uid})},wO.getDefaultOption=function(t){return{show:!0,icon:"M3.8,33.4 M47,18.9h9.8V8.7 M56.3,20.1 C52.1,9,40.5,0.6,26.8,2.1C12.6,3.7,1.6,16.2,2.1,30.6 M13,41.1H3.1v10.2 M3.7,39.9c4.2,11.1,15.8,19.5,29.5,18 c14.2-1.6,25.2-14.1,24.7-28.5",title:t.getLocale(["toolbox","restore","title"])}},M=wO;function wO(){return null!==TO&&TO.apply(this,arguments)||this}N_({type:"restore",event:"restore",update:"prepareAndUpdate"},(function(t,e){e.resetOption("recreate")}));var SO,MO=M,AO=!0,CO=Math.min,EO=Math.max,IO=Math.pow,DO=1e4,RO=6,LO=6,OO="globalPan",PO={w:[0,0],e:[0,1],n:[1,0],s:[1,1]},NO={w:"ew",e:"ew",n:"ns",s:"ns",ne:"nesw",sw:"nesw",nw:"nwse",se:"nwse"},kO={brushStyle:{lineWidth:2,stroke:"rgba(210,219,238,0.3)",fill:"#D2DBEE"},transformable:!0,brushMode:"single",removeOnClick:!1},BO=0;h(FO,SO=Bt),FO.prototype.enableBrush=function(t){return this._brushType&&this._doDisableBrush(),t.brushType&&this._doEnableBrush(t),this},FO.prototype._doEnableBrush=function(t){var e,n,r=this._zr;this._enableGlobalPan||(e=OO,n=this._uid,xE(r)[e]=n),F(this._handlers,(function(t,e){r.on(e,t)})),this._brushType=t.brushType,this._brushOption=D(I(kO),t,!0)},FO.prototype._doDisableBrush=function(){var t,e,n,r=this._zr;t=r,e=OO,n=this._uid,(t=xE(t))[e]===n&&(t[e]=null),F(this._handlers,(function(t,e){r.off(e,t)})),this._brushType=this._brushOption=null},FO.prototype.setPanels=function(t){var e;return t&&t.length?(e=this._panels={},F(t,(function(t){e[t.panelId]=I(t)}))):this._panels=null,this},FO.prototype.mount=function(t){this._enableGlobalPan=(t=t||{}).enableGlobalPan;var e=this.group;return this._zr.add(e),e.attr({x:t.x||0,y:t.y||0,rotation:t.rotation||0,scaleX:t.scaleX||1,scaleY:t.scaleY||1}),this._transform=e.getLocalTransform(),this},FO.prototype.updateCovers=function(t){t=z(t,(function(t){return D(I(kO),t,!0)}));var e="\0-brush-index-",n=this._covers,r=this._covers=[],i=this,o=this._creatingCover;return new j_(n,t,(function(t,e){return a(t.__brushOption,e)}),a).add(s).update(s).remove((function(t){n[t]!==o&&i.group.remove(n[t])})).execute(),this;function a(t,n){return(null!=t.id?t.id:e+n)+"-"+t.brushType}function s(e,a){var s=t[e];null!=a&&n[a]===o?r[e]=n[a]:(s=r[e]=null!=a?(n[a].__brushOption=s,n[a]):HO(i,zO(i,s)),GO(i,s))}},FO.prototype.unmount=function(){return this.enableBrush(!1),YO(this),this._zr.remove(this.group),this},FO.prototype.dispose=function(){this.unmount(),this.off()},Bo=FO;function FO(t){var e=SO.call(this)||this;return e._track=[],e._covers=[],e._handlers={},e._zr=t,e.group=new ei,e._uid="brushController_"+BO++,F(dP,(function(t,e){this._handlers[e]=G(t,this)}),e),e}function zO(t,e){var n=fP[e.brushType].createCover(t,e);return n.__brushOption=e,UO(n,e),t.group.add(n),n}function HO(t,e){var n=WO(e);return n.endCreating&&(n.endCreating(t,e),UO(e,e.__brushOption)),e}function VO(t,e){var n=e.__brushOption;WO(e).updateCoverShape(t,e,n.range,n)}function UO(t,e){var n=e.z;null==n&&(n=DO),t.traverse((function(t){t.z=n,t.z2=n}))}function GO(t,e){WO(e).updateCommon(t,e),VO(t,e)}function WO(t){return fP[t.__brushOption.brushType]}function XO(t,e,n){var r,i=t._panels;if(!i)return AO;var o=t._transform;return F(i,(function(t){t.isTargetByCursor(e,n,o)&&(r=t)})),r}function jO(t,e){return t=t._panels,t?(e=e.__brushOption.panelId,null!=e?t[e]:AO):AO}function YO(t){var e=t._covers,n=e.length;return F(e,(function(e){t.group.remove(e)}),t),e.length=0,n}function ZO(t,e){var n=z(t._covers,(function(t){var e=t.__brushOption;t=I(e.range);return{brushType:e.brushType,panelId:e.panelId,range:t}}));t.trigger("brush",{areas:n,isEnd:!!e.isEnd,removeOnClick:!!e.removeOnClick})}function qO(t){var e=t.length-1;return[t[0],t[e=e<0?0:e]]}function KO(t,e,n,r){var i=new ei;return i.add(new bs({name:"main",style:tP(n),silent:!0,draggable:!0,cursor:"move",drift:W(rP,t,e,i,["n","s","w","e"]),ondragend:W(ZO,e,{isEnd:!0})})),F(r,(function(n){i.add(new bs({name:n.join(""),style:{opacity:0},draggable:!0,silent:!0,invisible:!0,drift:W(rP,t,e,i,n),ondragend:W(ZO,e,{isEnd:!0})}))})),i}function QO(t,e,n,r){var i=r.brushStyle.lineWidth||0,o=EO(i,LO),a=n[0][0],s=n[1][0],l=a-i/2,u=s-i/2,h=n[0][1],c=n[1][1],d=h-o+i/2,p=c-o+i/2;n=h-a,h=c-s,c=n+i,i=h+i;$O(t,e,"main",a,s,n,h),r.transformable&&($O(t,e,"w",l,u,o,i),$O(t,e,"e",d,u,o,i),$O(t,e,"n",l,u,c,o),$O(t,e,"s",l,p,c,o),$O(t,e,"nw",l,u,o,o),$O(t,e,"ne",d,u,o,o),$O(t,e,"sw",l,p,o,o),$O(t,e,"se",d,p,o,o))}function JO(t,e){var n=e.__brushOption,r=n.transformable,i=e.childAt(0);i.useStyle(tP(n)),i.attr({silent:!r,cursor:r?"move":"default"}),F([["w"],["e"],["n"],["s"],["s","e"],["s","w"],["n","e"],["n","w"]],(function(n){var i=e.childOfName(n.join(""));n=1===n.length?nP(t,n[0]):function(t,e){return e=[nP(t,e[0]),nP(t,e[1])],"e"!==e[0]&&"w"!==e[0]||e.reverse(),e.join("")}(t,n);i&&i.attr({silent:!r,invisible:!r,cursor:r?NO[n]+"-resize":null})}))}function $O(t,e,n,r,i,o,a){n=e.childOfName(n),n&&n.setShape((r=aP(t,e,[[r,i],[r+o,i+a]]),o=CO(r[0][0],r[1][0]),i=CO(r[0][1],r[1][1]),a=EO(r[0][0],r[1][0]),r=EO(r[0][1],r[1][1]),{x:o,y:i,width:a-o,height:r-i}))}function tP(t){return L({strokeNoScale:!0},t.brushStyle)}function eP(t,e,n,r){var i=[CO(t,n),CO(e,r)];r=[EO(t,n),EO(e,r)];return[[i[0],r[0]],[i[1],r[1]]]}function nP(t,e){return{left:"w",right:"e",top:"n",bottom:"s"}[Gh({w:"left",e:"right",n:"top",s:"bottom"}[e],Vh(t.group))]}function rP(t,e,n,r,i,o){var a=n.__brushOption,s=t.toRectRange(a.range),l=oP(e,i,o);F(r,(function(t){t=PO[t],s[t[0]][t[1]]+=l[t[0]]})),a.range=t.fromRectRange(eP(s[0][0],s[1][0],s[0][1],s[1][1])),GO(e,n),ZO(e,{isEnd:!1})}function iP(t,e,n,r){var i=e.__brushOption.range,o=oP(t,n,r);F(i,(function(t){t[0]+=o[0],t[1]+=o[1]})),GO(t,e),ZO(t,{isEnd:!1})}function oP(t,e,n){return t=t.group,n=t.transformCoordToLocal(e,n),t=t.transformCoordToLocal(0,0),[n[0]-t[0],n[1]-t[1]]}function aP(t,e,n){return e=jO(t,e),e&&e!==AO?e.clipPath(n,t._transform):I(n)}function sP(t,e,n){if(t._brushType&&!function(t,e,n){return t=t._zr,e<0||e>t.getWidth()||n<0||n>t.getHeight()}(t,e.offsetX,e.offsetY)){var r=t._zr,i=t._covers,o=XO(t,e,n);if(!t._dragging)for(var a=0;a<i.length;a++){var s=i[a].__brushOption;if(o&&(o===AO||s.panelId===o.panelId)&&fP[s.brushType].contain(i[a],n[0],n[1]))return}o&&r.setCursorStyle("crosshair")}}function lP(t){t=t.event,t.preventDefault&&t.preventDefault()}function uP(t,e,n){return t.childOfName("main").contain(e,n)}function hP(t,e,n,r){var i,o,a=t._creatingCover,s=t._creatingPanel,l=t._brushOption;return t._track.push(n.slice()),function(t){if((n=t._track).length){var e=n[n.length-1],n=(t=n[0],e[0]-t[0]);t=e[1]-t[1],t=IO(n*n+t*t,.5);return RO<t}}(t)||a?(s&&!a&&("single"===l.brushMode&&YO(t),(i=I(l)).brushType=cP(i.brushType,s),i.panelId=s===AO?null:s.panelId,a=t._creatingCover=zO(t,i),t._covers.push(a)),a&&(o=fP[cP(t._brushType,s)],a.__brushOption.range=o.getCreatingRange(aP(t,a,t._track)),r&&(HO(t,a),o.updateCommon(t,a)),VO(t,a),o={isEnd:r})):r&&"single"===l.brushMode&&l.removeOnClick&&XO(t,e,n)&&YO(t)&&(o={isEnd:r,removeOnClick:!0}),o}function cP(t,e){return"auto"===t?e.defaultBrushType:t}var dP={mousedown:function(t){var e;this._dragging?pP(this,t):t.target&&t.target.draggable||(lP(t),e=this.group.transformCoordToLocal(t.offsetX,t.offsetY),this._creatingCover=null,(this._creatingPanel=XO(this,t,e))&&(this._dragging=!0,this._track=[e.slice()]))},mousemove:function(t){var e=t.offsetX,n=t.offsetY;n=this.group.transformCoordToLocal(e,n);sP(this,t,n),this._dragging&&(lP(t),(n=hP(this,t,n,!1))&&ZO(this,n))},mouseup:function(t){pP(this,t)}};function pP(t,e){var n,r;t._dragging&&(lP(e),n=e.offsetX,r=e.offsetY,r=t.group.transformCoordToLocal(n,r),r=hP(t,e,r,!0),t._dragging=!1,t._track=[],t._creatingCover=null,r&&ZO(t,r))}var fP={lineX:gP(0),lineY:gP(1),rect:{createCover:function(t,e){function n(t){return t}return KO({toRectRange:n,fromRectRange:n},t,e,[["w"],["e"],["n"],["s"],["s","e"],["s","w"],["n","e"],["n","w"]])},getCreatingRange:function(t){return t=qO(t),eP(t[1][0],t[1][1],t[0][0],t[0][1])},updateCoverShape:function(t,e,n,r){QO(t,e,n,r)},updateCommon:JO,contain:uP},polygon:{createCover:function(t,e){var n=new ei;return n.add(new Bu({name:"main",style:tP(e),silent:!0})),n},getCreatingRange:function(t){return t},endCreating:function(t,e){e.remove(e.childAt(0)),e.add(new Lu({name:"main",draggable:!0,drift:W(iP,t,e),ondragend:W(ZO,t,{isEnd:!0})}))},updateCoverShape:function(t,e,n,r){e.childAt(0).setShape({points:aP(t,e,n)})},updateCommon:JO,contain:uP}};function gP(t){return{createCover:function(e,n){return KO({toRectRange:function(e){return e=[e,[0,100]],t&&e.reverse(),e},fromRectRange:function(e){return e[t]}},e,n,[[["w"],["e"]],[["n"],["s"]]][t])},getCreatingRange:function(e){return e=qO(e),[CO(e[0][t],e[1][t]),EO(e[0][t],e[1][t])]},updateCoverShape:function(e,n,r,i){var o=jO(e,n),a=[r,o!==AO&&o.getLinearBrushOtherExtent?o.getLinearBrushOtherExtent(t):[0,[(a=e._zr).getWidth(),a.getHeight()][1-t]]];t&&a.reverse(),QO(e,n,a,i)},updateCommon:JO,contain:uP}}var mP=Bo;function yP(t){return Un.create(t)}var _P=["dataToPoint","pointToData"],vP=["grid","xAxis","yAxis","geo","graph","polar","radiusAxis","angleAxis","bmap"];xP.prototype.setOutputRanges=function(t,e){return this.matchOutputRanges(t,e,(function(t,e,n){(t.coordRanges||(t.coordRanges=[])).push(e),t.coordRange||(t.coordRange=e,e=AP[t.brushType](0,n,e),t.__rangeOffset={offset:EP[t.brushType](e.values,t.range,[1,1]),xyMinMax:e.xyMinMax})})),t},xP.prototype.matchOutputRanges=function(t,e,n){F(t,(function(t){var r=this.findTargetInfo(t,e);r&&!0!==r&&F(r.coordSyses,(function(r){var i=AP[t.brushType](1,r,t.range);n(t,i.values,r,e)}))}),this)},xP.prototype.setInputRanges=function(t,e){F(t,(function(t){var n,r=this.findTargetInfo(t,e);t.range=t.range||[],r&&!0!==r&&(t.panelId=r.panelId,n=AP[t.brushType](0,r.coordSys,t.coordRange),r=t.__rangeOffset,t.range=r?EP[t.brushType](n.values,r.offset,function(t,e){return t=DP(t),e=DP(e),e=[t[0]/e[0],t[1]/e[1]],isNaN(e[0])&&(e[0]=1),isNaN(e[1])&&(e[1]=1),e}(n.xyMinMax,r.xyMinMax)):n.values)}),this)},xP.prototype.makePanelOpts=function(t,e){return z(this._targetInfoList,(function(n){var r,i,o,a,s,l,u=n.getPanelRect();return{panelId:n.panelId,defaultBrushType:e?e(n):null,clipPath:(l=yP(l=u),function(t){return jh(t,l)}),isTargetByCursor:(o=t,a=n.coordSysModel,s=yP(u),function(t,e){return s.contain(e[0],e[1])&&!CE(t,o,a)}),getLinearBrushOtherExtent:(r=yP(r=u),function(t){var e=null!=i?i:t;t=e?r.width:r.height,e=e?r.x:r.y;return[e,e+(t||0)]})}}))},xP.prototype.controlSeries=function(t,e,n){return n=this.findTargetInfo(t,n),!0===n||n&&0<=P(n.coordSyses,e.coordinateSystem)},xP.prototype.findTargetInfo=function(t,e){for(var n=this._targetInfoList,r=TP(e,t),i=0;i<n.length;i++){var o=n[i],a=t.panelId;if(a){if(o.panelId===a)return o}else for(var s=0;s<SP.length;s++)if(SP[s](r,o))return o}return!0},pA=xP;function xP(t,e,n){var r=this;this._targetInfoList=[];var i=TP(e,t);F(wP,(function(t,e){n&&n.include&&!(0<=P(n.include,e))||t(i,r._targetInfoList)}))}function bP(t){return t[0]>t[1]&&t.reverse(),t}function TP(t,e){return Yi(t,e,{includeMainTypes:vP})}var wP={grid:function(t,e){var n=t.xAxisModels,r=t.yAxisModels,i=(t=t.gridModels,pt()),o={},a={};(n||r||t)&&(F(n,(function(t){t=t.axis.grid.model,i.set(t.id,t),o[t.id]=!0})),F(r,(function(t){t=t.axis.grid.model,i.set(t.id,t),a[t.id]=!0})),F(t,(function(t){i.set(t.id,t),o[t.id]=!0,a[t.id]=!0})),i.each((function(t){var i=t.coordinateSystem,s=[];F(i.getCartesians(),(function(t,e){(0<=P(n,t.getAxis("x").model)||0<=P(r,t.getAxis("y").model))&&s.push(t)})),e.push({panelId:"grid--"+t.id,gridModel:t,coordSysModel:t,coordSys:s[0],coordSyses:s,getPanelRect:MP.grid,xAxisDeclared:o[t.id],yAxisDeclared:a[t.id]})})))},geo:function(t,e){F(t.geoModels,(function(t){var n=t.coordinateSystem;e.push({panelId:"geo--"+t.id,geoModel:t,coordSysModel:t,coordSys:n,coordSyses:[n],getPanelRect:MP.geo})}))}},SP=[function(t,e){var n=t.xAxisModel,r=t.yAxisModel;t=t.gridModel;return(t=!(t=!t&&n?n.axis.grid.model:t)&&r?r.axis.grid.model:t)&&t===e.gridModel},function(t,e){return t=t.geoModel,t&&t===e.geoModel}],MP={grid:function(){return this.coordSys.master.getRect().clone()},geo:function(){var t=this.coordSys,e=t.getBoundingRect().clone();return e.applyTransform(Vh(t)),e}},AP={lineX:W(CP,0),lineY:W(CP,1),rect:function(t,e,n){var r=e[_P[t]]([n[0][0],n[1][0]]);n=e[_P[t]]([n[0][1],n[1][1]]),n=[bP([r[0],n[0]]),bP([r[1],n[1]])];return{values:n,xyMinMax:n}},polygon:function(t,e,n){var r=[[1/0,-1/0],[1/0,-1/0]];return{values:z(n,(function(n){return n=e[_P[t]](n),r[0][0]=Math.min(r[0][0],n[0]),r[1][0]=Math.min(r[1][0],n[1]),r[0][1]=Math.max(r[0][1],n[0]),r[1][1]=Math.max(r[1][1],n[1]),n})),xyMinMax:r}}};function CP(t,e,n,r){var i=n.getAxis(["x","y"][t]),o=bP(z([0,1],(function(t){return e?i.coordToData(i.toLocalCoord(r[t])):i.toGlobalCoord(i.dataToCoord(r[t]))})));n=[];return n[t]=o,n[1-t]=[NaN,NaN],{values:o,xyMinMax:n}}var EP={lineX:W(IP,0),lineY:W(IP,1),rect:function(t,e,n){return[[t[0][0]-n[0]*e[0][0],t[0][1]-n[0]*e[0][1]],[t[1][0]-n[1]*e[1][0],t[1][1]-n[1]*e[1][1]]]},polygon:function(t,e,n){return z(t,(function(t,r){return[t[0]-n[0]*e[r][0],t[1]-n[1]*e[r][1]]}))}};function IP(t,e,n,r){return[e[0]-r[t]*n[0],e[1]-r[t]*n[1]]}function DP(t){return t?[t[0][1]-t[0][0],t[1][1]-t[1][0]]:[NaN,NaN]}var RP,LP=pA,OP=F,PP=Li+"toolbox-dataZoom_";h(NP,RP=WL),NP.prototype.render=function(t,e,n,r){this._brushController||(this._brushController=new mP(n.getZr()),this._brushController.on("brush",G(this._onBrush,this)).mount()),function(t,e,n,r,i){var o=n._isZoomActive;r&&"takeGlobalCursor"===r.type&&(o="dataZoomSelect"===r.key&&r.dataZoomSelectActive),n._isZoomActive=o,t.setIconStatus("zoom",o?"emphasis":"normal"),i=new LP(zP(t),e,{include:["grid"]}).makePanelOpts(i,(function(t){return t.xAxisDeclared&&!t.yAxisDeclared?"lineX":!t.xAxisDeclared&&t.yAxisDeclared?"lineY":"rect"})),n._brushController.setPanels(i).enableBrush(!(!o||!i.length)&&{brushType:"auto",brushStyle:t.getModel("brushStyle").getItemStyle()})}(t,e,this,r,n),t.setIconStatus("back",1<function(t){return bO(t).length}(e)?"emphasis":"normal")},NP.prototype.onclick=function(t,e,n){FP[n].call(this)},NP.prototype.remove=function(t,e){this._brushController&&this._brushController.unmount()},NP.prototype.dispose=function(t,e){this._brushController&&this._brushController.dispose()},NP.prototype._onBrush=function(t){var e,n,r,i,o=t.areas;function a(t,r,i){var o,a,s,l=r.getAxis(t);r=l.model,o=t,a=r,n.eachComponent({mainType:"dataZoom",subType:"select"},(function(t){t.getAxisModel(o,a.componentIndex)&&(s=t)})),t=s,r=t.findRepresentativeAxisProxy(r).getMinMaxSpan();null==r.minValueSpan&&null==r.maxValueSpan||(i=OL(0,i.slice(),l.scale.getExtent(),0,r.minValueSpan,r.maxValueSpan)),t&&(e[t.id]={dataZoomId:t.id,startValue:i[0],endValue:i[1]})}t.isEnd&&o.length&&(e={},n=this.ecModel,this._brushController.updateCovers([]),new LP(zP(this.model),n,{include:["grid"]}).matchOutputRanges(o,n,(function(t,e,n){"cartesian2d"===n.type&&("rect"===(t=t.brushType)?(a("x",n,e[0]),a("y",n,e[1])):a({lineX:"x",lineY:"y"}[t],n,e))})),o=e,i=bO(r=n),vO(o,(function(t,e){for(var n,o=i.length-1;0<=o;o--)if(i[o][e])break;o<0&&(n=r.queryComponents({mainType:"dataZoom",subType:"select",id:e})[0])&&(n=n.getPercentRange(),i[0][e]={dataZoomId:e,start:n[0],end:n[1]})})),i.push(o),this._dispatchZoomAction(e))},NP.prototype._dispatchZoomAction=function(t){var e=[];OP(t,(function(t,n){e.push(I(t))})),e.length&&this.api.dispatchAction({type:"dataZoom",from:this.uid,batch:e})},NP.getDefaultOption=function(t){return{show:!0,filterMode:"filter",icon:{zoom:"M0,13.5h26.9 M13.5,26.9V0 M32.1,13.5H58V58H13.5 V32.1",back:"M22,1.4L9.9,13.5l12.3,12.3 M10.3,13.5H54.9v44.6 H10.3v-26"},title:t.getLocale(["toolbox","dataZoom","title"]),brushStyle:{borderWidth:0,color:"rgba(210,219,238,0.2)"}}},M=NP;function NP(){return null!==RP&&RP.apply(this,arguments)||this}var kP,BP,FP={zoom:function(){var t=!this._isZoomActive;this.api.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:t})},back:function(){this._dispatchZoomAction(function(t){var e=bO(t);t=e[e.length-1];1<e.length&&e.pop();var n={};return vO(t,(function(t,r){for(var i=e.length-1;0<=i;i--)if(t=e[i][r]){n[r]=t;break}})),n}(this.ecModel))}};function zP(t){return t={xAxisIndex:t.get("xAxisIndex",!0),yAxisIndex:t.get("yAxisIndex",!0),xAxisId:t.get("xAxisId",!0),yAxisId:t.get("yAxisId",!0)},null==t.xAxisIndex&&null==t.xAxisId&&(t.xAxisIndex="all"),null==t.yAxisIndex&&null==t.yAxisId&&(t.yAxisIndex="all"),t}kP="dataZoom",BP=function(t){var e=t.getComponent("toolbox",0);if(e){var n=e.getModel(["feature","dataZoom"]),r=[];t=Yi(t,zP(n));return OP(t.xAxisModels,(function(t){return i(t,"xAxis","xAxisIndex")})),OP(t.yAxisModels,(function(t){return i(t,"yAxis","yAxisIndex")})),r}function i(t,e,i){t=t.componentIndex,e={type:"select",$fromToolbox:!0,filterMode:n.get("filterMode",!0)||"filter",id:PP+e+t},e[i]=t,r.push(e)}},at(null==Jd.get(kP)&&BP),Jd.set(kP,BP);var HP=M;function VP(t,e){var n,r,i,o,a,s,l,u={axesInfo:{},seriesInvolved:!1,coordSysAxesInfo:{},coordSysMap:{}};return n=u,e=e,i=(r=t).getComponent("tooltip"),o=r.getComponent("axisPointer"),a=o.get("link",!0)||[],s=[],F(e.getCoordinateSystems(),(function(t){var e,l,u,h,c;function d(i,u,h){var c,d=h.model.getModel("axisPointer",o),p=d.get("show");p&&("auto"!==p||i||WP(d))&&(null==u&&(u=d.get("triggerTooltip")),c=(d=i?function(t,e,n,r,i,o){var a=e.getModel("axisPointer"),s={};return F(["type","snap","lineStyle","shadowStyle","label","animation","animationDurationUpdate","animationEasingUpdate","z"],(function(t){s[t]=I(a.get(t))})),s.snap="category"!==t.type&&!!o,"cross"===a.get("type")&&(s.type="line"),e=s.label||(s.label={}),null==e.show&&(e.show=!1),"cross"===i&&(i=a.get(["label","show"]),e.show=null==i||i,o||(o=s.lineStyle=a.get("crossStyle"))&&L(e,o.textStyle)),t.model.getModel("axisPointer",new xc(s,n,r))}(h,l,o,r,i,u):d).get("snap"),p=XP(h.model),i=u||c||"category"===h.type,d=n.axesInfo[p]={key:p,axis:h,coordSys:t,axisPointerModel:d,triggerTooltip:u,involveSeries:i,snap:c,useHandle:WP(d),seriesModels:[],linkGroup:null},e[p]=d,n.seriesInvolved=n.seriesInvolved||i,null!=(i=function(t,e){for(var n=e.model,r=e.dim,i=0;i<t.length;i++){var o=t[i]||{};if(UP(o[r+"AxisId"],n.id)||UP(o[r+"AxisIndex"],n.componentIndex)||UP(o[r+"AxisName"],n.name))return i}}(a,h))&&((h=s[i]||(s[i]={axesInfo:{}})).axesInfo[p]=d,h.mapper=a[i].mapper,d.linkGroup=h))}t.axisPointerEnabled&&(c=XP(t.model),e=n.coordSysAxesInfo[c]={},l=(n.coordSysMap[c]=t).model.getModel("tooltip",i),F(t.getAxes(),W(d,!1,null)),t.getTooltipAxes&&i&&l.get("show")&&(u="axis"===l.get("trigger"),h="cross"===l.get(["axisPointer","type"]),c=t.getTooltipAxes(l.get(["axisPointer","axis"])),(u||h)&&F(c.baseAxes,W(d,!h||"cross",u)),h&&F(c.otherAxes,W(d,"cross",!1))))})),u.seriesInvolved&&(l=u,t.eachSeries((function(t){var e=t.coordinateSystem,n=t.get(["tooltip","trigger"],!0),r=t.get(["tooltip","show"],!0);e&&"none"!==n&&!1!==n&&"item"!==n&&!1!==r&&!1!==t.get(["axisPointer","show"],!0)&&F(l.coordSysAxesInfo[XP(e.model)],(function(n){var r=n.axis;e.getAxis(r.dim)===r&&(n.seriesModels.push(t),null==n.seriesDataCount&&(n.seriesDataCount=0),n.seriesDataCount+=t.getData().count())}))}))),u}function UP(t,e){return"all"===t||X(t)&&0<=P(t,e)||t===e}function GP(t){var e=(t.ecModel.getComponent("axisPointer")||{}).coordSysAxesInfo;return e&&e.axesInfo[XP(t)]}function WP(t){return!!t.get(["handle","show"])}function XP(t){return t.type+"||"+t.id}var jP,YP={};function ZP(){var t=null!==jP&&jP.apply(this,arguments)||this;return t.type=ZP.type,t}var qP=(h(ZP,jP=gg),ZP.prototype.render=function(t,e,n,r){var i,o,a,s,l,u;!this.axisPointerClass||(u=GP(i=t))&&(s=u.axisPointerModel,l=u.axis.scale,o=s.option,a=s.get("status"),null!=(i=s.get("value"))&&(i=l.parse(i)),s=WP(s),null==a&&(o.status=s?"show":"hide"),(l=l.getExtent().slice())[0]>l[1]&&l.reverse(),(i=null==i||i>l[1]?l[1]:i)<l[0]&&(i=l[0]),o.value=i,s&&(o.status=u.axis.scale.isBlank()?"hide":"show")),jP.prototype.render.apply(this,arguments),this._doUpdateAxisPointerClass(t,n,!0)},ZP.prototype.updateAxisPointer=function(t,e,n,r){this._doUpdateAxisPointerClass(t,n,!1)},ZP.prototype.remove=function(t,e){var n=this._axisPointer;n&&n.remove(e)},ZP.prototype.dispose=function(t,e){this._disposeAxisPointer(e),jP.prototype.dispose.apply(this,arguments)},ZP.prototype._doUpdateAxisPointerClass=function(t,e,n){var r,i=ZP.getAxisPointerClass(this.axisPointerClass);i&&((r=(r=GP(r=t))&&r.axisPointerModel)?(this._axisPointer||(this._axisPointer=new i)).render(t,r,e,n):this._disposeAxisPointer(e))},ZP.prototype._disposeAxisPointer=function(t){this._axisPointer&&this._axisPointer.dispose(t),this._axisPointer=null},ZP.registerAxisPointerClass=function(t,e){YP[t]=e},ZP.getAxisPointerClass=function(t){return t&&YP[t]},ZP.type="axis",ZP),KP=Xi(),QP=I,JP=G;function $P(){this._dragging=!1,this.animationThreshold=15}function tN(t,e,n,r){!function t(e,n){if(K(e)&&K(n)){var r=!0;return F(n,(function(n,i){r=r&&t(e[i],n)})),!!r}return e===n}(KP(n).lastProp,r)&&(KP(n).lastProp=r,e?Nh(n,r,t):(n.stopAnimation(),n.attr(r)))}function eN(t,e){t[e.get(["label","show"])?"show":"hide"]()}function nN(t){return{x:t.x||0,y:t.y||0,rotation:t.rotation||0}}function rN(t,e,n){var r=e.get("z"),i=e.get("zlevel");t&&t.traverse((function(t){"group"!==t.type&&(null!=r&&(t.z=r),null!=i&&(t.zlevel=i),t.silent=n)}))}$P.prototype.render=function(t,e,n,r){var i=e.get("value"),o=e.get("status");if(this._axisModel=t,this._axisPointerModel=e,this._api=n,r||this._lastValue!==i||this._lastStatus!==o){this._lastValue=i,this._lastStatus=o;var a=this._group;r=this._handle;if(!o||"hide"===o)return a&&a.hide(),void(r&&r.hide());a&&a.show(),r&&r.show(),o={},this.makeElOption(o,i,t,e,n),r=o.graphicKey,r!==this._lastGraphicKey&&this.clear(n),this._lastGraphicKey=r,r=this._moveAnimation=this.determineAnimation(t,e),a?(r=W(tN,e,r),this.updatePointerEl(a,o,r),this.updateLabelEl(a,o,r,e)):(a=this._group=new ei,this.createPointerEl(a,o,t,e),this.createLabelEl(a,o,t,e),n.getZr().add(a)),rN(a,e,!0),this._renderHandle(i)}},$P.prototype.remove=function(t){this.clear(t)},$P.prototype.dispose=function(t){this.clear(t)},$P.prototype.determineAnimation=function(t,e){var n=e.get("animation"),r=t.axis,i="category"===r.type;e=e.get("snap");return!(!e&&!i)&&("auto"!==n&&null!=n?!0===n:(n=this.animationThreshold,!!(i&&r.getBandWidth()>n)||!!e&&(t=GP(t).seriesDataCount,r=r.getExtent(),Math.abs(r[0]-r[1])/t>n)))},$P.prototype.makeElOption=function(t,e,n,r,i){},$P.prototype.createPointerEl=function(t,e,n,r){var o=e.pointer;o&&(e=KP(t).pointerEl=new i[o.type](QP(e.pointer)),t.add(e))},$P.prototype.createLabelEl=function(t,e,n,r){e.label&&(e=KP(t).labelEl=new Os(QP(e.label)),t.add(e),eN(e,r))},$P.prototype.updatePointerEl=function(t,e,n){t=KP(t).pointerEl,t&&e.pointer&&(t.setStyle(e.pointer.style),n(t,{shape:e.pointer.shape}))},$P.prototype.updateLabelEl=function(t,e,n,r){t=KP(t).labelEl,t&&(t.setStyle(e.label.style),n(t,{x:e.label.x,y:e.label.y}),eN(t,r))},$P.prototype._renderHandle=function(t){if(!this._dragging&&this.updateHandleTransform){var e,n=this._axisPointerModel,r=this._api.getZr(),i=this._handle,o=n.getModel("handle"),a=n.get("status");if(!o.get("show")||!a||"hide"===a)return i&&r.remove(i),void(this._handle=null);this._handle||(e=!0,i=this._handle=Zh(o.get("icon"),{cursor:"move",draggable:!0,onmousemove:function(t){$t(t.event)},onmousedown:JP(this._onHandleDragMove,this,0,0),drift:JP(this._onHandleDragMove,this),ondragend:JP(this._onHandleDragEnd,this)}),r.add(i)),rN(i,n,!1),i.setStyle(o.getItemStyle(null,["color","borderColor","borderWidth","opacity","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"])),n=o.get("size"),X(n)||(n=[n,n]),i.scaleX=n[0]/2,i.scaleY=n[1]/2,Dg(this,"_doDispatchAxisPointer",o.get("throttle")||0,"fixRate"),this._moveHandleToValue(t,e)}},$P.prototype._moveHandleToValue=function(t,e){tN(this._axisPointerModel,!e&&this._moveAnimation,this._handle,nN(this.getHandleTransform(t,this._axisModel,this._axisPointerModel)))},$P.prototype._onHandleDragMove=function(t,e){var n=this._handle;n&&(this._dragging=!0,e=this.updateHandleTransform(nN(n),[t,e],this._axisModel,this._axisPointerModel),this._payloadInfo=e,n.stopAnimation(),n.attr(nN(e)),KP(n).lastProp=null,this._doDispatchAxisPointer())},$P.prototype._doDispatchAxisPointer=function(){var t,e;this._handle&&(t=this._payloadInfo,e=this._axisModel,this._api.dispatchAction({type:"updateAxisPointer",x:t.cursorPoint[0],y:t.cursorPoint[1],tooltipOption:t.tooltipOption,axesInfo:[{axisDim:e.axis.dim,axisIndex:e.componentIndex}]}))},$P.prototype._onHandleDragEnd=function(){var t;this._dragging=!1,this._handle&&(t=this._axisPointerModel.get("value"),this._moveHandleToValue(t),this._api.dispatchAction({type:"hideTip"}))},$P.prototype.clear=function(t){this._lastValue=null,this._lastStatus=null;var e=t.getZr(),n=this._group;t=this._handle;e&&n&&(this._lastGraphicKey=null,n&&e.remove(n),t&&e.remove(t),this._group=null,this._handle=null,this._payloadInfo=null)},$P.prototype.doClear=function(){},$P.prototype.buildLabel=function(t,e,n){return{x:t[n=n||0],y:t[1-n],width:e[n],height:e[1-n]}},Bo=$P;var iN=Math.PI,oN=(aN.prototype.hasBuilder=function(t){return!!sN[t]},aN.prototype.add=function(t){sN[t](this.opt,this.axisModel,this.group,this._transformGroup)},aN.prototype.getGroup=function(){return this.group},aN.innerTextLayout=function(t,e,n){var r;t=_i(e-t),n=vi(t)?(r=0<n?"top":"bottom","center"):vi(t-iN)?(r=0<n?"bottom":"top","center"):(r="middle",0<t&&t<iN?0<n?"right":"left":0<n?"left":"right");return{rotation:t,textAlign:n,textVerticalAlign:r}},aN.makeAxisEventDataBase=function(t){var e={componentType:t.mainType,componentIndex:t.componentIndex};return e[t.mainType+"Index"]=t.componentIndex,e},aN.isLabelSilent=function(t){var e=t.get("tooltip");return t.get("silent")||!(t.get("triggerEvent")||e&&e.show)},aN);function aN(t,e){this.group=new ei,this.opt=e,this.axisModel=t,L(e,{labelOffset:0,nameDirection:1,tickDirection:1,labelDirection:1,silent:!0,handleAutoShown:function(){return!0}}),e=new ei({x:e.position[0],y:e.position[1],rotation:e.rotation}),e.updateTransform(),this._transformGroup=e}var sN={axisLine:function(t,e,n,r){var i,o,a,s,l,u=e.get(["axisLine","show"]);(u="auto"===u&&t.handleAutoShown?t.handleAutoShown("axisLine"):u)&&(u=e.axis.getExtent(),r=r.transform,i=[u[0],0],u=[u[1],0],r&&(Dt(i,i,r),Dt(u,u,r)),o=R({lineCap:"round"},e.getModel(["axisLine","lineStyle"]).getLineStyle()),(r=new Vu({subPixelOptimize:!0,shape:{x1:i[0],y1:i[1],x2:u[0],y2:u[1]},style:o,strokeContainThreshold:t.strokeContainThreshold||5,silent:!0,z2:1})).anid="line",n.add(r),a=e.get(["axisLine","symbol"]),r=e.get(["axisLine","symbolSize"]),"number"==typeof(e=e.get(["axisLine","symbolOffset"])||0)&&(e=[e,e]),null!=a&&("string"==typeof a&&(a=[a,a]),s=(r="string"==typeof r||"number"==typeof r?[r,r]:r)[0],l=r[1],F([{rotate:t.rotation+Math.PI/2,offset:e[0],r:0},{rotate:t.rotation-Math.PI/2,offset:e[1],r:Math.sqrt((i[0]-u[0])*(i[0]-u[0])+(i[1]-u[1])*(i[1]-u[1]))}],(function(e,r){var u;"none"!==a[r]&&null!=a[r]&&(u=qm(a[r],-s/2,-l/2,s,l,o.stroke,!0),r=e.r+e.offset,u.attr({rotation:e.rotate,x:i[0]+r*Math.cos(t.rotation),y:i[1]-r*Math.sin(t.rotation),silent:!0,z2:11}),n.add(u))}))))},axisTickLabel:function(t,e,n,r){var i,o,a,s,l,u,h,c,d=function(t,e,n,r){var i=n.axis,o=n.getModel("axisTick"),a=o.get("show");if("auto"===a&&r.handleAutoShown&&(a=r.handleAutoShown("axisTick")),a&&!i.scale.isBlank()){a=o.getModel("lineStyle"),o=r.tickDirection*o.get("length");for(var s=cN(i.getTicksCoords(),e.transform,o,L(a.getLineStyle(),{stroke:n.get(["axisLine","lineStyle","color"])}),"ticks"),l=0;l<s.length;l++)t.add(s[l]);return s}}(n,r,e,t),p=function(t,e,n,r){var i=n.axis;if(et(r.axisLabelShow,n.get(["axisLabel","show"]))&&!i.scale.isBlank()){var o=n.getModel("axisLabel"),a=o.get("margin"),s=i.getViewLabels(),l=(et(r.labelRotate,o.get("rotate"))||0)*iN/180,u=oN.innerTextLayout(r.rotation,l,r.labelDirection),h=n.getCategories&&n.getCategories(!0),c=[],d=oN.isLabelSilent(n),p=n.get("triggerEvent");return F(s,(function(s,l){var f="ordinal"===i.scale.type?i.scale.getRawOrdinalNumber(s.tickValue):s.tickValue,g=s.formattedLabel,m=s.rawLabel,y=o;h&&h[f]&&K(_=h[f])&&_.textStyle&&(y=new xc(_.textStyle,o,n.ecModel));s=y.getTextColor()||n.get(["axisLine","lineStyle","color"]);var _=i.dataToCoord(f);s=new Os({x:_,y:r.labelOffset+r.labelDirection*a,rotation:u.rotation,silent:d,z2:10,style:nc(y,{text:g,align:y.getShallow("align",!0)||u.textAlign,verticalAlign:y.getShallow("verticalAlign",!0)||y.getShallow("baseline",!0)||u.textVerticalAlign,fill:"function"==typeof s?s("category"===i.type?m:"value"===i.type?f+"":f,l):s})});s.anid="label_"+f,p&&((f=oN.makeAxisEventDataBase(n)).targetType="axisLabel",f.value=m,Ps(s).eventData=f),e.add(s),s.updateTransform(),c.push(s),t.add(s),s.decomposeTransform()})),c}}(n,r,e,t);o=p,a=d,Ux((i=e).axis)||(s=i.get(["axisLabel","showMinLabel"]),l=i.get(["axisLabel","showMaxLabel"]),a=a||[],u=(o=o||[])[0],h=o[1],c=o[o.length-1],p=o[o.length-2],d=a[0],i=a[1],o=a[a.length-1],a=a[a.length-2],!1===s?(lN(u),lN(d)):uN(u,h)&&(s?(lN(h),lN(i)):(lN(u),lN(d))),!1===l?(lN(c),lN(o)):uN(p,c)&&(l?(lN(p),lN(a)):(lN(c),lN(o)))),function(t,e,n,r){var i=n.axis,o=n.getModel("minorTick");if(o.get("show")&&!i.scale.isBlank()){var a=i.getMinorTicksCoords();if(a.length){i=o.getModel("lineStyle");for(var s=r*o.get("length"),l=L(i.getLineStyle(),L(n.getModel("axisTick").getLineStyle(),{stroke:n.get(["axisLine","lineStyle","color"])})),u=0;u<a.length;u++)for(var h=cN(a[u],e.transform,s,l,"minorticks_"+u),c=0;c<h.length;c++)t.add(h[c])}}}(n,r,e,t.tickDirection)},axisName:function(t,e,n,r){var i,o,a,s,l,u,h,c,d=et(t.axisName,e.get("name"));d&&(u=e.get("nameLocation"),a=t.nameDirection,i=e.getModel("nameTextStyle"),s=e.get("nameGap")||0,o=(l=e.axis.getExtent())[0]>l[1]?-1:1,o=["start"===u?l[0]-o*s:"end"===u?l[1]+o*s:(l[0]+l[1])/2,hN(u)?t.labelOffset+a*s:0],null!=(s=e.get("nameRotate"))&&(s=s*iN/180),hN(u)?c=oN.innerTextLayout(t.rotation,null!=s?s:t.rotation,a):(c=function(t,e,n,r){var i;t=_i(n-t),r=r[0]>r[1],r="start"===e&&!r||"start"!==e&&r;return r=vi(t-iN/2)?(i=r?"bottom":"top","center"):vi(t-1.5*iN)?(i=r?"top":"bottom","center"):(i="middle",t<1.5*iN&&iN/2<t?r?"left":"right":r?"right":"left"),{rotation:t,textAlign:r,textVerticalAlign:i}}(t.rotation,u,s||0,l),null!=(h=t.axisNameAvailableWidth)&&(h=Math.abs(h/Math.sin(c.rotation)),isFinite(h)||(h=null))),a=i.getFont(),s=(u=e.get("nameTruncate",!0)||{}).ellipsis,l=et(t.nameTruncateMaxWidth,u.maxWidth,h),t=e.get("tooltip",!0),(h={componentType:u=e.mainType,name:d,$vars:["name"]})[u+"Index"]=e.componentIndex,(c=new Os({x:o[0],y:o[1],rotation:c.rotation,silent:oN.isLabelSilent(e),style:nc(i,{text:d,font:a,overflow:"truncate",width:l,ellipsis:s,fill:i.getTextColor()||e.get(["axisLine","lineStyle","color"]),align:i.get("align")||c.textAlign,verticalAlign:i.get("verticalAlign")||c.textVerticalAlign}),z2:1})).tooltip=t&&t.show?R({content:d,formatter:function(){return d},formatterParams:h},t):null,c.__fullText=d,c.anid="name",e.get("triggerEvent")&&((e=oN.makeAxisEventDataBase(e)).targetType="axisName",e.name=d,Ps(c).eventData=e),r.add(c),c.updateTransform(),n.add(c),c.decomposeTransform())}};function lN(t){t&&(t.ignore=!0)}function uN(t,e){var n=t&&t.getBoundingRect().clone(),r=e&&e.getBoundingRect().clone();if(n&&r){var i=_e([]);return Te(i,i,-t.rotation),n.applyTransform(xe([],i,t.getLocalTransform())),r.applyTransform(xe([],i,e.getLocalTransform())),n.intersect(r)}}function hN(t){return"middle"===t||"center"===t}function cN(t,e,n,r,i){for(var o=[],a=[],s=[],l=0;l<t.length;l++){var u=t[l].coord;a[0]=u,s[a[1]=0]=u,s[1]=n,e&&(Dt(a,a,e),Dt(s,s,e)),u=new Vu({subPixelOptimize:!0,shape:{x1:a[0],y1:a[1],x2:s[0],y2:s[1]},style:r,z2:2,autoBatch:!0,silent:!0}),u.anid=i+"_"+t[l].tickValue,o.push(u)}return o}var dN=oN;function pN(t,e,n,r,i){var o=fN(n.get("value"),e.axis,e.ecModel,n.get("seriesDataIndices"),{precision:n.get(["label","precision"]),formatter:n.get(["label","formatter"])}),a=n.getModel("label"),s=id(a.get("padding")||0),l=a.getFont(),u=Zn(o,l),h=i.position,c=u.width+s[1]+s[3];n=u.height+s[0]+s[2],u=i.align;"right"===u&&(h[0]-=c),"center"===u&&(h[0]-=c/2),u=i.verticalAlign,"bottom"===u&&(h[1]-=n),"middle"===u&&(h[1]-=n/2),i=h,u=c,c=n,r=(n=r).getWidth(),n=n.getHeight(),i[0]=Math.min(i[0]+u,r)-u,i[1]=Math.min(i[1]+c,n)-c,i[0]=Math.max(i[0],0),i[1]=Math.max(i[1],0),i=a.get("backgroundColor"),i&&"auto"!==i||(i=e.get(["axisLine","lineStyle","color"])),t.label={x:h[0],y:h[1],style:nc(a,{text:o,font:l,fill:a.getTextColor(),padding:s,backgroundColor:i}),z2:10}}function fN(t,e,n,r,i){t=e.scale.parse(t);var o,a=e.scale.getLabel({value:t},{precision:i.precision});i=i.formatter;return i&&(o={value:zx(e,{value:t}),axisDimension:e.dim,axisIndex:e.index,seriesData:[]},F(r,(function(t){var e=n.getSeriesByIndex(t.seriesIndex);t=t.dataIndexInside,t=e&&e.getDataParams(t);t&&o.seriesData.push(t)})),Y(i)?a=i.replace("{value}",a):j(i)&&(a=i(o))),a}function gN(t,e,n){var r=ye();return Te(r,r,n.rotation),be(r,r,n.position),Uh([t.dataToCoord(e),(n.labelOffset||0)+(n.labelDirection||1)*(n.labelMargin||0)],r)}function mN(t,e,n){n=n||{};var r=t.coordinateSystem,i=e.axis,o={},a=i.getAxesOnZeroOf()[0],s=i.position,l=a?"onZero":s,u=i.dim,h=r.getRect();t=[h.x,h.x+h.width,h.y,h.y+h.height],i={left:0,right:1,top:0,bottom:1,onZero:2},r=e.get("offset")||0,h="x"===u?[t[2]-r,t[3]+r]:[t[0]-r,t[1]+r];return a&&(r=a.toGlobalCoord(a.dataToCoord(0)),h[i.onZero]=Math.max(Math.min(r,h[1]),h[0])),o.position=["y"===u?h[i[l]]:t[0],"x"===u?h[i[l]]:t[3]],o.rotation=Math.PI/2*("x"===u?0:1),o.labelDirection=o.tickDirection=o.nameDirection={top:-1,bottom:1,left:-1,right:1}[s],o.labelOffset=a?h[i[s]]-h[i.onZero]:0,e.get(["axisTick","inside"])&&(o.tickDirection=-o.tickDirection),et(n.labelInside,e.get(["axisLabel","inside"]))&&(o.labelDirection=-o.labelDirection),e=e.get(["axisLabel","rotate"]),o.labelRotate="top"===l?-e:e,o.z2=1,o}function yN(t){return"cartesian2d"===t.get("coordinateSystem")}function _N(t){var e={xAxisModel:null,yAxisModel:null};return F(e,(function(n,r){var i=r.replace(/Model$/,"");i=t.getReferringComponents(i,Zi).models[0];e[r]=i})),e}var vN;h(xN,vN=Bo),xN.prototype.makeElOption=function(t,e,n,r,i){var o,a,s=n.axis,l=s.grid,u=r.get("type"),h=bN(l,s).getOtherAxis(s).getGlobalExtent(),c=s.toGlobalCoord(s.dataToCoord(e,!0));u&&"none"!==u&&(a=(d=r).get("type"),d=d.getModel(a+"Style"),"line"===a?(o=d.getLineStyle()).fill=null:"shadow"===a&&((o=d.getAreaStyle()).stroke=null),o=o,(d=TN[u](s,c,h)).style=o,t.graphicKey=d.type,t.pointer=d);var d=mN(l.model,n);l=e,e=t,t=d,d=n,n=r,r=i,i=dN.innerTextLayout(t.rotation,0,t.labelDirection),t.labelMargin=n.get(["label","margin"]),pN(e,d,n,r,{position:gN(d.axis,l,t),align:i.textAlign,verticalAlign:i.textVerticalAlign})},xN.prototype.getHandleTransform=function(t,e,n){var r=mN(e.axis.grid.model,e,{labelInside:!1});return r.labelMargin=n.get(["handle","margin"]),t=gN(e.axis,t,r),{x:t[0],y:t[1],rotation:r.rotation+(r.labelDirection<0?Math.PI:0)}},xN.prototype.updateHandleTransform=function(t,e,n,r){var i=n.axis,o=i.grid,a=i.getGlobalExtent(!0);n=bN(o,i).getOtherAxis(i).getGlobalExtent(),o="x"===i.dim?0:1,i=[t.x,t.y];return i[o]+=e[o],i[o]=Math.min(a[1],i[o]),i[o]=Math.max(a[0],i[o]),n=(n[1]+n[0])/2,n=[n,n],n[o]=i[o],{x:i[0],y:i[1],rotation:t.rotation,cursorPoint:n,tooltipOption:[{verticalAlign:"middle"},{align:"center"}][o]}},pA=xN;function xN(){return null!==vN&&vN.apply(this,arguments)||this}function bN(t,e){var n={};return n[e.dim+"AxisIndex"]=e.index,t.getCartesian(n)}var TN={line:function(t,e,n){var r;return{type:"Line",subPixelOptimize:!0,shape:(r=[e,n[0]],n=[e,n[1]],t=wN(t),{x1:r[t=t||0],y1:r[1-t],x2:n[t],y2:n[1-t]})}},shadow:function(t,e,n){var r=Math.max(1,t.getBandWidth()),i=n[1]-n[0];return{type:"Rect",shape:(n=[e-r/2,n[0]],i=[r,i],t=wN(t),{x:n[t=t||0],y:n[1-t],width:i[t],height:i[1-t]})}}};function wN(t){return"x"===t.dim?0:1}var SN,MN=pA;function AN(){var t=null!==SN&&SN.apply(this,arguments)||this;return t.type=AN.type,t}var CN,EN=(h(AN,SN=Ld),AN.type="axisPointer",AN.defaultOption={show:"auto",zlevel:0,z:50,type:"line",snap:!1,triggerTooltip:!0,value:null,status:null,link:[],animation:null,animationDurationUpdate:200,lineStyle:{color:"#B9BEC9",width:1,type:"dashed"},shadowStyle:{color:"rgba(210,219,238,0.2)"},label:{show:!0,formatter:null,precision:"auto",margin:3,color:"#fff",padding:[5,7,5,7],backgroundColor:"auto",borderColor:null,borderWidth:0,borderRadius:3},handle:{show:!1,icon:"M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7v-1.2h6.6z M13.3,22H6.7v-1.2h6.6z M13.3,19.6H6.7v-1.2h6.6z",size:45,margin:50,color:"#333",shadowBlur:3,shadowColor:"#aaa",shadowOffsetX:0,shadowOffsetY:2,throttle:40}},AN),IN=Xi(),DN=F;function RN(t,e,n){var r,i,o;function a(t,e){i.on(t,(function(t){var n,r,a,s=(n=o,{dispatchAction:a=function(t){var e=r[t.type];e?e.push(t):(t.dispatchAction=a,n.dispatchAction(t))},pendings:r={showTip:[],hideTip:[]}});DN(IN(i).records,(function(n){n&&e(n,t,s.dispatchAction)})),function(t,e){var n,r=t.showTip.length,i=t.hideTip.length;r?n=t.showTip[r-1]:i&&(n=t.hideTip[i-1]),n&&(n.dispatchAction=null,e.dispatchAction(n))}(s.pendings,o)}))}g.node||(r=e.getZr(),IN(r).records||(IN(r).records={}),o=e,IN(i=r).initialized||(IN(i).initialized=!0,a("click",W(ON,"click")),a("mousemove",W(ON,"mousemove")),a("globalout",LN)),(IN(r).records[t]||(IN(r).records[t]={})).handler=n)}function LN(t,e,n){t.handler("leave",null,n)}function ON(t,e,n,r){e.handler(t,n,r)}function PN(t,e){g.node||(e=e.getZr(),(IN(e).records||{})[t]&&(IN(e).records[t]=null))}function NN(){var t=null!==CN&&CN.apply(this,arguments)||this;return t.type=NN.type,t}var kN=(h(NN,CN=gg),NN.prototype.render=function(t,e,n){e=e.getComponent("tooltip");var r=t.get("triggerOn")||e&&e.get("triggerOn")||"mousemove|click";RN("axisPointer",n,(function(t,e,n){"none"!==r&&("leave"===t||0<=r.indexOf(t))&&n({type:"updateAxisPointer",currTrigger:t,x:e&&e.offsetX,y:e&&e.offsetY})}))},NN.prototype.remove=function(t,e){PN("axisPointer",e)},NN.prototype.dispose=function(t,e){PN("axisPointer",e)},NN.type="axisPointer",NN);function BN(t,e){var n=[],r=t.seriesIndex;if(null==r||!(a=e.getSeriesByIndex(r)))return{point:[]};var i=a.getData(),o=Wi(i,t);if(null==o||o<0||X(o))return{point:[]};var a,s=i.getItemGraphicEl(o);e=a.coordinateSystem;return a.getTooltipPosition?n=a.getTooltipPosition(o)||[]:e&&e.dataToPoint?n=t.isStacked?(r=e.getBaseAxis(),a=e.getOtherAxis(r).dim,t=r.dim,r="x"===a||"radius"===a?1:0,a=i.mapDimension(t),(t=[])[r]=i.get(a,o),t[1-r]=i.get(i.getCalculationInfo("stackResultDimension"),o),e.dataToPoint(t)||[]):e.dataToPoint(i.getValues(z(e.dimensions,(function(t){return i.mapDimension(t)})),o))||[]:s&&((o=s.getBoundingRect().clone()).applyTransform(s.transform),n=[o.x+o.width/2,o.y+o.height/2]),{point:n,el:s}}var FN,zN=Xi();function HN(t,e,n){var r=t.currTrigger,i=[t.x,t.y],o=t,a=t.dispatchAction||G(n.dispatchAction,n),s=e.getComponent("axisPointer").coordSysAxesInfo;if(s){XN(i)&&(i=BN({seriesIndex:o.seriesIndex,dataIndex:o.dataIndex},e).point);var l=XN(i),u=o.axesInfo,h=s.axesInfo,c="leave"===r||XN(i),d={},p={},f=(e={list:[],map:{}},{showPointer:W(UN,p),showTooltip:W(GN,e)});F(s.coordSysMap,(function(t,e){var n=l||t.containPoint(i);F(s.coordSysAxesInfo[e],(function(t,e){var r=t.axis,o=function(t,e){for(var n=0;n<(t||[]).length;n++){var r=t[n];if(e.axis.dim===r.axisDim&&e.axis.model.componentIndex===r.axisIndex)return r}}(u,t);c||!n||u&&!o||null!=(o=null!=(o=o&&o.value)||l?o:r.pointToData(i))&&VN(t,o,f,!1,d)}))}));var g,m,y={};return F(h,(function(t,e){var n=t.linkGroup;n&&!p[e]&&F(n.axesInfo,(function(e,r){r=p[r],e!==t&&r&&(r=r.value,n.mapper&&(r=t.axis.scale.parse(n.mapper(r,WN(e),WN(t)))),y[t.key]=r)}))})),F(y,(function(t,e){VN(h[e],t,f,!0,d)})),g=p,o=h,m=d.axesInfo=[],F(o,(function(t,e){var n=t.axisPointerModel.option;e=g[e];e?(t.useHandle||(n.status="show"),n.value=e.value,n.seriesDataIndices=(e.payloadBatch||[]).slice()):t.useHandle||(n.status="hide"),"show"===n.status&&m.push({axisDim:t.axis.dim,axisIndex:t.axis.model.componentIndex,value:n.value})})),r=e,o=t,e=a,!XN(t=i)&&r.list.length?(a=((r.list[0].dataByAxis[0]||{}).seriesDataIndices||[])[0]||{},e({type:"showTip",escapeConnect:!0,x:t[0],y:t[1],tooltipOption:o.tooltipOption,position:o.position,dataIndexInside:a.dataIndexInside,dataIndex:a.dataIndex,seriesIndex:a.seriesIndex,dataByCoordSys:r.list})):e({type:"hideTip"}),function(t,e){var n=e.getZr(),r="axisPointerLastHighlights",i=zN(n)[r]||{},o=zN(n)[r]={};F(t,(function(t,e){t=t.axisPointerModel.option,"show"===t.status&&F(t.seriesDataIndices,(function(t){var e=t.seriesIndex+" | "+t.dataIndex;o[e]=t}))}));var a=[],s=[];F(i,(function(t,e){o[e]||s.push(t)})),F(o,(function(t,e){i[e]||a.push(t)})),s.length&&e.dispatchAction({type:"downplay",escapeConnect:!0,notBlur:!0,batch:s}),a.length&&e.dispatchAction({type:"highlight",escapeConnect:!0,notBlur:!0,batch:a})}(h,n),d}}function VN(t,e,n,r,i){var o,a,s,l,u,h,c,d,p,f,g=t.axis;!g.scale.isBlank()&&g.containData(e)&&(t.involveSeries?(f=(a=e,s=t.axis,l=s.dim,u=a,h=[],c=Number.MAX_VALUE,d=-1,F(t.seriesModels,(function(t,e){var n=t.getData().mapDimensionsAll(l);if(t.getAxisTooltipData)var r=t.getAxisTooltipData(n,a,s),i=r.dataIndices,o=r.nestestValue;else{if(!(i=t.getData().indicesOfNearest(n[0],a,"category"===s.type?.5:null)).length)return;o=t.getData().get(n[0],i[0])}null!=o&&isFinite(o)&&(r=a-o,(n=Math.abs(r))<=c&&((n<c||0<=r&&d<0)&&(c=n,d=r,u=o,h.length=0),F(i,(function(e){h.push({seriesIndex:t.seriesIndex,dataIndexInside:e,dataIndex:t.getData().getRawIndex(e)})}))))})),o={payloadBatch:h,snapToValue:u}).snapToValue,(p=o.payloadBatch)[0]&&null==i.seriesIndex&&R(i,p[0]),!r&&t.snap&&g.containData(f)&&null!=f&&(e=f),n.showPointer(t,e,p),n.showTooltip(t,o,f)):n.showPointer(t,e))}function UN(t,e,n,r){t[e.key]={value:n,payloadBatch:r}}function GN(t,e,n,r){var i,o=n.payloadBatch,a=e.axis,s=a.model,l=e.axisPointerModel;e.triggerTooltip&&o.length&&(n=XP(i=e.coordSys.model),(e=t.map[n])||(e=t.map[n]={coordSysId:i.id,coordSysIndex:i.componentIndex,coordSysType:i.type,coordSysMainType:i.mainType,dataByAxis:[]},t.list.push(e)),e.dataByAxis.push({axisDim:a.dim,axisIndex:s.componentIndex,axisType:s.type,axisId:s.id,value:r,valueLabelOpt:{precision:l.get(["label","precision"]),formatter:l.get(["label","formatter"])},seriesDataIndices:o.slice()}))}function WN(t){var e=t.axis.model,n={};t=n.axisDim=t.axis.dim;return n.axisIndex=n[t+"AxisIndex"]=e.componentIndex,n.axisName=n[t+"AxisName"]=e.name,n.axisId=n[t+"AxisId"]=e.id,n}function XN(t){return!t||null==t[0]||isNaN(t[0])||null==t[1]||isNaN(t[1])}function jN(t){qP.registerAxisPointerClass("CartesianAxisPointer",MN),t.registerComponentModel(EN),t.registerComponentView(kN),t.registerPreprocessor((function(t){var e;t&&(t.axisPointer&&0!==t.axisPointer.length||(t.axisPointer={}),(e=t.axisPointer.link)&&!X(e)&&(t.axisPointer.link=[e]))})),t.registerProcessor(t.PRIORITY.PROCESSOR.STATISTIC,(function(t,e){t.getComponent("axisPointer").coordSysAxesInfo=VP(t,e)})),t.registerAction({type:"updateAxisPointer",event:"updateAxisPointer",update:":updateAxisPointer"},HN)}function YN(){var t=null!==FN&&FN.apply(this,arguments)||this;return t.type=YN.type,t}var ZN=(h(YN,FN=Ld),YN.type="tooltip",YN.dependencies=["axisPointer"],YN.defaultOption={zlevel:0,z:60,show:!0,showContent:!0,trigger:"item",triggerOn:"mousemove|click",alwaysShowContent:!1,displayMode:"single",renderMode:"auto",confine:null,showDelay:0,hideDelay:100,transitionDuration:.4,enterable:!1,backgroundColor:"#fff",shadowBlur:10,shadowColor:"rgba(0, 0, 0, .2)",shadowOffsetX:1,shadowOffsetY:2,borderRadius:4,borderWidth:1,padding:null,extraCssText:"",axisPointer:{type:"line",axis:"auto",animation:"auto",animationDurationUpdate:200,animationEasingUpdate:"exponentialOut",crossStyle:{color:"#999",width:1,type:"dashed",textStyle:{}}},textStyle:{color:"#666",fontSize:14}},YN);function qN(t){var e=t.get("confine");return null!=e?e:"richText"===t.get("renderMode")}var KN=["-ms-","-moz-","-o-","-webkit-",""];function QN(t,e,n){var r,i=[],o=t.get("transitionDuration"),a=t.get("backgroundColor"),s=t.get("shadowBlur"),l=t.get("shadowColor"),u=t.get("shadowOffsetX"),h=t.get("shadowOffsetY"),c=t.getModel("textStyle"),d=Jf(t,"html");return i.push("box-shadow:"+u+"px "+h+"px "+s+"px "+l),e&&o&&i.push((r="opacity "+(e=o)/2+"s "+(o="cubic-bezier(0.23, 1, 0.32, 1)")+",visibility "+e/2+"s "+o,n||(r+=",left "+e+"s "+o+",top "+e+"s "+o),z(KN,(function(t){return t+"transition:"+r})).join(";"))),a&&(g.canvasSupported?i.push("background-Color:"+a):(i.push("background-Color:#"+rn(a)),i.push("filter:alpha(opacity=70)"))),F(["width","color","radius"],(function(e){var n,r="border-"+e,o=(o=((o=r)||"").toLowerCase().replace(/-(.)/g,(function(t,e){return e.toUpperCase()})),o=n&&o?o.charAt(0).toUpperCase()+o.slice(1):o);o=t.get(o);null!=o&&i.push(r+":"+o+("color"===e?"":"px"))})),i.push(function(t){var e=[],n=t.get("fontSize");(o=t.getTextColor())&&e.push("color:"+o),e.push("font:"+t.getFont()),n&&e.push("line-height:"+Math.round(3*n/2)+"px");var r=t.get("textShadowColor"),i=t.get("textShadowBlur")||0,o=t.get("textShadowOffsetX")||0;n=t.get("textShadowOffsetY")||0;return r&&i&&e.push("text-shadow:"+o+"px "+n+"px "+i+"px "+r),F(["decoration","align"],(function(n){var r=t.get(n);r&&e.push("text-"+n+":"+r)})),e.join(";")}(c)),null!=d&&i.push("padding:"+id(d).join("px ")+"px"),i.join(";")+";"}function JN(t,e,n,r,i){var o,a,s=e&&e.painter;n?(o=s&&s.getViewportRoot())&&(a=t,n=document.body,Gt(Ut,o,r,i,!0)&&Gt(a,n,Ut[0],Ut[1])):(t[0]=r,t[1]=i,(s=s&&s.getViewportRootOffset())&&(t[0]+=s.offsetLeft,t[1]+=s.offsetTop)),t[2]=t[0]/e.getWidth(),t[3]=t[1]/e.getHeight()}function $N(t,e,n){if(this._show=!1,this._styleCoord=[0,0,0,0],this._enterable=!0,this._firstShow=!0,this._longHide=!0,g.wxa)return null;var r=document.createElement("div");r.domBelongToZr=!0,this.el=r;var i=this._zr=e.getZr();n=this._appendToBody=n&&n.appendToBody;JN(this._styleCoord,i,n,e.getWidth()/2,e.getHeight()/2),(n?document.body:t).appendChild(r),this._container=t;var o=this;r.onmouseenter=function(){o._enterable&&(clearTimeout(o._hideTimeout),o._show=!0),o._inContent=!0},r.onmousemove=function(t){var e;t=t||window.event,o._enterable||(e=i.handler,Qt(i.painter.getViewportRoot(),t,!0),e.dispatch("mousemove",t))},r.onmouseleave=function(){o._inContent=!1,o._enterable&&o._show&&o.hideLater(o._hideDelay)}}var tk=($N.prototype.update=function(t){var e=this._container,n=e.currentStyle||document.defaultView.getComputedStyle(e);e=e.style;"absolute"!==e.position&&"absolute"!==n.position&&(e.position="relative"),t.get("alwaysShowContent")&&this._moveIfResized(),this.el.className=t.get("className")||""},$N.prototype.show=function(t,e){clearTimeout(this._hideTimeout),clearTimeout(this._longHideTimeout);var n=this.el,r=this._styleCoord,i=n.offsetHeight/2;e=dd(e),n.style.cssText="position:absolute;display:block;border-style:solid;white-space:nowrap;z-index:9999999;"+QN(t,!this._firstShow,this._longHide)+";left:"+r[0]+"px;top:"+(r[1]-i)+"px;border-color: "+e+";"+(t.get("extraCssText")||""),n.style.display=n.innerHTML?"block":"none",n.style.pointerEvents=this._enterable?"auto":"none",this._show=!0,this._firstShow=!1,this._longHide=!1},$N.prototype.setContent=function(t,e,n,r,i){if(null!=t){var o=this.el;if(Y(i)&&"item"===n.get("trigger")&&!qN(n)&&(t+=function(t,e,n){if(!Y(n)||"inside"===n)return"";e=dd(e);n=r="left"===(r=n)?"right":"right"===r?"left":"top"===r?"bottom":"top";var r="",i="";i=-1<P(["left","right"],n)?(r=n+":-6px;top:50%;","translateY(-50%) rotate("+("left"==n?-225:-45)+"deg)"):(r=n+":-6px;left:50%;","translateX(-50%) rotate("+("top"==n?225:45)+"deg)");return'<div style="'+["position:absolute;width:10px;height:10px;",""+r+(i=z(KN,(function(t){return t+"transform:"+i})).join(";"))+";","border-bottom: "+e+" solid 1px;","border-right: "+e+" solid 1px;","background-color: "+t+";","box-shadow: 8px 8px 16px -3px #000;"].join("")+'"></div>'}(n.get("backgroundColor"),r,i)),Y(t))o.innerHTML=t;else if(t){o.innerHTML="",X(t)||(t=[t]);for(var a=0;a<t.length;a++)$(t[a])&&t[a].parentNode!==o&&o.appendChild(t[a])}}},$N.prototype.setEnterable=function(t){this._enterable=t},$N.prototype.getSize=function(){var t=this.el;return[t.clientWidth,t.clientHeight]},$N.prototype.moveTo=function(t,e){var n=this._styleCoord;JN(n,this._zr,this._appendToBody,t,e),null!=n[0]&&null!=n[1]&&((e=this.el.style).left=n[0].toFixed(0)+"px",e.top=n[1].toFixed(0)+"px")},$N.prototype._moveIfResized=function(){var t=this._styleCoord[2],e=this._styleCoord[3];this.moveTo(t*this._zr.getWidth(),e*this._zr.getHeight())},$N.prototype.hide=function(){var t=this;this.el.style.visibility="hidden",this.el.style.opacity="0",this._show=!1,this._longHideTimeout=setTimeout((function(){return t._longHide=!0}),500)},$N.prototype.hideLater=function(t){!this._show||this._inContent&&this._enterable||(t?(this._hideDelay=t,this._show=!1,this._hideTimeout=setTimeout(G(this.hide,this),t)):this.hide())},$N.prototype.isShow=function(){return this._show},$N.prototype.dispose=function(){this.el.parentNode.removeChild(this.el)},$N.prototype.getOuterSize=function(){var t,e=this.el.clientWidth,n=this.el.clientHeight;return document.defaultView&&document.defaultView.getComputedStyle&&(t=document.defaultView.getComputedStyle(this.el))&&(e+=parseInt(t.borderLeftWidth,10)+parseInt(t.borderRightWidth,10),n+=parseInt(t.borderTopWidth,10)+parseInt(t.borderBottomWidth,10)),{width:e,height:n}},$N);function ek(t){this._show=!1,this._styleCoord=[0,0,0,0],this._enterable=!0,this._zr=t.getZr(),ik(this._styleCoord,this._zr,t.getWidth()/2,t.getHeight()/2)}function nk(t){return Math.max(0,t)}function rk(t){var e=nk(t.shadowBlur||0),n=nk(t.shadowOffsetX||0);t=nk(t.shadowOffsetY||0);return{left:nk(e-n),right:nk(e+n),top:nk(e-t),bottom:nk(e+t)}}function ik(t,e,n,r){t[0]=n,t[1]=r,t[2]=t[0]/e.getWidth(),t[3]=t[1]/e.getHeight()}var ok,ak=(ek.prototype.update=function(t){t.get("alwaysShowContent")&&this._moveIfResized()},ek.prototype.show=function(){this._hideTimeout&&clearTimeout(this._hideTimeout),this.el.show(),this._show=!0},ek.prototype.setContent=function(t,e,n,r,i){K(t)&&xf(""),this.el&&this._zr.remove(this.el);var o=n.getModel("textStyle");this.el=new Os({style:{rich:e.richTextStyles,text:t,lineHeight:22,backgroundColor:n.get("backgroundColor"),borderRadius:n.get("borderRadius"),borderWidth:1,borderColor:r,shadowColor:n.get("shadowColor"),shadowBlur:n.get("shadowBlur"),shadowOffsetX:n.get("shadowOffsetX"),shadowOffsetY:n.get("shadowOffsetY"),textShadowColor:o.get("textShadowColor"),textShadowBlur:o.get("textShadowBlur")||0,textShadowOffsetX:o.get("textShadowOffsetX")||0,textShadowOffsetY:o.get("textShadowOffsetY")||0,fill:n.get(["textStyle","color"]),padding:Jf(n,"richText"),verticalAlign:"top",align:"left"},z:n.get("z")}),this._zr.add(this.el);var a=this;this.el.on("mouseover",(function(){a._enterable&&(clearTimeout(a._hideTimeout),a._show=!0),a._inContent=!0})),this.el.on("mouseout",(function(){a._enterable&&a._show&&a.hideLater(a._hideDelay),a._inContent=!1}))},ek.prototype.setEnterable=function(t){this._enterable=t},ek.prototype.getSize=function(){var t=this.el,e=this.el.getBoundingRect();t=rk(t.style);return[e.width+t.left+t.right,e.height+t.top+t.bottom]},ek.prototype.moveTo=function(t,e){var n,r,i=this.el;i&&(ik(n=this._styleCoord,this._zr,t,e),t=n[0],e=n[1],n=nk((r=i.style).borderWidth||0),r=rk(r),i.x=t+n+r.left,i.y=e+n+r.top,i.markRedraw())},ek.prototype._moveIfResized=function(){var t=this._styleCoord[2],e=this._styleCoord[3];this.moveTo(t*this._zr.getWidth(),e*this._zr.getHeight())},ek.prototype.hide=function(){this.el&&this.el.hide(),this._show=!1},ek.prototype.hideLater=function(t){!this._show||this._inContent&&this._enterable||(t?(this._hideDelay=t,this._show=!1,this._hideTimeout=setTimeout(G(this.hide,this),t)):this.hide())},ek.prototype.isShow=function(){return this._show},ek.prototype.getOuterSize=function(){var t=this.getSize();return{width:t[0],height:t[1]}},ek.prototype.dispose=function(){this._zr.remove(this.el)},ek),sk=G,lk=F,uk=hi,hk=new bs({shape:{x:-1,y:-1,width:2,height:2}});function ck(){var t=null!==ok&&ok.apply(this,arguments)||this;return t.type=ck.type,t}function dk(t){for(var e=t.pop();t.length;){var n=t.pop();n&&(Y(n=n instanceof xc?n.get("tooltip",!0):n)&&(n={formatter:n}),e=new xc(n,e,e.ecModel))}return e}function pk(t,e){return t.dispatchAction||G(e.dispatchAction,e)}function fk(t){return"center"===t||"middle"===t}var gk=(h(ck,ok=gg),ck.prototype.init=function(t,e){var n;g.node||(t=(n=t.getComponent("tooltip")).get("renderMode"),this._renderMode="auto"===(t=t)?g.domSupported?"html":"richText":t||"html",this._tooltipContent="richText"===this._renderMode?new ak(e):new tk(e.getDom(),e,{appendToBody:n.get("appendToBody",!0)}))},ck.prototype.render=function(t,e,n){g.node||(this.group.removeAll(),this._tooltipModel=t,this._ecModel=e,this._api=n,this._alwaysShowContent=t.get("alwaysShowContent"),(n=this._tooltipContent).update(t),n.setEnterable(t.get("enterable")),this._initGlobalListener(),this._keepShow())},ck.prototype._initGlobalListener=function(){var t=this._tooltipModel.get("triggerOn");RN("itemTooltip",this._api,sk((function(e,n,r){"none"!==t&&(0<=t.indexOf(e)?this._tryShow(n,r):"leave"===e&&this._hide(r))}),this))},ck.prototype._keepShow=function(){var t,e=this._tooltipModel,n=this._ecModel,r=this._api;null!=this._lastX&&null!=this._lastY&&"none"!==e.get("triggerOn")&&(t=this,clearTimeout(this._refreshUpdateTimeout),this._refreshUpdateTimeout=setTimeout((function(){r.isDisposed()||t.manuallyShowTip(e,n,r,{x:t._lastX,y:t._lastY,dataByCoordSys:t._lastDataByCoordSys})})))},ck.prototype.manuallyShowTip=function(t,e,n,r){var i,o,a;r.from===this.uid||g.node||(i=pk(r,n),this._ticket="",a=r.dataByCoordSys,r.tooltip&&null!=r.x&&null!=r.y?((o=hk).x=r.x,o.y=r.y,o.update(),o.tooltip=r.tooltip,this._tryShow({offsetX:r.x,offsetY:r.y,target:o},i)):a?this._tryShow({offsetX:r.x,offsetY:r.y,position:r.position,dataByCoordSys:a,tooltipOption:r.tooltipOption},i):null!=r.seriesIndex?this._manuallyAxisShowTip(t,e,n,r)||(t=(a=BN(r,e)).point[0],e=a.point[1],null!=t&&null!=e&&this._tryShow({offsetX:t,offsetY:e,position:r.position,target:a.el},i)):null!=r.x&&null!=r.y&&(n.dispatchAction({type:"updateAxisPointer",x:r.x,y:r.y}),this._tryShow({offsetX:r.x,offsetY:r.y,position:r.position,target:n.getZr().findHover(r.x,r.y).target},i)))},ck.prototype.manuallyHideTip=function(t,e,n,r){var i=this._tooltipContent;!this._alwaysShowContent&&this._tooltipModel&&i.hideLater(this._tooltipModel.get("hideDelay")),this._lastX=this._lastY=this._lastDataByCoordSys=null,r.from!==this.uid&&this._hide(pk(r,n))},ck.prototype._manuallyAxisShowTip=function(t,e,n,r){var i=r.seriesIndex,o=r.dataIndex,a=e.getComponent("axisPointer").coordSysAxesInfo;if(null!=i&&null!=o&&null!=a&&(e=e.getSeriesByIndex(i),e&&"axis"===dk([e.getData().getItemModel(o),e,(e.coordinateSystem||{}).model,t]).get("trigger")))return n.dispatchAction({type:"updateAxisPointer",seriesIndex:i,dataIndex:o,position:r.position}),!0},ck.prototype._tryShow=function(t,e){var n,r=t.target;this._tooltipModel&&(this._lastX=t.offsetX,this._lastY=t.offsetY,(n=t.dataByCoordSys)&&n.length?this._showAxisTooltip(n,t):r&&Um(r,(function(t){return null!=Ps(t).dataIndex}),!0)?(this._lastDataByCoordSys=null,this._showSeriesItemTooltip(t,r,e)):r&&r.tooltip?(this._lastDataByCoordSys=null,this._showComponentItemTooltip(t,r,e)):(this._lastDataByCoordSys=null,this._hide(e)))},ck.prototype._showOrMove=function(t,e){t=t.get("showDelay"),e=G(e,this),clearTimeout(this._showTimout),0<t?this._showTimout=setTimeout(e,t):e()},ck.prototype._showAxisTooltip=function(t,e){var n=this._ecModel,r=this._tooltipModel,i=[e.offsetX,e.offsetY],o=dk([e.tooltipOption,r]),a=this._renderMode,s=[],l=Xf("section",{blocks:[],noHeader:!0}),u=[],h=new $f;lk(t,(function(t){lk(t.dataByAxis,(function(t){var e,r,i=n.getComponent(t.axisDim+"Axis",t.axisIndex),o=t.value;i&&null!=o&&(e=fN(o,i.axis,n,t.seriesDataIndices,t.valueLabelOpt),r=Xf("section",{header:e,noHeader:!st(e),sortBlocks:!0,blocks:[]}),l.blocks.push(r),F(t.seriesDataIndices,(function(l){var c=n.getSeriesByIndex(l.seriesIndex),d=l.dataIndexInside;l=c.getDataParams(d);l.axisDim=t.axisDim,l.axisIndex=t.axisIndex,l.axisType=t.axisType,l.axisId=t.axisId,l.axisValue=zx(i.axis,{value:o}),l.axisValueLabel=e,l.marker=h.makeTooltipMarker("item",dd(l.color),a),d=sf(c.formatTooltip(d,!0,null)),d.markupFragment&&r.blocks.push(d.markupFragment),d.markupText&&u.push(d.markupText),s.push(l)})))}))})),l.blocks.reverse(),u.reverse();var c=e.position;e=o.get("order"),e=Zf(l,h,a,e,n.get("useUTC"),o.get("textStyle"));e&&u.unshift(e);var d=u.join("richText"===a?"\n\n":"<br/>");this._showOrMove(o,(function(){this._updateContentNotChangedOnAxis(t)?this._updatePosition(o,c,i[0],i[1],this._tooltipContent,s):this._showTooltipContent(o,d,s,Math.random()+"",i[0],i[1],c,null,h)}))},ck.prototype._showSeriesItemTooltip=function(t,e,n){var r,i,o,a,s=Um(e,(function(t){return null!=Ps(t).dataIndex}),!0),l=this._ecModel,u=Ps(s),h=u.seriesIndex,c=l.getSeriesByIndex(h),d=u.dataModel||c,p=u.dataIndex,f=(e=u.dataType,s=d.getData(e),u=this._renderMode,dk([s.getItemModel(p),d,c&&(c.coordinateSystem||{}).model,this._tooltipModel]));c=f.get("trigger");null!=c&&"item"!==c||(r=d.getDataParams(p,e),i=new $f,r.marker=i.makeTooltipMarker("item",dd(r.color),u),c=sf(d.formatTooltip(p,!1,e)),e=f.get("order"),o=c.markupFragment?Zf(c.markupFragment,i,u,e,l.get("useUTC"),f.get("textStyle")):c.markupText,a="item_"+d.name+"_"+p,this._showOrMove(f,(function(){this._showTooltipContent(f,o,r,a,t.offsetX,t.offsetY,t.position,t.target,i)})),n({type:"showTip",dataIndexInside:p,dataIndex:s.getRawIndex(p),seriesIndex:h,from:this.uid}))},ck.prototype._showComponentItemTooltip=function(t,e,n){var r=e.tooltip;Y(r)&&(r={content:r,formatter:r});var i=new xc(r,this._tooltipModel,this._ecModel),o=i.get("content"),a=Math.random()+"",s=new $f;this._showOrMove(i,(function(){this._showTooltipContent(i,o,i.get("formatterParams")||{},a,t.offsetX,t.offsetY,t.position,e,s)})),n({type:"showTip",from:this.uid})},ck.prototype._showTooltipContent=function(t,e,n,r,i,o,a,s,l){var u,h,c,d,p;this._ticket="",t.get("showContent")&&t.get("show")&&(u=this._tooltipContent,h=t.get("formatter"),a=a||t.get("position"),d=e,c=this._getNearestPoint([i,o],n,t.get("trigger"),t.get("borderColor")),h&&Y(h)?(p=t.ecModel.get("useUTC"),d=h,d=cd(d=(e=X(n)?n[0]:n)&&e.axisType&&0<=e.axisType.indexOf("time")?Vc(e.axisValue,d,p):d,n,!0)):j(h)&&(p=sk((function(e,r){e===this._ticket&&(u.setContent(r,l,t,c.color,a),this._updatePosition(t,a,i,o,u,n,s))}),this),this._ticket=r,d=h(n,r,p)),u.setContent(d,l,t,c.color,a),u.show(t,c.color),this._updatePosition(t,a,i,o,u,n,s))},ck.prototype._getNearestPoint=function(t,e,n,r){return"axis"===n||X(e)?{color:r||("html"===this._renderMode?"#fff":"none")}:X(e)?void 0:{color:r||e.color||e.borderColor}},ck.prototype._updatePosition=function(t,e,n,r,i,o,a){var s=this._api.getWidth(),l=this._api.getHeight();e=e||t.get("position");var u,h=i.getSize(),c=t.get("align"),d=t.get("verticalAlign"),p=a&&a.getBoundingRect().clone();a&&p.applyTransform(a.transform),X(e=j(e)?e([n,r],o,i.el,p,{viewSize:[s,l],contentSize:h.slice()}):e)?(n=uk(e[0],s),r=uk(e[1],l)):K(e)?((o=e).width=h[0],o.height=h[1],n=(o=vd(o,{width:s,height:l})).x,r=o.y,d=c=null):(n=(u=Y(e)&&a?function(t,e,n){var r=n[0],i=n[1],o=0,a=0,s=e.width,l=e.height;switch(t){case"inside":o=e.x+s/2-r/2,a=e.y+l/2-i/2;break;case"top":o=e.x+s/2-r/2,a=e.y-i-10;break;case"bottom":o=e.x+s/2-r/2,a=e.y+l+10;break;case"left":o=e.x-r-10-5,a=e.y+l/2-i/2;break;case"right":o=e.x+s+10+5,a=e.y+l/2-i/2}return[o,a]}(e,p,h):function(t,e,n,r,i,o,a){var s=n.getOuterSize();n=s.width,s=s.height;return null!=o&&(r<t+n+o+2?t-=n+o:t+=o),null!=a&&(i<e+s+a?e-=s+a:e+=a),[t,e]}(n,r,i,s,l,c?null:20,d?null:20))[0],r=u[1]),c&&(n-=fk(c)?h[0]/2:"right"===c?h[0]:0),d&&(r-=fk(d)?h[1]/2:"bottom"===d?h[1]:0),qN(t)&&(n=(c=n,d=r,h=s,t=l,s=(l=(s=i).getOuterSize()).width,l=l.height,c=Math.min(c+s,h)-s,d=Math.min(d+l,t)-l,c=Math.max(c,0),d=Math.max(d,0),u=[c,d])[0],r=u[1]),i.moveTo(n,r)},ck.prototype._updateContentNotChangedOnAxis=function(t){var e=this._lastDataByCoordSys,n=!!e&&e.length===t.length;return n&&lk(e,(function(e,r){e=e.dataByAxis||[];var i=(t[r]||{}).dataByAxis||[];(n=n&&e.length===i.length)&&lk(e,(function(t,e){var r=i[e]||{},o=(e=t.seriesDataIndices||[],r.seriesDataIndices||[]);(n=n&&t.value===r.value&&t.axisType===r.axisType&&t.axisId===r.axisId&&e.length===o.length)&&lk(e,(function(t,e){e=o[e],n=n&&t.seriesIndex===e.seriesIndex&&t.dataIndex===e.dataIndex}))}))})),this._lastDataByCoordSys=t,!!n},ck.prototype._hide=function(t){this._lastDataByCoordSys=null,t({type:"hideTip",from:this.uid})},ck.prototype.dispose=function(t,e){g.node||(this._tooltipContent.dispose(),PN("itemTooltip",e))},ck.type="tooltip",ck),mk=(M={get:function(t,e,n){return e=I((mk[t]||{})[e]),n&&X(e)?e[e.length-1]:e}},{color:{active:["#006edd","#e0ffff"],inactive:["rgba(0,0,0,0)"]},colorHue:{active:[0,360],inactive:[0,0]},colorSaturation:{active:[.3,1],inactive:[0,0]},colorLightness:{active:[.9,.5],inactive:[0,0]},colorAlpha:{active:[.3,1],inactive:[0,0]},opacity:{active:[.3,1],inactive:[0,0]},symbol:{active:["circle","roundRect","diamond"],inactive:["none"]},symbolSize:{active:[10,50],inactive:[0,0]}}),yk=M,_k=F,vk=K,xk=-1,bk=(Tk.prototype.mapValueToVisual=function(t){var e=this._normalizeData(t);return this._normalizedToVisual(e,t)},Tk.prototype.getNormalizer=function(){return G(this._normalizeData,this)},Tk.listVisualTypes=function(){return U(Tk.visualHandlers)},Tk.isValidType=function(t){return Tk.visualHandlers.hasOwnProperty(t)},Tk.eachVisual=function(t,e,n){K(t)?F(t,e,n):e.call(n,t)},Tk.mapVisual=function(t,e,n){var r,i=X(t)?[]:K(t)?{}:(r=!0,null);return Tk.eachVisual(t,(function(t,o){t=e.call(n,t,o),r?i=t:i[o]=t})),i},Tk.retrieveVisuals=function(t){var e,n={};return t&&_k(Tk.visualHandlers,(function(r,i){t.hasOwnProperty(i)&&(n[i]=t[i],e=!0)})),e?n:null},Tk.prepareVisualTypes=function(t){if(X(t))t=t.slice();else{if(!vk(t))return[];var e=[];_k(t,(function(t,n){e.push(n)})),t=e}return t.sort((function(t,e){return"color"===e&&"color"!==t&&0===t.indexOf("color")?1:-1})),t},Tk.dependsOn=function(t,e){return"color"===e?!(!t||0!==t.indexOf(e)):t===e},Tk.findPieceIndex=function(t,e,n){for(var r,i=1/0,o=0,a=e.length;o<a;o++){var s=e[o].value;if(null!=s){if(s===t||"string"==typeof s&&s===t+"")return o;n&&h(s,o)}}for(o=0,a=e.length;o<a;o++){var l=e[o],u=l.interval;l=l.close;if(u){if(u[0]===-1/0){if(Ok(l[1],t,u[1]))return o}else if(u[1]===1/0){if(Ok(l[0],u[0],t))return o}else if(Ok(l[0],u[0],t)&&Ok(l[1],t,u[1]))return o;n&&h(u[0],o),n&&h(u[1],o)}}if(n)return t===1/0?e.length-1:t===-1/0?0:r;function h(e,n){e=Math.abs(e-t),e<i&&(i=e,r=n)}},Tk.visualHandlers={color:{applyVisual:Ak("color"),getColorMapper:function(){var t=this.option;return G("category"===t.mappingMethod?function(t,e){return e||(t=this._normalizeData(t)),Ck.call(this,t)}:function(e,n,r){var i=!!r;return r=on(e=n?e:this._normalizeData(e),t.parsedVisual,r),i?r:cn(r,"rgba")},this)},_normalizedToVisual:{linear:function(t){return cn(on(t,this.option.parsedVisual),"rgba")},category:Ck,piecewise:function(t,e){return e=Dk.call(this,e),null==e?cn(on(t,this.option.parsedVisual),"rgba"):e},fixed:Ek}},colorHue:Sk((function(t,e){return un(t,e)})),colorSaturation:Sk((function(t,e){return un(t,null,e)})),colorLightness:Sk((function(t,e){return un(t,null,null,e)})),colorAlpha:Sk(hn),decal:{applyVisual:Ak("decal"),_normalizedToVisual:{linear:null,category:Ck,piecewise:null,fixed:null}},opacity:{applyVisual:Ak("opacity"),_normalizedToVisual:Ik([0,1])},liftZ:{applyVisual:Ak("liftZ"),_normalizedToVisual:{linear:Ek,category:Ek,piecewise:Ek,fixed:Ek}},symbol:{applyVisual:function(t,e,n){n("symbol",this.mapValueToVisual(t))},_normalizedToVisual:{linear:Mk,category:Ck,piecewise:function(t,e){return e=Dk.call(this,e),null==e?Mk.call(this,t):e},fixed:Ek}},symbolSize:{applyVisual:Ak("symbolSize"),_normalizedToVisual:Ik([0,1])}},Tk);function Tk(t){var e=t.mappingMethod,n=t.type;t=this.option=I(t);this.type=n,this.mappingMethod=e,this._normalizeData=Lk[e];var r;n=Tk.visualHandlers[n];this.applyVisual=n.applyVisual,this.getColorMapper=n.getColorMapper,this._normalizedToVisual=n._normalizedToVisual[e],"piecewise"===e?(wk(t),n=(r=t).pieceList,r.hasSpecialVisual=!1,F(n,(function(t,e){t.originIndex=e,null!=t.visual&&(r.hasSpecialVisual=!0)}))):"category"===e?t.categories?function(t){var e,n=t.categories,r=t.categoryMap={},i=t.visual;_k(n,(function(t,e){r[t]=e})),X(i)||(e=[],K(i)?_k(i,(function(t,n){n=r[n],e[null!=n?n:xk]=t})):e[xk]=i,i=Rk(t,e));for(var o=n.length-1;0<=o;o--)null==i[o]&&(delete r[n[o]],n.pop())}(t):wk(t,!0):(at("linear"!==e||t.dataExtent),wk(t))}function wk(t,e){var n=t.visual,r=[];K(n)?_k(n,(function(t){r.push(t)})):null!=n&&r.push(n),e||1!==r.length||{color:1,symbol:1}.hasOwnProperty(t.type)||(r[1]=r[0]),Rk(t,r)}function Sk(t){return{applyVisual:function(e,n,r){e=this.mapValueToVisual(e),r("color",t(n("color"),e))},_normalizedToVisual:Ik([0,1])}}function Mk(t){var e=this.option.visual;return e[Math.round(ui(t,[0,1],[0,e.length-1],!0))]||{}}function Ak(t){return function(e,n,r){r(t,this.mapValueToVisual(e))}}function Ck(t){var e=this.option.visual;return e[this.option.loop&&t!==xk?t%e.length:t]}function Ek(){return this.option.visual[0]}function Ik(t){return{linear:function(e){return ui(e,t,this.option.visual,!0)},category:Ck,piecewise:function(e,n){return n=Dk.call(this,n),null==n?ui(e,t,this.option.visual,!0):n},fixed:Ek}}function Dk(t){var e=this.option,n=e.pieceList;if(e.hasSpecialVisual&&(n=n[bk.findPieceIndex(t,n)],n&&n.visual))return n.visual[this.type]}function Rk(t,e){return t.visual=e,"color"===t.type&&(t.parsedVisual=z(e,(function(t){return tn(t)}))),e}var Lk={linear:function(t){return ui(t,this.option.dataExtent,[0,1],!0)},piecewise:function(t){var e=this.option.pieceList;t=bk.findPieceIndex(t,e,!0);if(null!=t)return ui(t,[0,e.length-1],[0,1],!0)},category:function(t){return t=this.option.categories?this.option.categoryMap[t]:t,null==t?xk:t},fixed:mt};function Ok(t,e,n){return t?e<=n:e<n}var Pk=bk,Nk=F;function kk(t){if(t)for(var e in t)if(t.hasOwnProperty(e))return 1}function Bk(t,e,n){var r={};return Nk(e,(function(e){var i=r[e]=(o.prototype.__hidden=o.prototype,new o);function o(){}Nk(t[e],(function(t,r){Pk.isValidType(r)&&(t={type:r,visual:t},n&&n(t,e),i[r]=new Pk(t),"opacity"===r&&((t=I(t)).type="colorAlpha",i.__hidden.__alphaForOpacity=new Pk(t)))}))})),r}var Fk,zk=Pk.mapVisual,Hk=Pk.eachVisual,Vk=X,Uk=F,Gk=di,Wk=ui;function Xk(){var t=null!==Fk&&Fk.apply(this,arguments)||this;return t.type=Xk.type,t.stateList=["inRange","outOfRange"],t.replacableOptionKeys=["inRange","outOfRange","target","controller","color"],t.layoutMode={type:"box",ignoreSize:!0},t.dataBound=[-1/0,1/0],t.targetVisuals={},t.controllerVisuals={},t}h(Xk,Fk=Ld),Xk.prototype.init=function(t,e,n){this.mergeDefaultAndTheme(t,n)},Xk.prototype.optionUpdated=function(t,e){var n,r,i,o=this.option;g.canvasSupported||(o.realtime=!1),e||(n=o,r=t,F(t=this.replacableOptionKeys,(function(t){r.hasOwnProperty(t)&&kk(r[t])&&(i=!0)})),i&&F(t,(function(t){r.hasOwnProperty(t)&&kk(r[t])?n[t]=I(r[t]):delete n[t]}))),this.textStyleModel=this.getModel("textStyle"),this.resetItemSize(),this.completeVisualOption()},Xk.prototype.resetVisual=function(t){var e=this.stateList;t=G(t,this),this.controllerVisuals=Bk(this.option.controller,e,t),this.targetVisuals=Bk(this.option.target,e,t)},Xk.prototype.getTargetSeriesIndices=function(){var t=this.option.seriesIndex,e=[];return null==t||"all"===t?this.ecModel.eachSeries((function(t,n){e.push(n)})):e=Oi(t),e},Xk.prototype.eachTargetSeries=function(t,e){F(this.getTargetSeriesIndices(),(function(n){n=this.ecModel.getSeriesByIndex(n),n&&t.call(e,n)}),this)},Xk.prototype.isTargetSeries=function(t){var e=!1;return this.eachTargetSeries((function(n){n===t&&(e=!0)})),e},Xk.prototype.formatValueText=function(t,e,n){var r,i=this.option,o=i.precision,a=this.dataBound;i=i.formatter;return n=n||["<",">"],X(t)&&(t=t.slice(),r=!0),e=e?t:r?[s(t[0]),s(t[1])]:s(t),Y(i)?i.replace("{value}",r?e[0]:e).replace("{value2}",r?e[1]:e):j(i)?r?i(t[0],t[1]):i(t):r?t[0]===a[0]?n[0]+" "+e[1]:t[1]===a[1]?n[1]+" "+e[0]:e[0]+" - "+e[1]:e;function s(t){return t===a[0]?"min":t===a[1]?"max":(+t).toFixed(Math.min(o,20))}},Xk.prototype.resetExtent=function(){var t=this.option;t=Gk([t.min,t.max]);this._dataExtent=t},Xk.prototype.getDataDimension=function(t){var e=this.option.dimension,n=t.dimensions;if(null!=e||n.length){if(null!=e)return t.getDimension(e);for(var r=t.dimensions,i=r.length-1;0<=i;i--){var o=r[i];if(!t.getDimensionInfo(o).isCalculationCoord)return o}}},Xk.prototype.getExtent=function(){return this._dataExtent.slice()},Xk.prototype.completeVisualOption=function(){var t=this.ecModel,e=this.option,n={inRange:e.inRange,outOfRange:e.outOfRange},r=e.target||(e.target={}),i=e.controller||(e.controller={});D(r,n),D(i,n);var o=this.isCategory();function a(n){Vk(e.color)&&!n.inRange&&(n.inRange={color:e.color.slice().reverse()}),n.inRange=n.inRange||{color:t.get("gradientColor")}}a.call(this,r),a.call(this,i),function(t,e,n){e=t[e];var r=t[n];e&&!r&&(r=t[n]={},Uk(e,(function(t,e){var n;!Pk.isValidType(e)||null!=(n=yk.get(e,"inactive",o))&&(r[e]=n,"color"!==e||r.hasOwnProperty("opacity")||r.hasOwnProperty("colorAlpha")||(r.opacity=[0,0]))})))}.call(this,r,"inRange","outOfRange"),function(t){var e=(t.inRange||{}).symbol||(t.outOfRange||{}).symbol,n=(t.inRange||{}).symbolSize||(t.outOfRange||{}).symbolSize,r=this.get("inactiveColor");Uk(this.stateList,(function(i){var a=this.itemSize,s=t[i];null==(s=s||(t[i]={color:o?r:[r]})).symbol&&(s.symbol=e&&I(e)||(o?"roundRect":["roundRect"])),null==s.symbolSize&&(s.symbolSize=n&&I(n)||(o?a[0]:[a[0],a[0]])),s.symbol=zk(s.symbol,(function(t){return"none"===t||"square"===t?"roundRect":t}));var l;i=s.symbolSize;null!=i&&(l=-1/0,Hk(i,(function(t){l<t&&(l=t)})),s.symbolSize=zk(i,(function(t){return Wk(t,[0,l],[0,a[0]],!0)})))}),this)}.call(this,i)},Xk.prototype.resetItemSize=function(){this.itemSize=[parseFloat(this.get("itemWidth")),parseFloat(this.get("itemHeight"))]},Xk.prototype.isCategory=function(){return!!this.option.categories},Xk.prototype.setSelected=function(t){},Xk.prototype.getSelected=function(){return null},Xk.prototype.getValueState=function(t){return null},Xk.prototype.getVisualMeta=function(t){return null},Xk.type="visualMap",Xk.dependencies=["series"],Xk.defaultOption={show:!0,zlevel:0,z:4,seriesIndex:"all",min:0,max:200,left:0,right:null,top:null,bottom:0,itemWidth:null,itemHeight:null,inverse:!1,orient:"vertical",backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",contentColor:"#5793f3",inactiveColor:"#aaa",borderWidth:0,padding:5,textGap:10,precision:0,textStyle:{color:"#333"}},Bo=Xk;var jk,Yk=[20,140];function Zk(){var t=null!==jk&&jk.apply(this,arguments)||this;return t.type=Zk.type,t}function qk(t,e,n){if(n[0]===n[1])return n.slice();for(var r=(n[1]-n[0])/200,i=n[0],o=[],a=0;a<=200&&i<n[1];a++)o.push(i),i+=r;return o.push(n[1]),o}var Kk,Qk=(h(Zk,jk=Bo),Zk.prototype.optionUpdated=function(t,e){jk.prototype.optionUpdated.apply(this,arguments),this.resetExtent(),this.resetVisual((function(t){t.mappingMethod="linear",t.dataExtent=this.getExtent()})),this._resetRange()},Zk.prototype.resetItemSize=function(){jk.prototype.resetItemSize.apply(this,arguments);var t=this.itemSize;null!=t[0]&&!isNaN(t[0])||(t[0]=Yk[0]),null!=t[1]&&!isNaN(t[1])||(t[1]=Yk[1])},Zk.prototype._resetRange=function(){var t=this.getExtent(),e=this.option.range;!e||e.auto?(t.auto=1,this.option.range=t):X(e)&&(e[0]>e[1]&&e.reverse(),e[0]=Math.max(e[0],t[0]),e[1]=Math.min(e[1],t[1]))},Zk.prototype.completeVisualOption=function(){jk.prototype.completeVisualOption.apply(this,arguments),F(this.stateList,(function(t){t=this.option.controller[t].symbolSize,t&&t[0]!==t[1]&&(t[0]=t[1]/3)}),this)},Zk.prototype.setSelected=function(t){this.option.range=t.slice(),this._resetRange()},Zk.prototype.getSelected=function(){var t=this.getExtent(),e=di((this.get("range")||[]).slice());return e[0]>t[1]&&(e[0]=t[1]),e[1]>t[1]&&(e[1]=t[1]),e[0]<t[0]&&(e[0]=t[0]),e[1]<t[0]&&(e[1]=t[0]),e},Zk.prototype.getValueState=function(t){var e=this.option.range,n=this.getExtent();return(e[0]<=n[0]||e[0]<=t)&&(e[1]>=n[1]||t<=e[1])?"inRange":"outOfRange"},Zk.prototype.findTargetDataIndices=function(t){var e=[];return this.eachTargetSeries((function(n){var r=[],i=n.getData();i.each(this.getDataDimension(i),(function(e,n){t[0]<=e&&e<=t[1]&&r.push(n)}),this),e.push({seriesId:n.id,dataIndex:r})}),this),e},Zk.prototype.getVisualMeta=function(t){var e=qk(0,0,this.getExtent()),n=qk(0,0,this.option.range.slice()),r=[];function i(e,n){r.push({value:e,color:t(e,n)})}for(var o=0,a=0,s=n.length,l=e.length;a<l&&(!n.length||e[a]<=n[0]);a++)e[a]<n[o]&&i(e[a],"outOfRange");for(var u=1;o<s;o++,u=0)u&&r.length&&i(n[o],"outOfRange"),i(n[o],"inRange");for(u=1;a<l;a++)(!n.length||n[n.length-1]<e[a])&&(u&&(r.length&&i(r[r.length-1].value,"outOfRange"),u=0),i(e[a],"outOfRange"));var h=r.length;return{stops:r,outerColors:[h?r[0].color:"transparent",h?r[h-1].color:"transparent"]}},Zk.type="visualMap.continuous",Zk.defaultOption=wc(Bo.defaultOption,{align:"auto",calculable:!1,hoverLink:!0,realtime:!0,handleIcon:"path://M-11.39,9.77h0a3.5,3.5,0,0,1-3.5,3.5h-22a3.5,3.5,0,0,1-3.5-3.5h0a3.5,3.5,0,0,1,3.5-3.5h22A3.5,3.5,0,0,1-11.39,9.77Z",handleSize:"120%",handleStyle:{borderColor:"#fff",borderWidth:1},indicatorIcon:"circle",indicatorSize:"50%",indicatorStyle:{borderColor:"#fff",borderWidth:2,shadowBlur:2,shadowOffsetX:1,shadowOffsetY:1,shadowColor:"rgba(0,0,0,0.2)"}}),Zk);function Jk(){var t=null!==Kk&&Kk.apply(this,arguments)||this;return t.type=Jk.type,t.autoPositionValues={left:1,right:1,top:1,bottom:1},t}h(Jk,Kk=gg),Jk.prototype.init=function(t,e){this.ecModel=t,this.api=e},Jk.prototype.render=function(t,e,n,r){!1!==(this.visualMapModel=t).get("show")?this.doRender(t,e,n,r):this.group.removeAll()},Jk.prototype.renderBackground=function(t){var e=this.visualMapModel,n=id(e.get("padding")||0),r=t.getBoundingRect();t.add(new bs({z2:-1,silent:!0,shape:{x:r.x-n[3],y:r.y-n[0],width:r.width+n[3]+n[1],height:r.height+n[0]+n[2]},style:{fill:e.get("backgroundColor"),stroke:e.get("borderColor"),lineWidth:e.get("borderWidth")}}))},Jk.prototype.getControllerVisual=function(t,e,n){var r,i=(n=n||{}).forceState,o=this.visualMapModel,a={};function s(t){return a[t]}function l(t,e){a[t]=e}"symbol"===e&&(a.symbol=o.get("itemSymbol")),"color"===e&&(r=o.get("contentColor"),a.color=r);var u=o.controllerVisuals[i||o.getValueState(t)];return F(Pk.prepareVisualTypes(u),(function(r){var i=u[r];n.convertOpacityToAlpha&&"opacity"===r&&(r="colorAlpha",i=u.__alphaForOpacity),Pk.dependsOn(r,e)&&i&&i.applyVisual(t,s,l)})),a[e]},Jk.prototype.positionGroup=function(t){var e=this.visualMapModel,n=this.api;xd(t,e.getBoxLayoutParams(),{width:n.getWidth(),height:n.getHeight()})},Jk.prototype.doRender=function(t,e,n,r){},Jk.type="visualMap",pA=Jk;var $k=[["left","right","width"],["top","bottom","height"]];function tB(t,e,n){var r=t.option,i=r.align;if(null!=i&&"auto"!==i)return i;t={width:e.getWidth(),height:e.getHeight()};for(var o="horizontal"===r.orient?1:0,a=$k[o],s=[0,null,10],l={},u=0;u<3;u++)l[$k[1-o][u]]=s[u],l[a[u]]=2===u?n[0]:r[a[u]];return i=[["x","width",3],["y","height",0]][o],e=vd(l,t,r.padding),a[(e.margin[i[2]]||0)+e[i[0]]+.5*e[i[1]]<.5*t[i[1]]?0:1]}function eB(t,e){return F(t||[],(function(t){null!=t.dataIndex&&(t.dataIndexInside=t.dataIndex,t.dataIndex=null),t.highlightKey="visualMap"+(e?e.componentIndex:"")})),t}var nB,rB=ui,iB=F,oB=Math.min,aB=Math.max;function sB(){var t=null!==nB&&nB.apply(this,arguments)||this;return t.type=sB.type,t._shapes={},t._dataInterval=[],t._handleEnds=[],t._hoverLinkDataIndices=[],t}function lB(t,e,n,r){return new Lu({shape:{points:t},draggable:!!n,cursor:e,drift:n,onmousemove:function(t){$t(t.event)},ondragend:r})}function uB(t){var e=t.get("hoverLinkOnHandle");return null==e?t.get("realtime"):e}function hB(t){return"vertical"===t?"ns-resize":"ew-resize"}var cB=(h(sB,nB=pA),sB.prototype.doRender=function(t,e,n,r){this._api=n,r&&"selectDataRange"===r.type&&r.from===this.uid||this._buildView()},sB.prototype._buildView=function(){this.group.removeAll();var t=this.visualMapModel,e=this.group;this._orient=t.get("orient"),this._useHandle=t.get("calculable"),this._resetInterval(),this._renderBar(e),t=t.get("text"),this._renderEndsText(e,t,0),this._renderEndsText(e,t,1),this._updateView(!0),this.renderBackground(e),this._updateView(),this._enableHoverLinkToSeries(),this._enableHoverLinkFromSeries(),this.positionGroup(e)},sB.prototype._renderEndsText=function(t,e,n){var r,i,o;e&&(r=null!=(r=e[1-n])?r+"":"",i=(o=this.visualMapModel).get("textGap"),e=o.itemSize,o=this._shapes.mainGroup,e=this._applyTransform([e[0]/2,0===n?-i:e[1]+i],o),i=this._applyTransform(0===n?"bottom":"top",o),n=this._orient,o=this.visualMapModel.textStyleModel,this.group.add(new Os({style:{x:e[0],y:e[1],verticalAlign:"horizontal"===n?"middle":i,align:"horizontal"===n?i:"center",text:r,font:o.getFont(),fill:o.getTextColor()}})))},sB.prototype._renderBar=function(t){var e=this.visualMapModel,n=this._shapes,r=e.itemSize,i=this._orient,o=this._useHandle,a=tB(e,this.api,r),s=n.mainGroup=this._createBarGroup(a);a=new ei;s.add(a),a.add(n.outOfRange=lB()),a.add(n.inRange=lB(null,o?hB(this._orient):null,G(this._dragHandle,this,"all",!1),G(this._dragHandle,this,"all",!0))),a.setClipPath(new bs({shape:{x:0,y:0,width:r[0],height:r[1],r:3}})),a=e.textStyleModel.getTextRect(""),a=aB(a.width,a.height),o&&(n.handleThumbs=[],n.handleLabels=[],n.handleLabelPoints=[],this._createHandle(e,s,0,r,a,i),this._createHandle(e,s,1,r,a,i)),this._createIndicator(e,s,r,a,i),t.add(s)},sB.prototype._createHandle=function(t,e,n,r,i,o){var a=G(this._dragHandle,this,n,!1),s=G(this._dragHandle,this,n,!0),l=Jn(t.get("handleSize"),r[0]),u=qm(t.get("handleIcon"),-l/2,-l/2,l,l,null,!0),h=hB(this._orient);u.attr({cursor:h,draggable:!0,drift:a,ondragend:s,onmousemove:function(t){$t(t.event)}}),u.x=r[0]/2,u.useStyle(t.getModel("handleStyle").getItemStyle()),u.setStyle({strokeNoScale:!0,strokeFirst:!0}),u.style.lineWidth*=2,u.ensureState("emphasis").style=t.getModel(["emphasis","handleStyle"]).getItemStyle(),Ml(u,!0),e.add(u),e=this.visualMapModel.textStyleModel,s=new Os({cursor:h,draggable:!0,drift:a,onmousemove:function(t){$t(t.event)},ondragend:s,style:{x:0,y:0,text:"",font:e.getFont(),fill:e.getTextColor()}}),s.ensureState("blur").style={opacity:.1},s.stateTransition={duration:200},this.group.add(s),e=[l,0],l=this._shapes,l.handleThumbs[n]=u,l.handleLabelPoints[n]=e,l.handleLabels[n]=s},sB.prototype._createIndicator=function(t,e,n,r,i){var o=Jn(t.get("indicatorSize"),n[0]),a=qm(t.get("indicatorIcon"),-o/2,-o/2,o,o,null,!0);a.attr({cursor:"move",invisible:!0,silent:!0,x:n[0]/2}),o=t.getModel("indicatorStyle").getItemStyle(),a instanceof cs?(t=a.style,a.useStyle(R({image:t.image,x:t.x,y:t.y,width:t.width,height:t.height},o))):a.useStyle(o),e.add(a),e=this.visualMapModel.textStyleModel,e=new Os({silent:!0,invisible:!0,style:{x:0,y:0,text:"",font:e.getFont(),fill:e.getTextColor()}}),this.group.add(e),r=[("horizontal"===i?r/2:6)+n[0]/2,0],n=this._shapes,n.indicator=a,n.indicatorLabel=e,n.indicatorLabelPoint=r,this._firstShowIndicator=!0},sB.prototype._dragHandle=function(t,e,n,r){this._useHandle&&(this._dragging=!e,e||(r=this._applyTransform([n,r],this._shapes.mainGroup,!0),this._updateInterval(t,r[1]),this._hideIndicator(),this._updateView()),e===!this.visualMapModel.get("realtime")&&this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:this._dataInterval.slice()}),e?this._hovering||this._clearHoverLinkToSeries():uB(this.visualMapModel)&&this._doHoverLinkToSeries(this._handleEnds[t],!1))},sB.prototype._resetInterval=function(){var t=this.visualMapModel,e=this._dataInterval=t.getSelected(),n=t.getExtent();t=[0,t.itemSize[1]];this._handleEnds=[rB(e[0],n,t,!0),rB(e[1],n,t,!0)]},sB.prototype._updateInterval=function(t,e){var n=this.visualMapModel,r=this._handleEnds,i=[0,n.itemSize[1]];OL(e=e||0,r,i,t,0),n=n.getExtent(),this._dataInterval=[rB(r[0],i,n,!0),rB(r[1],i,n,!0)]},sB.prototype._updateView=function(t){var e=this.visualMapModel,n=e.getExtent(),r=this._shapes,i=[0,e.itemSize[1]];e=t?i:this._handleEnds,t=this._createBarVisual(this._dataInterval,n,e,"inRange"),i=this._createBarVisual(n,n,i,"outOfRange");r.inRange.setStyle({fill:t.barColor}).setShape("points",t.barPoints),r.outOfRange.setStyle({fill:i.barColor}).setShape("points",i.barPoints),this._updateHandle(e,t)},sB.prototype._createBarVisual=function(t,e,n,r){var i={forceState:r,convertOpacityToAlpha:!0};r=this._makeColorGradient(t,i),i=[this.getControllerVisual(t[0],"symbolSize",i),this.getControllerVisual(t[1],"symbolSize",i)],i=this._createBarPoints(n,i);return{barColor:new oh(0,0,0,1,r),barPoints:i,handlesColor:[r[0].color,r[r.length-1].color]}},sB.prototype._makeColorGradient=function(t,e){var n=[],r=(t[1]-t[0])/100;n.push({color:this.getControllerVisual(t[0],"color",e),offset:0});for(var i=1;i<100;i++){var o=t[0]+r*i;if(o>t[1])break;n.push({color:this.getControllerVisual(o,"color",e),offset:i/100})}return n.push({color:this.getControllerVisual(t[1],"color",e),offset:1}),n},sB.prototype._createBarPoints=function(t,e){var n=this.visualMapModel.itemSize;return[[n[0]-e[0],t[0]],[n[0],t[0]],[n[0],t[1]],[n[0]-e[1],t[1]]]},sB.prototype._createBarGroup=function(t){var e=this._orient,n=this.visualMapModel.get("inverse");return new ei("horizontal"!==e||n?"horizontal"===e&&n?{scaleX:"bottom"===t?-1:1,rotation:-Math.PI/2}:"vertical"!==e||n?{scaleX:"left"===t?1:-1}:{scaleX:"left"===t?1:-1,scaleY:-1}:{scaleX:"bottom"===t?1:-1,rotation:Math.PI/2})},sB.prototype._updateHandle=function(t,e){var n,r,i,o,a,s;this._useHandle&&(n=this._shapes,r=this.visualMapModel,i=n.handleThumbs,o=n.handleLabels,a=r.itemSize,s=r.getExtent(),iB([0,1],(function(l){var u=i[l];u.setStyle("fill",e.handlesColor[l]),u.y=t[l];var h=rB(t[l],[0,a[1]],s,!0);h=this.getControllerVisual(h,"symbolSize");u.scaleX=u.scaleY=h/a[0],u.x=a[0]-h/2,u=Uh(n.handleLabelPoints[l],Vh(u,this.group)),o[l].setStyle({x:u[0],y:u[1],text:r.formatValueText(this._dataInterval[l]),verticalAlign:"middle",align:"vertical"===this._orient?this._applyTransform("left",n.mainGroup):"center"})}),this))},sB.prototype._showIndicator=function(t,e,n,r){var i=this.visualMapModel,o=i.getExtent(),a=i.itemSize,s=[0,a[1]],l=this._shapes,u=l.indicator;if(u){u.attr("invisible",!1);var h=this.getControllerVisual(t,"color",{convertOpacityToAlpha:!0}),c=this.getControllerVisual(t,"symbolSize"),d=rB(t,o,s,!0);t=a[0]-c/2,o={x:u.x,y:u.y};u.y=d,u.x=t,s=Uh(l.indicatorLabelPoint,Vh(u,this.group)),a=l.indicatorLabel,a.attr("invisible",!1),c=this._applyTransform("left",l.mainGroup),l="horizontal"===this._orient,a.setStyle({text:(n||"")+i.formatValueText(e),verticalAlign:l?c:"middle",align:l?"center":c}),h={x:t,y:d,style:{fill:h}},s={style:{x:s[0],y:s[1]}},i.ecModel.isAnimationEnabled()&&!this._firstShowIndicator?(i={duration:100,easing:"cubicInOut",additive:!0},u.x=o.x,u.y=o.y,u.animateTo(h,i),a.animateTo(s,i)):(u.attr(h),a.attr(s)),this._firstShowIndicator=!1;var p=this._shapes.handleLabels;if(p)for(var f=0;f<p.length;f++)this._api.enterBlur(p[f])}},sB.prototype._enableHoverLinkToSeries=function(){var t=this;this._shapes.mainGroup.on("mousemove",(function(e){var n;t._hovering=!0,t._dragging||(n=t.visualMapModel.itemSize,(e=t._applyTransform([e.offsetX,e.offsetY],t._shapes.mainGroup,!0,!0))[1]=oB(aB(0,e[1]),n[1]),t._doHoverLinkToSeries(e[1],0<=e[0]&&e[0]<=n[0]))})).on("mouseout",(function(){t._hovering=!1,t._dragging||t._clearHoverLinkToSeries()}))},sB.prototype._enableHoverLinkFromSeries=function(){var t=this.api.getZr();this.visualMapModel.option.hoverLink?(t.on("mouseover",this._hoverLinkFromSeriesMouseOver,this),t.on("mouseout",this._hideIndicator,this)):this._clearHoverLinkFromSeries()},sB.prototype._doHoverLinkToSeries=function(t,e){var n,r,i,o=this.visualMapModel,a=o.itemSize;function s(t,e,n){for(var r=0,i=t.length;r<i;r++){var o=Hi(t[r].seriesId,null);if(null==o)return;for(var a=Oi(t[r].dataIndex),s=n&&n[o],l=0,u=a.length;l<u;l++){var h=a[l];s&&s[h]?s[h]=null:(e[o]||(e[o]={}))[h]=1}}}function l(t,e){var n,r,i=[];for(n in t)t.hasOwnProperty(n)&&null!=t[n]&&(e?i.push(+n):(r=l(t[n],!0)).length&&i.push({seriesId:n,dataIndex:r}));return i}o.option.hoverLink&&(n=[0,a[1]],r=o.getExtent(),a=[(t=oB(aB(n[0],t),n[1]))-(i=function(t,e,n){var r=6;t=t.get("hoverLinkDataSize");return t&&(r=rB(t,e,n,!0)/2),r}(o,r,n)),t+i],t=rB(t,n,r,!0),r=[rB(a[0],n,r,!0),rB(a[1],n,r,!0)],a[0]<n[0]&&(r[0]=-1/0),n[1]<a[1]&&(r[1]=1/0),e&&(r[0]===-1/0?this._showIndicator(t,r[1],"< ",i):r[1]===1/0?this._showIndicator(t,r[0],"> ",i):this._showIndicator(t,t," ",i)),t=this._hoverLinkDataIndices,i=[],(e||uB(o))&&(i=this._hoverLinkDataIndices=o.findTargetDataIndices(r)),r=i,i={},s(t||[],t={}),s(r||[],i,t),i=[l(t),l(i)],this._dispatchHighDown("downplay",eB(i[0],o)),this._dispatchHighDown("highlight",eB(i[1],o)))},sB.prototype._hoverLinkFromSeriesMouseOver=function(t){var e=t.target,n=this.visualMapModel;e&&null!=Ps(e).dataIndex&&(t=Ps(e),e=this.ecModel.getSeriesByIndex(t.seriesIndex),n.isTargetSeries(e)&&(t=(e=e.getData(t.dataType)).get(n.getDataDimension(e),t.dataIndex),isNaN(t)||this._showIndicator(t,t)))},sB.prototype._hideIndicator=function(){var t=this._shapes;t.indicator&&t.indicator.attr("invisible",!0),t.indicatorLabel&&t.indicatorLabel.attr("invisible",!0);var e=this._shapes.handleLabels;if(e)for(var n=0;n<e.length;n++)this._api.leaveBlur(e[n])},sB.prototype._clearHoverLinkToSeries=function(){this._hideIndicator();var t=this._hoverLinkDataIndices;this._dispatchHighDown("downplay",eB(t,this.visualMapModel)),t.length=0},sB.prototype._clearHoverLinkFromSeries=function(){this._hideIndicator();var t=this.api.getZr();t.off("mouseover",this._hoverLinkFromSeriesMouseOver),t.off("mouseout",this._hideIndicator)},sB.prototype._applyTransform=function(t,e,n,r){return r=Vh(e,r?null:this.group),(X(t)?Uh:Gh)(t,r,n)},sB.prototype._dispatchHighDown=function(t,e){e&&e.length&&this.api.dispatchAction({type:t,batch:e})},sB.prototype.dispose=function(){this._clearHoverLinkFromSeries(),this._clearHoverLinkToSeries()},sB.prototype.remove=function(){this._clearHoverLinkFromSeries(),this._clearHoverLinkToSeries()},sB.type="visualMap.continuous",sB),dB={type:"selectDataRange",event:"dataRangeSelected",update:"update"},pB=function(t,e){e.eachComponent({mainType:"visualMap",query:t},(function(e){e.setSelected(t.selected)}))},fB=[{createOnAllSeries:!0,reset:function(t,e){var n=[];return e.eachComponent("visualMap",(function(e){var r,i,o,a,s=t.pipelineContext;!e.isTargetSeries(t)||s&&s.large||n.push((s=e.stateList,r=e.targetVisuals,i=G(e.getValueState,e),o=e.getDataDimension(t.getData()),a={},F(s,(function(t){var e=Pk.prepareVisualTypes(r[t]);a[t]=e})),{progress:function(t,e){var n,s;function l(t){return am(e,s,t)}function u(t,n){lm(e,s,t,n)}for(null!=o&&(n=e.getDimension(o));null!=(s=t.next());){var h=e.getRawDataItem(s);if(!h||!1!==h.visualMap)for(var c=null!=o?e.get(n,s):s,d=(h=i(c),r[h]),p=a[h],f=0,g=p.length;f<g;f++){var m=p[f];d[m]&&d[m].applyVisual(c,l,u)}}}}))})),n}},{createOnAllSeries:!0,reset:function(t,e){var n=t.getData(),r=[];e.eachComponent("visualMap",(function(e){var i;e.isTargetSeries(t)&&(i=e.getVisualMeta(G(gB,null,t,e))||{stops:[],outerColors:[]},e=e.getDataDimension(n),null!=(e=n.getDimensionInfo(e))&&(i.dimension=e.index,r.push(i)))})),t.getData().setVisual("visualMeta",r)}}];function gB(t,e,n,r){for(var i=e.targetVisuals[r],o=Pk.prepareVisualTypes(i),a={color:sm(t.getData(),"color")},s=0,l=o.length;s<l;s++){var u=o[s];u=i["opacity"===u?"__alphaForOpacity":u];u&&u.applyVisual(n,h,c)}return a.color;function h(t){return a[t]}function c(t,e){a[t]=e}}var mB=F;function yB(t){t=t&&t.visualMap,X(t)||(t=t?[t]:[]),mB(t,(function(t){t&&(_B(t,"splitList")&&!_B(t,"pieces")&&(t.pieces=t.splitList,delete t.splitList),(t=t.pieces)&&X(t)&&mB(t,(function(t){K(t)&&(_B(t,"start")&&!_B(t,"min")&&(t.min=t.start),_B(t,"end")&&!_B(t,"max")&&(t.max=t.end))})))}))}function _B(t,e){return t&&t.hasOwnProperty&&t.hasOwnProperty(e)}var vB=!1;function xB(t){vB||(vB=!0,t.registerSubTypeDefaulter("visualMap",(function(t){return t.categories||(t.pieces?0<t.pieces.length:0<t.splitNumber)&&!t.calculable?"piecewise":"continuous"})),t.registerAction(dB,pB),F(fB,(function(e){t.registerVisual(t.PRIORITY.VISUAL.COMPONENT,e)})),t.registerPreprocessor(yB))}function bB(t){t.registerComponentModel(Qk),t.registerComponentView(cB),xB(t)}var TB;h(wB,TB=Bo),wB.prototype.optionUpdated=function(t,e){TB.prototype.optionUpdated.apply(this,arguments),this.resetExtent();var n=this._mode=this._determineMode();this._pieceList=[],SB[this._mode].call(this,this._pieceList),this._resetSelected(t,e);var r=this.option.categories;this.resetVisual((function(t,e){"categories"===n?(t.mappingMethod="category",t.categories=I(r)):(t.dataExtent=this.getExtent(),t.mappingMethod="piecewise",t.pieceList=z(this._pieceList,(function(t){return t=I(t),"inRange"!==e&&(t.visual=null),t})))}))},wB.prototype.completeVisualOption=function(){var t=this.option,e={},n=Pk.listVisualTypes(),r=this.isCategory();function i(t,e,n){return t&&t[e]&&t[e].hasOwnProperty(n)}F(t.pieces,(function(t){F(n,(function(n){t.hasOwnProperty(n)&&(e[n]=1)}))})),F(e,(function(e,n){var o=!1;F(this.stateList,(function(e){o=o||i(t,e,n)||i(t.target,e,n)}),this),o||F(this.stateList,(function(e){(t[e]||(t[e]={}))[n]=yk.get(n,"inRange"===e?"active":"inactive",r)}))}),this),TB.prototype.completeVisualOption.apply(this,arguments)},wB.prototype._resetSelected=function(t,e){var n,r=this.option,i=this._pieceList,o=(e?r:t).selected||{};r.selected=o,F(i,(function(t,e){t=this.getSelectedMapKey(t),o.hasOwnProperty(t)||(o[t]=!0)}),this),"single"===r.selectedMode&&(n=!1,F(i,(function(t,e){t=this.getSelectedMapKey(t),o[t]&&(n?o[t]=!1:n=!0)}),this))},wB.prototype.getSelectedMapKey=function(t){return"categories"===this._mode?t.value+"":t.index+""},wB.prototype.getPieceList=function(){return this._pieceList},wB.prototype._determineMode=function(){var t=this.option;return t.pieces&&0<t.pieces.length?"pieces":this.option.categories?"categories":"splitNumber"},wB.prototype.setSelected=function(t){this.option.selected=I(t)},wB.prototype.getValueState=function(t){return t=Pk.findPieceIndex(t,this._pieceList),null!=t&&this.option.selected[this.getSelectedMapKey(this._pieceList[t])]?"inRange":"outOfRange"},wB.prototype.findTargetDataIndices=function(t){var e=[],n=this._pieceList;return this.eachTargetSeries((function(r){var i=[],o=r.getData();o.each(this.getDataDimension(o),(function(e,r){Pk.findPieceIndex(e,n)===t&&i.push(r)}),this),e.push({seriesId:r.id,dataIndex:i})}),this),e},wB.prototype.getRepresentValue=function(t){return this.isCategory()||null!=t.value?t.value:(t=t.interval||[])[0]===-1/0&&t[1]===1/0?0:(t[0]+t[1])/2},wB.prototype.getVisualMeta=function(t){if(!this.isCategory()){var e,n=[],r=["",""],i=this,o=this._pieceList.slice();o.length?((e=o[0].interval[0])!==-1/0&&o.unshift({interval:[-1/0,e]}),(e=o[o.length-1].interval[1])!==1/0&&o.push({interval:[e,1/0]})):o.push({interval:[-1/0,1/0]});var a=-1/0;return F(o,(function(t){t=t.interval,t&&(t[0]>a&&s([a,t[0]],"outOfRange"),s(t.slice()),a=t[1])}),this),{stops:n,outerColors:r}}function s(e,o){var a=i.getRepresentValue({interval:e});o=o||i.getValueState(a),o=t(a,o),e[0]===-1/0?r[0]=o:e[1]===1/0?r[1]=o:n.push({value:e[0],color:o},{value:e[1],color:o})}},wB.type="visualMap.piecewise",wB.defaultOption=wc(Bo.defaultOption,{selected:null,minOpen:!1,maxOpen:!1,align:"auto",itemWidth:20,itemHeight:14,itemSymbol:"roundRect",pieces:null,categories:null,splitNumber:5,selectedMode:"multiple",itemGap:10,hoverLink:!0}),M=wB;function wB(){var t=null!==TB&&TB.apply(this,arguments)||this;return t.type=wB.type,t._pieceList=[],t}var SB={splitNumber:function(t){var e=this.option,n=Math.min(e.precision,20),r=this.getExtent(),i=e.splitNumber;i=Math.max(parseInt(i,10),1);e.splitNumber=i;for(var o=(r[1]-r[0])/i;+o.toFixed(n)!==o&&n<5;)n++;e.precision=n,o=+o.toFixed(n),e.minOpen&&t.push({interval:[-1/0,r[0]],close:[0,0]});for(var a=0,s=r[0];a<i;s+=o,a++){var l=a===i-1?r[1]:s+o;t.push({interval:[s,l],close:[1,1]})}e.maxOpen&&t.push({interval:[r[1],1/0],close:[0,0]}),Ai(t),F(t,(function(t,e){t.index=e,t.text=this.formatValueText(t.interval)}),this)},categories:function(t){var e=this.option;F(e.categories,(function(e){t.push({text:this.formatValueText(e,!0),value:e})}),this),MB(e,t)},pieces:function(t){var e=this.option;F(e.pieces,(function(e,n){var r={text:"",index:n};if(null!=(e=K(e)?e:{value:e}).label&&(r.text=e.label),e.hasOwnProperty("value"))n=r.value=e.value,r.interval=[n,n],r.close=[1,1];else{for(var i=r.interval=[],o=r.close=[0,0],a=[1,0,1],s=[-1/0,1/0],l=[],u=0;u<2;u++){for(var h=[["gte","gt","min"],["lte","lt","max"]][u],c=0;c<3&&null==i[u];c++)i[u]=e[h[c]],o[u]=a[c],l[u]=2===c;null==i[u]&&(i[u]=s[u])}l[0]&&i[1]===1/0&&(o[0]=0),l[1]&&i[0]===-1/0&&(o[1]=0),i[0]===i[1]&&o[0]&&o[1]&&(r.value=i[0])}r.visual=Pk.retrieveVisuals(e),t.push(r)}),this),MB(e,t),Ai(t),F(t,(function(t){var e=t.close;e=[["<",""][e[1]],[">",""][e[0]]];t.text=t.text||this.formatValueText(null!=t.value?t.value:t.interval,!1,e)}),this)}};function MB(t,e){var n=t.inverse;("vertical"===t.orient?!n:n)&&e.reverse()}var AB,CB=M;function EB(){var t=null!==AB&&AB.apply(this,arguments)||this;return t.type=EB.type,t}var IB,DB=(h(EB,AB=pA),EB.prototype.doRender=function(){var t=this.group;t.removeAll();var e=this.visualMapModel,n=e.get("textGap"),r=e.textStyleModel,i=r.getFont(),o=r.getTextColor(),a=this._getItemAlign(),s=e.itemSize,l=this._getViewData(),u=(r=l.endsText,et(e.get("showLabel",!0),!r));r&&this._renderEndsText(t,r[0],s,u,a),F(l.viewPieceList,(function(r){var l=r.piece,h=new ei;h.onclick=G(this._onItemClick,this,l),this._enableHoverLink(h,r.indexInModelPieceList),r=e.getRepresentValue(l),this._createItemSymbol(h,r,[0,0,s[0],s[1]]),u&&(r=this.visualMapModel.getValueState(r),h.add(new Os({style:{x:"right"===a?-n:s[0]+n,y:s[1]/2,text:l.text,verticalAlign:"middle",align:a,font:i,fill:o,opacity:"outOfRange"===r?.5:1}}))),t.add(h)}),this),r&&this._renderEndsText(t,r[1],s,u,a),_d(e.get("orient"),t,e.get("itemGap")),this.renderBackground(t),this.positionGroup(t)},EB.prototype._enableHoverLink=function(t,e){var n=this;t.on("mouseover",(function(){return r("highlight")})).on("mouseout",(function(){return r("downplay")}));var r=function(t){var r=n.visualMapModel;r.option.hoverLink&&n.api.dispatchAction({type:t,batch:eB(r.findTargetDataIndices(e),r)})}},EB.prototype._getItemAlign=function(){var t=this.visualMapModel,e=t.option;return"vertical"===e.orient?tB(t,this.api,t.itemSize):(e=e.align,e&&"auto"!==e?e:"left")},EB.prototype._renderEndsText=function(t,e,n,r,i){var o,a;e&&(o=new ei,a=this.visualMapModel.textStyleModel,o.add(new Os({style:{x:r?"right"===i?n[0]:0:n[0]/2,y:n[1]/2,verticalAlign:"middle",align:r?i:"center",text:e,font:a.getFont(),fill:a.getTextColor()}})),t.add(o))},EB.prototype._getViewData=function(){var t=this.visualMapModel,e=z(t.getPieceList(),(function(t,e){return{piece:t,indexInModelPieceList:e}})),n=t.get("text"),r=t.get("orient");t=t.get("inverse");return("horizontal"===r?t:!t)?e.reverse():n=n&&n.slice().reverse(),{viewPieceList:e,endsText:n}},EB.prototype._createItemSymbol=function(t,e,n){t.add(qm(this.getControllerVisual(e,"symbol"),n[0],n[1],n[2],n[3],this.getControllerVisual(e,"color")))},EB.prototype._onItemClick=function(t){var e=this.visualMapModel,n=e.option,r=I(n.selected),i=e.getSelectedMapKey(t);"single"===n.selectedMode?(r[i]=!0,F(r,(function(t,e){r[e]=e===i}))):r[i]=!r[i],this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:r})},EB.type="visualMap.piecewise",EB);function RB(t){t.registerComponentModel(CB),t.registerComponentView(DB),xB(t)}function LB(){return null!==IB&&IB.apply(this,arguments)||this}var OB,PB=(h(LB,IB=Ld),LB.type="grid",LB.dependencies=["xAxis","yAxis"],LB.layoutMode="box",LB.defaultOption={show:!1,zlevel:0,z:0,left:"10%",top:60,right:"10%",bottom:70,containLabel:!1,backgroundColor:"rgba(0,0,0,0)",borderWidth:1,borderColor:"#ccc"},LB),NB=(h(kB,OB=Ld),kB.prototype.getCoordSysModel=function(){return this.getReferringComponents("grid",Zi).models[0]},kB.type="cartesian2dAxis",kB);function kB(){return null!==OB&&OB.apply(this,arguments)||this}k(NB,Wx);Bo={show:!0,zlevel:0,z:0,inverse:!1,name:"",nameLocation:"end",nameRotate:null,nameTruncate:{maxWidth:null,ellipsis:"...",placeholder:"."},nameTextStyle:{},nameGap:15,silent:!1,triggerEvent:!1,tooltip:{show:!1},axisPointer:{},axisLine:{show:!0,onZero:!0,onZeroAxisIndex:null,lineStyle:{color:"#6E7079",width:1,type:"solid"},symbol:["none","none"],symbolSize:[10,15]},axisTick:{show:!0,inside:!1,length:5,lineStyle:{width:1}},axisLabel:{show:!0,inside:!1,rotate:0,showMinLabel:null,showMaxLabel:null,margin:8,fontSize:12},splitLine:{show:!0,lineStyle:{color:["#E0E6F1"],width:1,type:"solid"}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.2)","rgba(210,219,238,0.2)"]}}},M=D({boundaryGap:!0,deduplication:null,splitLine:{show:!1},axisTick:{alignWithLabel:!1,interval:"auto"},axisLabel:{interval:"auto"}},Bo),pA=D({boundaryGap:[0,0],axisLine:{show:"auto"},axisTick:{show:"auto"},splitNumber:5,minorTick:{show:!1,splitNumber:5,length:3,lineStyle:{}},minorSplitLine:{show:!1,lineStyle:{color:"#F4F7FD",width:1}}},Bo);var BB={category:M,value:pA,time:D({scale:!0,splitNumber:6,axisLabel:{showMinLabel:!1,showMaxLabel:!1,rich:{primary:{fontWeight:"bold"}}},splitLine:{show:!1}},pA),log:L({scale:!0,logBase:10},pA)},FB={value:1,category:1,time:1,log:1};function zB(t,e,n,r){F(FB,(function(i,o){var a,s=D(D({},BB[o],!0),r,!0);h(l,a=n),l.prototype.mergeDefaultAndTheme=function(t,e){var n=bd(this),r=n?wd(t):{};D(t,e.getTheme().get(o+"Axis")),D(t,this.getDefaultOption()),t.type=HB(t),n&&Td(t,r,n)},l.prototype.optionUpdated=function(){"category"===this.option.type&&(this.__ordinalMeta=Bv.createByAxisModel(this))},l.prototype.getCategories=function(t){var e=this.option;if("category"===e.type)return t?e.data:this.__ordinalMeta.categories},l.prototype.getOrdinalMeta=function(){return this.__ordinalMeta},l.type=e+"Axis."+o,l.defaultOption=s,s=l;function l(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=a.apply(this,t)||this;return r.type=e+"Axis."+o,r}t.registerComponentModel(s)})),t.registerSubTypeDefaulter(e+"Axis",HB)}function HB(t){return t.type||(t.data?"category":"value")}function VB(t){this.type="cartesian",this._dimList=[],this._axes={},this.name=t||""}VB.prototype.getAxis=function(t){return this._axes[t]},VB.prototype.getAxes=function(){return z(this._dimList,(function(t){return this._axes[t]}),this)},VB.prototype.getAxesByScale=function(t){return t=t.toLowerCase(),V(this.getAxes(),(function(e){return e.scale.type===t}))},VB.prototype.addAxis=function(t){var e=t.dim;this._axes[e]=t,this._dimList.push(e)},Bo=VB;var UB,GB=["x","y"];function WB(t){return"interval"===t.type||"time"===t.type}function XB(){var t=null!==UB&&UB.apply(this,arguments)||this;return t.type="cartesian2d",t.dimensions=GB,t}var jB,YB=(h(XB,UB=Bo),XB.prototype.calcAffineTransform=function(){this._transform=this._invTransform=null;var t,e,n,r,i=this.getAxis("x").scale,o=this.getAxis("y").scale;WB(i)&&WB(o)&&(n=i.getExtent(),r=o.getExtent(),t=this.dataToPoint([n[0],r[0]]),e=this.dataToPoint([n[1],r[1]]),i=n[1]-n[0],o=r[1]-r[0],i&&o&&(i=(e[0]-t[0])/i,o=(e[1]-t[1])/o,n=t[0]-n[0]*i,r=t[1]-r[0]*o,r=this._transform=[i,0,0,o,n,r],this._invTransform=Se([],r)))},XB.prototype.getBaseAxis=function(){return this.getAxesByScale("ordinal")[0]||this.getAxesByScale("time")[0]||this.getAxis("x")},XB.prototype.containPoint=function(t){var e=this.getAxis("x"),n=this.getAxis("y");return e.contain(e.toLocalCoord(t[0]))&&n.contain(n.toLocalCoord(t[1]))},XB.prototype.containData=function(t){return this.getAxis("x").containData(t[0])&&this.getAxis("y").containData(t[1])},XB.prototype.dataToPoint=function(t,e,n){n=n||[];var r=t[0],i=t[1];if(this._transform&&null!=r&&isFinite(r)&&null!=i&&isFinite(i))return Dt(n,t,this._transform);var o=this.getAxis("x");t=this.getAxis("y");return n[0]=o.toGlobalCoord(o.dataToCoord(r)),n[1]=t.toGlobalCoord(t.dataToCoord(i)),n},XB.prototype.clampData=function(t,e){var n=this.getAxis("x").scale,r=this.getAxis("y").scale,i=n.getExtent(),o=r.getExtent();n=n.parse(t[0]),t=r.parse(t[1]);return(e=e||[])[0]=Math.min(Math.max(Math.min(i[0],i[1]),n),Math.max(i[0],i[1])),e[1]=Math.min(Math.max(Math.min(o[0],o[1]),t),Math.max(o[0],o[1])),e},XB.prototype.pointToData=function(t,e){if(e=e||[],this._invTransform)return Dt(e,t,this._invTransform);var n=this.getAxis("x"),r=this.getAxis("y");return e[0]=n.coordToData(n.toLocalCoord(t[0])),e[1]=r.coordToData(r.toLocalCoord(t[1])),e},XB.prototype.getOtherAxis=function(t){return this.getAxis("x"===t.dim?"y":"x")},XB.prototype.getArea=function(){var t=this.getAxis("x").getGlobalExtent(),e=this.getAxis("y").getGlobalExtent(),n=Math.min(t[0],t[1]),r=Math.min(e[0],e[1]);t=Math.max(t[0],t[1])-n,e=Math.max(e[0],e[1])-r;return new Un(n,r,t,e)},XB);function ZB(t,e,n,r,i){return n=jB.call(this,t,e,n)||this,n.index=0,n.type=r||"value",n.position=i||"bottom",n}var qB=(h(ZB,jB=hb),ZB.prototype.isHorizontal=function(){var t=this.position;return"top"===t||"bottom"===t},ZB.prototype.getGlobalExtent=function(t){var e=this.getExtent();return e[0]=this.toGlobalCoord(e[0]),e[1]=this.toGlobalCoord(e[1]),t&&e[0]>e[1]&&e.reverse(),e},ZB.prototype.pointToData=function(t,e){return this.coordToData(this.toLocalCoord(t["x"===this.dim?0:1]),e)},ZB.prototype.setCategorySortInfo=function(t){if("category"!==this.type)return!1;this.model.option.categorySortInfo=t,this.scale.setSortInfo(t)},ZB);function KB(t,e,n){this.type="grid",this._coordsMap={},this._coordsList=[],this._axesMap={},this._axesList=[],this.axisPointerEnabled=!0,this.dimensions=GB,this._initCartesian(t,e,n),this.model=t}function QB(t,e){return t.getCoordSysModel()===e}function JB(t,e,n,r){n.getAxesOnZeroOf=function(){return i?[i]:[]};var i,o=t[e];e=n.model,n=e.get(["axisLine","onZero"]),e=e.get(["axisLine","onZeroAxisIndex"]);if(n){if(null!=e)$B(o[e])&&(i=o[e]);else for(var a in o)if(o.hasOwnProperty(a)&&$B(o[a])&&!r[s(o[a])]){i=o[a];break}i&&(r[s(i)]=!0)}function s(t){return t.dim+"_"+t.index}}function $B(t){return t&&"category"!==t.type&&"time"!==t.type&&(e=(t=(e=t).scale.getExtent())[0],t=t[1],!(0<e&&0<t||e<0&&t<0));var e}var tF,eF=(KB.prototype.getRect=function(){return this._rect},KB.prototype.update=function(t,e){var n=this._axesMap;this._updateScale(t,this.model),F(n.x,(function(t){kx(t.scale,t.model)})),F(n.y,(function(t){kx(t.scale,t.model)}));var r={};F(n.x,(function(t){JB(n,"y",t,r)})),F(n.y,(function(t){JB(n,"x",t,r)})),this.resize(this.model,e)},KB.prototype.resize=function(t,e,n){var r=t.getBoxLayoutParams(),i=(t=!n&&t.get("containLabel"),vd(r,{width:e.getWidth(),height:e.getHeight()}));this._rect=i;var o=this._axesList;function a(){F(o,(function(t){var e,n,r=t.isHorizontal(),o=r?[0,i.width]:[0,i.height],a=t.inverse?1:0;t.setExtent(o[a],o[1-a]),t=t,e=r?i.x:i.y,r=t.getExtent(),n=r[0]+r[1],t.toGlobalCoord="x"===t.dim?function(t){return t+e}:function(t){return n-t+e},t.toLocalCoord="x"===t.dim?function(t){return t-e}:function(t){return n-t+e}}))}a(),t&&(F(o,(function(t){var e,n,r;t.model.get(["axisLabel","inside"])||(e=Hx(t))&&(n=t.isHorizontal()?"height":"width",r=t.model.get(["axisLabel","margin"]),i[n]-=e[n]+r,"top"===t.position?i.y+=e.height+r:"left"===t.position&&(i.x+=e.width+r))})),a()),F(this._coordsList,(function(t){t.calcAffineTransform()}))},KB.prototype.getAxis=function(t,e){if(t=this._axesMap[t],null!=t)return t[e||0]},KB.prototype.getAxes=function(){return this._axesList.slice()},KB.prototype.getCartesian=function(t,e){if(null!=t&&null!=e)return this._coordsMap["x"+t+"y"+e];K(t)&&(e=t.yAxisIndex,t=t.xAxisIndex);for(var n=0,r=this._coordsList;n<r.length;n++)if(r[n].getAxis("x").index===t||r[n].getAxis("y").index===e)return r[n]},KB.prototype.getCartesians=function(){return this._coordsList.slice()},KB.prototype.convertToPixel=function(t,e,n){return e=this._findConvertTarget(e),e.cartesian?e.cartesian.dataToPoint(n):e.axis?e.axis.toGlobalCoord(e.axis.dataToCoord(n)):null},KB.prototype.convertFromPixel=function(t,e,n){return e=this._findConvertTarget(e),e.cartesian?e.cartesian.pointToData(n):e.axis?e.axis.coordToData(e.axis.toLocalCoord(n)):null},KB.prototype._findConvertTarget=function(t){var e,n,r=t.seriesModel,i=t.xAxisModel||r&&r.getReferringComponents("xAxis",Zi).models[0],o=t.yAxisModel||r&&r.getReferringComponents("yAxis",Zi).models[0],a=t.gridModel;t=this._coordsList;return r?P(t,e=r.coordinateSystem)<0&&(e=null):i&&o?e=this.getCartesian(i.componentIndex,o.componentIndex):i?n=this.getAxis("x",i.componentIndex):o?n=this.getAxis("y",o.componentIndex):a&&a.coordinateSystem===this&&(e=this._coordsList[0]),{cartesian:e,axis:n}},KB.prototype.containPoint=function(t){var e=this._coordsList[0];if(e)return e.containPoint(t)},KB.prototype._initCartesian=function(t,e,n){var r=this,i=this,o={left:!1,right:!1,top:!1,bottom:!1},a={x:{},y:{}},s={x:0,y:0};if(e.eachComponent("xAxis",l("x"),this),e.eachComponent("yAxis",l("y"),this),!s.x||!s.y)return this._axesMap={},void(this._axesList=[]);function l(e){return function(n,r){var l,u;QB(n,t)&&(u=n.get("position"),"x"===e?"top"!==u&&"bottom"!==u&&(u=o.bottom?"top":"bottom"):"left"!==u&&"right"!==u&&(u=o.left?"right":"left"),o[u]=!0,u="category"===(l=new qB(e,Bx(n),[0,0],n.get("type"),u)).type,l.onBand=u&&n.get("boundaryGap"),l.inverse=n.get("inverse"),(n.axis=l).model=n,l.grid=i,l.index=r,i._axesList.push(l),a[e][r]=l,s[e]++)}}F((this._axesMap=a).x,(function(e,n){F(a.y,(function(i,o){var a="x"+n+"y"+o;o=new YB(a);o.master=r,o.model=t,r._coordsMap[a]=o,r._coordsList.push(o),o.addAxis(e),o.addAxis(i)}))}))},KB.prototype._updateScale=function(t,e){function n(t,e){F(Gx(t,e.dim),(function(n){e.scale.unionExtentFromData(t,n)}))}F(this._axesList,(function(t){var e;t.scale.setExtent(1/0,-1/0),"category"===t.type&&(e=t.model.get("categorySortInfo"),t.scale.setSortInfo(e))})),t.eachSeries((function(t){var r,i;yN(t)&&(i=(r=_N(t)).xAxisModel,r=r.yAxisModel,QB(i,e)&&QB(r,e)&&(i=this.getCartesian(i.componentIndex,r.componentIndex),r=t.getData(),t=i.getAxis("x"),i=i.getAxis("y"),"list"===r.type&&(n(r,t),n(r,i))))}),this)},KB.prototype.getTooltipAxes=function(t){var e=[],n=[];return F(this.getCartesians(),(function(r){var i=null!=t&&"auto"!==t?r.getAxis(t):r.getBaseAxis();r=r.getOtherAxis(i);P(e,i)<0&&e.push(i),P(n,r)<0&&n.push(r)})),{baseAxes:e,otherAxes:n}},KB.create=function(t,e){var n=[];return t.eachComponent("grid",(function(r,i){var o=new KB(r,t,e);o.name="grid_"+i,o.resize(r,e,!0),r.coordinateSystem=o,n.push(o)})),t.eachSeries((function(t){var e,n,r;yN(t)&&(e=(r=_N(t)).xAxisModel,n=r.yAxisModel,r=e.getCoordSysModel().coordinateSystem,t.coordinateSystem=r.getCartesian(e.componentIndex,n.componentIndex))})),n},KB.dimensions=GB,KB),nF=Xi(),rF=["axisLine","axisTickLabel","axisName"],iF=["splitArea","splitLine","minorSplitLine"];h(oF,tF=qP),oF.prototype.render=function(t,e,n,r){this.group.removeAll();var i,o,a=this._axisGroup;this._axisGroup=new ei,this.group.add(this._axisGroup),t.get("show")&&(o=mN(i=t.getCoordSysModel(),t),o=new dN(t,R({handleAutoShown:function(e){for(var n=i.coordinateSystem.getCartesians(),r=0;r<n.length;r++){var o=n[r].getOtherAxis(t.axis).type;if("value"===o||"log"===o)return!0}return!1}},o)),F(rF,o.add,o),this._axisGroup.add(o.getGroup()),F(iF,(function(e){t.get([e,"show"])&&sF[e](this,this._axisGroup,t,i)}),this),Xh(a,this._axisGroup,t),tF.prototype.render.call(this,t,e,n,r))},oF.prototype.remove=function(){nF(this).splitAreaColors=null},oF.type="cartesianAxis",M=oF;function oF(){var t=null!==tF&&tF.apply(this,arguments)||this;return t.type=oF.type,t.axisPointerClass="CartesianAxisPointer",t}var aF,sF={splitLine:function(t,e,n,r){var i=n.axis;if(!i.scale.isBlank())for(var o=n.getModel("splitLine"),a=(n=o.getModel("lineStyle"),X(a=n.get("color"))?a:[a]),s=r.coordinateSystem.getRect(),l=i.isHorizontal(),u=0,h=i.getTicksCoords({tickModel:o}),c=[],d=[],p=n.getLineStyle(),f=0;f<h.length;f++){var g=i.toGlobalCoord(h[f].coord);l?(c[0]=g,c[1]=s.y,d[0]=g,d[1]=s.y+s.height):(c[0]=s.x,c[1]=g,d[0]=s.x+s.width,d[1]=g);var m=u++%a.length;g=h[f].tickValue;e.add(new Vu({anid:null!=g?"line_"+h[f].tickValue:null,subPixelOptimize:!0,autoBatch:!0,shape:{x1:c[0],y1:c[1],x2:d[0],y2:d[1]},style:L({stroke:a[m]},p),silent:!0}))}},minorSplitLine:function(t,e,n,r){var i=n.axis,o=(n=n.getModel("minorSplitLine").getModel("lineStyle"),r.coordinateSystem.getRect()),a=i.isHorizontal(),s=i.getMinorTicksCoords();if(s.length)for(var l=[],u=[],h=n.getLineStyle(),c=0;c<s.length;c++)for(var d=0;d<s[c].length;d++){var p=i.toGlobalCoord(s[c][d].coord);a?(l[0]=p,l[1]=o.y,u[0]=p,u[1]=o.y+o.height):(l[0]=o.x,l[1]=p,u[0]=o.x+o.width,u[1]=p),e.add(new Vu({anid:"minor_line_"+s[c][d].tickValue,subPixelOptimize:!0,autoBatch:!0,shape:{x1:l[0],y1:l[1],x2:u[0],y2:u[1]},style:h,silent:!0}))}},splitArea:function(t,e,n,r){!function(t,e,n,r){var i=n.axis;if(!i.scale.isBlank()){var o=n.getModel("splitArea"),a=(n=o.getModel("areaStyle"),n.get("color")),s=r.coordinateSystem.getRect(),l=i.getTicksCoords({tickModel:o,clamp:!0});if(l.length){var u=a.length,h=nF(t).splitAreaColors,c=pt(),d=0;if(h)for(var p=0;p<l.length;p++){var f=h.get(l[p].tickValue);if(null!=f){d=(f+(u-1)*p)%u;break}}var g=i.toGlobalCoord(l[0].coord),m=n.getAreaStyle();for(a=X(a)?a:[a],p=1;p<l.length;p++){var y=i.toGlobalCoord(l[p].coord),_=void 0,v=void 0,x=void 0,b=void 0;g=i.isHorizontal()?(_=g,v=s.y,b=s.height,_+(x=y-_)):(_=s.x,v=g,x=s.width,v+(b=y-v)),y=l[p-1].tickValue;null!=y&&c.set(y,d),e.add(new bs({anid:null!=y?"area_"+y:null,shape:{x:_,y:v,width:x,height:b},style:L({fill:a[d]},m),autoBatch:!0,silent:!0})),d=(d+1)%u}nF(t).splitAreaColors=c}}}(t,e,n,r)}},lF=(h(uF,aF=M),uF.type="xAxis",uF);function uF(){var t=null!==aF&&aF.apply(this,arguments)||this;return t.type=uF.type,t}var hF,cF=(h(dF,hF=M),dF.type="yAxis",dF);function dF(){var t=null!==hF&&hF.apply(this,arguments)||this;return t.type=lF.type,t}var pF,fF=(h(gF,pF=gg),gF.prototype.render=function(t,e){this.group.removeAll(),t.get("show")&&this.group.add(new bs({shape:t.coordinateSystem.getRect(),style:L({fill:t.get("backgroundColor")},t.getItemStyle()),silent:!0,z2:-1}))},gF.type="grid",gF);function gF(){var t=null!==pF&&pF.apply(this,arguments)||this;return t.type="grid",t}var mF,yF={offset:0};function _F(t){t.registerComponentView(fF),t.registerComponentModel(PB),t.registerCoordinateSystem("cartesian2d",eF),zB(t,"x",NB,yF),zB(t,"y",NB,yF),t.registerComponentView(lF),t.registerComponentView(cF),t.registerPreprocessor((function(t){t.xAxis&&t.yAxis&&!t.grid&&(t.grid={})}))}function vF(){var t=null!==mF&&mF.apply(this,arguments)||this;return t.type=vF.type,t.layoutMode={type:"box",ignoreSize:!0},t}var xF,bF=(h(vF,mF=Ld),vF.prototype.init=function(t,e,n){this.mergeDefaultAndTheme(t,n),t.selected=t.selected||{},this._updateSelector(t)},vF.prototype.mergeOption=function(t,e){mF.prototype.mergeOption.call(this,t,e),this._updateSelector(t)},vF.prototype._updateSelector=function(t){var e=t.selector,n=this.ecModel;X(e=!0===e?t.selector=["all","inverse"]:e)&&F(e,(function(t,r){Y(t)&&(t={type:t}),e[r]=D(t,(r=n,"all"===(t=t.type)?{type:"all",title:r.getLocale(["legend","selector","all"])}:"inverse"===t?{type:"inverse",title:r.getLocale(["legend","selector","inverse"])}:void 0))}))},vF.prototype.optionUpdated=function(){this._updateData(this.ecModel);var t=this._data;if(t[0]&&"single"===this.get("selectedMode")){for(var e=!1,n=0;n<t.length;n++){var r=t[n].get("name");if(this.isSelected(r)){this.select(r),e=!0;break}}e||this.select(t[0].get("name"))}},vF.prototype._updateData=function(t){var e=[],n=[];t.eachRawSeries((function(r){var i,o=r.name;n.push(o),r.legendVisualProvider?(o=r.legendVisualProvider.getAllNames(),t.isSeriesFiltered(r)||(n=n.concat(o)),o.length?e=e.concat(o):i=!0):i=!0,i&&Vi(r)&&e.push(r.name)})),this._availableNames=n;var r=z(this.get("data")||e,(function(t){return new xc(t="string"==typeof t||"number"==typeof t?{name:t}:t,this,this.ecModel)}),this);this._data=r},vF.prototype.getData=function(){return this._data},vF.prototype.select=function(t){var e=this.option.selected;"single"===this.get("selectedMode")&&F(this._data,(function(t){e[t.get("name")]=!1})),e[t]=!0},vF.prototype.unSelect=function(t){"single"!==this.get("selectedMode")&&(this.option.selected[t]=!1)},vF.prototype.toggleSelected=function(t){var e=this.option.selected;e.hasOwnProperty(t)||(e[t]=!0),this[e[t]?"unSelect":"select"](t)},vF.prototype.allSelect=function(){var t=this._data,e=this.option.selected;F(t,(function(t){e[t.get("name",!0)]=!0}))},vF.prototype.inverseSelect=function(){var t=this._data,e=this.option.selected;F(t,(function(t){t=t.get("name",!0),e.hasOwnProperty(t)||(e[t]=!0),e[t]=!e[t]}))},vF.prototype.isSelected=function(t){var e=this.option.selected;return!(e.hasOwnProperty(t)&&!e[t])&&0<=P(this._availableNames,t)},vF.prototype.getOrient=function(){return"vertical"===this.get("orient")?{index:1,name:"vertical"}:{index:0,name:"horizontal"}},vF.type="legend.plain",vF.dependencies=["series"],vF.defaultOption={zlevel:0,z:4,show:!0,orient:"horizontal",left:"center",top:0,align:"auto",backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderRadius:0,borderWidth:0,padding:5,itemGap:10,itemWidth:25,itemHeight:14,inactiveColor:"#ccc",inactiveBorderColor:"#ccc",itemStyle:{borderWidth:0},textStyle:{color:"#333"},selectedMode:!0,selector:!1,selectorLabel:{show:!0,borderRadius:10,padding:[3,5,3,5],fontSize:12,fontFamily:" sans-serif",color:"#666",borderWidth:1,borderColor:"#666"},emphasis:{selectorLabel:{show:!0,color:"#eee",backgroundColor:"#666"}},selectorPosition:"auto",selectorItemGap:7,selectorButtonGap:10,tooltip:{show:!1}},vF),TF=W,wF=F,SF=ei;function MF(){var t=null!==xF&&xF.apply(this,arguments)||this;return t.type=MF.type,t.newlineDisabled=!1,t}function AF(t,e,n,r,i,o,a){var s;return"line"!==e&&e.indexOf("empty")<0?(s=n.getItemStyle(),t.style.stroke=r,t.style.decal=o,a||(s.stroke=i)):s=n.getItemStyle(["borderWidth","borderColor"]),t.setStyle(s),t}function CF(t,e,n,r){DF(t,e,n,r),n.dispatchAction({type:"legendToggleSelect",name:null!=t?t:e}),IF(t,e,n,r)}function EF(t){for(var e,n=t.getZr().storage.getDisplayList(),r=0,i=n.length;r<i&&!(e=n[r].states.emphasis);)r++;return e&&e.hoverLayer}function IF(t,e,n,r){EF(n)||n.dispatchAction({type:"highlight",seriesName:t,name:e,excludeSeriesId:r})}function DF(t,e,n,r){EF(n)||n.dispatchAction({type:"downplay",seriesName:t,name:e,excludeSeriesId:r})}var RF,LF=(h(MF,xF=gg),MF.prototype.init=function(){this.group.add(this._contentGroup=new SF),this.group.add(this._selectorGroup=new SF),this._isFirstRender=!0},MF.prototype.getContentGroup=function(){return this._contentGroup},MF.prototype.getSelectorGroup=function(){return this._selectorGroup},MF.prototype.render=function(t,e,n){var r,i,o,a,s,l=this._isFirstRender;this._isFirstRender=!1,this.resetInner(),t.get("show",!0)&&(r=t.get("align"),s=t.get("orient"),r&&"auto"!==r||(r="right"===t.get("left")&&"vertical"===s?"right":"left"),i=t.get("selector",!0),a=t.get("selectorPosition",!0),this.renderInner(r,t,e,n,i,s,a=!i||a&&"auto"!==a?a:"horizontal"===s?"end":"start"),n=vd(o=t.getBoxLayoutParams(),e={width:n.getWidth(),height:n.getHeight()},s=t.get("padding")),s=vd(L({width:(a=this.layoutInner(t,r,n,l,i,a)).width,height:a.height},o),e,s),this.group.x=s.x-a.x,this.group.y=s.y-a.y,this.group.markRedraw(),this.group.add(this._backgroundEl=JL(a,t)))},MF.prototype.resetInner=function(){this.getContentGroup().removeAll(),this._backgroundEl&&this.group.remove(this._backgroundEl),this.getSelectorGroup().removeAll()},MF.prototype.renderInner=function(t,e,n,r,i,o,a){var s=this.getContentGroup(),l=pt(),u=e.get("selectedMode"),h=[];n.eachRawSeries((function(t){t.get("legendHoverLink")||h.push(t.id)})),wF(e.getData(),(function(i,o){var a=i.get("name");if(!this.newlineDisabled&&(""===a||"\n"===a)){var c=new SF;return c.newline=!0,void s.add(c)}var d,p,f,g,m=n.getSeriesByName(a)[0];l.get(a)||(m?(d=(f=(g=m.getData()).getVisual("style"))[g.getVisual("drawType")]||f.fill,p=f.stroke,c=f.decal,f=g.getVisual("legendSymbol")||"roundRect",g=g.getVisual("symbol"),this._createItem(a,o,i,e,f,g,t,d,p,c,u).on("click",TF(CF,a,null,r,h)).on("mouseover",TF(IF,m.name,null,r,h)).on("mouseout",TF(DF,m.name,null,r,h)),l.set(a,!0)):n.eachRawSeries((function(n){var s,c,d;l.get(a)||!n.legendVisualProvider||(s=n.legendVisualProvider).containName(a)&&(c=s.indexOfName(a),n=(d=s.getItemVisual(c,"style")).stroke,s=d.decal,c=d.fill,(d=tn(d.fill))&&0===d[3]&&(d[3]=.2,c=cn(d,"rgba")),this._createItem(a,o,i,e,"roundRect",null,t,c,n,s,u).on("click",TF(CF,null,a,r,h)).on("mouseover",TF(IF,null,a,r,h)).on("mouseout",TF(DF,null,a,r,h)),l.set(a,!0))}),this))}),this),i&&this._createSelector(i,e,r,o,a)},MF.prototype._createSelector=function(t,e,n,r,i){var o=this.getSelectorGroup();wF(t,(function(t){var r=t.type,i=new Os({style:{x:0,y:0,align:"center",verticalAlign:"middle"},onclick:function(){n.dispatchAction({type:"all"===r?"legendAllSelect":"legendInverseSelect"})}});o.add(i),tc(i,{normal:e.getModel("selectorLabel"),emphasis:e.getModel(["emphasis","selectorLabel"])},{defaultText:t.title}),bl(i)}))},MF.prototype._createItem=function(t,e,n,r,i,o,a,s,l,u,h){var c=r.get("itemWidth"),d=r.get("itemHeight"),p=r.get("inactiveColor"),f=r.get("inactiveBorderColor"),g=r.get("symbolKeepAspect"),m=r.getModel("itemStyle"),y=r.isSelected(t),_=new SF,v=n.getModel("textStyle"),x=n.get("icon"),b=n.getModel("tooltip"),T=b.parentModel;n=qm(i=x||i,0,0,c,d,y?s:p,null==g||g);return _.add(AF(n,i,m,l,f,u,y)),x||!o||o===i&&"none"!==o||(g=qm(o="none"===o?"circle":o,(c-(i=.8*d))/2,(d-i)/2,i,i,y?s:p,null==g||g),_.add(AF(g,o,m,l,f,u,y))),f="left"===a?c+5:-5,u=a,c=r.get("formatter"),a=t,"string"==typeof c&&c?a=c.replace("{name}",null!=t?t:""):"function"==typeof c&&(a=c(t)),_.add(new Os({style:nc(v,{text:a,x:f,y:d/2,fill:y?v.getTextColor():p,align:u,verticalAlign:"middle"})})),u=new bs({shape:_.getBoundingRect(),invisible:!0}),b.get("show")&&(r={componentType:"legend",legendIndex:r.componentIndex,name:t,$vars:["name"]},u.tooltip=R({content:t,formatter:T.get("formatter",!0)||function(t){return t.name},formatterParams:r},b.option)),_.add(u),_.eachChild((function(t){t.silent=!0})),u.silent=!h,this.getContentGroup().add(_),bl(_),_.__legendDataIndex=e,_},MF.prototype.layoutInner=function(t,e,n,r,i,o){var a=this.getContentGroup(),s=this.getSelectorGroup();_d(t.get("orient"),a,t.get("itemGap"),n.width,n.height);var l=a.getBoundingRect(),u=[-l.x,-l.y];if(s.markRedraw(),a.markRedraw(),i){_d("horizontal",s,t.get("selectorItemGap",!0));var h=s.getBoundingRect(),c=[-h.x,-h.y],d=t.get("selectorButtonGap",!0),p=t.getOrient().index;n=0===p?"width":"height",i=0===p?"height":"width",t=0===p?"y":"x";return"end"===o?c[p]+=l[n]+d:u[p]+=h[n]+d,c[1-p]+=l[i]/2-h[i]/2,s.x=c[0],s.y=c[1],a.x=u[0],a.y=u[1],s={x:0,y:0},s[n]=l[n]+d+h[n],s[i]=Math.max(l[i],h[i]),s[t]=Math.min(0,h[t]+c[1-p]),s}return a.x=u[0],a.y=u[1],this.group.getBoundingRect()},MF.prototype.remove=function(){this.getContentGroup().removeAll(),this._isFirstRender=!0},MF.type="legend.plain",MF);function OF(t){var e=t.findComponents({mainType:"legend"});e&&e.length&&t.filterSeries((function(t){for(var n=0;n<e.length;n++)if(!e[n].isSelected(t.name))return!1;return!0}))}function PF(t,e,n){var r,i={},o="toggleSelected"===t;return n.eachComponent("legend",(function(n){o&&null!=r?n[r?"select":"unSelect"](e.name):"allSelect"===t||"inverseSelect"===t?n[t]():(n[t](e.name),r=n.isSelected(e.name)),F(n.getData(),(function(t){var e=t.get("name");"\n"!==e&&""!==e&&(t=n.isSelected(e),i.hasOwnProperty(e)?i[e]=i[e]&&t:i[e]=t)}))})),"allSelect"===t||"inverseSelect"===t?{selected:i}:{name:e.name,selected:i}}function NF(t){t.registerComponentModel(bF),t.registerComponentView(LF),t.registerProcessor(t.PRIORITY.PROCESSOR.SERIES_FILTER,OF),t.registerSubTypeDefaulter("legend",(function(){return"plain"})),(t=t).registerAction("legendToggleSelect","legendselectchanged",W(PF,"toggleSelected")),t.registerAction("legendAllSelect","legendselectall",W(PF,"allSelect")),t.registerAction("legendInverseSelect","legendinverseselect",W(PF,"inverseSelect")),t.registerAction("legendSelect","legendselected",W(PF,"select")),t.registerAction("legendUnSelect","legendunselected",W(PF,"unSelect"))}function kF(){var t=null!==RF&&RF.apply(this,arguments)||this;return t.type=kF.type,t}function BF(t,e,n){var r=[1,1];r[t.getOrient().index]=0,Td(e,n,{type:"box",ignoreSize:!!r})}var FF,zF=(h(kF,RF=bF),kF.prototype.setScrollDataIndex=function(t){this.option.scrollDataIndex=t},kF.prototype.init=function(t,e,n){var r=wd(t);RF.prototype.init.call(this,t,e,n),BF(this,t,r)},kF.prototype.mergeOption=function(t,e){RF.prototype.mergeOption.call(this,t,e),BF(this,this.option,t)},kF.type="legend.scroll",kF.defaultOption=wc(bF.defaultOption,{scrollDataIndex:0,pageButtonItemGap:5,pageButtonGap:null,pageButtonPosition:"end",pageFormatter:"{current}/{total}",pageIcons:{horizontal:["M0,0L12,-10L12,10z","M0,0L-12,-10L-12,10z"],vertical:["M0,0L20,0L10,-20z","M0,0L20,0L10,20z"]},pageIconColor:"#2f4554",pageIconInactiveColor:"#aaa",pageIconSize:15,pageTextStyle:{color:"#333"},animationDurationUpdate:800}),kF),HF=ei,VF=["width","height"],UF=["x","y"];function GF(){var t=null!==FF&&FF.apply(this,arguments)||this;return t.type=GF.type,t.newlineDisabled=!0,t._currentIndex=0,t}var WF,XF=(h(GF,FF=LF),GF.prototype.init=function(){FF.prototype.init.call(this),this.group.add(this._containerGroup=new HF),this._containerGroup.add(this.getContentGroup()),this.group.add(this._controllerGroup=new HF)},GF.prototype.resetInner=function(){FF.prototype.resetInner.call(this),this._controllerGroup.removeAll(),this._containerGroup.removeClipPath(),this._containerGroup.__rectSize=null},GF.prototype.renderInner=function(t,e,n,r,i,o,a){var s=this;FF.prototype.renderInner.call(this,t,e,n,r,i,o,a);var l=this._controllerGroup,u=(a=e.get("pageIconSize",!0),X(a)?a:[a,a]);function h(t,n){var i=t+"DataIndex";i=Zh(e.get("pageIcons",!0)[e.getOrient().name][n],{onclick:G(s._pageGo,s,i,e,r)},{x:-u[0]/2,y:-u[1]/2,width:u[0],height:u[1]});i.name=t,l.add(i)}h("pagePrev",0),a=e.getModel("pageTextStyle"),l.add(new Os({name:"pageText",style:{text:"xx/xx",fill:a.getTextColor(),font:a.getFont(),verticalAlign:"middle",align:"center"},silent:!0})),h("pageNext",1)},GF.prototype.layoutInner=function(t,e,n,r,i,o){var a=this.getSelectorGroup(),s=t.getOrient().index,l=VF[s],u=UF[s],h=VF[1-s],c=UF[1-s];i&&_d("horizontal",a,t.get("selectorItemGap",!0));var d=t.get("selectorButtonGap",!0),p=a.getBoundingRect(),f=[-p.x,-p.y],g=I(n);return i&&(g[l]=n[l]-p[l]-d),g=this._layoutContentAndController(t,r,g,s,l,h,c,u),i&&("end"===o?f[s]+=g[l]+d:(o=p[l]+d,f[s]-=o,g[u]-=o),g[l]+=p[l]+d,f[1-s]+=g[c]+g[h]/2-p[h]/2,g[h]=Math.max(g[h],p[h]),g[c]=Math.min(g[c],p[c]+f[1-s]),a.x=f[0],a.y=f[1],a.markRedraw()),g},GF.prototype._layoutContentAndController=function(t,e,n,r,i,o,a,s){var l=this.getContentGroup(),u=this._containerGroup,h=this._controllerGroup;_d(t.get("orient"),l,t.get("itemGap"),r?n.width:null,r?null:n.height),_d("horizontal",h,t.get("pageButtonItemGap",!0));var c=l.getBoundingRect(),d=h.getBoundingRect(),p=this._showController=c[i]>n[i],f=[-c.x,-c.y];e||(f[r]=l[s]);var g=[0,0];e=[-d.x,-d.y],s=nt(t.get("pageButtonGap",!0),t.get("itemGap",!0));return p&&("end"===t.get("pageButtonPosition",!0)?e[r]+=n[i]-d[i]:g[r]+=d[i]+s),e[1-r]+=c[o]/2-d[o]/2,l.setPosition(f),u.setPosition(g),h.setPosition(e),g={x:0,y:0},g[i]=(p?n:c)[i],g[o]=Math.max(c[o],d[o]),g[a]=Math.min(0,d[a]+e[1-r]),u.__rectSize=n[i],p?((r={x:0,y:0})[i]=Math.max(n[i]-d[i]-s,0),r[o]=g[o],u.setClipPath(new bs({shape:r})),u.__rectSize=r[i]):h.eachChild((function(t){t.attr({invisible:!0,silent:!0})})),h=this._getPageInfo(t),null!=h.pageIndex&&Nh(l,{x:h.contentPosition[0],y:h.contentPosition[1]},p?t:null),this._updatePageInfoView(t,h),g},GF.prototype._pageGo=function(t,e,n){t=this._getPageInfo(e)[t],null!=t&&n.dispatchAction({type:"legendScroll",scrollDataIndex:t,legendId:e.id})},GF.prototype._updatePageInfoView=function(t,e){var n=this._controllerGroup;F(["pagePrev","pageNext"],(function(r){var i=null!=e[r+"DataIndex"];r=n.childOfName(r);r&&(r.setStyle("fill",i?t.get("pageIconColor",!0):t.get("pageIconInactiveColor",!0)),r.cursor=i?"pointer":"default")}));var r=n.childOfName("pageText"),i=t.get("pageFormatter"),o=e.pageIndex,a=null!=o?o+1:0;o=e.pageCount;r&&i&&r.setStyle("text",Y(i)?i.replace("{current}",null==a?"":a+"").replace("{total}",null==o?"":o+""):i({current:a,total:o}))},GF.prototype._getPageInfo=function(t){var e=t.get("scrollDataIndex",!0),n=this.getContentGroup(),r=this._containerGroup.__rectSize,i=t.getOrient().index,o=VF[i],a=UF[i],s=this._findTargetItemIndex(e),l=n.children(),u=(t=l[s],l.length),h=(e=u?1:0,{contentPosition:[n.x,n.y],pageCount:e,pageIndex:e-1,pagePrevDataIndex:null,pageNextDataIndex:null});if(!t)return h;t=g(t),h.contentPosition[i]=-t.s;for(var c=s+1,d=t,p=t,f=null;c<=u;++c)(!(f=g(l[c]))&&p.e>d.s+r||f&&!m(f,d.s))&&(d=p.i>d.i?p:f)&&(null==h.pageNextDataIndex&&(h.pageNextDataIndex=d.i),++h.pageCount),p=f;for(c=s-1,d=t,p=t,f=null;-1<=c;--c)(f=g(l[c]))&&m(p,f.s)||!(d.i<p.i)||(p=d,null==h.pagePrevDataIndex&&(h.pagePrevDataIndex=d.i),++h.pageCount,++h.pageIndex),d=f;return h;function g(t){if(t){var e=t.getBoundingRect(),n=e[a]+t[a];return{s:n,e:n+e[o],i:t.__legendDataIndex}}}function m(t,e){return t.e>=e&&t.s<=e+r}},GF.prototype._findTargetItemIndex=function(t){return this._showController?(this.getContentGroup().eachChild((function(r,i){r=r.__legendDataIndex,null==n&&null!=r&&(n=i),r===t&&(e=i)})),null!=e?e:n):0;var e,n},GF.type="legend.scroll",GF);function jF(t){U_(NF),t.registerComponentModel(zF),t.registerComponentView(XF),t.registerAction("legendScroll","legendscroll",(function(t,e){var n=t.scrollDataIndex;null!=n&&e.eachComponent({mainType:"legend",subType:"scroll",query:t},(function(t){t.setScrollDataIndex(n)}))}))}function YF(){var t=null!==WF&&WF.apply(this,arguments)||this;return t.type=YF.type,t}var ZF=(h(YF,WF=wu),YF.type="dataZoom.inside",YF.defaultOption=wc(wu.defaultOption,{disabled:!1,zoomLock:!1,zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!1,preventDefaultMouseMove:!0}),YF),qF=Xi();function KF(t,e){e&&(t.removeKey(e.model.uid),(e=e.controller)&&e.dispose())}function QF(t,e){t.dispatchAction({type:"dataZoom",animation:{easing:"cubicOut",duration:100},batch:e})}function JF(t,e,n,r){return t.coordinateSystem.containPoint([n,r])}function $F(t){t.registerProcessor(t.PRIORITY.PROCESSOR.FILTER,(function(t,e){var n=qF(e),r=n.coordSysRecordMap||(n.coordSysRecordMap=pt());r.each((function(t){t.dataZoomInfoMap=null})),t.eachComponent({mainType:"dataZoom",subType:"inside"},(function(t){F(vL(t).infoList,(function(n){var i,o,a=n.model.uid,s=r.get(a)||r.set(a,(s=e,a=n.model,i={model:a,containsPoint:W(JF,a),dispatchAction:W(QF,s),dataZoomInfoMap:null,controller:null},o=i.controller=new ME(s.getZr()),F(["pan","zoom","scrollMove"],(function(t){o.on(t,(function(e){var n=[];i.dataZoomInfoMap.each((function(r){var o;e.isAvailableBehavior(r.model.option)&&(o=(o=(r.getRange||{})[t])&&o(r.dzReferCoordSysInfo,i.model.mainType,i.controller,e),!r.model.get("disabled",!0)&&o&&n.push({dataZoomId:r.model.id,start:o[0],end:o[1]}))})),n.length&&i.dispatchAction(n)}))})),i));(s.dataZoomInfoMap||(s.dataZoomInfoMap=pt())).set(t.uid,{dzReferCoordSysInfo:n,model:t,getRange:null})}))})),r.each((function(t){var e,n,i,o,a,s=t.controller,l=t.dataZoomInfoMap;!l||null!=(n=l.keys()[0])&&(e=l.get(n)),e?(o={type_true:2,type_move:1,type_false:0,type_undefined:-1},a=!0,l.each((function(t){var e=t.model;t=!e.get("disabled",!0)&&(!e.get("zoomLock",!0)||"move");o["type_"+i]<o["type_"+t]&&(i=t),a=a&&e.get("preventDefaultMouseMove",!0)})),l={controlType:i,opt:{zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!0,preventDefaultMouseMove:!!a}},s.enable(l.controlType,l.opt),s.setPointerChecker(t.containsPoint),Dg(t,"dispatchAction",e.model.get("throttle",!0),"fixRate")):KF(r,t)}))}))}var tz;h(ez,tz=f),ez.prototype.render=function(t,e,n){var r,i;tz.prototype.render.apply(this,arguments),t.noTarget()?this._clear():(this.range=t.getPercentRange(),n=n,r=t,i={pan:G(nz.pan,this),zoom:G(nz.zoom,this),scrollMove:G(nz.scrollMove,this)},qF(n).coordSysRecordMap.each((function(t){t=t.dataZoomInfoMap.get(r.uid),t&&(t.getRange=i)})))},ez.prototype.dispose=function(){this._clear(),tz.prototype.dispose.apply(this,arguments)},ez.prototype._clear=function(){!function(t,e){for(var n=qF(t).coordSysRecordMap,r=n.keys(),i=0;i<r.length;i++){var o=r[i],a=n.get(o),s=a.dataZoomInfoMap;s&&(o=e.uid,s.get(o)&&(s.removeKey(o),s.keys().length||KF(n,a)))}}(this.api,this.dataZoomModel),this.range=null},ez.type="dataZoom.inside",pA=ez;function ez(){var t=null!==tz&&tz.apply(this,arguments)||this;return t.type="dataZoom.inside",t}var nz={zoom:function(t,e,n,r){var i=this.range,o=i.slice(),a=t.axisModels[0];if(a)return t=oz[e](null,[r.originX,r.originY],a,n,t),t=(0<t.signal?t.pixelStart+t.pixelLength-t.pixel:t.pixel-t.pixelStart)/t.pixelLength*(o[1]-o[0])+o[0],r=Math.max(1/r.scale,0),o[0]=(o[0]-t)*r+t,o[1]=(o[1]-t)*r+t,t=this.dataZoomModel.findRepresentativeAxisProxy().getMinMaxSpan(),OL(0,o,[0,100],0,t.minSpan,t.maxSpan),this.range=o,i[0]!==o[0]||i[1]!==o[1]?o:void 0},pan:rz((function(t,e,n,r,i,o){return n=oz[r]([o.oldX,o.oldY],[o.newX,o.newY],e,i,n),n.signal*(t[1]-t[0])*n.pixel/n.pixelLength})),scrollMove:rz((function(t,e,n,r,i,o){return oz[r]([0,0],[o.scrollDelta,o.scrollDelta],e,i,n).signal*(t[1]-t[0])*o.scrollDelta}))};function rz(t){return function(e,n,r,i){var o=this.range,a=o.slice(),s=e.axisModels[0];if(s)return OL(t(a,s,e,n,r,i),a,[0,100],"all"),this.range=a,o[0]!==a[0]||o[1]!==a[1]?a:void 0}}var iz,oz={grid:function(t,e,n,r,i){var o=n.axis;n={},i=i.model.coordinateSystem.getRect();return t=t||[0,0],"x"===o.dim?(n.pixel=e[0]-t[0],n.pixelLength=i.width,n.pixelStart=i.x,n.signal=o.inverse?1:-1):(n.pixel=e[1]-t[1],n.pixelLength=i.height,n.pixelStart=i.y,n.signal=o.inverse?-1:1),n},polar:function(t,e,n,r,i){var o=n.axis,a={},s=i.model.coordinateSystem,l=s.getRadiusAxis().getExtent();i=s.getAngleAxis().getExtent();return t=t?s.pointToCoord(t):[0,0],e=s.pointToCoord(e),"radiusAxis"===n.mainType?(a.pixel=e[0]-t[0],a.pixelLength=l[1]-l[0],a.pixelStart=l[0],a.signal=o.inverse?1:-1):(a.pixel=e[1]-t[1],a.pixelLength=i[1]-i[0],a.pixelStart=i[0],a.signal=o.inverse?-1:1),a},singleAxis:function(t,e,n,r,i){var o=n.axis;n=i.model.coordinateSystem.getRect(),i={};return t=t||[0,0],"horizontal"===o.orient?(i.pixel=e[0]-t[0],i.pixelLength=n.width,i.pixelStart=n.x,i.signal=o.inverse?1:-1):(i.pixel=e[1]-t[1],i.pixelLength=n.height,i.pixelStart=n.y,i.signal=o.inverse?-1:1),i}},az=pA;function sz(t){UL(t),t.registerComponentModel(ZF),t.registerComponentView(az),$F(t)}function lz(){var t=null!==iz&&iz.apply(this,arguments)||this;return t.type=lz.type,t}var uz,hz=(h(lz,iz=wu),lz.type="dataZoom.slider",lz.layoutMode="box",lz.defaultOption=wc(wu.defaultOption,{show:!0,right:"ph",top:"ph",width:"ph",height:"ph",left:null,bottom:null,borderColor:"#d2dbee",borderRadius:3,backgroundColor:"rgba(47,69,84,0)",dataBackground:{lineStyle:{color:"#d2dbee",width:.5},areaStyle:{color:"#d2dbee",opacity:.2}},selectedDataBackground:{lineStyle:{color:"#8fb0f7",width:.5},areaStyle:{color:"#8fb0f7",opacity:.2}},fillerColor:"rgba(135,175,274,0.2)",handleIcon:"path://M-9.35,34.56V42m0-40V9.5m-2,0h4a2,2,0,0,1,2,2v21a2,2,0,0,1-2,2h-4a2,2,0,0,1-2-2v-21A2,2,0,0,1-11.35,9.5Z",handleSize:"100%",handleStyle:{color:"#fff",borderColor:"#ACB8D1"},moveHandleSize:7,moveHandleIcon:"path://M-320.9-50L-320.9-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-348-41-339-50-320.9-50z M-212.3-50L-212.3-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-239.4-41-230.4-50-212.3-50z M-103.7-50L-103.7-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-130.9-41-121.8-50-103.7-50z",moveHandleStyle:{color:"#D2DBEE",opacity:.7},showDetail:!0,showDataShadow:"auto",realtime:!0,zoomLock:!1,textStyle:{color:"#6E7079"},brushSelect:!0,brushStyle:{color:"rgba(135,175,274,0.15)"},emphasis:{handleStyle:{borderColor:"#8FB0F7"},moveHandleStyle:{color:"#8FB0F7"}}}),lz),cz=bs,dz="horizontal",pz="vertical",fz=["line","bar","candlestick","scatter"],gz={easing:"cubicOut",duration:100};function mz(){var t=null!==uz&&uz.apply(this,arguments)||this;return t.type=mz.type,t._displayables={},t}function yz(t){return"vertical"===t?"ns-resize":"ew-resize"}var _z=(h(mz,uz=f),mz.prototype.init=function(t,e){this.api=e,this._onBrush=G(this._onBrush,this),this._onBrushEnd=G(this._onBrushEnd,this)},mz.prototype.render=function(t,e,n,r){if(uz.prototype.render.apply(this,arguments),Dg(this,"_dispatchZoomAction",t.get("throttle"),"fixRate"),this._orient=t.getOrient(),!1!==t.get("show")){if(t.noTarget())return this._clear(),void this.group.removeAll();r&&"dataZoom"===r.type&&r.from===this.uid||this._buildView(),this._updateView()}else this.group.removeAll()},mz.prototype.dispose=function(){this._clear(),uz.prototype.dispose.apply(this,arguments)},mz.prototype._clear=function(){var t,e;(n=(t=this)[e="_dispatchZoomAction"])&&n[Ag]&&(t[e]=n[Ag]);var n=this.api.getZr();n.off("mousemove",this._onBrush),n.off("mouseup",this._onBrushEnd)},mz.prototype._buildView=function(){var t=this.group;t.removeAll(),this._brushing=!1,this._displayables.brushRect=null,this._resetLocation(),this._resetInterval();var e=this._displayables.sliderGroup=new ei;this._renderBackground(),this._renderHandle(),this._renderDataShadow(),t.add(e),this._positionGroup()},mz.prototype._resetLocation=function(){var t=this.dataZoomModel,e=this.api,n=t.get("brushSelect")?7:0,r=this._findCoordRect(),i=(e={width:e.getWidth(),height:e.getHeight()},this._orient===dz?{right:e.width-r.x-r.width,top:e.height-30-7-n,width:r.width,height:30}:{right:7,top:r.y,width:30,height:r.height}),o=wd(t.option);F(["right","top","width","height"],(function(t){"ph"===o[t]&&(o[t]=i[t])})),e=vd(o,e),this._location={x:e.x,y:e.y},this._size=[e.width,e.height],this._orient===pz&&this._size.reverse()},mz.prototype._positionGroup=function(){var t=this.group,e=this._location,n=this._orient,r=this.dataZoomModel.getFirstTargetAxisModel(),i=r&&r.get("inverse"),o=this._displayables.sliderGroup;r=(this._dataShadowInfo||{}).otherAxisInverse;o.attr(n!==dz||i?n===dz&&i?{scaleY:r?1:-1,scaleX:-1}:n!==pz||i?{scaleY:r?-1:1,scaleX:-1,rotation:Math.PI/2}:{scaleY:r?-1:1,scaleX:1,rotation:Math.PI/2}:{scaleY:r?1:-1,scaleX:1}),o=t.getBoundingRect([o]),t.x=e.x-o.x,t.y=e.y-o.y,t.markRedraw()},mz.prototype._getViewExtent=function(){return[0,this._size[0]]},mz.prototype._renderBackground=function(){var t=this.dataZoomModel,e=this._size,n=this._displayables.sliderGroup,r=t.get("brushSelect");n.add(new cz({silent:!0,shape:{x:0,y:0,width:e[0],height:e[1]},style:{fill:t.get("backgroundColor")},z2:-40})),t=new cz({shape:{x:0,y:0,width:e[0],height:e[1]},style:{fill:"transparent"},z2:0,onclick:G(this._onClickPanel,this)}),e=this.api.getZr(),r?(t.on("mousedown",this._onBrushStart,this),t.cursor="crosshair",e.on("mousemove",this._onBrush),e.on("mouseup",this._onBrushEnd)):(e.off("mousemove",this._onBrush),e.off("mouseup",this._onBrushEnd)),n.add(t)},mz.prototype._renderDataShadow=function(){var t=this._dataShadowInfo=this._prepareDataShadowInfo();if(this._displayables.dataShadowSegs=[],t){var e=this._size,n=t.series,r=n.getRawData();n=n.getShadowDim?n.getShadowDim():t.otherDim;if(null!=n){t=.3*((o=r.getDataExtent(n))[1]-o[0]);var i,o=[o[0]-t,o[1]+t],a=[0,e[1]],s=(t=[0,e[0]],[[e[0],0],[0,0]]),l=[],u=t[1]/(r.count()-1),h=0,c=Math.round(r.count()/e[0]);r.each([n],(function(t,e){var n;0<c&&e%c?h+=u:(t=(n=null==t||isNaN(t)||""===t)?0:ui(t,o,a,!0),n&&!i&&e?(s.push([s[s.length-1][0],0]),l.push([l[l.length-1][0],0])):!n&&i&&(s.push([h,0]),l.push([h,0])),s.push([h,t]),l.push([h,t]),h+=u,i=n)}));for(var d,p,f,g=this.dataZoomModel,m=0;m<3;m++){var y=(d=1===m,p=f=p=void 0,p=g.getModel(d?"selectedDataBackground":"dataBackground"),f=new ei,d=new Lu({shape:{points:s},segmentIgnoreThreshold:1,style:p.getModel("areaStyle").getAreaStyle(),silent:!0,z2:-20}),p=new Bu({shape:{points:l},segmentIgnoreThreshold:1,style:p.getModel("lineStyle").getLineStyle(),silent:!0,z2:-19}),f.add(d),f.add(p),f);this._displayables.sliderGroup.add(y),this._displayables.dataShadowSegs.push(y)}}}},mz.prototype._prepareDataShadowInfo=function(){var t=this.dataZoomModel,e=t.get("showDataShadow");if(!1!==e){var n,r=this.ecModel;return t.eachTargetAxis((function(i,o){F(t.getAxisProxy(i,o).getTargetSeriesModels(),(function(t){var a,s,l,u;n||!0!==e&&P(fz,t.get("type"))<0||(a=r.getComponent(yL(i),o).axis,u=t.coordinateSystem,null!=(s={x:"y",y:"x",radius:"angle",angle:"radius"}[i])&&u.getOtherAxis&&(l=u.getOtherAxis(a).inverse),s=t.getData().mapDimension(s),n={thisAxis:a,series:t,thisDim:i,otherDim:s,otherAxisInverse:l})}),this)}),this),n}},mz.prototype._renderHandle=function(){var t=this.group,e=this._displayables,n=e.handles=[null,null],r=e.handleLabels=[null,null],i=this._displayables.sliderGroup,o=this._size,a=this.dataZoomModel,s=this.api,l=a.get("borderRadius")||0,u=a.get("brushSelect"),h=e.filler=new cz({silent:u,style:{fill:a.get("fillerColor")},textConfig:{position:"inside"}});i.add(h),i.add(new cz({silent:!0,subPixelOptimize:!0,shape:{x:0,y:0,width:o[0],height:o[1],r:l},style:{stroke:a.get("dataBackgroundColor")||a.get("borderColor"),lineWidth:1,fill:"rgba(0,0,0,0)"}})),F([0,1],(function(e){var o=a.get("handleIcon"),s=qm(o=!jm[o]&&o.indexOf("path://")<0&&o.indexOf("image://")<0?"path://"+o:o,-1,0,2,2,null,!0);s.attr({cursor:yz(this._orient),draggable:!0,drift:G(this._onDragMove,this,e),ondragend:G(this._onDragEnd,this),onmouseover:G(this._showDataInfo,this,!0),onmouseout:G(this._showDataInfo,this,!1),z2:5});var l=s.getBoundingRect();o=a.get("handleSize");this._handleHeight=hi(o,this._size[1]),this._handleWidth=l.width/l.height*this._handleHeight,s.setStyle(a.getModel("handleStyle").getItemStyle()),s.style.strokeNoScale=!0,s.rectHover=!0,s.ensureState("emphasis").style=a.getModel(["emphasis","handleStyle"]).getItemStyle(),bl(s),l=a.get("handleColor"),null!=l&&(s.style.fill=l),i.add(n[e]=s),s=a.getModel("textStyle"),t.add(r[e]=new Os({silent:!0,invisible:!0,style:{x:0,y:0,text:"",verticalAlign:"middle",align:"center",fill:s.getTextColor(),font:s.getFont()},z2:10}))}),this);var c,d=h;u&&(l=hi(a.get("moveHandleSize"),o[1]),c=e.moveHandle=new bs({style:a.getModel("moveHandleStyle").getItemStyle(),silent:!0,shape:{r:[0,0,2,2],y:o[1]-.5,height:l}}),h=.8*l,(u=e.moveHandleIcon=qm(a.get("moveHandleIcon"),-h/2,-h/2,h,h,"#fff",!0)).silent=!0,u.y=o[1]+l/2-.5,c.ensureState("emphasis").style=a.getModel(["emphasis","moveHandleStyle"]).getItemStyle(),h=Math.min(o[1]/2,Math.max(l,10)),(d=e.moveZone=new bs({invisible:!0,shape:{y:o[1]-h,height:l+h}})).on("mouseover",(function(){s.enterEmphasis(c)})).on("mouseout",(function(){s.leaveEmphasis(c)})),i.add(c),i.add(u),i.add(d)),d.attr({draggable:!0,cursor:yz(this._orient),drift:G(this._onDragMove,this,"all"),ondragstart:G(this._showDataInfo,this,!0),ondragend:G(this._onDragEnd,this),onmouseover:G(this._showDataInfo,this,!0),onmouseout:G(this._showDataInfo,this,!1)})},mz.prototype._resetInterval=function(){var t=this._range=this.dataZoomModel.getPercentRange(),e=this._getViewExtent();this._handleEnds=[ui(t[0],[0,100],e,!0),ui(t[1],[0,100],e,!0)]},mz.prototype._updateInterval=function(t,e){var n=this.dataZoomModel,r=this._handleEnds,i=this._getViewExtent(),o=n.findRepresentativeAxisProxy().getMinMaxSpan(),a=[0,100];return OL(e,r,i,n.get("zoomLock")?"all":t,null!=o.minSpan?ui(o.minSpan,a,i,!0):null,null!=o.maxSpan?ui(o.maxSpan,a,i,!0):null),o=this._range,a=this._range=di([ui(r[0],i,a,!0),ui(r[1],i,a,!0)]),!o||o[0]!==a[0]||o[1]!==a[1]},mz.prototype._updateView=function(t){var e=this._displayables,n=this._handleEnds,r=di(n.slice()),i=this._size;F([0,1],(function(t){var r=e.handles[t],o=this._handleHeight;r.attr({scaleX:o/2,scaleY:o/2,x:n[t]+(t?-1:1),y:i[1]/2-o/2})}),this),e.filler.setShape({x:r[0],y:0,width:r[1]-r[0],height:i[1]});var o={x:r[0],width:r[1]-r[0]};e.moveHandle&&(e.moveHandle.setShape(o),e.moveZone.setShape(o),e.moveZone.getBoundingRect(),e.moveHandleIcon&&e.moveHandleIcon.attr("x",o.x+o.width/2));for(var a=e.dataShadowSegs,s=[0,r[0],r[1],i[0]],l=0;l<a.length;l++){var u=a[l],h=u.getClipPath();h||(h=new bs,u.setClipPath(h)),h.setShape({x:s[l],y:0,width:s[l+1]-s[l],height:i[1]})}this._updateDataInfo(t)},mz.prototype._updateDataInfo=function(t){var e,n,r=this.dataZoomModel,i=this._displayables,o=i.handleLabels,a=this._orient,s=["",""];!r.get("showDetail")||(n=r.findRepresentativeAxisProxy())&&(e=n.getAxisModel().axis,r=this._range,n=t?n.calculateDataWindow({start:r[0],end:r[1]}).valueWindow:n.getDataValueWindow(),s=[this._formatLabel(n[0],e),this._formatLabel(n[1],e)]);var l=di(this._handleEnds.slice());function u(t){var e=Vh(i.handles[t].parent,this.group),n=Gh(0===t?"right":"left",e),r=this._handleWidth/2+5;e=Uh([l[t]+(0===t?-r:r),this._size[1]/2],e);o[t].setStyle({x:e[0],y:e[1],verticalAlign:a===dz?"middle":n,align:a===dz?n:"center",text:s[t]})}u.call(this,0),u.call(this,1)},mz.prototype._formatLabel=function(t,e){var n=this.dataZoomModel,r=n.get("labelFormatter");n=n.get("labelPrecision");return null!=n&&"auto"!==n||(n=e.getPixelPrecision()),n=null==t||isNaN(t)?"":"category"===e.type||"time"===e.type?e.scale.getLabel({value:Math.round(t)}):t.toFixed(Math.min(n,20)),j(r)?r(t,n):Y(r)?r.replace("{value}",n):n},mz.prototype._showDataInfo=function(t){t=this._dragging||t;var e=this._displayables,n=e.handleLabels;n[0].attr("invisible",!t),n[1].attr("invisible",!t),e.moveHandle&&this.api[t?"enterEmphasis":"leaveEmphasis"](e.moveHandle,1)},mz.prototype._onDragMove=function(t,e,n,r){this._dragging=!0,$t(r.event),n=Uh([e,n],this._displayables.sliderGroup.getLocalTransform(),!0),t=this._updateInterval(t,n[0]),n=this.dataZoomModel.get("realtime"),this._updateView(!n),t&&n&&this._dispatchZoomAction(!0)},mz.prototype._onDragEnd=function(){this._dragging=!1,this._showDataInfo(!1),this.dataZoomModel.get("realtime")||this._dispatchZoomAction(!1)},mz.prototype._onClickPanel=function(t){var e=this._size;t=this._displayables.sliderGroup.transformCoordToLocal(t.offsetX,t.offsetY);t[0]<0||t[0]>e[0]||t[1]<0||t[1]>e[1]||(e=((e=this._handleEnds)[0]+e[1])/2,e=this._updateInterval("all",t[0]-e),this._updateView(),e&&this._dispatchZoomAction(!1))},mz.prototype._onBrushStart=function(t){var e=t.offsetX;t=t.offsetY;this._brushStart=new Dn(e,t),this._brushing=!0,this._brushStartTime=+new Date},mz.prototype._onBrushEnd=function(t){var e,n,r;this._brushing&&(r=this._displayables.brushRect,this._brushing=!1,r&&(r.attr("ignore",!0),e=r.shape,+new Date-this._brushStartTime<200&&Math.abs(e.width)<5||(n=this._getViewExtent(),this._range=di([ui(e.x,n,r=[0,100],!0),ui(e.x+e.width,n,r,!0)]),this._handleEnds=[e.x,e.x+e.width],this._updateView(),this._dispatchZoomAction(!1))))},mz.prototype._onBrush=function(t){this._brushing&&($t(t.event),this._updateBrushRect(t.offsetX,t.offsetY))},mz.prototype._updateBrushRect=function(t,e){var n=this._displayables,r=this.dataZoomModel,i=n.brushRect;i||(i=n.brushRect=new cz({silent:!0,style:r.getModel("brushStyle").getItemStyle()}),n.sliderGroup.add(i)),i.attr("ignore",!1),r=this._brushStart,n=this._displayables.sliderGroup,e=n.transformCoordToLocal(t,e),n=n.transformCoordToLocal(r.x,r.y),r=this._size,e[0]=Math.max(Math.min(r[0],e[0]),0),i.setShape({x:n[0],y:0,width:e[0]-n[0],height:r[1]})},mz.prototype._dispatchZoomAction=function(t){var e=this._range;this.api.dispatchAction({type:"dataZoom",from:this.uid,dataZoomId:this.dataZoomModel.id,animation:t?gz:null,start:e[0],end:e[1]})},mz.prototype._findCoordRect=function(){var t,e,n=vL(this.dataZoomModel).infoList;return(t=!t&&n.length?(e=n[0].model.coordinateSystem).getRect&&e.getRect():t)?t:{x:.2*(n=this.api.getWidth()),y:.2*(e=this.api.getHeight()),width:.6*n,height:.6*e}},mz.type="dataZoom.slider",mz);function vz(t){t.registerComponentModel(hz),t.registerComponentView(_z),UL(t)}function xz(t){Pi(t,"label",["show"])}var bz,Tz=Xi();h(wz,bz=Ld),wz.prototype.init=function(t,e,n){this.mergeDefaultAndTheme(t,n),this._mergeOption(t,n,!1,!0)},wz.prototype.isAnimationEnabled=function(){if(g.node)return!1;var t=this.__hostSeries;return this.getShallow("animation")&&t&&t.isAnimationEnabled()},wz.prototype.mergeOption=function(t,e){this._mergeOption(t,e,!1,!1)},wz.prototype._mergeOption=function(t,e,n,r){var i=this.mainType;n||e.eachSeries((function(t){var n=t.get(this.mainType,!0),o=Tz(t)[i];n&&n.data?(o?o._mergeOption(n,e,!0):(r&&xz(n),F(n.data,(function(t){t instanceof Array?(xz(t[0]),xz(t[1])):xz(t)})),R(o=this.createMarkerModelFromSeries(n,this,e),{mainType:this.mainType,seriesIndex:t.seriesIndex,name:t.name,createdBySelf:!0}),o.__hostSeries=t),Tz(t)[i]=o):Tz(t)[i]=null}),this)},wz.prototype.formatTooltip=function(t,e,n){var r=this.getData(),i=this.getRawValue(t);t=r.getName(t);return Xf("section",{header:this.name,blocks:[Xf("nameValue",{name:t,value:i,noName:!t,noValue:null==i})]})},wz.prototype.getData=function(){return this._data},wz.prototype.setData=function(t){this._data=t},wz.getMarkerModelFromSeries=function(t,e){return Tz(t)[e]},wz.type="marker",wz.dependencies=["series","grid","polar","geo"],Bo=wz;function wz(){var t=null!==bz&&bz.apply(this,arguments)||this;return t.type=wz.type,t.createdBySelf=!1,t}k(Bo,Oo.prototype);var Sz,Mz=Bo;function Az(){var t=null!==Sz&&Sz.apply(this,arguments)||this;return t.type=Az.type,t}var Cz=(h(Az,Sz=Mz),Az.prototype.createMarkerModelFromSeries=function(t,e,n){return new Az(t,e,n)},Az.type="markLine",Az.defaultOption={zlevel:0,z:5,symbol:["circle","arrow"],symbolSize:[8,16],precision:2,tooltip:{trigger:"item"},label:{show:!0,position:"end",distance:5},lineStyle:{type:"dashed"},emphasis:{label:{show:!0},lineStyle:{width:3}},animationEasing:"linear"},Az);function Ez(t,e,n,r,i,o){var a=[],s=Dv(e,r)?e.getCalculationInfo("stackResultDimension"):r;t=Pz(e,s,t),t=e.indicesOfNearest(s,t)[0];return a[i]=e.get(n,t),a[o]=e.get(s,t),s=e.get(r,t),t=pi(e.get(r,t)),0<=(t=Math.min(t,20))&&(a[o]=+a[o].toFixed(t)),[a,s]}var Iz={min:W(Ez,"min"),max:W(Ez,"max"),average:W(Ez,"average"),median:W(Ez,"median")};function Dz(t,e){var n=t.getData(),r=t.coordinateSystem;if(e&&(o=e,isNaN(parseFloat(o.x))||isNaN(parseFloat(o.y)))&&!X(e.coord)&&r){var i=r.dimensions,o=Rz(e,n,r,t);if((e=I(e)).type&&Iz[e.type]&&o.baseAxis&&o.valueAxis)r=P(i,o.baseAxis.dim),t=P(i,o.valueAxis.dim),t=Iz[e.type](n,o.baseDataDim,o.valueDataDim,r,t),e.coord=t[0],e.value=t[1];else{for(var a=[null!=e.xAxis?e.xAxis:e.radiusAxis,null!=e.yAxis?e.yAxis:e.angleAxis],s=0;s<2;s++)Iz[a[s]]&&(a[s]=Pz(n,n.mapDimension(i[s]),a[s]));e.coord=a}}return e}function Rz(t,e,n,r){var i={};return null!=t.valueIndex||null!=t.valueDim?(i.valueDataDim=null!=t.valueIndex?e.getDimension(t.valueIndex):t.valueDim,i.valueAxis=n.getAxis(function(t,e){var n=t.getData(),r=n.dimensions;e=n.getDimension(e);for(var i=0;i<r.length;i++){var o=n.getDimensionInfo(r[i]);if(o.name===e)return o.coordDim}}(r,i.valueDataDim)),i.baseAxis=n.getOtherAxis(i.valueAxis),i.baseDataDim=e.mapDimension(i.baseAxis.dim)):(i.baseAxis=r.getBaseAxis(),i.valueAxis=n.getOtherAxis(i.baseAxis),i.baseDataDim=e.mapDimension(i.baseAxis.dim),i.valueDataDim=e.mapDimension(i.valueAxis.dim)),i}function Lz(t,e){return!(t&&t.containData&&e.coord&&(n=e,isNaN(parseFloat(n.x))&&isNaN(parseFloat(n.y))))||t.containData(e.coord);var n}function Oz(t,e,n,r){return r<2?t.coord&&t.coord[r]:t.value}function Pz(t,e,n){if("average"!==n)return"median"===n?t.getMedian(e):t.getDataExtent(e)["max"===n?1:0];var r=0,i=0;return t.each(e,(function(t,e){isNaN(t)||(r+=t,i++)})),r/i}var Nz,kz,Bz=Vu.prototype,Fz=Zu.prototype,zz=function(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1};function Hz(){return null!==Nz&&Nz.apply(this,arguments)||this}function Vz(t){return isNaN(+t.cpx1)||isNaN(+t.cpy1)}function Uz(t){return t=kz.call(this,t)||this,t.type="ec-line",t}h(Hz,Nz=zz);var Gz,Wz=(h(Uz,kz=rs),Uz.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},Uz.prototype.getDefaultShape=function(){return new zz},Uz.prototype.buildPath=function(t,e){(Vz(e)?Bz:Fz).buildPath.call(this,t,e)},Uz.prototype.pointAt=function(t){return(Vz(this.shape)?Bz:Fz).pointAt.call(this,t)},Uz.prototype.tangentAt=function(t){var e=this.shape;t=Vz(e)?[e.x2-e.x1,e.y2-e.y1]:Fz.tangentAt.call(this,t);return Mt(t,t)},Uz),Xz=["fromSymbol","toSymbol"];function jz(t){return"_"+t+"Type"}function Yz(t,e,n){var r=e.getItemVisual(n,t);if(r&&"none"!==r){var i=e.getItemVisual(n,t+"Size");n=e.getItemVisual(n,t+"Rotate"),i=X(i)?i:[i,i],i=qm(r,-i[0]/2,-i[1]/2,i[0],i[1]);return i.__specifiedRotation=null==n||isNaN(n)?void 0:+n*Math.PI/180||0,i.name=t,i}}function Zz(t,e){t.x1=e[0][0],t.y1=e[0][1],t.x2=e[1][0],t.y2=e[1][1],t.percent=1,e=e[2],e?(t.cpx1=e[0],t.cpy1=e[1]):(t.cpx1=NaN,t.cpy1=NaN)}function qz(t,e,n){var r=Gz.call(this)||this;return r._createLine(t,e,n),r}var Kz=(h(qz,Gz=ei),qz.prototype._createLine=function(t,e,n){var r,i=t.hostModel,o=t.getItemLayout(e);r=o,Zz((o=new Wz({name:"line",subPixelOptimize:!0})).shape,r),o=o;o.shape.percent=0,kh(o,{shape:{percent:1}},i,e),this.add(o),F(Xz,(function(n){var r=Yz(n,t,e);this.add(r),this[jz(n)]=t.getItemVisual(e,n)}),this),this._updateCommonStl(t,e,n)},qz.prototype.updateData=function(t,e,n){var r=t.hostModel,i=this.childOfName("line"),o=t.getItemLayout(e),a={shape:{}};Zz(a.shape,o),Nh(i,a,r,e),F(Xz,(function(n){var r=t.getItemVisual(e,n),i=jz(n);this[i]!==r&&(this.remove(this.childOfName(n)),n=Yz(n,t,e),this.add(n)),this[i]=r}),this),this._updateCommonStl(t,e,n)},qz.prototype.getLinePath=function(){return this.childAt(0)},qz.prototype._updateCommonStl=function(t,e,n){var r=t.hostModel,i=this.childOfName("line"),o=n&&n.emphasisLineStyle,a=n&&n.blurLineStyle,s=n&&n.selectLineStyle,l=n&&n.labelStatesModels;n&&!t.hasItemOption||(o=(n=t.getItemModel(e)).getModel(["emphasis","lineStyle"]).getLineStyle(),a=n.getModel(["blur","lineStyle"]).getLineStyle(),s=n.getModel(["select","lineStyle"]).getLineStyle(),l=ec(n));var u=t.getItemVisual(e,"style"),h=u.stroke;i.useStyle(u),i.style.fill=null,i.style.strokeNoScale=!0,i.ensureState("emphasis").style=o,i.ensureState("blur").style=a,i.ensureState("select").style=s,F(Xz,(function(t){var e=this.childOfName(t);if(e){e.setColor(h),e.style.opacity=u.opacity;for(var n=0;n<Vs.length;n++){var r=Vs[n],o=i.getState(r);o&&(o=o.style||{},r=(r=e.ensureState(r)).style||(r.style={}),null!=o.stroke&&(r[e.__isEmptyBrush?"stroke":"fill"]=o.stroke),null!=o.opacity&&(r.opacity=o.opacity))}e.markRedraw()}}),this),s=r.getRawValue(e),tc(this,l,{labelDataIndex:e,labelFetcher:{getFormattedLabel:function(e,n){return r.getFormattedLabel(e,n,t.dataType)}},inheritColor:h||"#000",defaultOpacity:u.opacity,defaultText:(null==s?t.getName(e):isFinite(s)?ci(s):s)+""}),s=this.getTextContent(),s&&(l=l.normal,s.__align=s.style.align,s.__verticalAlign=s.style.verticalAlign,s.__position=l.get("position")||"middle",X(l=l.get("distance"))||(l=[l,l]),s.__labelDistance=l),this.setTextConfig({position:null,local:!0,inside:!1}),bl(this)},qz.prototype.highlight=function(){dl(this)},qz.prototype.downplay=function(){pl(this)},qz.prototype.updateLayout=function(t,e){this.setLinePoints(t.getItemLayout(e))},qz.prototype.setLinePoints=function(t){var e=this.childOfName("line");Zz(e.shape,t),e.dirty()},qz.prototype.beforeUpdate=function(){var t=this.childOfName("fromSymbol"),e=this.childOfName("toSymbol"),n=this.getTextContent();if(t||e||n&&!n.ignore){for(var r=1,i=this.parent;i;)i.scaleX&&(r/=i.scaleX),i=i.parent;var o=this.childOfName("line");if(this.__dirty||o.__dirty){var a=o.shape.percent,s=o.pointAt(0),l=o.pointAt(a),u=bt([],l,s);if(Mt(u,u),t&&(t.setPosition(s),_(t,0),t.scaleX=t.scaleY=r*a,t.markRedraw()),e&&(e.setPosition(l),_(e,1),e.scaleX=e.scaleY=r*a,e.markRedraw()),n&&!n.ignore){n.x=n.y=0;var h=void(n.originX=n.originY=0),c=void 0,d=(e=n.__labelDistance,e[0]*r),p=e[1]*r,f=(e=a/2,o.tangentAt(e)),g=(a=[f[1],-f[0]],o.pointAt(e));0<a[1]&&(a[0]=-a[0],a[1]=-a[1]);var m=f[0]<0?-1:1;"start"!==n.__position&&"end"!==n.__position&&(a=-Math.atan2(f[1],f[0]),l[0]<s[0]&&(a=Math.PI+a),n.rotation=a);var y=void 0;switch(n.__position){case"insideStartTop":case"insideMiddleTop":case"insideEndTop":case"middle":y=-p,c="bottom";break;case"insideStartBottom":case"insideMiddleBottom":case"insideEndBottom":y=p,c="top";break;default:y=0,c="middle"}switch(n.__position){case"end":n.x=u[0]*d+l[0],n.y=u[1]*p+l[1],h=.8<u[0]?"left":u[0]<-.8?"right":"center",c=.8<u[1]?"top":u[1]<-.8?"bottom":"middle";break;case"start":n.x=-u[0]*d+s[0],n.y=-u[1]*p+s[1],h=.8<u[0]?"right":u[0]<-.8?"left":"center",c=.8<u[1]?"bottom":u[1]<-.8?"top":"middle";break;case"insideStartTop":case"insideStart":case"insideStartBottom":n.x=d*m+s[0],n.y=s[1]+y,h=f[0]<0?"right":"left",n.originX=-d*m,n.originY=-y;break;case"insideMiddleTop":case"insideMiddle":case"insideMiddleBottom":case"middle":n.x=g[0],n.y=g[1]+y,h="center",n.originY=-y;break;case"insideEndTop":case"insideEnd":case"insideEndBottom":n.x=-d*m+l[0],n.y=l[1]+y,h=0<=f[0]?"right":"left",n.originX=d*m,n.originY=-y}n.scaleX=n.scaleY=r,n.setStyle({verticalAlign:n.__verticalAlign||c,align:n.__align||h})}}}function _(t,e){var n,r=t.__specifiedRotation;null==r?(n=o.tangentAt(e),t.attr("rotation",(1===e?-1:1)*Math.PI/2-Math.atan2(n[1],n[0]))):t.attr("rotation",r)}},qz);function Qz(t){this.group=new ei,this._LineCtor=t||Kz}function Jz(t){return t=t.hostModel,{lineStyle:t.getModel("lineStyle").getLineStyle(),emphasisLineStyle:t.getModel(["emphasis","lineStyle"]).getLineStyle(),blurLineStyle:t.getModel(["blur","lineStyle"]).getLineStyle(),selectLineStyle:t.getModel(["select","lineStyle"]).getLineStyle(),labelStatesModels:ec(t)}}function $z(t){return isNaN(t[0])||isNaN(t[1])}function tH(t){return!$z(t[0])&&!$z(t[1])}var eH,nH=(Qz.prototype.isPersistent=function(){return!0},Qz.prototype.updateData=function(t){var e=this,n=this.group,r=this._lineData;this._lineData=t,r||n.removeAll();var i=Jz(t);t.diff(r).add((function(n){e._doAdd(t,n,i)})).update((function(n,o){e._doUpdate(r,t,o,n,i)})).remove((function(t){n.remove(r.getItemGraphicEl(t))})).execute()},Qz.prototype.updateLayout=function(){var t=this._lineData;t&&t.eachItemGraphicEl((function(e,n){e.updateLayout(t,n)}),this)},Qz.prototype.incrementalPrepareUpdate=function(t){this._seriesScope=Jz(t),this._lineData=null,this.group.removeAll()},Qz.prototype.incrementalUpdate=function(t,e){function n(t){var e;t.isGroup||(e=t).animators&&0<e.animators.length||(t.incremental=!0,t.ensureState("emphasis").hoverLayer=!0)}for(var r,i=t.start;i<t.end;i++)tH(e.getItemLayout(i))&&((r=new this._LineCtor(e,i,this._seriesScope)).traverse(n),this.group.add(r),e.setItemGraphicEl(i,r))},Qz.prototype.remove=function(){this.group.removeAll()},Qz.prototype._doAdd=function(t,e,n){tH(t.getItemLayout(e))&&(n=new this._LineCtor(t,e,n),t.setItemGraphicEl(e,n),this.group.add(n))},Qz.prototype._doUpdate=function(t,e,n,r,i){n=t.getItemGraphicEl(n),tH(e.getItemLayout(r))?(n?n.updateData(e,r,i):n=new this._LineCtor(e,r,i),e.setItemGraphicEl(r,n),this.group.add(n)):this.group.remove(n)},Qz),rH=Xi();function iH(){var t=null!==eH&&eH.apply(this,arguments)||this;return t.type=iH.type,t}function oH(t,e,n,r){var i,o,a,s=t.getData(),l=[Dz(t,(l=X(r)?r:"min"===(i=r.type)||"max"===i||"average"===i||"median"===i||null!=r.xAxis||null!=r.yAxis?(l=o=void 0,l=null!=r.yAxis||null!=r.xAxis?(o=e.getAxis(null!=r.yAxis?"y":"x"),et(r.yAxis,r.xAxis)):(o=(a=Rz(r,s,e,t)).valueAxis,Pz(s,Rv(s,a.valueDataDim),i)),s=1-(e="x"===o.dim?0:1),a={coord:[]},(o=I(r)).type=null,o.coord=[],o.coord[s]=-1/0,a.coord[s]=1/0,0<=(n=n.get("precision"))&&"number"==typeof l&&(l=+l.toFixed(Math.min(n,20))),o.coord[e]=a.coord[e]=l,[o,a,{type:i,valueIndex:r.valueIndex,value:l}]):[])[0]),Dz(t,l[1]),R({},l[2])];return l[2].type=l[2].type||null,D(l[2],l[0]),D(l[2],l[1]),l}h(iH,eH=gg),iH.prototype.init=function(){this.markerGroupMap=pt()},iH.prototype.render=function(t,e,n){var r=this,i=this.markerGroupMap;i.each((function(t){rH(t).keep=!1})),e.eachSeries((function(t){var i=Mz.getMarkerModelFromSeries(t,r.type);i&&r.renderSeries(t,i,e,n)})),i.each((function(t){rH(t).keep||r.group.remove(t.group)}))},iH.prototype.markKeep=function(t){rH(t).keep=!0},iH.prototype.blurSeries=function(t){var e=this;F(t,(function(t){t=Mz.getMarkerModelFromSeries(t,e.type),t&&t.getData().eachItemGraphicEl((function(t){t&&fl(t)}))}))},iH.type="marker",M=iH;var aH,sH=Xi();function lH(t){return!isNaN(t)&&!isFinite(t)}function uH(t,e,n,r){var i=1-t,o=r.dimensions[t];return lH(e[i])&&lH(n[i])&&e[t]===n[t]&&r.getAxis(o).containData(e[t])}function hH(t,e){if("cartesian2d"===t.type){var n=e[0].coord,r=e[1].coord;if(n&&r&&(uH(1,n,r,t)||uH(0,n,r,t)))return!0}return Lz(t,e[0])&&Lz(t,e[1])}function cH(t,e,n,r,i){var o,a,s,l,u=r.coordinateSystem,h=t.getItemModel(e),c=hi(h.get("x"),i.getWidth());i=hi(h.get("y"),i.getHeight());isNaN(c)||isNaN(i)?(o=r.getMarkerPosition?r.getMarkerPosition(t.getValues(t.dimensions,e)):(l=u.dimensions,a=t.get(l[0],e),s=t.get(l[1],e),u.dataToPoint([a,s])),nD(u,"cartesian2d")&&(a=u.getAxis("x"),s=u.getAxis("y"),l=u.dimensions,lH(t.get(l[0],e))?o[0]=a.toGlobalCoord(a.getExtent()[n?0:1]):lH(t.get(l[1],e))&&(o[1]=s.toGlobalCoord(s.getExtent()[n?0:1]))),isNaN(c)||(o[0]=c),isNaN(i)||(o[1]=i)):o=[c,i],t.setItemLayout(e,o)}function dH(){var t=null!==aH&&aH.apply(this,arguments)||this;return t.type=dH.type,t}var pH,fH=(h(dH,aH=M),dH.prototype.updateTransform=function(t,e,n){e.eachSeries((function(t){var e,r,i,o=Mz.getMarkerModelFromSeries(t,"markLine");o&&(e=o.getData(),r=sH(o).from,i=sH(o).to,r.each((function(e){cH(r,e,!0,t,n),cH(i,e,!1,t,n)})),e.each((function(t){e.setItemLayout(t,[r.getItemLayout(t),i.getItemLayout(t)])})),this.markerGroupMap.get(t.id).updateLayout())}),this)},dH.prototype.renderSeries=function(t,e,n,r){var i=t.coordinateSystem,o=t.id,a=t.getData(),s=this.markerGroupMap;o=s.get(o)||s.set(o,new nH);this.group.add(o.group);i=function(t,e,n){o=t?z(t&&t.dimensions,(function(t){return L({name:t},e.getData().getDimensionInfo(e.getData().mapDimension(t))||{})})):[{name:"value",type:"float"}];var r=new Tv(o,n),i=new Tv(o,n),o=new Tv([],n);n=z(n.get("data"),W(oH,e,t,n));return t&&(n=V(n,W(hH,t))),t=t?Oz:function(t){return t.value},r.initData(z(n,(function(t){return t[0]})),null,t),i.initData(z(n,(function(t){return t[1]})),null,t),o.initData(z(n,(function(t){return t[2]}))),o.hasItemOption=!0,{from:r,to:i,line:o}}(i,t,e);var l=i.from,u=i.to,h=i.line;sH(e).from=l,sH(e).to=u,e.setData(h);var c=e.get("symbol"),d=e.get("symbolSize");function p(e,n,i){var o=e.getItemModel(n);cH(e,n,i,t,r);var s=o.getModel("itemStyle").getItemStyle();null==s.fill&&(s.fill=sm(a,"color")),e.setItemVisual(n,{symbolRotate:o.get("symbolRotate"),symbolSize:o.get("symbolSize")||d[i?0:1],symbol:o.get("symbol",!0)||c[i?0:1],style:s})}X(c)||(c=[c,c]),X(d)||(d=[d,d]),i.from.each((function(t){p(l,t,!0),p(u,t,!1)})),h.each((function(t){var e=h.getItemModel(t).getModel("lineStyle").getLineStyle();h.setItemLayout(t,[l.getItemLayout(t),u.getItemLayout(t)]),null==e.stroke&&(e.stroke=l.getItemVisual(t,"style").fill),h.setItemVisual(t,{fromSymbolRotate:l.getItemVisual(t,"symbolRotate"),fromSymbolSize:l.getItemVisual(t,"symbolSize"),fromSymbol:l.getItemVisual(t,"symbol"),toSymbolRotate:u.getItemVisual(t,"symbolRotate"),toSymbolSize:u.getItemVisual(t,"symbolSize"),toSymbol:u.getItemVisual(t,"symbol"),style:e})})),o.updateData(h),i.line.eachItemGraphicEl((function(t,n){t.traverse((function(t){Ps(t).dataModel=e}))})),this.markKeep(o),o.group.silent=e.get("silent")||t.get("silent")},dH.type="markLine",dH);function gH(){var t=null!==pH&&pH.apply(this,arguments)||this;return t.type=gH.type,t}var mH,yH=(h(gH,pH=Mz),gH.prototype.createMarkerModelFromSeries=function(t,e,n){return new gH(t,e,n)},gH.type="markPoint",gH.defaultOption={zlevel:0,z:5,symbol:"pin",symbolSize:50,tooltip:{trigger:"item"},label:{show:!0,position:"inside"},itemStyle:{borderWidth:2},emphasis:{label:{show:!0}}},gH);function _H(t,e,n){var r=e.coordinateSystem;t.each((function(i){var o,a,s=t.getItemModel(i),l=hi(s.get("x"),n.getWidth()),u=hi(s.get("y"),n.getHeight());isNaN(l)||isNaN(u)?e.getMarkerPosition?a=e.getMarkerPosition(t.getValues(t.dimensions,i)):r&&(o=t.get(r.dimensions[0],i),s=t.get(r.dimensions[1],i),a=r.dataToPoint([o,s])):a=[l,u],isNaN(l)||(a[0]=l),isNaN(u)||(a[1]=u),t.setItemLayout(i,a)}))}function vH(){var t=null!==mH&&mH.apply(this,arguments)||this;return t.type=vH.type,t}var xH=(h(vH,mH=M),vH.prototype.updateTransform=function(t,e,n){e.eachSeries((function(t){var e=Mz.getMarkerModelFromSeries(t,"markPoint");e&&(_H(e.getData(),t,n),this.markerGroupMap.get(t.id).updateLayout())}),this)},vH.prototype.renderSeries=function(t,e,n,r){var i=t.coordinateSystem,o=t.id,a=t.getData(),s=this.markerGroupMap,l=(o=s.get(o)||s.set(o,new kD),function(t,e,n){r=t?z(t&&t.dimensions,(function(t){return L({name:t},e.getData().getDimensionInfo(e.getData().mapDimension(t))||{})})):[{name:"value",type:"float"}];var r=new Tv(r,n);n=z(n.get("data"),W(Dz,e));return t&&(n=V(n,W(Lz,t))),r.initData(n,null,t?Oz:function(t){return t.value}),r}(i,t,e));e.setData(l),_H(e.getData(),t,r),l.each((function(t){var n,r=l.getItemModel(t),i=r.getShallow("symbol"),o=r.getShallow("symbolSize"),s=r.getShallow("symbolRotate");(j(i)||j(o)||j(s))&&(n=e.getRawValue(t),u=e.getDataParams(t),j(i)&&(i=i(n,u)),j(o)&&(o=o(n,u)),j(s)&&(s=s(n,u)));var u=r.getModel("itemStyle").getItemStyle();r=sm(a,"color");u.fill||(u.fill=r),l.setItemVisual(t,{symbol:i,symbolSize:o,symbolRotate:s,style:u})})),o.updateData(l),this.group.add(o.group),l.eachItemGraphicEl((function(t){t.traverse((function(t){Ps(t).dataModel=e}))})),this.markKeep(o),o.group.silent=e.get("silent")||t.get("silent")},vH.type="markPoint",vH),bH=n("72dd"),TH=null,wH=null;function SH(t,e){void 0===e&&(e={});var n=document.createElement(t);return Object.keys(e).forEach((function(t){n[t]=e[t]})),n}function MH(t,e,n){return(window.getComputedStyle(t,n||null)||{display:"none"})[e]}function AH(t){if(!document.documentElement.contains(t))return{detached:!0,rendered:!1};for(var e=t;e!==document;){if("none"===MH(e,"display"))return{detached:!1,rendered:!1};e=e.parentNode}return{detached:!1,rendered:!0}}var CH=0,EH=null;function IH(t,e){var n,r,i,o,a,s;t.__resize_mutation_handler__||(t.__resize_mutation_handler__=function(){var t=AH(this),e=t.rendered;t=t.detached;e!==this.__resize_rendered__&&(!t&&this.__resize_triggers__&&(LH(this),this.addEventListener("scroll",DH,!0)),this.__resize_rendered__=e,RH(this))}.bind(t)),t.__resize_listeners__||(t.__resize_listeners__=[],window.ResizeObserver?(n=t.offsetWidth,r=t.offsetHeight,a=new ResizeObserver((function(){!t.__resize_observer_triggered__&&(t.__resize_observer_triggered__=!0,t.offsetWidth===n&&t.offsetHeight===r)||RH(t)})),i=(o=AH(t)).detached,o=o.rendered,t.__resize_observer_triggered__=!1===i&&!1===o,(t.__resize_observer__=a).observe(t)):t.attachEvent&&t.addEventListener?(t.__resize_legacy_resize_handler__=function(){RH(t)},t.attachEvent("onresize",t.__resize_legacy_resize_handler__),document.addEventListener("DOMSubtreeModified",t.__resize_mutation_handler__)):(CH||(a='.resize-triggers{visibility:hidden;opacity:0;pointer-events:none}.resize-contract-trigger,.resize-contract-trigger:before,.resize-expand-trigger,.resize-triggers{content:"";position:absolute;top:0;left:0;height:100%;width:100%;overflow:hidden}.resize-contract-trigger,.resize-expand-trigger{background:#eee;overflow:auto}.resize-contract-trigger:before{width:200%;height:200%}',(s=document.createElement("style")).styleSheet?s.styleSheet.cssText=a:s.appendChild(document.createTextNode(a)),(document.querySelector("head")||document.body).appendChild(s),EH=s),function(t){var e=MH(t,"position");e&&"static"!==e||(t.style.position="relative"),t.__resize_old_position__=e,t.__resize_last__={};var n=SH("div",{className:"resize-triggers"}),r=SH("div",{className:"resize-expand-trigger"}),i=SH("div");e=SH("div",{className:"resize-contract-trigger"});r.appendChild(i),n.appendChild(r),n.appendChild(e),t.appendChild(n),t.__resize_triggers__={triggers:n,expand:r,expandChild:i,contract:e},LH(t),t.addEventListener("scroll",DH,!0),t.__resize_last__={width:t.offsetWidth,height:t.offsetHeight}}(t),t.__resize_rendered__=AH(t).rendered,window.MutationObserver&&((s=new MutationObserver(t.__resize_mutation_handler__)).observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0}),t.__resize_mutation_observer__=s))),t.__resize_listeners__.push(e),CH++}function DH(){var t,e=this;LH(this),this.__resize_raf__&&(t=this.__resize_raf__,(wH=wH||(window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)}).bind(window))(t)),this.__resize_raf__=(t=function(){var t,n,r,i=(t=(r=(i=e).__resize_last__).width,n=r.height,r=i.offsetWidth,i=i.offsetHeight,r!==t||i!==n?{width:r,height:i}:null);i&&(e.__resize_last__=i,RH(e))},(TH=TH||(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){return setTimeout(t,16)}).bind(window))(t))}function RH(t){t&&t.__resize_listeners__&&t.__resize_listeners__.forEach((function(e){e.call(t,t)}))}function LH(t){var e=t.__resize_triggers__,n=e.expand,r=e.expandChild,i=e.contract,o=i.scrollWidth,a=i.scrollHeight,s=n.offsetWidth,l=n.offsetHeight;t=n.scrollWidth,e=n.scrollHeight;i.scrollLeft=o,i.scrollTop=a,r.style.width=s+1+"px",r.style.height=l+1+"px",n.scrollLeft=t,n.scrollTop=e}var OH=function(){return(OH=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},PH=["getWidth","getHeight","getDom","getOption","resize","dispatchAction","convertToPixel","convertFromPixel","containPixel","getDataURL","getConnectedDataURL","appendData","clear","isDisposed","dispose"];function NH(t,e){return n=Object.create(null),PH.forEach((function(r){var i;n[r]=(i=r,function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(t.value||e(),!t.value)throw new Error("ECharts is not initialized yet.");return t.value[i].apply(t.value,n)})})),n;var n}var kH,BH,FH,zH;pA={autoresize:Boolean},wu={loading:Boolean,loadingOptions:Object},f=[],Oo=[];function HH(){var t=document.createElement("style");if(t.setAttribute("type","text/css"),kH.attributes)for(var e=Object.keys(kH.attributes),n=0;n<e.length;n++)t.setAttribute(e[n],kH.attributes[e[n]]);return FH.insertAdjacentElement("prepend"==BH?"afterbegin":"beforeend",t),t}kH={},(Bo="x-vue-echarts{display:block;width:100%;height:100%}")&&"undefined"!=typeof document&&(BH=!0===kH.prepend?"prepend":"append",M=!0===kH.singleTag,FH="string"==typeof kH.container?document.querySelector(kH.container):document.getElementsByTagName("head")[0],zH=M?(-1===(zH=f.indexOf(FH))&&(zH=f.push(FH)-1,Oo[zH]={}),Oo[zH]&&Oo[zH][BH]?Oo[zH][BH]:Oo[zH][BH]=HH()):HH(),65279===Bo.charCodeAt(0)&&(Bo=Bo.substring(1)),zH.styleSheet?zH.styleSheet.cssText+=Bo:zH.appendChild(document.createTextNode(Bo)));var VH=/^on[^a-z]/;bH.Vue2&&bH.Vue2.config.ignoredElements.push("x-vue-echarts");var UH=Object(bH.defineComponent)({name:"echarts",props:OH(OH({option:Object,theme:{type:[Object,String]},initOptions:Object,updateOptions:Object,group:String,manualUpdate:Boolean},pA),wu),inheritAttrs:!1,setup:function(t,e){var n=e.attrs,r=e.listeners,i=Object(bH.shallowRef)(),o=Object(bH.shallowRef)(),a=Object(bH.shallowRef)(),s=Object(bH.inject)("ecTheme",null),l=Object(bH.inject)("ecInitOptions",null),u=Object(bH.inject)("ecUpdateOptions",null),h=Object(bH.toRefs)(t),c=h.autoresize,d=h.manualUpdate,p=h.loading,f=h.loadingOptions,g=Object(bH.computed)((function(){return a.value||t.option||Object.create(null)})),m=Object(bH.computed)((function(){return t.theme||Object(bH.unref)(s)||{}})),y=Object(bH.computed)((function(){return t.initOptions||Object(bH.unref)(l)||{}})),_=Object(bH.computed)((function(){return t.updateOptions||Object(bH.unref)(u)||{}}));e=Object(bH.computed)((function(){return function(t){var e,n,r={};for(e in t)n=e,VH.test(n)||(r[e]=t[e]);return r}(n)}));function v(e){var a,s;function l(){a.setOption(e||g.value,_.value)}!o.value&&i.value&&(a=o.value=E_(i.value,m.value,y.value),t.group&&(a.group=t.group),(s=r)||(s={},Object.keys(n).filter((function(t){return 0===t.indexOf("on")&&2<t.length})).forEach((function(t){var e=t.charAt(2).toLowerCase()+t.slice(3);s[e]=n[t]}))),Object.keys(s).forEach((function(t){var e=s[t];e&&(0===t.indexOf("zr:")?a.getZr().on(t.slice(3).toLowerCase(),e):a.on(t.toLowerCase(),e))})),c.value?Object(bH.nextTick)((function(){!function(){if(a&&!a.isDisposed())try{a.resize()}catch(e){if("Cannot read property 'get' of undefined"===e.message)return;throw e}}(),l()})):l())}function x(){o.value&&(o.value.dispose(),o.value=void 0)}var b=null;Object(bH.watch)(d,(function(e){"function"==typeof b&&(b(),b=null),e||(b=Object(bH.watch)((function(){return t.option}),(function(t){t&&(o.value?o.value.setOption(t,_.value):v())}),{deep:!0}))}),{immediate:!0}),Object(bH.watch)([m,y],(function(){x(),v()}),{deep:!0}),Object(bH.watchEffect)((function(){t.group&&o.value&&(o.value.group=t.group)}));var T,w,S,M,A,C;h=NH(o,v);return w=o,S=p,M=f,A=Object(bH.inject)("ecLoadingOptions",{}),C=Object(bH.computed)((function(){return OH(OH({},Object(bH.unref)(A)),null==M?void 0:M.value)})),Object(bH.watchEffect)((function(){var t=w.value;t&&(S.value?t.showLoading(C.value):t.hideLoading())})),d=o,p=c,f=i,T=null,Object(bH.watch)([f,d,p],(function(t,e,n){var r=t[0],i=t[1];t=t[2];r&&i&&t&&(T=Ig((function(){i.resize()}),100),IH(r,T)),n((function(){T&&r&&function(t,e){var n=t.__resize_listeners__;if(n){if(e&&n.splice(n.indexOf(e),1),!n.length||!e){if(t.detachEvent&&t.removeEventListener)return t.detachEvent("onresize",t.__resize_legacy_resize_handler__),document.removeEventListener("DOMSubtreeModified",t.__resize_mutation_handler__);t.__resize_observer__?(t.__resize_observer__.unobserve(t),t.__resize_observer__.disconnect(),t.__resize_observer__=null):(t.__resize_mutation_observer__&&(t.__resize_mutation_observer__.disconnect(),t.__resize_mutation_observer__=null),t.removeEventListener("scroll",DH),t.removeChild(t.__resize_triggers__.triggers),t.__resize_triggers__=null),t.__resize_listeners__=null}!--CH&&EH&&EH.parentNode.removeChild(EH)}}(r,T)}))})),Object(bH.onMounted)((function(){t.option&&v()})),Object(bH.onUnmounted)(x),OH({chart:o,root:i,setOption:function(e,n){t.manualUpdate&&(a.value=e),o.value?o.value.setOption(e,n||{}):v(e)},nonEventAttrs:e},h)},render:function(){var t=OH({},this.nonEventAttrs);return t.ref="root",t.class=t.class?["echarts"].concat(t.class):"echarts",Object(bH.h)("x-vue-echarts",t)}});n=n("abc5");U_([vb,function(t){U_(HI),t.registerChartView(mI),t.registerSeriesModel(vI),t.registerLayout(bI),t.registerProcessor(t.PRIORITY.PROCESSOR.STATISTIC,xI),Hm("map",t.registerAction)},function(t){t.registerChartView(MD),t.registerSeriesModel(ZI),t.registerLayout(t.PRIORITY.VISUAL.LAYOUT,W(ax,"bar")),t.registerLayout(t.PRIORITY.VISUAL.PROGRESSIVE_LAYOUT,sx),t.registerVisual({seriesType:"bar",reset:function(t){t.getData().setVisual("legendSymbol","roundRect")}}),t.registerProcessor(t.PRIORITY.PROCESSOR.STATISTIC,GI("bar")),t.registerAction({type:"changeAxisOrder",event:"changeAxisOrder",update:"update"},(function(t,e){var n=t.componentType||"series";e.eachComponent({mainType:n,query:t},(function(e){t.sortInfo&&e.axis.setCategorySortInfo(t.sortInfo)}))}))},function(t){var e;t.registerChartView(pR),t.registerSeriesModel(ED),t.registerLayout((e=!0,{seriesType:"line",plan:mg(),reset:function(t){var n=t.getData(),r=t.coordinateSystem,i=t.pipelineContext,o=e||i.large;if(r){t=z(r.dimensions,(function(t){return n.mapDimension(t)})).slice(0,2);var a=t.length;i=n.getCalculationInfo("stackResultDimension");Dv(n,t[0])&&(t[0]=i),Dv(n,t[1])&&(t[1]=i);i=n.getDimensionInfo(t[0]),t=n.getDimensionInfo(t[1]);var s=i&&i.index,l=t&&t.index;return a&&{progress:function(t,e){for(var n=t.end-t.start,i=o&&VD(n*a),u=[],h=[],c=t.start,d=0;c<t.end;c++){var p,f=void 0;f=1===a?(p=e.getByDimIdx(s,c),r.dataToPoint(p,null,h)):(u[0]=e.getByDimIdx(s,c),u[1]=e.getByDimIdx(l,c),r.dataToPoint(u,null,h)),o?(i[d++]=f[0],i[d++]=f[1]):e.setItemLayout(c,f.slice())}o&&e.setLayout("points",i)}}}}})),t.registerProcessor(t.PRIORITY.PROCESSOR.STATISTIC,GI("line"))},function(t){t.registerChartView(CR),t.registerSeriesModel(OR),Hm("pie",t.registerAction),t.registerLayout(W(mR,"pie")),t.registerProcessor({seriesType:"pie",reset:function(t,e){var n,r=e.findComponents({mainType:"legend"});r&&r.length&&(n=t.getData()).filterSelf((function(t){for(var e=n.getName(t),i=0;i<r.length;i++)if(!r[i].isSelected(e))return!1;return!0}))}})},function(t){t.registerComponentModel(hL),t.registerComponentView(pL)},function(t){t.registerComponentModel(QL),t.registerComponentView(eO),YL("saveAsImage",iO),YL("magicType",uO),YL("dataView",_O),YL("dataZoom",HP),YL("restore",MO),U_(GL)},function(t){U_(jN),t.registerComponentModel(ZN),t.registerComponentView(gk),t.registerAction({type:"showTip",event:"showTip",update:"tooltip:manuallyShowTip"},(function(){})),t.registerAction({type:"hideTip",event:"hideTip",update:"tooltip:manuallyHideTip"},(function(){}))},function(t){U_(bB),U_(RB)},HI,function(t){U_(_F),U_(jN)},function(t){U_(NF),U_(jF)},function(t){U_(sz),U_(vz)},function(t){t.registerComponentModel(Cz),t.registerComponentView(fH),t.registerPreprocessor((function(t){t.markLine=t.markLine||{}}))},function(t){t.registerComponentModel(yH),t.registerComponentView(xH),t.registerPreprocessor((function(t){t.markPoint=t.markPoint||{}}))},function(t){t.registerChartView(qR),t.registerSeriesModel($R),t.registerPreprocessor(tL),t.registerVisual(oL),t.registerLayout(uL)},function(t){t.registerComponentModel(PA),t.registerComponentView(tC),t.registerCoordinateSystem("globe",yE),t.registerAction({type:"globeChangeCamera",event:"globecamerachanged",update:"series:updateCamera"},(function(t,e){e.eachComponent({mainType:"globe",query:t},(function(e){e.setView(t)}))})),t.registerAction({type:"globeUpdateDisplacment",event:"globedisplacementupdated",update:"update"},(function(t,e){}))}]),D_("customize1",n);var GH=UH}}]);